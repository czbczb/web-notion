import{t as wE,b as ox,i as Md,c as xc,d as LE,m as ax,e as Id,f as Od,g as Rc,h as UE,j as kE,k as sx,l as ux,n as lx,o as cx,p as fx,q as hx,v as dx,w as zE,x as px,y as _x,z as vx,A as mx,B as gx,C as Ex,D as yx,E as Ax,F as Tx,G as Sx,H as xx,I as Rx,J as Cx,K as bx,L as Mx,M as Ix,N as Ox,O as Px,P as Nx,Q as sl}from"./index.9e8b6c69.js";import{S as E,Y as he,T as pe,Z as $n,P as Pd,R as Dn,W as VE,V as HE,r as Fx,aa as Dx,k as Bx,o as Lx}from"./antdv.415263d7.js";const vi=11102230246251565e-32,$r=134217729,Ux=(3+8*vi)*vi;function Xf(e,t,r,n,i){let o,a,s,u,l=t[0],f=n[0],c=0,h=0;f>l==f>-l?(o=l,l=t[++c]):(o=f,f=n[++h]);let d=0;if(c<e&&h<r)for(f>l==f>-l?(a=l+o,s=o-(a-l),l=t[++c]):(a=f+o,s=o-(a-f),f=n[++h]),o=a,s!==0&&(i[d++]=s);c<e&&h<r;)f>l==f>-l?(a=o+l,u=a-o,s=o-(a-u)+(l-u),l=t[++c]):(a=o+f,u=a-o,s=o-(a-u)+(f-u),f=n[++h]),o=a,s!==0&&(i[d++]=s);for(;c<e;)a=o+l,u=a-o,s=o-(a-u)+(l-u),l=t[++c],o=a,s!==0&&(i[d++]=s);for(;h<r;)a=o+f,u=a-o,s=o-(a-u)+(f-u),f=n[++h],o=a,s!==0&&(i[d++]=s);return(o!==0||d===0)&&(i[d++]=o),d}function kx(e,t){let r=t[0];for(let n=1;n<e;n++)r+=t[n];return r}function mu(e){return new Float64Array(e)}const zx=(3+16*vi)*vi,Vx=(2+12*vi)*vi,Hx=(9+64*vi)*vi*vi,Qo=mu(4),_0=mu(8),v0=mu(12),m0=mu(16),Jr=mu(4);function Xx(e,t,r,n,i,o,a){let s,u,l,f,c,h,d,p,v,m,y,A,T,R,b,H,B,q;const Ee=e-i,Z=r-i,k=t-o,$=n-o;R=Ee*$,h=$r*Ee,d=h-(h-Ee),p=Ee-d,h=$r*$,v=h-(h-$),m=$-v,b=p*m-(R-d*v-p*v-d*m),H=k*Z,h=$r*k,d=h-(h-k),p=k-d,h=$r*Z,v=h-(h-Z),m=Z-v,B=p*m-(H-d*v-p*v-d*m),y=b-B,c=b-y,Qo[0]=b-(y+c)+(c-B),A=R+y,c=A-R,T=R-(A-c)+(y-c),y=T-H,c=T-y,Qo[1]=T-(y+c)+(c-H),q=A+y,c=q-A,Qo[2]=A-(q-c)+(y-c),Qo[3]=q;let K=kx(4,Qo),ce=Vx*a;if(K>=ce||-K>=ce||(c=e-Ee,s=e-(Ee+c)+(c-i),c=r-Z,l=r-(Z+c)+(c-i),c=t-k,u=t-(k+c)+(c-o),c=n-$,f=n-($+c)+(c-o),s===0&&u===0&&l===0&&f===0)||(ce=Hx*a+Ux*Math.abs(K),K+=Ee*f+$*s-(k*l+Z*u),K>=ce||-K>=ce))return K;R=s*$,h=$r*s,d=h-(h-s),p=s-d,h=$r*$,v=h-(h-$),m=$-v,b=p*m-(R-d*v-p*v-d*m),H=u*Z,h=$r*u,d=h-(h-u),p=u-d,h=$r*Z,v=h-(h-Z),m=Z-v,B=p*m-(H-d*v-p*v-d*m),y=b-B,c=b-y,Jr[0]=b-(y+c)+(c-B),A=R+y,c=A-R,T=R-(A-c)+(y-c),y=T-H,c=T-y,Jr[1]=T-(y+c)+(c-H),q=A+y,c=q-A,Jr[2]=A-(q-c)+(y-c),Jr[3]=q;const Ne=Xf(4,Qo,4,Jr,_0);R=Ee*f,h=$r*Ee,d=h-(h-Ee),p=Ee-d,h=$r*f,v=h-(h-f),m=f-v,b=p*m-(R-d*v-p*v-d*m),H=k*l,h=$r*k,d=h-(h-k),p=k-d,h=$r*l,v=h-(h-l),m=l-v,B=p*m-(H-d*v-p*v-d*m),y=b-B,c=b-y,Jr[0]=b-(y+c)+(c-B),A=R+y,c=A-R,T=R-(A-c)+(y-c),y=T-H,c=T-y,Jr[1]=T-(y+c)+(c-H),q=A+y,c=q-A,Jr[2]=A-(q-c)+(y-c),Jr[3]=q;const je=Xf(Ne,_0,4,Jr,v0);R=s*f,h=$r*s,d=h-(h-s),p=s-d,h=$r*f,v=h-(h-f),m=f-v,b=p*m-(R-d*v-p*v-d*m),H=u*l,h=$r*u,d=h-(h-u),p=u-d,h=$r*l,v=h-(h-l),m=l-v,B=p*m-(H-d*v-p*v-d*m),y=b-B,c=b-y,Jr[0]=b-(y+c)+(c-B),A=R+y,c=A-R,T=R-(A-c)+(y-c),y=T-H,c=T-y,Jr[1]=T-(y+c)+(c-H),q=A+y,c=q-A,Jr[2]=A-(q-c)+(y-c),Jr[3]=q;const Je=Xf(je,v0,4,Jr,m0);return m0[Je-1]}function Wx(e,t,r,n,i,o){const a=(t-o)*(r-i),s=(e-i)*(n-o),u=a-s,l=Math.abs(a+s);return Math.abs(u)>=zx*l?u:-Xx(e,t,r,n,i,o,l)}var XE={},WE={},g0=e=>WE[e],xn=(e,t)=>{WE[e]=t},jx=e=>XE[e],Ua=(e,t)=>{XE[e]=t},E0={},Wf={},jf=34,hs=10,Gf=13;function jE(e){return new Function("d","return {"+e.map(function(t,r){return JSON.stringify(t)+": d["+r+'] || ""'}).join(",")+"}")}function Gx(e,t){var r=jE(e);return function(n,i){return t(r(n),i,e)}}function y0(e){var t=Object.create(null),r=[];return e.forEach(function(n){for(var i in n)i in t||r.push(t[i]=i)}),r}function un(e,t){var r=e+"",n=r.length;return n<t?new Array(t-n+1).join(0)+r:r}function $x(e){return e<0?"-"+un(-e,6):e>9999?"+"+un(e,6):un(e,4)}function Yx(e){var t=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":$x(e.getUTCFullYear())+"-"+un(e.getUTCMonth()+1,2)+"-"+un(e.getUTCDate(),2)+(i?"T"+un(t,2)+":"+un(r,2)+":"+un(n,2)+"."+un(i,3)+"Z":n?"T"+un(t,2)+":"+un(r,2)+":"+un(n,2)+"Z":r||t?"T"+un(t,2)+":"+un(r,2)+"Z":"")}function Zx(e){var t=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(c,h){var d,p,v=i(c,function(m,y){if(d)return d(m,y-1);p=m,d=h?Gx(m,h):jE(m)});return v.columns=p||[],v}function i(c,h){var d=[],p=c.length,v=0,m=0,y,A=p<=0,T=!1;c.charCodeAt(p-1)===hs&&--p,c.charCodeAt(p-1)===Gf&&--p;function R(){if(A)return Wf;if(T)return T=!1,E0;var H,B=v,q;if(c.charCodeAt(B)===jf){for(;v++<p&&c.charCodeAt(v)!==jf||c.charCodeAt(++v)===jf;);return(H=v)>=p?A=!0:(q=c.charCodeAt(v++))===hs?T=!0:q===Gf&&(T=!0,c.charCodeAt(v)===hs&&++v),c.slice(B+1,H-1).replace(/""/g,'"')}for(;v<p;){if((q=c.charCodeAt(H=v++))===hs)T=!0;else if(q===Gf)T=!0,c.charCodeAt(v)===hs&&++v;else if(q!==r)continue;return c.slice(B,H)}return A=!0,c.slice(B,p)}for(;(y=R())!==Wf;){for(var b=[];y!==E0&&y!==Wf;)b.push(y),y=R();h&&(b=h(b,m++))==null||d.push(b)}return d}function o(c,h){return c.map(function(d){return h.map(function(p){return f(d[p])}).join(e)})}function a(c,h){return h==null&&(h=y0(c)),[h.map(f).join(e)].concat(o(c,h)).join(`
`)}function s(c,h){return h==null&&(h=y0(c)),o(c,h).join(`
`)}function u(c){return c.map(l).join(`
`)}function l(c){return c.map(f).join(e)}function f(c){return c==null?"":c instanceof Date?Yx(c):t.test(c+="")?'"'+c.replace(/"/g,'""')+'"':c}return{parse:n,parseRows:i,format:a,formatBody:s,formatRows:u,formatRow:l,formatValue:f}}var qx=Zx(","),Kx=qx.parse;function Qs(e,t,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=t||{},n.geometry=e,n}function Nd(e,t,r){r===void 0&&(r={});for(var n=0,i=e;n<i.length;n++){var o=i[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<o[o.length-1].length;a++)if(o[o.length-1][a]!==o[0][a])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:e};return Qs(s,t,r)}function Qx(e,t,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return Qs(n,t,r)}function Jx(e,t){t===void 0&&(t={});var r={type:"FeatureCollection"};return t.id&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.features=e,r}function e2(e,t,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return Qs(n,t,r)}function GE(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function A0(e){return e.type==="Feature"?e.geometry:e}function $E(e,t,r){if(e!==null)for(var n,i,o,a,s,u,l,f=0,c=0,h,d=e.type,p=d==="FeatureCollection",v=d==="Feature",m=p?e.features.length:1,y=0;y<m;y++){l=p?e.features[y].geometry:v?e.geometry:e,h=l?l.type==="GeometryCollection":!1,s=h?l.geometries.length:1;for(var A=0;A<s;A++){var T=0,R=0;if(a=h?l.geometries[A]:l,a!==null){u=a.coordinates;var b=a.type;switch(f=r&&(b==="Polygon"||b==="MultiPolygon")?1:0,b){case null:break;case"Point":if(t(u,c,y,T,R)===!1)return!1;c++,T++;break;case"LineString":case"MultiPoint":for(n=0;n<u.length;n++){if(t(u[n],c,y,T,R)===!1)return!1;c++,b==="MultiPoint"&&T++}b==="LineString"&&T++;break;case"Polygon":case"MultiLineString":for(n=0;n<u.length;n++){for(i=0;i<u[n].length-f;i++){if(t(u[n][i],c,y,T,R)===!1)return!1;c++}b==="MultiLineString"&&T++,b==="Polygon"&&R++}b==="Polygon"&&T++;break;case"MultiPolygon":for(n=0;n<u.length;n++){for(R=0,i=0;i<u[n].length;i++){for(o=0;o<u[n][i].length-f;o++){if(t(u[n][i][o],c,y,T,R)===!1)return!1;c++}R++}T++}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)if($E(a.geometries[n],t,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function t2(e,t){var r,n,i,o,a,s,u,l,f,c,h=0,d=e.type==="FeatureCollection",p=e.type==="Feature",v=d?e.features.length:1;for(r=0;r<v;r++){for(s=d?e.features[r].geometry:p?e.geometry:e,l=d?e.features[r].properties:p?e.properties:{},f=d?e.features[r].bbox:p?e.bbox:void 0,c=d?e.features[r].id:p?e.id:void 0,u=s?s.type==="GeometryCollection":!1,a=u?s.geometries.length:1,i=0;i<a;i++){if(o=u?s.geometries[i]:s,o===null){if(t(null,h,l,f,c)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(o,h,l,f,c)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(t(o.geometries[n],h,l,f,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}h++}}function YE(e,t){t2(e,function(r,n,i,o,a){var s=r===null?null:r.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return t(Qs(r,i,{bbox:o,id:a}),n,0)===!1?!1:void 0}var u;switch(s){case"MultiPoint":u="Point";break;case"MultiLineString":u="LineString";break;case"MultiPolygon":u="Polygon";break}for(var l=0;l<r.coordinates.length;l++){var f=r.coordinates[l],c={type:u,coordinates:f};if(t(Qs(c,i),n,l)===!1)return!1}})}var Ol={REGISTERED_PROTOCOLS:{}},r2=Object.defineProperty,n2=Object.defineProperties,i2=Object.getOwnPropertyDescriptors,T0=Object.getOwnPropertySymbols,o2=Object.prototype.hasOwnProperty,a2=Object.prototype.propertyIsEnumerable,S0=(e,t,r)=>t in e?r2(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Fd=(e,t)=>{for(var r in t||(t={}))o2.call(t,r)&&S0(e,r,t[r]);if(T0)for(var r of T0(t))a2.call(t,r)&&S0(e,r,t[r]);return e},Dd=(e,t)=>n2(e,i2(t)),Bd=e=>Ol.REGISTERED_PROTOCOLS[e.substring(0,e.indexOf("://"))],s2=class extends Error{constructor(e,t,r,n){super(`AJAXError: ${t} (${e}): ${r}`),this.status=e,this.statusText=t,this.url=r,this.body=n}};function ZE(e,t){const r=new XMLHttpRequest,n=Array.isArray(e.url)?e.url[0]:e.url;r.open(e.method||"GET",n,!0),e.type==="arrayBuffer"&&(r.responseType="arraybuffer");for(const i in e.headers)e.headers.hasOwnProperty(i)&&r.setRequestHeader(i,e.headers[i]);return e.type==="json"&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials=e.credentials==="include",r.onerror=()=>{t(new Error(r.statusText))},r.onload=()=>{if((r.status>=200&&r.status<300||r.status===0)&&r.response!==null){let i=r.response;if(e.type==="json")try{i=JSON.parse(r.response)}catch(o){return t(o)}t(null,i,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"),r)}else{const i=new Blob([r.response],{type:r.getResponseHeader("Content-Type")});t(new s2(r.status,r.statusText,n.toString(),i))}},r.cancel=r.abort,r.send(e.body),r}function u2(e){return new Promise((t,r)=>{ZE(e,(n,i,o,a,s)=>{n?r({err:n,data:null,xhr:s}):t({err:null,data:i,cacheControl:o,expires:a,xhr:s})})})}function wd(e,t){return ZE(e,t)}var l2=(e,t)=>(Bd(e.url)||wd)(Dd(Fd({},e),{type:"json"}),t),Ld=(e,t)=>(Bd(e.url)||wd)(Dd(Fd({},e),{type:"arrayBuffer"}),t),c2=(e,t)=>wd(Dd(Fd({},e),{method:"GET"}),t),x0="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function qE(e,t){const r=new window.Image,n=window.URL||window.webkitURL;r.crossOrigin="anonymous",r.onload=()=>{t(null,r),n.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(()=>{r.src=x0})},r.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const i=new Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?n.createObjectURL(i):x0}function KE(e,t){const r=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(r).then(n=>{t(null,n)}).catch(n=>{t(new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}var Nh=(e,t,r)=>{const n=(i,o)=>{if(i)t(i);else if(o){const a=typeof createImageBitmap=="function",s=r?r(o):o;a?KE(s,t):qE(s,t)}};return e.type==="json"?l2(e,n):Ld(e,n)},f2=(e,t)=>{typeof createImageBitmap=="function"?KE(e,t):qE(e,t)};function Ud(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function QE(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function gu(){}var Js=.7,Xl=1/Js,va="\\s*([+-]?\\d+)\\s*",eu="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",ti="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",h2=/^#([0-9a-f]{3,8})$/,d2=new RegExp("^rgb\\("+[va,va,va]+"\\)$"),p2=new RegExp("^rgb\\("+[ti,ti,ti]+"\\)$"),_2=new RegExp("^rgba\\("+[va,va,va,eu]+"\\)$"),v2=new RegExp("^rgba\\("+[ti,ti,ti,eu]+"\\)$"),m2=new RegExp("^hsl\\("+[eu,ti,ti]+"\\)$"),g2=new RegExp("^hsla\\("+[eu,ti,ti,eu]+"\\)$"),R0={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ud(gu,xa,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:C0,formatHex:C0,formatHsl:E2,formatRgb:b0,toString:b0});function C0(){return this.rgb().formatHex()}function E2(){return JE(this).formatHsl()}function b0(){return this.rgb().formatRgb()}function xa(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=h2.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?M0(t):r===3?new Tn(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?ul(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?ul(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=d2.exec(e))?new Tn(t[1],t[2],t[3],1):(t=p2.exec(e))?new Tn(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=_2.exec(e))?ul(t[1],t[2],t[3],t[4]):(t=v2.exec(e))?ul(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=m2.exec(e))?P0(t[1],t[2]/100,t[3]/100,1):(t=g2.exec(e))?P0(t[1],t[2]/100,t[3]/100,t[4]):R0.hasOwnProperty(e)?M0(R0[e]):e==="transparent"?new Tn(NaN,NaN,NaN,0):null}function M0(e){return new Tn(e>>16&255,e>>8&255,e&255,1)}function ul(e,t,r,n){return n<=0&&(e=t=r=NaN),new Tn(e,t,r,n)}function y2(e){return e instanceof gu||(e=xa(e)),e?(e=e.rgb(),new Tn(e.r,e.g,e.b,e.opacity)):new Tn}function Wl(e,t,r,n){return arguments.length===1?y2(e):new Tn(e,t,r,n==null?1:n)}function Tn(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}Ud(Tn,Wl,QE(gu,{brighter:function(e){return e=e==null?Xl:Math.pow(Xl,e),new Tn(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?Js:Math.pow(Js,e),new Tn(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:I0,formatHex:I0,formatRgb:O0,toString:O0}));function I0(){return"#"+$f(this.r)+$f(this.g)+$f(this.b)}function O0(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function $f(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function P0(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new ei(e,t,r,n)}function JE(e){if(e instanceof ei)return new ei(e.h,e.s,e.l,e.opacity);if(e instanceof gu||(e=xa(e)),!e)return new ei;if(e instanceof ei)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,i=Math.min(t,r,n),o=Math.max(t,r,n),a=NaN,s=o-i,u=(o+i)/2;return s?(t===o?a=(r-n)/s+(r<n)*6:r===o?a=(n-t)/s+2:a=(t-r)/s+4,s/=u<.5?o+i:2-o-i,a*=60):s=u>0&&u<1?0:a,new ei(a,s,u,e.opacity)}function A2(e,t,r,n){return arguments.length===1?JE(e):new ei(e,t,r,n==null?1:n)}function ei(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}Ud(ei,A2,QE(gu,{brighter:function(e){return e=e==null?Xl:Math.pow(Xl,e),new ei(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?Js:Math.pow(Js,e),new ei(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,i=2*r-n;return new Tn(Yf(e>=240?e-240:e+120,i,n),Yf(e,i,n),Yf(e<120?e+240:e-120,i,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function Yf(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}function Zt(e){const t=xa(e),r=[0,0,0,0];return t!=null&&(r[0]=t.r/255,r[1]=t.g/255,r[2]=t.b/255,r[3]=t.opacity),r}function _o(e){const t=e&&e[0],r=e&&e[1],n=e&&e[2];return t+r*256+n*65536-1}function Ra(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function T2(e){let t=window.document.createElement("canvas"),r=t.getContext("2d");t.width=256,t.height=1;let n=null;const i=r.createLinearGradient(0,0,256,1),o=e.positions[0],a=e.positions[e.positions.length-1];for(let s=0;s<e.colors.length;++s){const u=(e.positions[s]-o)/(a-o);i.addColorStop(u,e.colors[s])}return r.fillStyle=i,r.fillRect(0,0,256,1),n=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),t=null,r=null,{data:n,width:256,height:1}}function S2(e,t){let r=window.document.createElement("canvas"),n=r.getContext("2d");r.width=256,r.height=1;const i=n.createLinearGradient(0,0,256,1),o=t[1]-t[0];for(let u=0;u<e.colors.length;++u){const l=Math.max((e.positions[u]-t[0])/o,0);i.addColorStop(l,e.colors[u])}n.fillStyle=i,n.fillRect(0,0,256,1);const a=n.getImageData(0,0,256,1).data,s=kd(n,a);return r=null,n=null,s}function x2(e){let t=window.document.createElement("canvas"),r=t.getContext("2d");t.width=256,t.height=1;const n=r.createImageData(256,1);return n.data.fill(0),e.positions.forEach((i,o)=>{const a=Zt(e.colors[o]);n.data[i*4+0]=a[0]*255,n.data[i*4+1]=a[1]*255,n.data[i*4+2]=a[2]*255,n.data[i*4+3]=a[3]*255}),t=null,r=null,n}function R2(e){let t=window.document.createElement("canvas"),r=t.getContext("2d");r.globalAlpha=1,t.width=256,t.height=1;const n=256/e.colors.length;for(let a=0;a<e.colors.length;a++)r.beginPath(),r.lineWidth=2,r.strokeStyle=e.colors[a],r.moveTo(a*n,0),r.lineTo((a+1)*n,0),r.stroke();const i=r.getImageData(0,0,256,1).data,o=kd(r,i);return t=null,r=null,o}function C2(e,t){let r=window.document.createElement("canvas"),n=r.getContext("2d");n.globalAlpha=1,r.width=256,r.height=1;const i=t[1]-t[0];e.positions.length-e.colors.length!==1&&console.warn("positions \u7684\u6570\u5B57\u4E2A\u6570\u5E94\u5F53\u6BD4 colors \u7684\u6837\u5F0F\u591A\u4E00\u4E2A,poisitions \u7684\u9996\u5C3E\u503C\u4E00\u822C\u4E3A\u6570\u636E\u7684\u6700\u5927\u6700\u65B0\u503C");for(let s=0;s<e.colors.length;s++)n.beginPath(),n.lineWidth=2,n.strokeStyle=e.colors[s],n.moveTo((e.positions[s]-t[0])/i*255,0),n.lineTo((e.positions[s+1]-t[0])/i*255,0),n.stroke();const o=n.getImageData(0,0,256,1).data,a=kd(n,o);return r=null,n=null,a}function kd(e,t){const r=e.createImageData(256,1);for(let n=0;n<r.data.length;n+=4)r.data[n+0]=t[n+0],r.data[n+1]=t[n+1],r.data[n+2]=t[n+2],r.data[n+3]=t[n+3];return r}function zd(e){switch(e==null?void 0:e.type){case"cat":return[0,255];default:return[0,1]}}var so={BACK:1029,FRONT:1028};function Vd(e){switch(e){case"GAODE1.x":return so.BACK;case"GAODE2.x":return so.BACK;case"MAPBOX":return so.FRONT;case"SIMPLE":return so.FRONT;case"GLOBEL":return so.BACK;case"DEBAULT":return so.FRONT;default:return so.FRONT}}function b2(e,t,r){return e===e&&(r!==void 0&&(e=e<=r?e:r),t!==void 0&&(e=e>=t?e:t)),e}var M2=b2,I2=M2,Zf=wE;function O2(e,t,r){return r===void 0&&(r=t,t=void 0),r!==void 0&&(r=Zf(r),r=r===r?r:0),t!==void 0&&(t=Zf(t),t=t===t?t:0),I2(Zf(e),t,r)}var P2=O2,N2=ox,F2=function(){return N2.Date.now()},D2=F2,B2=Md,qf=D2,N0=wE,w2="Expected a function",L2=Math.max,U2=Math.min;function k2(e,t,r){var n,i,o,a,s,u,l=0,f=!1,c=!1,h=!0;if(typeof e!="function")throw new TypeError(w2);t=N0(t)||0,B2(r)&&(f=!!r.leading,c="maxWait"in r,o=c?L2(N0(r.maxWait)||0,t):o,h="trailing"in r?!!r.trailing:h);function d(H){var B=n,q=i;return n=i=void 0,l=H,a=e.apply(q,B),a}function p(H){return l=H,s=setTimeout(y,t),f?d(H):a}function v(H){var B=H-u,q=H-l,Ee=t-B;return c?U2(Ee,o-q):Ee}function m(H){var B=H-u,q=H-l;return u===void 0||B>=t||B<0||c&&q>=o}function y(){var H=qf();if(m(H))return A(H);s=setTimeout(y,v(H))}function A(H){return s=void 0,h&&n?d(H):(n=i=void 0,a)}function T(){s!==void 0&&clearTimeout(s),l=0,n=u=i=s=void 0}function R(){return s===void 0?a:A(qf())}function b(){var H=qf(),B=m(H);if(n=arguments,i=this,u=H,B){if(s===void 0)return p(u);if(c)return clearTimeout(s),s=setTimeout(y,t),d(u)}return s===void 0&&(s=setTimeout(y,t)),a}return b.cancel=T,b.flush=R,b}var e1=k2,z2=xc,V2=LE,H2=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,X2=/^\w*$/;function W2(e,t){if(z2(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||V2(e)?!0:X2.test(e)||!H2.test(e)||t!=null&&e in Object(t)}var j2=W2,G2=ax,$2=500;function Y2(e){var t=G2(e,function(n){return r.size===$2&&r.clear(),n}),r=t.cache;return t}var Z2=Y2,q2=Z2,K2=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Q2=/\\(\\)?/g,J2=q2(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(K2,function(r,n,i,o){t.push(i?o.replace(Q2,"$1"):n||r)}),t}),eR=J2,tR=xc,rR=j2,nR=eR,iR=Id;function oR(e,t){return tR(e)?e:rR(e,t)?[e]:nR(iR(e))}var aR=oR,sR=LE,uR=1/0;function lR(e){if(typeof e=="string"||sR(e))return e;var t=e+"";return t=="0"&&1/e==-uR?"-0":t}var cR=lR,fR=aR,hR=cR;function dR(e,t){t=fR(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[hR(t[r++])];return r&&r==n?e:void 0}var pR=dR,_R=pR;function vR(e,t,r){var n=e==null?void 0:_R(e,t);return n===void 0?r:n}var mR=vR,gR=Od,ER=Rc,yR="[object Boolean]";function AR(e){return e===!0||e===!1||ER(e)&&gR(e)==yR}var TR=AR;function SR(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var xR=SR,RR=UE,CR=xR,bR=kE,MR=1,IR=2;function OR(e,t,r,n,i,o){var a=r&MR,s=e.length,u=t.length;if(s!=u&&!(a&&u>s))return!1;var l=o.get(e),f=o.get(t);if(l&&f)return l==t&&f==e;var c=-1,h=!0,d=r&IR?new RR:void 0;for(o.set(e,t),o.set(t,e);++c<s;){var p=e[c],v=t[c];if(n)var m=a?n(v,p,c,t,e,o):n(p,v,c,e,t,o);if(m!==void 0){if(m)continue;h=!1;break}if(d){if(!CR(t,function(y,A){if(!bR(d,A)&&(p===y||i(p,y,r,n,o)))return d.push(A)})){h=!1;break}}else if(!(p===v||i(p,v,r,n,o))){h=!1;break}}return o.delete(e),o.delete(t),h}var t1=OR;function PR(e){var t=-1,r=Array(e.size);return e.forEach(function(n,i){r[++t]=[i,n]}),r}var NR=PR;function FR(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var Hd=FR,F0=sx,D0=ux,DR=lx,BR=t1,wR=NR,LR=Hd,UR=1,kR=2,zR="[object Boolean]",VR="[object Date]",HR="[object Error]",XR="[object Map]",WR="[object Number]",jR="[object RegExp]",GR="[object Set]",$R="[object String]",YR="[object Symbol]",ZR="[object ArrayBuffer]",qR="[object DataView]",B0=F0?F0.prototype:void 0,Kf=B0?B0.valueOf:void 0;function KR(e,t,r,n,i,o,a){switch(r){case qR:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case ZR:return!(e.byteLength!=t.byteLength||!o(new D0(e),new D0(t)));case zR:case VR:case WR:return DR(+e,+t);case HR:return e.name==t.name&&e.message==t.message;case jR:case $R:return e==t+"";case XR:var s=wR;case GR:var u=n&UR;if(s||(s=LR),e.size!=t.size&&!u)return!1;var l=a.get(e);if(l)return l==t;n|=kR,a.set(e,t);var f=BR(s(e),s(t),n,i,o,a);return a.delete(e),f;case YR:if(Kf)return Kf.call(e)==Kf.call(t)}return!1}var QR=KR,w0=cx,JR=1,eC=Object.prototype,tC=eC.hasOwnProperty;function rC(e,t,r,n,i,o){var a=r&JR,s=w0(e),u=s.length,l=w0(t),f=l.length;if(u!=f&&!a)return!1;for(var c=u;c--;){var h=s[c];if(!(a?h in t:tC.call(t,h)))return!1}var d=o.get(e),p=o.get(t);if(d&&p)return d==t&&p==e;var v=!0;o.set(e,t),o.set(t,e);for(var m=a;++c<u;){h=s[c];var y=e[h],A=t[h];if(n)var T=a?n(A,y,h,t,e,o):n(y,A,h,e,t,o);if(!(T===void 0?y===A||i(y,A,r,n,o):T)){v=!1;break}m||(m=h=="constructor")}if(v&&!m){var R=e.constructor,b=t.constructor;R!=b&&"constructor"in e&&"constructor"in t&&!(typeof R=="function"&&R instanceof R&&typeof b=="function"&&b instanceof b)&&(v=!1)}return o.delete(e),o.delete(t),v}var nC=rC,Qf=fx,iC=t1,oC=QR,aC=nC,L0=hx,U0=xc,k0=dx.exports,sC=zE,uC=1,z0="[object Arguments]",V0="[object Array]",ll="[object Object]",lC=Object.prototype,H0=lC.hasOwnProperty;function cC(e,t,r,n,i,o){var a=U0(e),s=U0(t),u=a?V0:L0(e),l=s?V0:L0(t);u=u==z0?ll:u,l=l==z0?ll:l;var f=u==ll,c=l==ll,h=u==l;if(h&&k0(e)){if(!k0(t))return!1;a=!0,f=!1}if(h&&!f)return o||(o=new Qf),a||sC(e)?iC(e,t,r,n,i,o):oC(e,t,u,r,n,i,o);if(!(r&uC)){var d=f&&H0.call(e,"__wrapped__"),p=c&&H0.call(t,"__wrapped__");if(d||p){var v=d?e.value():e,m=p?t.value():t;return o||(o=new Qf),i(v,m,r,n,o)}}return h?(o||(o=new Qf),aC(e,t,r,n,i,o)):!1}var fC=cC,hC=fC,X0=Rc;function r1(e,t,r,n,i){return e===t?!0:e==null||t==null||!X0(e)&&!X0(t)?e!==e&&t!==t:hC(e,t,r,n,r1,i)}var dC=r1,pC=dC;function _C(e,t){return pC(e,t)}var vC=_C;function mC(e){return e==null}var gC=mC,EC=Od,yC=Rc,AC="[object Number]";function TC(e){return typeof e=="number"||yC(e)&&EC(e)==AC}var SC=TC,xC=Od,RC=xc,CC=Rc,bC="[object String]";function MC(e){return typeof e=="string"||!RC(e)&&CC(e)&&xC(e)==bC}var IC=MC,OC=_x,PC=px,NC=PC(function(e,t,r){OC(e,t,r)}),FC=NC;function DC(e,t,r,n){for(var i=r-1,o=e.length;++i<o;)if(n(e[i],t))return i;return-1}var BC=DC,wC=vx,LC=gx,UC=BC,kC=Ex,zC=mx,VC=Array.prototype,W0=VC.splice;function HC(e,t,r,n){var i=n?UC:LC,o=-1,a=t.length,s=e;for(e===t&&(t=zC(t)),r&&(s=wC(e,kC(r)));++o<a;)for(var u=0,l=t[o],f=r?r(l):l;(u=i(s,f,u,n))>-1;)s!==e&&W0.call(s,u,1),W0.call(e,u,1);return e}var XC=HC,WC=XC;function jC(e,t){return e&&e.length&&t&&t.length?WC(e,t):e}var GC=jC,$C=yx,YC=GC,ZC=$C(YC),qC=ZC,KC=e1,QC=Md,JC="Expected a function";function e3(e,t,r){var n=!0,i=!0;if(typeof e!="function")throw new TypeError(JC);return QC(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),KC(e,t,{leading:n,maxWait:t,trailing:i})}var t3=e3,Jf=Ax,r3=Tx,n3=Hd,i3=1/0,o3=Jf&&1/n3(new Jf([,-0]))[1]==i3?function(e){return new Jf(e)}:r3,a3=o3,s3=UE,u3=Sx,l3=xx,c3=kE,f3=a3,h3=Hd,d3=200;function p3(e,t,r){var n=-1,i=u3,o=e.length,a=!0,s=[],u=s;if(r)a=!1,i=l3;else if(o>=d3){var l=t?null:f3(e);if(l)return h3(l);a=!1,i=c3,u=new s3}else u=t?[]:s;e:for(;++n<o;){var f=e[n],c=t?t(f):f;if(f=r||f!==0?f:0,a&&c===c){for(var h=u.length;h--;)if(u[h]===c)continue e;t&&u.push(c),s.push(f)}else i(u,c,r)||(u!==s&&u.push(c),s.push(f))}return s}var _3=p3,v3=_3;function m3(e){return e&&e.length?v3(e):[]}var g3=m3;function E3(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),r=r>i?i:r,r<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var o=Array(i);++n<i;)o[n]=e[n+t];return o}var y3=E3,A3=y3;function T3(e,t,r){var n=e.length;return r=r===void 0?n:r,!t&&r>=n?e:A3(e,t,r)}var S3=T3,x3="\\ud800-\\udfff",R3="\\u0300-\\u036f",C3="\\ufe20-\\ufe2f",b3="\\u20d0-\\u20ff",M3=R3+C3+b3,I3="\\ufe0e\\ufe0f",O3="\\u200d",P3=RegExp("["+O3+x3+M3+I3+"]");function N3(e){return P3.test(e)}var n1=N3;function F3(e){return e.split("")}var D3=F3,i1="\\ud800-\\udfff",B3="\\u0300-\\u036f",w3="\\ufe20-\\ufe2f",L3="\\u20d0-\\u20ff",U3=B3+w3+L3,k3="\\ufe0e\\ufe0f",z3="["+i1+"]",Fh="["+U3+"]",Dh="\\ud83c[\\udffb-\\udfff]",V3="(?:"+Fh+"|"+Dh+")",o1="[^"+i1+"]",a1="(?:\\ud83c[\\udde6-\\uddff]){2}",s1="[\\ud800-\\udbff][\\udc00-\\udfff]",H3="\\u200d",u1=V3+"?",l1="["+k3+"]?",X3="(?:"+H3+"(?:"+[o1,a1,s1].join("|")+")"+l1+u1+")*",W3=l1+u1+X3,j3="(?:"+[o1+Fh+"?",Fh,a1,s1,z3].join("|")+")",G3=RegExp(Dh+"(?="+Dh+")|"+j3+W3,"g");function $3(e){return e.match(G3)||[]}var Y3=$3,Z3=D3,q3=n1,K3=Y3;function Q3(e){return q3(e)?K3(e):Z3(e)}var J3=Q3,eb=S3,tb=n1,rb=J3,nb=Id;function ib(e){return function(t){t=nb(t);var r=tb(t)?rb(t):void 0,n=r?r[0]:t.charAt(0),i=r?eb(r,1).join(""):t.slice(1);return n[e]()+i}}var ob=ib,ab=ob,sb=ab("toUpperCase"),c1=sb;function ub(e){return e===void 0}var lb=ub,cb=Id,fb=c1;function hb(e){return fb(cb(e).toLowerCase())}var db=hb,pb=db,_b=Rx,vb=_b(function(e,t,r){return t=t.toLowerCase(),e+(r?pb(t):t)}),mb=vb,Ar={isNil:gC,merge:FC,throttle:t3,isString:IC,debounce:e1,pull:qC,isTypedArray:zE,isPlainObject:Cx,isNumber:SC,isBoolean:TR,isEqual:vC,cloneDeep:bx,uniq:g3,clamp:P2,upperFirst:c1,get:mR,mergeWith:Mx,isFunction:Ix,isObject:Md,isUndefined:lb,camelCase:mb};function gb(e){let t=e;return typeof e=="string"&&(t=window.document.getElementById(e)),t}function f1(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function h1(e){return f1(e).split(/\s+/)}function Eb(e){var t;const r=(t=document==null?void 0:document.documentElement)==null?void 0:t.style;if(!r)return e[0];for(const n in e)if(e[n]&&e[n]in r)return e[n];return e[0]}function pn(e,t,r){const n=window.document.createElement(e);return t&&(n.className=t||""),r&&r.appendChild(n),n}function jl(e){const t=e.parentNode;t&&t.removeChild(e)}function js(e,t){if(e.classList!==void 0){const r=h1(t);for(let n=0,i=r.length;n<i;n++)e.classList.add(r[n])}else if(!yb(e,t)){const r=Xd(e);d1(e,(r?r+" ":"")+t)}}function Bh(e,t){e.classList!==void 0?h1(t).forEach(n=>{e.classList.remove(n)}):d1(e,f1((" "+Xd(e)+" ").replace(" "+t+" "," ")))}function yb(e,t){if(e.classList!==void 0)return e.classList.contains(t);const r=Xd(e);return r.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(r)}function d1(e,t){e instanceof HTMLElement?e.className=t:e.className.baseVal=t}function Xd(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}Eb(["transform","WebkitTransform"]);function Ab(){var e;const t=window.document.querySelector('meta[name="viewport"]');if(!t)return 1;const n=((e=t.content)==null?void 0:e.split(",")).find(i=>{const[o]=i.split("=");return o==="initial-scale"});return n?n.split("=")[1]*1:1}var An=Ab()<1?1:window.devicePixelRatio;function Tb(e,t){e.setAttribute("style",`${e.style.cssText}${t}`)}function Sb(e){return Object.entries(e).map(([t,r])=>`${t}: ${r}`).join(";")}function xb(e,t){return{left:e.left-t.left,top:e.top-t.top,right:t.left+t.width-e.left-e.width,bottom:t.top+t.height-e.top-e.height}}function p1(e){e.innerHTML=""}function Rb(e){e.setAttribute("draggable","false")}function Cb(e,t){var r;const n=Array.isArray(t)?t:[t];let i=e;for(;i instanceof Element&&i!==window.document.body;){if(n.find(o=>i==null?void 0:i.matches(o)))return i;i=(r=i==null?void 0:i.parentElement)!=null?r:null}}function bb(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap}var wh=navigator==null?void 0:navigator.userAgent;wh.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);wh.indexOf("Android")>-1||wh.indexOf("Adr")>-1;function Lh(e){var t=[1/0,1/0,-1/0,-1/0];return $E(e,function(r){t[0]>r[0]&&(t[0]=r[0]),t[1]>r[1]&&(t[1]=r[1]),t[2]<r[0]&&(t[2]=r[0]),t[3]<r[1]&&(t[3]=r[1])}),t}Lh.default=Lh;function eh(e){return typeof e=="number"}var j0=2*Math.PI*6378137/2;function Mb(e,t){const[r,n,i,o]=t;return e.lng>r&&e.lng<=i&&e.lat>n&&e.lat<=o}function Ib(e){const t=[1/0,1/0,-1/0,-1/0];return e.forEach(r=>{const{coordinates:n}=r;_1(t,n)}),t}function _1(e,t){return Array.isArray(t[0])?t.forEach(r=>{_1(e,r)}):(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])),e}function th(e,t=!0,r={enable:!0,decimal:1}){e=Nb(e,t);const n=e[0],i=e[1];let o=n*j0/180,a=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return a=a*j0/180,r.enable&&(o=Number(o.toFixed(r.decimal)),a=Number(a.toFixed(r.decimal))),e.length===3?[o,a,e[2]]:[o,a]}function Ob(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Pb(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function Nb(e,t){if(t===!1)return e;const r=Ob(e[0]);let n=Pb(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function fn(e){const t=85.0511287798,r=Math.max(Math.min(t,e[1]),-t),n=256<<20;let i=Math.PI/180,o=e[0]*i,a=r*i;a=Math.log(Math.tan(Math.PI/4+a/2));const s=.5/Math.PI,u=.5,l=-.5/Math.PI;return i=.5,o=n*(s*o+u),a=n*(l*a+i),[Math.floor(o),Math.floor(a)]}function cl(e,t){const r=85.0511287798,n=Math.PI/180,i=6378137;return t=Math.max(Math.min(r,t),-r),e*=n,t*=n,t=Math.log(Math.tan(Math.PI/4+t/2)),[e*i,t*i]}function Wd(e,t){const r=Math.abs(e[1][1]-e[0][1])*t,n=Math.abs(e[1][0]-e[0][0])*t;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function v1(e,t){return e[0][0]<=t[0][0]&&e[0][1]<=t[0][1]&&e[1][0]>=t[1][0]&&e[1][1]>=t[1][1]}function Gl(e){return[[e[0],e[1]],[e[2],e[3]]]}function Fb(e){const t=Db(e,[0,0]);return[e[0]/t,e[1]/t]}function Db(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function zi(e){if(eh(e[0]))return e;if(eh(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(eh(e[0][0][0])){const t=e;let r=0,n=0,i=0;return t.forEach(o=>{o.forEach(a=>{r+=a[0],n+=a[1],i++})}),[r/i,n/i,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function Bb(e){let t=e[0],r=e[1],n=e[0],i=e[1],o=0,a=0,s=0;for(let u=0;u<e.length;u+=2){const l=e[u],f=e[u+1];l&&f&&(t=Math.max(l,t),r=Math.max(f,r),n=Math.min(l,n),i=Math.min(f,i),o+=l,a+=f,s++)}return{center:[o/s,a/s],radius:Math.sqrt(Math.pow(t-n,2)+Math.pow(r-i,2))/2}}function wb(e){return Lh(Jx([Qx(e)]))}function Lb(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}var m1=(e=>(e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFAULT="DEFAUlTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e))(m1||{}),Ub=class{constructor(e=50,t){this.limit=e,this.destroy=t||this.defaultDestroy,this.order=[],this.clear()}clear(){this.order.forEach(e=>{this.delete(e)}),this.cache={},this.order=[]}get(e){const t=this.cache[e];return t&&(this.deleteOrder(e),this.appendOrder(e)),t}set(e,t){this.cache[e]?(this.delete(e),this.cache[e]=t,this.appendOrder(e)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[e]=t,this.appendOrder(e))}delete(e){const t=this.cache[e];t&&(this.deleteCache(e),this.deleteOrder(e),this.destroy(t,e))}deleteCache(e){delete this.cache[e]}deleteOrder(e){const t=this.order.findIndex(r=>r===e);t>=0&&this.order.splice(t,1)}appendOrder(e){this.order.push(e)}defaultDestroy(e,t){return null}};function kb(e){if(e.length===0)throw new Error("max requires at least one data point");let t=e[0];for(let r=1;r<e.length;r++)e[r]>t&&(t=e[r]);return t*1}function zb(e){if(e.length===0)throw new Error("min requires at least one data point");let t=e[0];for(let r=1;r<e.length;r++)e[r]<t&&(t=e[r]);return t*1}function g1(e){if(e.length===0)return 0;let t=e[0]*1;for(let r=1;r<e.length;r++)t+=e[r]*1;return t}function Vb(e){if(e.length===0)throw new Error("mean requires at least one data point");return g1(e)/e.length}function Hb(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();let t=e[0],r=NaN,n=0,i=1;for(let o=1;o<e.length+1;o++)e[o]!==t?(i>n&&(n=i,r=t),i=1,t=e[o]):i++;return r*1}var E1={min:zb,max:kb,mean:Vb,sum:g1,mode:Hb};function y1(e,t){return e.map(r=>r[t])}function Xb(e,t){t===void 0&&(t={});var r=Number(e[0]),n=Number(e[1]),i=Number(e[2]),o=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var a=[r,n],s=[r,o],u=[i,o],l=[i,n];return Nd([[a,l,u,s,a]],t.properties,{bbox:e,id:t.id})}var vn={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function i(u,l,f){this.fn=u,this.context=l,this.once=f||!1}function o(u,l,f,c,h){if(typeof f!="function")throw new TypeError("The listener must be a function");var d=new i(f,c||u,h),p=r?r+l:l;return u._events[p]?u._events[p].fn?u._events[p]=[u._events[p],d]:u._events[p].push(d):(u._events[p]=d,u._eventsCount++),u}function a(u,l){--u._eventsCount===0?u._events=new n:delete u._events[l]}function s(){this._events=new n,this._eventsCount=0}s.prototype.eventNames=function(){var l=[],f,c;if(this._eventsCount===0)return l;for(c in f=this._events)t.call(f,c)&&l.push(r?c.slice(1):c);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(f)):l},s.prototype.listeners=function(l){var f=r?r+l:l,c=this._events[f];if(!c)return[];if(c.fn)return[c.fn];for(var h=0,d=c.length,p=new Array(d);h<d;h++)p[h]=c[h].fn;return p},s.prototype.listenerCount=function(l){var f=r?r+l:l,c=this._events[f];return c?c.fn?1:c.length:0},s.prototype.emit=function(l,f,c,h,d,p){var v=r?r+l:l;if(!this._events[v])return!1;var m=this._events[v],y=arguments.length,A,T;if(m.fn){switch(m.once&&this.removeListener(l,m.fn,void 0,!0),y){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,f),!0;case 3:return m.fn.call(m.context,f,c),!0;case 4:return m.fn.call(m.context,f,c,h),!0;case 5:return m.fn.call(m.context,f,c,h,d),!0;case 6:return m.fn.call(m.context,f,c,h,d,p),!0}for(T=1,A=new Array(y-1);T<y;T++)A[T-1]=arguments[T];m.fn.apply(m.context,A)}else{var R=m.length,b;for(T=0;T<R;T++)switch(m[T].once&&this.removeListener(l,m[T].fn,void 0,!0),y){case 1:m[T].fn.call(m[T].context);break;case 2:m[T].fn.call(m[T].context,f);break;case 3:m[T].fn.call(m[T].context,f,c);break;case 4:m[T].fn.call(m[T].context,f,c,h);break;default:if(!A)for(b=1,A=new Array(y-1);b<y;b++)A[b-1]=arguments[b];m[T].fn.apply(m[T].context,A)}}return!0},s.prototype.on=function(l,f,c){return o(this,l,f,c,!1)},s.prototype.once=function(l,f,c){return o(this,l,f,c,!0)},s.prototype.removeListener=function(l,f,c,h){var d=r?r+l:l;if(!this._events[d])return this;if(!f)return a(this,d),this;var p=this._events[d];if(p.fn)p.fn===f&&(!h||p.once)&&(!c||p.context===c)&&a(this,d);else{for(var v=0,m=[],y=p.length;v<y;v++)(p[v].fn!==f||h&&!p[v].once||c&&p[v].context!==c)&&m.push(p[v]);m.length?this._events[d]=m.length===1?m[0]:m:a(this,d)}return this},s.prototype.removeAllListeners=function(l){var f;return l?(f=r?r+l:l,this._events[f]&&a(this,f)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s})(vn);const jd=vn.exports;var Gs=(e=>(e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace",e))(Gs||{}),In=(e=>(e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled",e))(In||{}),A1=0,G0=1,Cc=2;function Wb(e){e.forEach(t=>{t.isCurrent&&(t.isVisible=t.isLoaded)})}function jb(e){e.forEach(t=>{t.properties.state=A1}),e.forEach(t=>{t.isCurrent&&!T1(t)&&Gd(t)}),e.forEach(t=>{t.isVisible=Boolean(t.properties.state&Cc)})}function Gb(e){e.forEach(r=>{r.properties.state=A1}),e.forEach(r=>{r.isCurrent&&T1(r)}),e.slice().sort((r,n)=>r.z-n.z).forEach(r=>{r.isVisible=Boolean(r.properties.state&Cc),r.children.length&&(r.isVisible||r.properties.state&G0)?r.children.forEach(n=>{n.properties.state=G0}):r.isCurrent&&Gd(r)})}function T1(e){for(;e;){if(e.isLoaded)return e.properties.state|=Cc,!0;e=e.parent}return!1}function Gd(e){e.children.forEach(t=>{t.isLoaded?t.properties.state|=Cc:Gd(t)})}var S1=[-1/0,-1/0,1/0,1/0],$b=.2,Yb=5,Zb={[Gs.Realtime]:Wb,[Gs.Overlap]:jb,[Gs.Replace]:Gb},qb=()=>{};function Uh(e,t,r){const n=Math.floor((e+180)/360*Math.pow(2,r)),i=Math.floor((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,r));return[n,i]}function $0(e,t,r){const n=e/Math.pow(2,r)*360-180,i=Math.PI-2*Math.PI*t/Math.pow(2,r),o=180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)));return[n,o]}var x1=(e,t,r)=>{const[n,i]=$0(e,t,r),[o,a]=$0(e+1,t+1,r);return[n,a,o,i]};function Kb({zoom:e,latLonBounds:t,maxZoom:r=1/0,minZoom:n=0,zoomOffset:i=0,extent:o=S1}){let a=Math.ceil(e)+i;if(Number.isFinite(n)&&a<n)return[];Number.isFinite(r)&&a>r&&(a=r);const[s,u,l,f]=t,c=[Math.max(s,o[0]),Math.max(u,o[1]),Math.min(l,o[2]),Math.min(f,o[3])],h=[],[d,p]=Uh(c[0],c[1],a),[v,m]=Uh(c[2],c[3],a);for(let R=d;R<=v;R++)for(let b=m;b<=p;b++)h.push({x:R,y:b,z:a});const y=(v+d)/2,A=(p+m)/2,T=(R,b)=>Math.abs(R-y)+Math.abs(b-A);return h.sort((R,b)=>T(R.x,R.y)-T(b.x,b.y)),h}var Qb=(e,t,r,n=!0)=>{const i=Math.pow(2,r),o=i-1,a=i;let s=e;const u=t;return n&&(s<0?s=s+a:s>o&&(s=s%a)),{warpX:s,warpY:u}},Jb=(e,t,r)=>new Promise((n,i)=>{var o=u=>{try{s(r.next(u))}catch(l){i(l)}},a=u=>{try{s(r.throw(u))}catch(l){i(l)}},s=u=>u.done?n(u.value):Promise.resolve(u.value).then(o,a);s((r=r.apply(e,t)).next())}),eM=class extends vn.exports.EventEmitter{constructor(e){super(),this.tileSize=256,this.isVisible=!1,this.isCurrent=!1,this.isVisibleChange=!1,this.loadedLayers=0,this.isLayerLoaded=!1,this.isLoad=!1,this.isChildLoad=!1,this.parent=null,this.children=[],this.data=null,this.properties={},this.loadDataId=0;const{x:t,y:r,z:n,tileSize:i,warp:o=!0}=e;this.x=t,this.y=r,this.z=n,this.warp=o||!0,this.tileSize=i}get isLoading(){return this.loadStatus===In.Loading}get isLoaded(){return this.loadStatus===In.Loaded}get isFailure(){return this.loadStatus===In.Failure}setTileLayerLoaded(){this.isLayerLoaded=!0}get isCancelled(){return this.loadStatus===In.Cancelled}get isDone(){return[In.Loaded,In.Cancelled,In.Failure].includes(this.loadStatus)}get bounds(){return x1(this.x,this.y,this.z)}get bboxPolygon(){const[e,t,r,n]=this.bounds,i=[(r-e)/2,(n-t)/2];return Xb(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:i,meta:`
      ${this.key}
      `}})}get key(){return`${this.x}_${this.y}_${this.z}`}layerLoad(){this.loadedLayers++,this.emit("layerLoaded")}loadData(e){return Jb(this,arguments,function*({getData:t,onLoad:r,onError:n}){this.loadDataId++;const i=this.loadDataId;this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=In.Loading;let o=null,a;try{const{x:s,y:u,z:l,bounds:f,tileSize:c,warp:h}=this,{warpX:d,warpY:p}=Qb(s,u,l,h),{signal:v}=this.abortController;o=yield t({x:d,y:p,z:l,bounds:f,tileSize:c,signal:v,warp:h},this)}catch(s){a=s}if(i===this.loadDataId&&!(this.isCancelled&&!o)){if(a||!o){this.loadStatus=In.Failure,n(a,this);return}this.loadStatus=In.Loaded,this.data=o,r(this)}})}reloadData(e){this.isLoading&&this.abortLoad(),this.loadData(e)}abortLoad(){this.isLoaded||this.isCancelled||(this.loadStatus=In.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}},tM=(e,t)=>{const r=Gl(e),n=Wd(r,t),i=360*3-180,o=85.0511287798065;return[Math.max(n[0][0],-i),Math.max(n[0][1],-o),Math.min(n[1][0],i),Math.min(n[1][1],o)]},rM=(e,t)=>{const r=Gl(e),n=Gl(t);return v1(r,n)},nM=Object.defineProperty,iM=Object.defineProperties,oM=Object.getOwnPropertyDescriptors,Y0=Object.getOwnPropertySymbols,aM=Object.prototype.hasOwnProperty,sM=Object.prototype.propertyIsEnumerable,Z0=(e,t,r)=>t in e?nM(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,q0=(e,t)=>{for(var r in t||(t={}))aM.call(t,r)&&Z0(e,r,t[r]);if(Y0)for(var r of Y0(t))sM.call(t,r)&&Z0(e,r,t[r]);return e},uM=(e,t)=>iM(e,oM(t)),{throttle:lM}=Ar,cM=class extends jd{constructor(e){super(),this.currentTiles=[],this.cacheTiles=new Map,this.throttleUpdate=lM((t,r)=>{this.update(t,r)},16),this.onTileLoad=t=>{this.emit("tile-loaded",t),this.updateTileVisible(),this.loadFinished()},this.onTileError=(t,r)=>{this.emit("tile-error",{error:t,tile:r}),this.updateTileVisible(),this.loadFinished()},this.onTileUnload=t=>{this.emit("tile-unload",t),this.loadFinished()},this.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:S1,getTileData:qb,warp:!0,updateStrategy:Gs.Replace},this.updateOptions(e)}get isLoaded(){return this.currentTiles.every(e=>e.isDone)}get tiles(){return Array.from(this.cacheTiles.values()).sort((t,r)=>t.z-r.z)}updateOptions(e){const t=e.minZoom===void 0?this.options.minZoom:Math.ceil(e.minZoom),r=e.maxZoom===void 0?this.options.maxZoom:Math.floor(e.maxZoom);this.options=uM(q0(q0({},this.options),e),{minZoom:t,maxZoom:r})}update(e,t){const r=Math.max(0,Math.ceil(e));if(this.lastViewStates&&this.lastViewStates.zoom===r&&rM(this.lastViewStates.latLonBoundsBuffer,t))return;const n=tM(t,$b);this.lastViewStates={zoom:r,latLonBounds:t,latLonBoundsBuffer:n},this.currentZoom=r;let i=!1;const o=this.getTileIndices(r,n).filter(a=>this.options.warp||a.x>=0&&a.x<Math.pow(2,r));this.emit("tiles-load-start"),this.currentTiles=o.map(({x:a,y:s,z:u})=>{let l=this.getTile(a,s,u);return l?(((l==null?void 0:l.isFailure)||(l==null?void 0:l.isCancelled))&&l.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),l):(l=this.createTile(a,s,u),i=!0,l)}),i&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}reloadAll(){for(const[e,t]of this.cacheTiles){if(!this.currentTiles.includes(t)){this.cacheTiles.delete(e),this.onTileUnload(t);return}this.onTileUnload(t),t.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}reloadTileById(e,t,r){const n=this.cacheTiles.get(`${t},${r},${e}`);n&&(this.onTileUnload(n),n.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}reloadTileByLnglat(e,t,r){const n=this.getTileByLngLat(e,t,r);n&&this.reloadTileById(n.z,n.x,n.y)}reloadTileByExtent(e,t){this.getTileIndices(t,e).forEach(n=>{this.reloadTileById(n.z,n.x,n.y)})}pruneRequests(){const e=[];for(const t of this.cacheTiles.values())t.isLoading&&!t.isCurrent&&!t.isVisible&&e.push(t);for(;e.length>0;)e.shift().abortLoad()}getTileByLngLat(e,t,r){const{zoomOffset:n}=this.options,i=Math.ceil(r)+n,o=Uh(e,t,i);return this.tiles.filter(s=>s.key===`${o[0]}_${o[1]}_${i}`)[0]}getTileExtent(e,t){return this.getTileIndices(t,e)}getTileByZXY(e,t,r){return this.tiles.filter(i=>i.key===`${t}_${r}_${e}`)[0]}clear(){for(const e of this.cacheTiles.values())e.isLoading?e.abortLoad():this.onTileUnload(e);this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}destroy(){this.clear(),this.removeAllListeners()}updateTileVisible(){const e=this.options.updateStrategy,t=new Map;for(const i of this.cacheTiles.values())t.set(i.key,i.isVisible),i.isCurrent=!1,i.isVisible=!1;for(const i of this.currentTiles)i.isCurrent=!0,i.isVisible=!0;const r=Array.from(this.cacheTiles.values());typeof e=="function"?e(r):Zb[e](r);let n=!1;Array.from(this.cacheTiles.values()).forEach(i=>{i.isVisible!==t.get(i.key)?(i.isVisibleChange=!0,n=!0):i.isVisibleChange=!1}),n&&this.emit("tile-update")}getTileIndices(e,t){const{tileSize:r,extent:n,zoomOffset:i}=this.options,o=Math.floor(this.options.maxZoom),a=Math.ceil(this.options.minZoom);return Kb({maxZoom:o,minZoom:a,zoomOffset:i,tileSize:r,zoom:e,latLonBounds:t,extent:n})}getTileId(e,t,r){return`${e},${t},${r}`}loadFinished(){const e=!this.currentTiles.some(t=>!t.isDone);return e&&this.emit("tiles-load-finished"),e}getTile(e,t,r){const n=this.getTileId(e,t,r);return this.cacheTiles.get(n)}createTile(e,t,r){const n=this.getTileId(e,t,r),i=new eM({x:e,y:t,z:r,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(n,i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),i}resizeCacheTiles(){const e=Yb*this.currentTiles.length;if(this.cacheTiles.size>e){for(const[r,n]of this.cacheTiles)if(!n.isVisible&&!this.currentTiles.includes(n)&&(this.cacheTiles.delete(r),this.onTileUnload(n)),this.cacheTiles.size<=e)break}this.rebuildTileTree()}rebuildTileTree(){for(const e of this.cacheTiles.values())e.parent=null,e.children.length=0;for(const e of this.cacheTiles.values()){const t=this.getNearestAncestor(e.x,e.y,e.z);e.parent=t,t!=null&&t.children&&t.children.push(e)}}getNearestAncestor(e,t,r){for(;r>this.options.minZoom;){e=Math.floor(e/2),t=Math.floor(t/2),r=r-1;const n=this.getTile(e,t,r);if(n)return n}return null}};function R1(e){const t=[];let r=/\{([a-z])-([a-z])\}/.exec(e);if(r){const n=r[1].charCodeAt(0),i=r[2].charCodeAt(0);let o;for(o=n;o<=i;++o)t.push(e.replace(r[0],String.fromCharCode(o)));return t}if(r=/\{(\d+)-(\d+)\}/.exec(e),r){const n=parseInt(r[2],10);for(let i=parseInt(r[1],10);i<=n;i++)t.push(e.replace(r[0],i.toString()));return t}return t.push(e),t}function ma(e,t){if(!e||!e.length)throw new Error("url is not allowed to be empty");const{x:r,y:n,z:i}=t,o=R1(e),a=Math.abs(r+n)%o.length;return(Bd(o[a])?`${o[a]}/{z}/{x}/{y}`:o[a]).replace(/\{x\}/g,r.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,i.toString()).replace(/\{bbox\}/g,x1(r,n,i).join(",")).replace(/\{-y\}/g,(Math.pow(2,i)-n-1).toString())}function fM(e,t){const{x:r,y:n,z:i,layer:o,version:a="1.0.0",style:s="default",format:u,service:l="WMTS",tileMatrixset:f}=t,c=R1(e),h=Math.abs(r+n)%c.length;return`${c[h]}&SERVICE=${l}&REQUEST=GetTile&VERSION=${a}&LAYER=${o}&STYLE=${s}&TILEMATRIXSET=${f}&FORMAT=${u}&TILECOL=${r}&TILEROW=${n}&TILEMATRIX=${i}`}function ds(e,t){return e==null?t:e}var hM=Pl;function Pl(e,t){var r=e&&e.type,n;if(r==="FeatureCollection")for(n=0;n<e.features.length;n++)Pl(e.features[n],t);else if(r==="GeometryCollection")for(n=0;n<e.geometries.length;n++)Pl(e.geometries[n],t);else if(r==="Feature")Pl(e.geometry,t);else if(r==="Polygon")K0(e.coordinates,t);else if(r==="MultiPolygon")for(n=0;n<e.coordinates.length;n++)K0(e.coordinates[n],t);return e}function K0(e,t){if(e.length!==0){Q0(e[0],t);for(var r=1;r<e.length;r++)Q0(e[r],!t)}}function Q0(e,t){for(var r=0,n=0,i=0,o=e.length,a=o-1;i<o;a=i++){var s=(e[i][0]-e[a][0])*(e[a][1]+e[i][1]),u=r+s;n+=Math.abs(r)>=Math.abs(s)?r-u+s:s-u+r,r=u}r+n>=0!=!!t&&e.reverse()}function dM(e,t){return e.map(r=>r[t]*1)}function C1(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function kh(e){const t=Object.isFrozen(e)?Ar.cloneDeep(e):e;return hM(t,!0),t}function Eu(e,t){return e||[[t[0],t[3]],[t[2],t[3]],[t[2],t[1]],[t[0],t[1]]]}var pM=Object.defineProperty,_M=Object.defineProperties,vM=Object.getOwnPropertyDescriptors,J0=Object.getOwnPropertySymbols,mM=Object.prototype.hasOwnProperty,gM=Object.prototype.propertyIsEnumerable,ev=(e,t,r)=>t in e?pM(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,tv=(e,t)=>{for(var r in t||(t={}))mM.call(t,r)&&ev(e,r,t[r]);if(J0)for(var r of J0(t))gM.call(t,r)&&ev(e,r,t[r]);return e},rv=(e,t)=>_M(e,vM(t));function b1(e,t){const{x:r,y:n,x1:i,y1:o,coordinates:a,geometry:s}=t,u=[];if(!Array.isArray(e))return{dataArray:[]};if(s)return e.filter(l=>l[s]&&l[s].type&&l[s].coordinates&&l[s].coordinates.length>0).forEach((l,f)=>{const c=kh(l[s]);YE(c,h=>{const d=GE(h),p=rv(tv({},l),{_id:f,coordinates:d});u.push(p)})}),{dataArray:u};for(let l=0;l<e.length;l++){const f=e[l];let c=[];if(a){let d="Polygon";Array.isArray(a[0])||(d="Point"),Array.isArray(a[0])&&!Array.isArray(a[0][0])&&(d="LineString"),c=kh({type:d,coordinates:f[a]}).coordinates}else if(r&&n&&i&&o){const d=[parseFloat(f[r]),parseFloat(f[n])],p=[parseFloat(f[i]),parseFloat(f[o])];c=[d,p]}else r&&n&&(c=[parseFloat(f[r]),parseFloat(f[n])]);const h=rv(tv({},f),{_id:l,coordinates:c});u.push(h)}return{dataArray:u}}function EM(e,t){const r=Kx(e);return b1(r,t)}var yM=Object.defineProperty,AM=Object.defineProperties,TM=Object.getOwnPropertyDescriptors,nv=Object.getOwnPropertySymbols,SM=Object.prototype.hasOwnProperty,xM=Object.prototype.propertyIsEnumerable,iv=(e,t,r)=>t in e?yM(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,RM=(e,t)=>{for(var r in t||(t={}))SM.call(t,r)&&iv(e,r,t[r]);if(nv)for(var r of nv(t))xM.call(t,r)&&iv(e,r,t[r]);return e},CM=(e,t)=>AM(e,TM(t));function bM(e){const t=e.toString();let r=5381,n=t.length;for(;n;)r=r*33^t.charCodeAt(--n);return r>>>0}function MM(e,t){return t===void 0?null:typeof(e.properties[t]*1)=="number"?e.properties[t]*1:e.properties&&e.properties[t]?bM(e.properties[t]+"")%1000019:null}function IM(e,t){const r=[],n={};return e.features?(e.features=e.features.filter(i=>{const o=i.geometry;return i!=null&&o&&o.type&&o.coordinates&&o.coordinates.length>0}),e=kh(e),e.features.length===0?{dataArray:[],featureKeys:n}:(YE(e,(i,o)=>{let a=MM(i,t==null?void 0:t.featureId);a===null&&(a=o);const s=a,u=GE(i),l=CM(RM({},i.properties),{coordinates:u,_id:s});r.push(l)}),{dataArray:r,featureKeys:n})):(e.features=[],{dataArray:[]})}function zh(e,t,r,n){for(var i=n,o=r-t>>1,a=r-t,s,u=e[t],l=e[t+1],f=e[r],c=e[r+1],h=t+3;h<r;h+=3){var d=OM(e[h],e[h+1],u,l,f,c);if(d>i)s=h,i=d;else if(d===i){var p=Math.abs(h-o);p<a&&(s=h,a=p)}}i>n&&(s-t>3&&zh(e,t,s,n),e[s+2]=i,r-s>3&&zh(e,s,r,n))}function OM(e,t,r,n,i,o){var a=i-r,s=o-n;if(a!==0||s!==0){var u=((e-r)*a+(t-n)*s)/(a*a+s*s);u>1?(r=i,n=o):u>0&&(r+=a*u,n+=s*u)}return a=e-r,s=t-n,a*a+s*s}function tu(e,t,r,n){var i={id:typeof e>"u"?null:e,type:t,geometry:r,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return PM(i),i}function PM(e){var t=e.geometry,r=e.type;if(r==="Point"||r==="MultiPoint"||r==="LineString")rh(e,t);else if(r==="Polygon"||r==="MultiLineString")for(var n=0;n<t.length;n++)rh(e,t[n]);else if(r==="MultiPolygon")for(n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++)rh(e,t[n][i])}function rh(e,t){for(var r=0;r<t.length;r+=3)e.minX=Math.min(e.minX,t[r]),e.minY=Math.min(e.minY,t[r+1]),e.maxX=Math.max(e.maxX,t[r]),e.maxY=Math.max(e.maxY,t[r+1])}function NM(e,t){var r=[];if(e.type==="FeatureCollection")for(var n=0;n<e.features.length;n++)Nl(r,e.features[n],t,n);else e.type==="Feature"?Nl(r,e,t):Nl(r,{geometry:e},t);return r}function Nl(e,t,r,n){if(!!t.geometry){var i=t.geometry.coordinates,o=t.geometry.type,a=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),s=[],u=t.id;if(r.promoteId?u=t.properties[r.promoteId]:r.generateId&&(u=n||0),o==="Point")ov(i,s);else if(o==="MultiPoint")for(var l=0;l<i.length;l++)ov(i[l],s);else if(o==="LineString")Vh(i,s,a,!1);else if(o==="MultiLineString")if(r.lineMetrics){for(l=0;l<i.length;l++)s=[],Vh(i[l],s,a,!1),e.push(tu(u,"LineString",s,t.properties));return}else nh(i,s,a,!1);else if(o==="Polygon")nh(i,s,a,!0);else if(o==="MultiPolygon")for(l=0;l<i.length;l++){var f=[];nh(i[l],f,a,!0),s.push(f)}else if(o==="GeometryCollection"){for(l=0;l<t.geometry.geometries.length;l++)Nl(e,{id:u,geometry:t.geometry.geometries[l],properties:t.properties},r,n);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(tu(u,o,s,t.properties))}}function ov(e,t){t.push(M1(e[0])),t.push(I1(e[1])),t.push(0)}function Vh(e,t,r,n){for(var i,o,a=0,s=0;s<e.length;s++){var u=M1(e[s][0]),l=I1(e[s][1]);t.push(u),t.push(l),t.push(0),s>0&&(n?a+=(i*l-u*o)/2:a+=Math.sqrt(Math.pow(u-i,2)+Math.pow(l-o,2))),i=u,o=l}var f=t.length-3;t[2]=1,zh(t,0,f,r),t[f+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function nh(e,t,r,n){for(var i=0;i<e.length;i++){var o=[];Vh(e[i],o,r,n),t.push(o)}}function M1(e){return e/360+.5}function I1(e){var t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function pi(e,t,r,n,i,o,a,s){if(r/=t,n/=t,o>=r&&a<n)return e;if(a<r||o>=n)return null;for(var u=[],l=0;l<e.length;l++){var f=e[l],c=f.geometry,h=f.type,d=i===0?f.minX:f.minY,p=i===0?f.maxX:f.maxY;if(d>=r&&p<n){u.push(f);continue}else if(p<r||d>=n)continue;var v=[];if(h==="Point"||h==="MultiPoint")FM(c,v,r,n,i);else if(h==="LineString")O1(c,v,r,n,i,!1,s.lineMetrics);else if(h==="MultiLineString")ih(c,v,r,n,i,!1);else if(h==="Polygon")ih(c,v,r,n,i,!0);else if(h==="MultiPolygon")for(var m=0;m<c.length;m++){var y=[];ih(c[m],y,r,n,i,!0),y.length&&v.push(y)}if(v.length){if(s.lineMetrics&&h==="LineString"){for(m=0;m<v.length;m++)u.push(tu(f.id,h,v[m],f.tags));continue}(h==="LineString"||h==="MultiLineString")&&(v.length===1?(h="LineString",v=v[0]):h="MultiLineString"),(h==="Point"||h==="MultiPoint")&&(h=v.length===3?"Point":"MultiPoint"),u.push(tu(f.id,h,v,f.tags))}}return u.length?u:null}function FM(e,t,r,n,i){for(var o=0;o<e.length;o+=3){var a=e[o+i];a>=r&&a<=n&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function O1(e,t,r,n,i,o,a){for(var s=av(e),u=i===0?DM:BM,l=e.start,f,c,h=0;h<e.length-3;h+=3){var d=e[h],p=e[h+1],v=e[h+2],m=e[h+3],y=e[h+4],A=i===0?d:p,T=i===0?m:y,R=!1;a&&(f=Math.sqrt(Math.pow(d-m,2)+Math.pow(p-y,2))),A<r?T>r&&(c=u(s,d,p,m,y,r),a&&(s.start=l+f*c)):A>n?T<n&&(c=u(s,d,p,m,y,n),a&&(s.start=l+f*c)):oh(s,d,p,v),T<r&&A>=r&&(c=u(s,d,p,m,y,r),R=!0),T>n&&A<=n&&(c=u(s,d,p,m,y,n),R=!0),!o&&R&&(a&&(s.end=l+f*c),t.push(s),s=av(e)),a&&(l+=f)}var b=e.length-3;d=e[b],p=e[b+1],v=e[b+2],A=i===0?d:p,A>=r&&A<=n&&oh(s,d,p,v),b=s.length-3,o&&b>=3&&(s[b]!==s[0]||s[b+1]!==s[1])&&oh(s,s[0],s[1],s[2]),s.length&&t.push(s)}function av(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function ih(e,t,r,n,i,o){for(var a=0;a<e.length;a++)O1(e[a],t,r,n,i,o,!1)}function oh(e,t,r,n){e.push(t),e.push(r),e.push(n)}function DM(e,t,r,n,i,o){var a=(o-t)/(n-t);return e.push(o),e.push(r+(i-r)*a),e.push(1),a}function BM(e,t,r,n,i,o){var a=(o-r)/(i-r);return e.push(t+(n-t)*a),e.push(o),e.push(1),a}function wM(e,t){var r=t.buffer/t.extent,n=e,i=pi(e,1,-1-r,r,0,-1,2,t),o=pi(e,1,1-r,2+r,0,-1,2,t);return(i||o)&&(n=pi(e,1,-r,1+r,0,-1,2,t)||[],i&&(n=sv(i,1).concat(n)),o&&(n=n.concat(sv(o,-1)))),n}function sv(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n],o=i.type,a;if(o==="Point"||o==="MultiPoint"||o==="LineString")a=ah(i.geometry,t);else if(o==="MultiLineString"||o==="Polygon"){a=[];for(var s=0;s<i.geometry.length;s++)a.push(ah(i.geometry[s],t))}else if(o==="MultiPolygon")for(a=[],s=0;s<i.geometry.length;s++){for(var u=[],l=0;l<i.geometry[s].length;l++)u.push(ah(i.geometry[s][l],t));a.push(u)}r.push(tu(i.id,o,a,i.tags))}return r}function ah(e,t){var r=[];r.size=e.size,e.start!==void 0&&(r.start=e.start,r.end=e.end);for(var n=0;n<e.length;n+=3)r.push(e[n]+t,e[n+1],e[n+2]);return r}function uv(e,t){if(e.transformed)return e;var r=1<<e.z,n=e.x,i=e.y,o,a,s;for(o=0;o<e.features.length;o++){var u=e.features[o],l=u.geometry,f=u.type;if(u.geometry=[],f===1)for(a=0;a<l.length;a+=2)u.geometry.push(lv(l[a],l[a+1],t,r,n,i));else for(a=0;a<l.length;a++){var c=[];for(s=0;s<l[a].length;s+=2)c.push(lv(l[a][s],l[a][s+1],t,r,n,i));u.geometry.push(c)}}return e.transformed=!0,e}function lv(e,t,r,n,i,o){return[Math.round(r*(e*n-i)),Math.round(r*(t*n-o))]}function LM(e,t,r,n,i){for(var o=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){a.numFeatures++,UM(a,e[s],o,i);var u=e[s].minX,l=e[s].minY,f=e[s].maxX,c=e[s].maxY;u<a.minX&&(a.minX=u),l<a.minY&&(a.minY=l),f>a.maxX&&(a.maxX=f),c>a.maxY&&(a.maxY=c)}return a}function UM(e,t,r,n){var i=t.geometry,o=t.type,a=[];if(o==="Point"||o==="MultiPoint")for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),e.numPoints++,e.numSimplified++;else if(o==="LineString")sh(a,i,e,r,!1,!1);else if(o==="MultiLineString"||o==="Polygon")for(s=0;s<i.length;s++)sh(a,i[s],e,r,o==="Polygon",s===0);else if(o==="MultiPolygon")for(var u=0;u<i.length;u++){var l=i[u];for(s=0;s<l.length;s++)sh(a,l[s],e,r,!0,s===0)}if(a.length){var f=t.tags||null;if(o==="LineString"&&n.lineMetrics){f={};for(var c in t.tags)f[c]=t.tags[c];f.mapbox_clip_start=i.start/i.size,f.mapbox_clip_end=i.end/i.size}var h={geometry:a,type:o==="Polygon"||o==="MultiPolygon"?3:o==="LineString"||o==="MultiLineString"?2:1,tags:f};t.id!==null&&(h.id=t.id),e.features.push(h)}}function sh(e,t,r,n,i,o){var a=n*n;if(n>0&&t.size<(i?a:n)){r.numPoints+=t.length/3;return}for(var s=[],u=0;u<t.length;u+=3)(n===0||t[u+2]>a)&&(r.numSimplified++,s.push(t[u]),s.push(t[u+1])),r.numPoints++;i&&kM(s,o),e.push(s)}function kM(e,t){for(var r=0,n=0,i=e.length,o=i-2;n<i;o=n,n+=2)r+=(e[n]-e[o])*(e[n+1]+e[o+1]);if(r>0===t)for(n=0,i=e.length;n<i/2;n+=2){var a=e[n],s=e[n+1];e[n]=e[i-2-n],e[n+1]=e[i-1-n],e[i-2-n]=a,e[i-1-n]=s}}function zM(e,t){return new bc(e,t)}function bc(e,t){t=this.options=VM(Object.create(this.options),t);var r=t.debug;if(r&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=NM(e,t);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=wM(n,t),n.length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}bc.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};bc.prototype.splitTile=function(e,t,r,n,i,o,a){for(var s=[e,t,r,n],u=this.options,l=u.debug;s.length;){n=s.pop(),r=s.pop(),t=s.pop(),e=s.pop();var f=1<<t,c=Hh(t,r,n),h=this.tiles[c];if(!h&&(l>1&&console.time("creation"),h=this.tiles[c]=LM(e,t,r,n,u),this.tileCoords.push({z:t,x:r,y:n}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,r,n,h.numFeatures,h.numPoints,h.numSimplified),console.timeEnd("creation"));var d="z"+t;this.stats[d]=(this.stats[d]||0)+1,this.total++}if(h.source=e,i){if(t===u.maxZoom||t===i)continue;var p=1<<i-t;if(r!==Math.floor(o/p)||n!==Math.floor(a/p))continue}else if(t===u.indexMaxZoom||h.numPoints<=u.indexMaxPoints)continue;if(h.source=null,e.length!==0){l>1&&console.time("clipping");var v=.5*u.buffer/u.extent,m=.5-v,y=.5+v,A=1+v,T,R,b,H,B,q;T=R=b=H=null,B=pi(e,f,r-v,r+y,0,h.minX,h.maxX,u),q=pi(e,f,r+m,r+A,0,h.minX,h.maxX,u),e=null,B&&(T=pi(B,f,n-v,n+y,1,h.minY,h.maxY,u),R=pi(B,f,n+m,n+A,1,h.minY,h.maxY,u),B=null),q&&(b=pi(q,f,n-v,n+y,1,h.minY,h.maxY,u),H=pi(q,f,n+m,n+A,1,h.minY,h.maxY,u),q=null),l>1&&console.timeEnd("clipping"),s.push(T||[],t+1,r*2,n*2),s.push(R||[],t+1,r*2,n*2+1),s.push(b||[],t+1,r*2+1,n*2),s.push(H||[],t+1,r*2+1,n*2+1)}}};bc.prototype.getTile=function(e,t,r){var n=this.options,i=n.extent,o=n.debug;if(e<0||e>24)return null;var a=1<<e;t=(t%a+a)%a;var s=Hh(e,t,r);if(this.tiles[s])return uv(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",e,t,r);for(var u=e,l=t,f=r,c;!c&&u>0;)u--,l=Math.floor(l/2),f=Math.floor(f/2),c=this.tiles[Hh(u,l,f)];return!c||!c.source?null:(o>1&&console.log("found parent tile z%d-%d-%d",u,l,f),o>1&&console.time("drilling down"),this.splitTile(c.source,u,l,f,e,t,r),o>1&&console.timeEnd("drilling down"),this.tiles[s]?uv(this.tiles[s],i):null)};function Hh(e,t,r){return((1<<e)*r+t)*32+e}function VM(e,t){for(var r in t)e[r]=t[r];return e}var Bs=class{constructor(e,t,r,n){this.vectorLayerCache={},this.x=t,this.y=r,this.z=n,this.vectorTile=e}getTileData(e){return!e||!this.vectorTile.layers[e]?[]:this.vectorLayerCache[e]?this.vectorLayerCache[e]:this.vectorTile.layers[e].features}getFeatureById(){throw new Error("Method not implemented.")}},HM=Object.defineProperty,XM=Object.defineProperties,WM=Object.getOwnPropertyDescriptors,cv=Object.getOwnPropertySymbols,jM=Object.prototype.hasOwnProperty,GM=Object.prototype.propertyIsEnumerable,fv=(e,t,r)=>t in e?HM(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,$l=(e,t)=>{for(var r in t||(t={}))jM.call(t,r)&&fv(e,r,t[r]);if(cv)for(var r of cv(t))GM.call(t,r)&&fv(e,r,t[r]);return e},$M=(e,t)=>XM(e,WM(t)),YM=(e,t,r)=>new Promise((n,i)=>{var o=u=>{try{s(r.next(u))}catch(l){i(l)}},a=u=>{try{s(r.throw(u))}catch(l){i(l)}},s=u=>u.done?n(u.value):Promise.resolve(u.value).then(o,a);s((r=r.apply(e,t)).next())}),ZM={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function qM(e){let t=0;for(let r=0,n=e.length,i=n-1,o,a;r<n;i=r++)o=e[r],a=e[i],t+=(a.x-o.x)*(o.y+a.y);return t}function KM(e){const t=e.length;if(t<=1)return[e];const r=[];let n,i;for(let o=0;o<t;o++){const a=qM(e[o]);a!==0&&(i===void 0&&(i=a<0),i===a<0?(n&&r.push(n),n=[e[o]]):n.push(e[o]))}return n&&r.push(n),r}var QM=["Unknown","Point","LineString","Polygon"];function JM(e,t,r,n,i){let o=i.geometry;const a=i.type,s=i.tags,u=i.id,l=e*Math.pow(2,n),f=e*t,c=e*r;let h=QM[a],d,p;function v(y){for(let A=0;A<y.length;A++){const T=y[A];if(T[3])break;const R=180-(T[1]+c)*360/l,b=(T[0]+f)*360/l-180,H=360/Math.PI*Math.atan(Math.exp(R*Math.PI/180))-90;y[A]=[b,H,0,1]}}switch(a){case 1:const y=[];for(d=0;d<o.length;d++)y[d]=o[d][0];o=y,v(o);break;case 2:for(d=0;d<o.length;d++)v(o[d]);break;case 3:for(o=KM(o),d=0;d<o.length;d++)for(p=0;p<o[d].length;p++)v(o[d][p]);break}return o.length===1?o=o[0]:h="Multi"+h,{type:"Feature",geometry:{type:h,coordinates:o},properties:s,id:u,tileOrigin:[0,0],coord:""}}var eI=(e,t,r,n)=>YM(void 0,null,function*(){return new Promise(i=>{const o=t.getTile(e.z,e.x,e.y),s={layers:{defaultLayer:{features:o?o.features.map(l=>JM(n,r.x,r.y,r.z,l)):[]}}},u=new Bs(s,e.x,e.y,e.z);i(u)})});function tI(e){const t={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions>"u"?t:$l($l({},t),e.geojsonvtOptions)}function rI(e,t){const r=tI(t),n=r.extent||4096,i=zM(e,r),o=(s,u)=>eI(u,i,s,n),a=$M($l($l({},ZM),t),{getTileData:o});return{data:e,dataArray:[],tilesetOptions:a,isTile:!0}}var nI=Object.defineProperty,iI=Object.defineProperties,oI=Object.getOwnPropertyDescriptors,hv=Object.getOwnPropertySymbols,aI=Object.prototype.hasOwnProperty,sI=Object.prototype.propertyIsEnumerable,dv=(e,t,r)=>t in e?nI(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,pv=(e,t)=>{for(var r in t||(t={}))aI.call(t,r)&&dv(e,r,t[r]);if(hv)for(var r of hv(t))sI.call(t,r)&&dv(e,r,t[r]);return e},_v=(e,t)=>iI(e,oI(t));function P1(e,t){const{extent:r=[121.168,30.2828,121.384,30.4219],coordinates:n,requestParameters:i={}}=t,o=new Promise(u=>{e instanceof HTMLImageElement||bb(e)?u([e]):uI(e,i,l=>{u(l)})}),a=Eu(n,r);return{originData:e,images:o,_id:1,dataArray:[{_id:0,coordinates:a}]}}function uI(e,t,r){const n=[];if(typeof e=="string")Nh(_v(pv({},t),{url:e}),(i,o)=>{o&&(n.push(o),r(n))});else{const i=e.length;let o=0;e.forEach(a=>{Nh(_v(pv({},t),{url:a}),(s,u)=>{o++,u&&n.push(u),o===i&&r(n)})})}return P1}var lI=Object.defineProperty,cI=Object.defineProperties,fI=Object.getOwnPropertyDescriptors,vv=Object.getOwnPropertySymbols,hI=Object.prototype.hasOwnProperty,dI=Object.prototype.propertyIsEnumerable,mv=(e,t,r)=>t in e?lI(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,N1=(e,t)=>{for(var r in t||(t={}))hI.call(t,r)&&mv(e,r,t[r]);if(vv)for(var r of vv(t))dI.call(t,r)&&mv(e,r,t[r]);return e},F1=(e,t)=>cI(e,fI(t)),pI=(e,t,r)=>new Promise((n,i)=>{var o=u=>{try{s(r.next(u))}catch(l){i(l)}},a=u=>{try{s(r.throw(u))}catch(l){i(l)}},s=u=>u.done?n(u.value):Promise.resolve(u.value).then(o,a);s((r=r.apply(e,t)).next())}),_I=(e,t,r,n)=>pI(void 0,null,function*(){const i={x:t.x,y:t.y,z:t.z},o=ma(e,i);return new Promise(a=>{n?n(i,(s,u)=>{if(s||!u){const l={layers:{defaultLayer:{features:[]}}},f=new Bs(l,t.x,t.y,t.z);a(f)}else{const l={layers:{defaultLayer:{features:u.features}}},f=new Bs(l,t.x,t.y,t.z);a(f)}}):c2(F1(N1({},r),{url:o}),(s,u)=>{if(s||!u){const l={layers:{defaultLayer:{features:[]}}},f=new Bs(l,t.x,t.y,t.z);a(f)}else{const f={layers:{defaultLayer:{features:JSON.parse(u)}}},c=new Bs(f,t.x,t.y,t.z);a(c)}})})});function vI(e,t){const r=(i,o)=>_I(e,o,t==null?void 0:t.requestParameters,t.getCustomData),n=F1(N1({},t),{getTileData:r});return{dataArray:[],tilesetOptions:n,isTile:!0}}var mI=ga;function ga(e,t){this.x=e,this.y=t}ga.prototype={clone:function(){return new ga(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,r=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=r,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),n=t*this.x-r*this.y,i=r*this.x+t*this.y;return this.x=n,this.y=i,this},_rotateAround:function(e,t){var r=Math.cos(e),n=Math.sin(e),i=t.x+r*(this.x-t.x)-n*(this.y-t.y),o=t.y+n*(this.x-t.x)+r*(this.y-t.y);return this.x=i,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}};ga.convert=function(e){return e instanceof ga?e:Array.isArray(e)?new ga(e[0],e[1]):e};var gI=mI,EI=Ca;function Ca(e,t,r,n,i){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=i,e.readFields(yI,this,t)}function yI(e,t,r){e==1?t.id=r.readVarint():e==2?AI(r,t):e==3?t.type=r.readVarint():e==4&&(t._geometry=r.pos)}function AI(e,t){for(var r=e.readVarint()+e.pos;e.pos<r;){var n=t._keys[e.readVarint()],i=t._values[e.readVarint()];t.properties[n]=i}}Ca.types=["Unknown","Point","LineString","Polygon"];Ca.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,n=0,i=0,o=0,a=[],s;e.pos<t;){if(n<=0){var u=e.readVarint();r=u&7,n=u>>3}if(n--,r===1||r===2)i+=e.readSVarint(),o+=e.readSVarint(),r===1&&(s&&a.push(s),s=[]),s.push(new gI(i,o));else if(r===7)s&&s.push(s[0].clone());else throw new Error("unknown command "+r)}return s&&a.push(s),a};Ca.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,n=0,i=0,o=0,a=1/0,s=-1/0,u=1/0,l=-1/0;e.pos<t;){if(n<=0){var f=e.readVarint();r=f&7,n=f>>3}if(n--,r===1||r===2)i+=e.readSVarint(),o+=e.readSVarint(),i<a&&(a=i),i>s&&(s=i),o<u&&(u=o),o>l&&(l=o);else if(r!==7)throw new Error("unknown command "+r)}return[a,u,s,l]};Ca.prototype.toGeoJSON=function(e,t,r){var n=this.extent*Math.pow(2,r),i=this.extent*e,o=this.extent*t,a=this.loadGeometry(),s=Ca.types[this.type],u,l;function f(d){for(var p=0;p<d.length;p++){var v=d[p],m=180-(v.y+o)*360/n;d[p]=[(v.x+i)*360/n-180,360/Math.PI*Math.atan(Math.exp(m*Math.PI/180))-90]}}switch(this.type){case 1:var c=[];for(u=0;u<a.length;u++)c[u]=a[u][0];a=c,f(a);break;case 2:for(u=0;u<a.length;u++)f(a[u]);break;case 3:for(a=TI(a),u=0;u<a.length;u++)for(l=0;l<a[u].length;l++)f(a[u][l]);break}a.length===1?a=a[0]:s="Multi"+s;var h={type:"Feature",geometry:{type:s,coordinates:a},properties:this.properties};return"id"in this&&(h.id=this.id),h};function TI(e){var t=e.length;if(t<=1)return[e];for(var r=[],n,i,o=0;o<t;o++){var a=SI(e[o]);a!==0&&(i===void 0&&(i=a<0),i===a<0?(n&&r.push(n),n=[e[o]]):n.push(e[o]))}return n&&r.push(n),r}function SI(e){for(var t=0,r=0,n=e.length,i=n-1,o,a;r<n;i=r++)o=e[r],a=e[i],t+=(a.x-o.x)*(o.y+a.y);return t}var xI=EI,RI=D1;function D1(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(CI,this,t),this.length=this._features.length}function CI(e,t,r){e===15?t.version=r.readVarint():e===1?t.name=r.readString():e===5?t.extent=r.readVarint():e===2?t._features.push(r.pos):e===3?t._keys.push(r.readString()):e===4&&t._values.push(bI(r))}function bI(e){for(var t=null,r=e.readVarint()+e.pos;e.pos<r;){var n=e.readVarint()>>3;t=n===1?e.readString():n===2?e.readFloat():n===3?e.readDouble():n===4?e.readVarint64():n===5?e.readVarint():n===6?e.readSVarint():n===7?e.readBoolean():null}return t}D1.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new xI(this._pbf,t,this.extent,this._keys,this._values)};var MI=RI,II=OI;function OI(e,t){this.layers=e.readFields(PI,{},t)}function PI(e,t,r){if(e===3){var n=new MI(r,r.readVarint()+r.pos);n.length&&(t[n.name]=n)}}var NI=II,$d={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */$d.read=function(e,t,r,n,i){var o,a,s=i*8-n-1,u=(1<<s)-1,l=u>>1,f=-7,c=r?i-1:0,h=r?-1:1,d=e[t+c];for(c+=h,o=d&(1<<-f)-1,d>>=-f,f+=s;f>0;o=o*256+e[t+c],c+=h,f-=8);for(a=o&(1<<-f)-1,o>>=-f,f+=n;f>0;a=a*256+e[t+c],c+=h,f-=8);if(o===0)o=1-l;else{if(o===u)return a?NaN:(d?-1:1)*(1/0);a=a+Math.pow(2,n),o=o-l}return(d?-1:1)*a*Math.pow(2,o-n)};$d.write=function(e,t,r,n,i,o){var a,s,u,l=o*8-i-1,f=(1<<l)-1,c=f>>1,h=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,p=n?1:-1,v=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=f):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),a+c>=1?t+=h/u:t+=h*Math.pow(2,1-c),t*u>=2&&(a++,u/=2),a+c>=f?(s=0,a=f):a+c>=1?(s=(t*u-1)*Math.pow(2,i),a=a+c):(s=t*Math.pow(2,c-1)*Math.pow(2,i),a=0));i>=8;e[r+d]=s&255,d+=p,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;e[r+d]=a&255,d+=p,a/=256,l-=8);e[r+d-p]|=v*128};var FI=Wt,fl=$d;function Wt(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Wt.Varint=0;Wt.Fixed64=1;Wt.Bytes=2;Wt.Fixed32=5;var Xh=(1<<16)*(1<<16),gv=1/Xh,DI=12,B1=typeof TextDecoder>"u"?null:new TextDecoder("utf8");Wt.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,o=this.pos;this.type=n&7,e(i,t,this),this.pos===o&&this.skip(n)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=hl(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=yv(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=hl(this.buf,this.pos)+hl(this.buf,this.pos+4)*Xh;return this.pos+=8,e},readSFixed64:function(){var e=hl(this.buf,this.pos)+yv(this.buf,this.pos+4)*Xh;return this.pos+=8,e},readFloat:function(){var e=fl.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=fl.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t=this.buf,r,n;return n=t[this.pos++],r=n&127,n<128||(n=t[this.pos++],r|=(n&127)<<7,n<128)||(n=t[this.pos++],r|=(n&127)<<14,n<128)||(n=t[this.pos++],r|=(n&127)<<21,n<128)?r:(n=t[this.pos],r|=(n&15)<<28,BI(r,e,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2===1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=DI&&B1?ZI(this.buf,t,e):YI(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Wt.Bytes)return e.push(this.readVarint(t));var r=hi(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Wt.Bytes)return e.push(this.readSVarint());var t=hi(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Wt.Bytes)return e.push(this.readBoolean());var t=hi(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Wt.Bytes)return e.push(this.readFloat());var t=hi(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Wt.Bytes)return e.push(this.readDouble());var t=hi(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Wt.Bytes)return e.push(this.readFixed32());var t=hi(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Wt.Bytes)return e.push(this.readSFixed32());var t=hi(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Wt.Bytes)return e.push(this.readFixed64());var t=hi(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Wt.Bytes)return e.push(this.readSFixed64());var t=hi(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=e&7;if(t===Wt.Varint)for(;this.buf[this.pos++]>127;);else if(t===Wt.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Wt.Fixed32)this.pos+=4;else if(t===Wt.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+t)},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),ea(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),ea(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),ea(this.buf,e&-1,this.pos),ea(this.buf,Math.floor(e*gv),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),ea(this.buf,e&-1,this.pos),ea(this.buf,Math.floor(e*gv),this.pos+4),this.pos+=8},writeVarint:function(e){if(e=+e||0,e>268435455||e<0){wI(e,this);return}this.realloc(4),this.buf[this.pos++]=e&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=e>>>7&127)))},writeSVarint:function(e){this.writeVarint(e<0?-e*2-1:e*2)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(e.length*4),this.pos++;var t=this.pos;this.pos=qI(this.buf,e,this.pos);var r=this.pos-t;r>=128&&Ev(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),fl.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),fl.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var n=this.pos-r;n>=128&&Ev(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(e,t,r){this.writeTag(e,Wt.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,kI,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,zI,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,XI,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,VI,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,HI,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,WI,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,jI,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,GI,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,$I,t)},writeBytesField:function(e,t){this.writeTag(e,Wt.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Wt.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Wt.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Wt.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Wt.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Wt.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Wt.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Wt.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Wt.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Wt.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};function BI(e,t,r){var n=r.buf,i,o;if(o=n[r.pos++],i=(o&112)>>4,o<128||(o=n[r.pos++],i|=(o&127)<<3,o<128)||(o=n[r.pos++],i|=(o&127)<<10,o<128)||(o=n[r.pos++],i|=(o&127)<<17,o<128)||(o=n[r.pos++],i|=(o&127)<<24,o<128)||(o=n[r.pos++],i|=(o&1)<<31,o<128))return Jo(e,i,t);throw new Error("Expected varint not more than 10 bytes")}function hi(e){return e.type===Wt.Bytes?e.readVarint()+e.pos:e.pos+1}function Jo(e,t,r){return r?t*4294967296+(e>>>0):(t>>>0)*4294967296+(e>>>0)}function wI(e,t){var r,n;if(e>=0?(r=e%4294967296|0,n=e/4294967296|0):(r=~(-e%4294967296),n=~(-e/4294967296),r^4294967295?r=r+1|0:(r=0,n=n+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),LI(r,n,t),UI(n,t)}function LI(e,t,r){r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos]=e&127}function UI(e,t){var r=(e&7)<<4;t.buf[t.pos++]|=r|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127)))))}function Ev(e,t,r){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(Math.LN2*7));r.realloc(n);for(var i=r.pos-1;i>=e;i--)r.buf[i+n]=r.buf[i]}function kI(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function zI(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function VI(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function HI(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function XI(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function WI(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function jI(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function GI(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function $I(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function hl(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+e[t+3]*16777216}function ea(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function yv(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function YI(e,t,r){for(var n="",i=t;i<r;){var o=e[i],a=null,s=o>239?4:o>223?3:o>191?2:1;if(i+s>r)break;var u,l,f;s===1?o<128&&(a=o):s===2?(u=e[i+1],(u&192)===128&&(a=(o&31)<<6|u&63,a<=127&&(a=null))):s===3?(u=e[i+1],l=e[i+2],(u&192)===128&&(l&192)===128&&(a=(o&15)<<12|(u&63)<<6|l&63,(a<=2047||a>=55296&&a<=57343)&&(a=null))):s===4&&(u=e[i+1],l=e[i+2],f=e[i+3],(u&192)===128&&(l&192)===128&&(f&192)===128&&(a=(o&15)<<18|(u&63)<<12|(l&63)<<6|f&63,(a<=65535||a>=1114112)&&(a=null))),a===null?(a=65533,s=1):a>65535&&(a-=65536,n+=String.fromCharCode(a>>>10&1023|55296),a=56320|a&1023),n+=String.fromCharCode(a),i+=s}return n}function ZI(e,t,r){return B1.decode(e.subarray(t,r))}function qI(e,t,r){for(var n=0,i,o;n<t.length;n++){if(i=t.charCodeAt(n),i>55295&&i<57344)if(o)if(i<56320){e[r++]=239,e[r++]=191,e[r++]=189,o=i;continue}else i=o-55296<<10|i-56320|65536,o=null;else{i>56319||n+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):o=i;continue}else o&&(e[r++]=239,e[r++]=191,e[r++]=189,o=null);i<128?e[r++]=i:(i<2048?e[r++]=i>>6|192:(i<65536?e[r++]=i>>12|224:(e[r++]=i>>18|240,e[r++]=i>>12&63|128),e[r++]=i>>6&63|128),e[r++]=i&63|128)}return r}var KI=Object.defineProperty,QI=Object.defineProperties,JI=Object.getOwnPropertyDescriptors,Av=Object.getOwnPropertySymbols,eO=Object.prototype.hasOwnProperty,tO=Object.prototype.propertyIsEnumerable,Tv=(e,t,r)=>t in e?KI(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Sv=(e,t)=>{for(var r in t||(t={}))eO.call(t,r)&&Tv(e,r,t[r]);if(Av)for(var r of Av(t))tO.call(t,r)&&Tv(e,r,t[r]);return e},rO=(e,t)=>QI(e,JI(t)),xv=class{constructor(e,t,r,n){this.vectorLayerCache={},this.x=t,this.y=r,this.z=n,this.vectorTile=new NI(new FI(e))}getTileData(e){if(!e||!this.vectorTile.layers[e])return[];if(this.vectorLayerCache[e])return this.vectorLayerCache[e];const t=this.vectorTile.layers[e];if(Array.isArray(t.features))return this.vectorLayerCache[e]=t.features,t.features;const r=[];for(let n=0;n<t.length;n++){const o=t.feature(n).toGeoJSON(this.x,this.y,this.z);r.push(rO(Sv({},o),{properties:Sv({id:o.id},o.properties)}))}return this.vectorLayerCache[e]=r,r}getFeatureById(){throw new Error("Method not implemented.")}},nO=Object.defineProperty,iO=Object.defineProperties,oO=Object.getOwnPropertyDescriptors,Rv=Object.getOwnPropertySymbols,aO=Object.prototype.hasOwnProperty,sO=Object.prototype.propertyIsEnumerable,Cv=(e,t,r)=>t in e?nO(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Wh=(e,t)=>{for(var r in t||(t={}))aO.call(t,r)&&Cv(e,r,t[r]);if(Rv)for(var r of Rv(t))sO.call(t,r)&&Cv(e,r,t[r]);return e},w1=(e,t)=>iO(e,oO(t)),uO=(e,t,r)=>new Promise((n,i)=>{var o=u=>{try{s(r.next(u))}catch(l){i(l)}},a=u=>{try{s(r.throw(u))}catch(l){i(l)}},s=u=>u.done?n(u.value):Promise.resolve(u.value).then(o,a);s((r=r.apply(e,t)).next())}),lO={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},cO=(e,t,r,n,i)=>uO(void 0,null,function*(){const o=ma(e,t);return new Promise(a=>{if(i)i({x:r.x,y:r.y,z:r.z},(s,u)=>{if(s||!u)a(void 0);else{const l=new xv(u,r.x,r.y,r.z);a(l)}});else{const s=Ld(w1(Wh({},n),{url:o}),(u,l)=>{if(u||!l)a(void 0);else{const f=new xv(l,r.x,r.y,r.z);a(f)}});r.xhrCancel=()=>s.cancel()}})});function fO(e,t){const r=Array.isArray(e)?e[0]:e,n=(o,a)=>cO(r,o,a,t==null?void 0:t.requestParameters,t==null?void 0:t.getCustomData),i=w1(Wh(Wh({},lO),t),{getTileData:n});return{data:r,dataArray:[],tilesetOptions:i,isTile:!0}}function hO(e,t,r){switch(e){case"+":return t+r;case"-":return t-r;case"*":return t*r;case"/":return t/r;case"%":return t%r;case"^":return Math.pow(t,r);case"abs":return Math.abs(t);case"floor":return Math.floor(t);case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"sin":return Math.sin(t);case"cos":return Math.cos(t);case"atan":return r===-1?Math.atan(t):Math.atan2(t,r);case"min":return Math.min(t,r);case"max":return Math.max(t,r);case"log10":return Math.log(t);case"log2":return Math.log2(t);default:return console.warn("Calculate symbol err! Return default 0"),0}}function $s(e,t){const{width:r,height:n}=t[0],i=t.map(u=>u.rasterData),o=r*n,a=[],s=JSON.stringify(e);for(let u=0;u<o;u++){const l=JSON.parse(s),f=L1(l,i,u);if(typeof f=="number")a.push(f);else{const c=jh(l);a.push(c)}}return a}function L1(e,t,r){if(e.length===2&&e[0]==="band"&&typeof e[1]=="number")try{return t[e[1]][r]}catch(n){return console.warn("Raster Data err!"),0}e.map((n,i)=>{if(Array.isArray(n)&&n.length>0)switch(n[0]){case"band":try{e[i]=t[n[1]][r]}catch(o){console.warn("Raster Data err!"),e[i]=0}break;default:L1(n,t,r)}})}function dO(e){const[t,r=-1,n=-1]=e;return t===void 0?(console.warn("Express err!"),["+",0,0]):[t.replace(/\s+/g,""),r,n]}function jh(e){const t=dO(e),r=t[0];let n=t[1],i=t[2];return Array.isArray(n)&&(n=jh(e[1])),Array.isArray(i)&&(i=jh(e[2])),hO(r,n,i)}var pO={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:_O}};function _O(e,t){const r=e[0].rasterData,n=e[1].rasterData,i=e[2].rasterData,o=[],[a,s]=(t==null?void 0:t.countCut)||[2,98],u=(t==null?void 0:t.RMinMax)||Ea(r,a,s),l=(t==null?void 0:t.GMinMax)||Ea(n,a,s),f=(t==null?void 0:t.BMinMax)||Ea(i,a,s);for(let c=0;c<r.length;c++)o.push(Math.max(0,r[c]-u[0])),o.push(Math.max(0,n[c]-l[0])),o.push(Math.max(0,i[c]-f[0]));return{rasterData:o,rMinMax:u,gMinMax:l,bMinMax:f}}function Ea(e,t,r){const n=e.slice().sort((s,u)=>s-u),i=n.length,o=n[Math.ceil(i*t/100)],a=n[Math.ceil(i*r/100)];return[o,a]}var vO=Object.defineProperty,mO=Object.defineProperties,gO=Object.getOwnPropertyDescriptors,bv=Object.getOwnPropertySymbols,EO=Object.prototype.hasOwnProperty,yO=Object.prototype.propertyIsEnumerable,Mv=(e,t,r)=>t in e?vO(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,AO=(e,t)=>{for(var r in t||(t={}))EO.call(t,r)&&Mv(e,r,t[r]);if(bv)for(var r of bv(t))yO.call(t,r)&&Mv(e,r,t[r]);return e},TO=(e,t)=>mO(e,gO(t)),U1=(e,t,r)=>new Promise((n,i)=>{var o=u=>{try{s(r.next(u))}catch(l){i(l)}},a=u=>{try{s(r.throw(u))}catch(l){i(l)}},s=u=>u.done?n(u.value):Promise.resolve(u.value).then(o,a);s((r=r.apply(e,t)).next())});function Yd(e,t,r){return U1(this,null,function*(){if(e.length===0)return{rasterData:[0],width:1,heigh:1};const n=yield Promise.all(e.map(({data:u,bands:l=[0]})=>t(u,l))),i=[];n.forEach(u=>{Array.isArray(u)?i.push(...u):i.push(u)});const{width:o,height:a}=i[0];let s;switch(typeof r){case"function":s=r(i);break;case"object":Array.isArray(r)?s={rasterData:$s(r,i)}:s=SO(r,i);break;default:s={rasterData:i[0].rasterData}}return TO(AO({},s),{width:o,height:a})})}function SO(e,t){const r=pO[e.type];if(r.type==="function")return r.method(t,e==null?void 0:e.options);if(r.type==="operation")return e.type==="rgb"?xO(r.expression,t):{rasterData:$s(r.expression,t)}}function xO(e,t){e.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),e.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),e.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");const r=$s(e.r||["band",0],t),n=$s(e.g||["band",0],t),i=$s(e.b||["band",0],t);return[r,n,i]}function Gh(e,t,r,n){return U1(this,null,function*(){const i=yield Yd(e,t,r);n(null,{data:i})})}function RO(e,t){const{extent:r=[121.168,30.2828,121.384,30.4219],coordinates:n,width:i,height:o,min:a,max:s,format:u,operation:l}=t;let f,c,h;if(u===void 0||C1(e))f=Array.from(e),c=i,h=o;else{const v=Array.isArray(e)?e:[e];f=Yd(v,u,l)}const d=Eu(n,r);return{_id:1,dataArray:[{_id:1,data:f,width:c,height:h,min:a,max:s,coordinates:d}]}}let ka=function(e){return e.Normal="normal",e.PostProcessing="post-processing",e}({}),g=function(e){return e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e}({});const CO=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,{camelCase:bO,isNil:MO,upperFirst:IO}=Ar;class gi{constructor(){E(this,"shaderModuleService",void 0),E(this,"rendererService",void 0),E(this,"config",void 0),E(this,"quad",CO),E(this,"enabled",!0),E(this,"renderToScreen",!1),E(this,"model",void 0),E(this,"name",void 0),E(this,"optionsToUpdate",{})}getName(){return this.name}setName(t){this.name=t}getType(){return ka.PostProcessing}init(t,r){this.config=r,this.rendererService=t.getContainer().rendererService,this.shaderModuleService=t.getContainer().shaderModuleService;const{createAttribute:n,createBuffer:i,createModel:o}=this.rendererService,{vs:a,fs:s,uniforms:u}=this.setupShaders();this.model=o({vs:a,fs:s,attributes:{a_Position:n({buffer:i({data:[-4,-4,4,-4,0,4],type:g.FLOAT}),size:2})},uniforms:he(he({u_Texture:null},u),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}render(t,r){const n=t.multiPassRenderer.getPostProcessor(),{useFramebuffer:i,getViewportSize:o,clear:a}=this.rendererService,{width:s,height:u}=o();i(this.renderToScreen?null:n.getWriteFBO(),()=>{a({framebuffer:n.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});const l=he({u_BloomFinal:0,u_Texture:n.getReadFBO(),u_ViewportSize:[s,u]},this.convertOptionsToUniforms(this.optionsToUpdate));r&&(l.u_BloomFinal=1,l.u_Texture2=r),this.model.draw({uniforms:l})})}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}setRenderToScreen(t){this.renderToScreen=t}updateOptions(t){this.optionsToUpdate=he(he({},this.optionsToUpdate),t)}setupShaders(){throw new Error("Method not implemented.")}convertOptionsToUniforms(t){const r={};return Object.keys(t).forEach(n=>{MO(t[n])||(r[`u_${IO(bO(n))}`]=t[n])}),r}}function OO(e){let t=0;switch(e){case"vec2":case"ivec2":t=2;break;case"vec3":case"ivec3":t=3;break;case"vec4":case"ivec4":case"mat2":t=4;break;case"mat3":t=9;break;case"mat4":t=16;break}return t}const k1=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Iv(e,t=!1){const r={};return e=e.replace(k1,(n,i,o)=>{const a=o.split(":"),s=a[0].trim();let u="";switch(a.length>1&&(u=a[1].trim()),i){case"bool":u=u==="true";break;case"float":case"int":u=Number(u);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":u?u=u.replace("[","").replace("]","").split(",").reduce((l,f)=>(l.push(Number(f.trim())),l),[]):u=new Array(OO(i)).fill(0);break}return r[s]=u,`${t?"uniform ":""}${i} ${s};
`}),{content:e,uniforms:r}}function uh(e){let{content:t,uniforms:r}=Iv(e,!0);return t=t.replace(/(\s*uniform\s*.*\s*){((?:\s*.*\s*)*?)};/g,(n,i,o)=>{o=o.trim().replace(/^.*$/gm,u=>`uniform ${u}`);const{content:a,uniforms:s}=Iv(o);return Object.assign(r,s),`${i}{
${a}
};`}),{content:t,uniforms:r}}function Ov(e){const t={};return e.replace(k1,(r,n,i)=>{const o=i.trim();return t[o]?"":(t[o]=!0,`uniform ${n} ${o};
`)})}const uo={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"};let Yl=function(e){return e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom",e}({}),Li=function(e){return e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2",e}({});const lo={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"};var Br={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"};let ln=function(e){return e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag",e}({}),Bi=function(e){return e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none",e}({}),ho=function(e){return e.MULTIPLE="MULTIPLE",e.SINGLE="SINGLE",e}({}),Mc=function(e){return e.AND="and",e.OR="or",e}({}),jr=function(e){return e.INIT="init",e.UPDATE="update",e}({}),jt=function(e){return e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging",e.CUSTOM="threshold",e}({}),ta=function(e){return e.CONSTANT="constant",e.VARIABLE="variable",e}({}),Qe=function(e){return e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform",e}({});const Pv=["mapload","mapchange","mapAfterFrameChange"];var Zd={exports:{}};Zd.exports=yu;Zd.exports.default=yu;var ya=1e20;function yu(e,t,r,n,i,o){this.fontSize=e||24,this.buffer=t===void 0?3:t,this.cutoff=n||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=r||8;var a=this.size=this.fontSize+this.buffer*2,s=a+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function PO(e,t,r,n,i,o,a){o.fill(ya,0,t*r),a.fill(0,0,t*r);for(var s=(t-n)/2,u=0;u<i;u++)for(var l=0;l<n;l++){var f=(u+s)*t+l+s,c=e.data[4*(u*n+l)+3]/255;if(c===1)o[f]=0,a[f]=ya;else if(c===0)o[f]=ya,a[f]=0;else{var h=Math.max(0,.5-c),d=Math.max(0,c-.5);o[f]=h*h,a[f]=d*d}}}function NO(e,t,r,n,i,o,a){for(var s=0;s<t*r;s++){var u=Math.sqrt(n[s])-Math.sqrt(i[s]);e[s]=Math.round(255-255*(u/o+a))}}yu.prototype._draw=function(e,t){var r=this.ctx.measureText(e),n=r.width,i=2*this.buffer,o,a,s,u,l,f,c,h;t&&this.useMetrics?(l=Math.floor(r.actualBoundingBoxAscent),h=this.buffer+Math.ceil(r.actualBoundingBoxAscent),f=this.buffer,c=this.buffer,a=Math.min(this.size,Math.ceil(r.actualBoundingBoxRight-r.actualBoundingBoxLeft)),u=Math.min(this.size-f,Math.ceil(r.actualBoundingBoxAscent+r.actualBoundingBoxDescent)),o=a+i,s=u+i,this.ctx.textBaseline="alphabetic"):(o=a=this.size,s=u=this.size,l=19*this.fontSize/24,f=c=0,h=this.middle,this.ctx.textBaseline="middle");var d;a&&u&&(this.ctx.clearRect(c,f,a,u),this.ctx.fillText(e,this.buffer,h),d=this.ctx.getImageData(c,f,a,u));var p=new Uint8ClampedArray(o*s);return PO(d,o,s,a,u,this.gridOuter,this.gridInner),Nv(this.gridOuter,o,s,this.f,this.v,this.z),Nv(this.gridInner,o,s,this.f,this.v,this.z),NO(p,o,s,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:p,metrics:{width:a,height:u,sdfWidth:o,sdfHeight:s,top:l,left:0,advance:n}}};yu.prototype.draw=function(e){return this._draw(e,!1).data};yu.prototype.drawWithMetrics=function(e){return this._draw(e,!0)};function Nv(e,t,r,n,i,o){for(var a=0;a<t;a++)Fv(e,a,t,r,n,i,o);for(var s=0;s<r;s++)Fv(e,s*t,1,t,n,i,o)}function Fv(e,t,r,n,i,o,a){var s,u,l,f;for(o[0]=0,a[0]=-ya,a[1]=ya,s=0;s<n;s++)i[s]=e[t+s*r];for(s=1,u=0,l=0;s<n;s++){do f=o[u],l=(i[s]-i[f]+s*s-f*f)/(s-f)/2;while(l<=a[u]&&--u>-1);u++,o[u]=s,a[u]=l,a[u+1]=ya}for(s=0,u=0;s<n;s++){for(;a[u+1]<s;)u++;f=o[u],e[t+s*r]=i[f]+(s-f)*(s-f)}}const ps=30;function FO({characterSet:e,getFontWidth:t,fontHeight:r,buffer:n,maxCanvasWidth:i,mapping:o={},xOffset:a=0,yOffset:s=0}){let u=0,l=a;Array.from(e).forEach((c,h)=>{if(!o[c]){const d=t(c,h);l+ps>i&&(l=0,u++),o[c]={x:l,y:s+u*ps,width:ps,height:ps,advance:d},l+=ps}});const f=r+n*2;return{mapping:o,xOffset:l,yOffset:s+u*f,canvasHeight:z1(s+(u+1)*f)}}function DO(e,t,r){let n=0,i=0,o=0,a=[];const s={};for(const l of e)if(!s[l.id]){const{size:f}=l;n+f+t>r&&(Dv(s,a,i),n=0,i=o+i+t,o=0,a=[]),a.push({icon:l,xOffset:n}),n=n+f+t,o=Math.max(o,f)}a.length>0&&Dv(s,a,i);const u=z1(o+i+t);return{mapping:s,canvasHeight:u}}function Dv(e,t,r){for(const n of t){const{icon:i,xOffset:o}=n;e[i.id]=he(he({},i),{},{x:o,y:r,image:i.image,width:i.width,height:i.height})}}function z1(e){return Math.pow(2,Math.ceil(Math.log2(e)))}const BO=WO(),wO="sans-serif",LO="normal",UO=24,kO=3,zO=.25,VO=8,Bv=1024,HO=1,wv=1,XO=3;function WO(){const e=[];for(let t=32;t<128;t++)e.push(String.fromCharCode(t));return e}function Lv(e,t,r,n){e.font=`${n} ${r}px ${t}`,e.fillStyle="black",e.textBaseline="middle"}function Uv(e,t){for(let r=0;r<e.length;r++)t.data[4*r+3]=e[r]}class jO extends vn.exports.EventEmitter{constructor(...t){super(...t),E(this,"fontAtlas",void 0),E(this,"iconFontMap",void 0),E(this,"iconFontGlyphs",{}),E(this,"fontOptions",void 0),E(this,"key",void 0),E(this,"cache",new Ub(XO))}get scale(){return wv}get canvas(){const t=this.cache.get(this.key);return t&&t.data}get mapping(){const t=this.cache.get(this.key);return t&&t.mapping||{}}getCanvasByKey(t){const r=this.cache.get(t);return r&&r.data}getMappingByKey(t){const r=this.cache.get(t);return r&&r.mapping||{}}init(){this.cache.clear(),this.fontOptions={fontFamily:wO,fontWeight:LO,characterSet:BO,fontSize:UO,buffer:kO,sdf:!0,cutoff:zO,radius:VO,iconfont:!1},this.key="",this.iconFontMap=new Map}addIconGlyphs(t){t.forEach(r=>{this.iconFontGlyphs[r.name]=r.unicode})}addIconFont(t,r){this.iconFontMap.set(t,r)}getIconFontKey(t){return this.iconFontMap.get(t)||t}getGlyph(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}setFontOptions(t){this.fontOptions=he(he({},this.fontOptions),t),this.key=this.getKey();const r=this.getNewChars(this.key,this.fontOptions.characterSet),n=this.cache.get(this.key);if(n&&r.length===0)return;const i=this.generateFontAtlas(this.key,r,n);this.fontAtlas=i,this.cache.set(this.key,i)}addFontFace(t,r){const n=document.createElement("style");n.type="text/css",n.innerText=`
        @font-face{
            font-family: '${t}';
            src: url('${r}') format('woff2'),
            url('${r}') format('woff'),
            url('${r}') format('truetype');
        }`,n.onload=()=>{if(document.fonts)try{document.fonts.load(`24px ${t}`,"L7text"),document.fonts.ready.then(()=>{this.emit("fontloaded",{fontFamily:t})})}catch(i){console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(i)}},document.getElementsByTagName("head")[0].appendChild(n)}destroy(){this.cache.clear(),this.iconFontMap.clear()}generateFontAtlas(t,r,n){const{fontFamily:i,fontWeight:o,fontSize:a,buffer:s,sdf:u,radius:l,cutoff:f,iconfont:c}=this.fontOptions;let h=n&&n.data;h||(h=window.document.createElement("canvas"),h.width=Bv);const d=h.getContext("2d",{willReadFrequently:!0});Lv(d,i,a,o);const{mapping:p,canvasHeight:v,xOffset:m,yOffset:y}=FO(he({getFontWidth:T=>d.measureText(T).width,fontHeight:a*wv,buffer:s,characterSet:r,maxCanvasWidth:Bv},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})),A=d.getImageData(0,0,h.width,h.height);if(h.height=v,d.putImageData(A,0,0),Lv(d,i,a,o),u){const T=new Zd.exports(a,s,l,f,i,o),R=d.getImageData(0,0,T.size,T.size);for(const b of r){if(c){const H=String.fromCharCode(parseInt(b.replace("&#x","").replace(";",""),16)),B=T.draw(H);Uv(B,R)}else Uv(T.draw(b),R);d.putImageData(R,p[b].x,p[b].y)}}else for(const T of r)d.fillText(T,p[T].x,p[T].y+a*HO);return{xOffset:m,yOffset:y,mapping:p,data:h,width:h.width,height:h.height}}getKey(){const{fontFamily:t,fontWeight:r}=this.fontOptions;return`${t}_${r}`}getNewChars(t,r){const n=this.cache.get(t);if(!n)return r;const i=[],o=n.mapping,a=new Set(Object.keys(o));return new Set(r).forEach(u=>{a.has(u)||i.push(u)}),i}}const GO=3,kv=1024,_s=64;class $O extends vn.exports.EventEmitter{constructor(...t){super(...t),E(this,"canvasHeight",128),E(this,"texture",void 0),E(this,"canvas",void 0),E(this,"iconData",void 0),E(this,"iconMap",void 0),E(this,"ctx",void 0),E(this,"loadingImageCount",0)}isLoading(){return this.loadingImageCount===0}init(){this.iconData=[],this.iconMap={},this.canvas=window.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}addImage(t,r){var n=this;return pe(function*(){let i=new Image;n.loadingImageCount++,n.hasImage(t)?console.warn("Image Id already exists"):n.iconData.push({id:t,size:_s}),n.updateIconMap(),i=yield n.loadImage(r);const o=n.iconData.find(a=>a.id===t);o&&(o.image=i,o.width=i.width,o.height=i.height),n.update()})()}addImageMini(t,r,n){const i=n.getSceneConfig().canvas;let o=i.createImage();if(this.loadingImageCount++,this.hasImage(t))throw new Error("Image Id already exists");this.iconData.push({id:t,size:_s}),this.updateIconMap(),this.loadImageMini(r,i).then(a=>{o=a;const s=this.iconData.find(u=>u.id===t);s&&(s.image=o,s.width=o.width,s.height=o.height),this.update()})}getTexture(){return this.texture}getIconMap(){return this.iconMap}getCanvas(){return this.canvas}hasImage(t){return this.iconMap.hasOwnProperty(t)}removeImage(t){this.hasImage(t)&&(this.iconData=this.iconData.filter(r=>r.id!==t),delete this.iconMap[t],this.update())}destroy(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}loadImage(t){return new Promise((r,n)=>{if(t instanceof HTMLImageElement){r(t);return}const i=new Image;i.crossOrigin="anonymous",i.onload=()=>{r(i)},i.onerror=()=>{n(new Error("Could not load image at "+t))},i.src=t instanceof File?URL.createObjectURL(t):t})}update(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}updateIconAtlas(){this.canvas.width=kv,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(t=>{const{x:r,y:n,image:i,width:o=64,height:a=64}=this.iconMap[t],u=Math.max(o,a)/_s,l=a/u,f=o/u;i&&this.ctx.drawImage(i,r+(_s-f)/2,n+(_s-l)/2,f,l)})}updateIconMap(){const{mapping:t,canvasHeight:r}=DO(this.iconData,GO,kv);this.iconMap=t,this.canvasHeight=r}loadImageMini(t,r){return new Promise((n,i)=>{const o=r.createImage();o.crossOrigin="anonymous",o.onload=()=>{n(o)},o.onerror=()=>{i(new Error("Could not load image at "+t))},o.src=t})}}var Nr=1e-6,Sn=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function Bn(){var e=new Sn(16);return Sn!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function YO(e){var t=new Sn(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ZO(e,t,r,n,i,o,a,s,u,l,f,c,h,d,p,v){var m=new Sn(16);return m[0]=e,m[1]=t,m[2]=r,m[3]=n,m[4]=i,m[5]=o,m[6]=a,m[7]=s,m[8]=u,m[9]=l,m[10]=f,m[11]=c,m[12]=h,m[13]=d,m[14]=p,m[15]=v,m}function qO(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function V1(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],f=t[8],c=t[9],h=t[10],d=t[11],p=t[12],v=t[13],m=t[14],y=t[15],A=r*s-n*a,T=r*u-i*a,R=r*l-o*a,b=n*u-i*s,H=n*l-o*s,B=i*l-o*u,q=f*v-c*p,Ee=f*m-h*p,Z=f*y-d*p,k=c*m-h*v,$=c*y-d*v,K=h*y-d*m,ce=A*K-T*$+R*k+b*Z-H*Ee+B*q;return ce?(ce=1/ce,e[0]=(s*K-u*$+l*k)*ce,e[1]=(i*$-n*K-o*k)*ce,e[2]=(v*B-m*H+y*b)*ce,e[3]=(h*H-c*B-d*b)*ce,e[4]=(u*Z-a*K-l*Ee)*ce,e[5]=(r*K-i*Z+o*Ee)*ce,e[6]=(m*R-p*B-y*T)*ce,e[7]=(f*B-h*R+d*T)*ce,e[8]=(a*$-s*Z+l*q)*ce,e[9]=(n*Z-r*$-o*q)*ce,e[10]=(p*H-v*R+y*A)*ce,e[11]=(c*R-f*H-d*A)*ce,e[12]=(s*Ee-a*k-u*q)*ce,e[13]=(r*k-n*Ee+i*q)*ce,e[14]=(v*T-p*b-m*A)*ce,e[15]=(f*b-c*T+h*A)*ce,e):null}function ri(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],f=t[7],c=t[8],h=t[9],d=t[10],p=t[11],v=t[12],m=t[13],y=t[14],A=t[15],T=r[0],R=r[1],b=r[2],H=r[3];return e[0]=T*n+R*s+b*c+H*v,e[1]=T*i+R*u+b*h+H*m,e[2]=T*o+R*l+b*d+H*y,e[3]=T*a+R*f+b*p+H*A,T=r[4],R=r[5],b=r[6],H=r[7],e[4]=T*n+R*s+b*c+H*v,e[5]=T*i+R*u+b*h+H*m,e[6]=T*o+R*l+b*d+H*y,e[7]=T*a+R*f+b*p+H*A,T=r[8],R=r[9],b=r[10],H=r[11],e[8]=T*n+R*s+b*c+H*v,e[9]=T*i+R*u+b*h+H*m,e[10]=T*o+R*l+b*d+H*y,e[11]=T*a+R*f+b*p+H*A,T=r[12],R=r[13],b=r[14],H=r[15],e[12]=T*n+R*s+b*c+H*v,e[13]=T*i+R*u+b*h+H*m,e[14]=T*o+R*l+b*d+H*y,e[15]=T*a+R*f+b*p+H*A,e}function ba(e,t,r){var n=r[0],i=r[1],o=r[2],a,s,u,l,f,c,h,d,p,v,m,y;return t===e?(e[12]=t[0]*n+t[4]*i+t[8]*o+t[12],e[13]=t[1]*n+t[5]*i+t[9]*o+t[13],e[14]=t[2]*n+t[6]*i+t[10]*o+t[14],e[15]=t[3]*n+t[7]*i+t[11]*o+t[15]):(a=t[0],s=t[1],u=t[2],l=t[3],f=t[4],c=t[5],h=t[6],d=t[7],p=t[8],v=t[9],m=t[10],y=t[11],e[0]=a,e[1]=s,e[2]=u,e[3]=l,e[4]=f,e[5]=c,e[6]=h,e[7]=d,e[8]=p,e[9]=v,e[10]=m,e[11]=y,e[12]=a*n+f*i+p*o+t[12],e[13]=s*n+c*i+v*o+t[13],e[14]=u*n+h*i+m*o+t[14],e[15]=l*n+d*i+y*o+t[15]),e}function ru(e,t,r){var n=r[0],i=r[1],o=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Ic(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[4],a=t[5],s=t[6],u=t[7],l=t[8],f=t[9],c=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+l*n,e[5]=a*i+f*n,e[6]=s*i+c*n,e[7]=u*i+h*n,e[8]=l*i-o*n,e[9]=f*i-a*n,e[10]=c*i-s*n,e[11]=h*i-u*n,e}function qd(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[0],a=t[1],s=t[2],u=t[3],l=t[8],f=t[9],c=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-l*n,e[1]=a*i-f*n,e[2]=s*i-c*n,e[3]=u*i-h*n,e[8]=o*n+l*i,e[9]=a*n+f*i,e[10]=s*n+c*i,e[11]=u*n+h*i,e}function Kd(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[0],a=t[1],s=t[2],u=t[3],l=t[4],f=t[5],c=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+l*n,e[1]=a*i+f*n,e[2]=s*i+c*n,e[3]=u*i+h*n,e[4]=l*i-o*n,e[5]=f*i-a*n,e[6]=c*i-s*n,e[7]=h*i-u*n,e}function KO(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function QO(e,t,r,n,i){var o=1/Math.tan(t/2),a;return e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0?(a=1/(n-i),e[10]=(i+n)*a,e[14]=2*i*n*a):(e[10]=-1,e[14]=-2*n),e}var H1=QO;function JO(e,t,r,n){var i,o,a,s,u,l,f,c,h,d,p=t[0],v=t[1],m=t[2],y=n[0],A=n[1],T=n[2],R=r[0],b=r[1],H=r[2];return Math.abs(p-R)<Nr&&Math.abs(v-b)<Nr&&Math.abs(m-H)<Nr?qO(e):(f=p-R,c=v-b,h=m-H,d=1/Math.hypot(f,c,h),f*=d,c*=d,h*=d,i=A*h-T*c,o=T*f-y*h,a=y*c-A*f,d=Math.hypot(i,o,a),d?(d=1/d,i*=d,o*=d,a*=d):(i=0,o=0,a=0),s=c*a-h*o,u=h*i-f*a,l=f*o-c*i,d=Math.hypot(s,u,l),d?(d=1/d,s*=d,u*=d,l*=d):(s=0,u=0,l=0),e[0]=i,e[1]=s,e[2]=f,e[3]=0,e[4]=o,e[5]=u,e[6]=c,e[7]=0,e[8]=a,e[9]=l,e[10]=h,e[11]=0,e[12]=-(i*p+o*v+a*m),e[13]=-(s*p+u*v+l*m),e[14]=-(f*p+c*v+h*m),e[15]=1,e)}function zv(e,t){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],f=e[8],c=e[9],h=e[10],d=e[11],p=e[12],v=e[13],m=e[14],y=e[15],A=t[0],T=t[1],R=t[2],b=t[3],H=t[4],B=t[5],q=t[6],Ee=t[7],Z=t[8],k=t[9],$=t[10],K=t[11],ce=t[12],Ne=t[13],je=t[14],Je=t[15];return Math.abs(r-A)<=Nr*Math.max(1,Math.abs(r),Math.abs(A))&&Math.abs(n-T)<=Nr*Math.max(1,Math.abs(n),Math.abs(T))&&Math.abs(i-R)<=Nr*Math.max(1,Math.abs(i),Math.abs(R))&&Math.abs(o-b)<=Nr*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(a-H)<=Nr*Math.max(1,Math.abs(a),Math.abs(H))&&Math.abs(s-B)<=Nr*Math.max(1,Math.abs(s),Math.abs(B))&&Math.abs(u-q)<=Nr*Math.max(1,Math.abs(u),Math.abs(q))&&Math.abs(l-Ee)<=Nr*Math.max(1,Math.abs(l),Math.abs(Ee))&&Math.abs(f-Z)<=Nr*Math.max(1,Math.abs(f),Math.abs(Z))&&Math.abs(c-k)<=Nr*Math.max(1,Math.abs(c),Math.abs(k))&&Math.abs(h-$)<=Nr*Math.max(1,Math.abs(h),Math.abs($))&&Math.abs(d-K)<=Nr*Math.max(1,Math.abs(d),Math.abs(K))&&Math.abs(p-ce)<=Nr*Math.max(1,Math.abs(p),Math.abs(ce))&&Math.abs(v-Ne)<=Nr*Math.max(1,Math.abs(v),Math.abs(Ne))&&Math.abs(m-je)<=Nr*Math.max(1,Math.abs(m),Math.abs(je))&&Math.abs(y-Je)<=Nr*Math.max(1,Math.abs(y),Math.abs(Je))}function ws(){var e=new Sn(3);return Sn!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Wr(e,t,r){var n=new Sn(3);return n[0]=e,n[1]=t,n[2]=r,n}function eP(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function tP(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function Ls(e,t){var r=t[0],n=t[1],i=t[2],o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function rP(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function nP(e,t,r){var n=t[0],i=t[1],o=t[2],a=r[0],s=r[1],u=r[2];return e[0]=i*u-o*s,e[1]=o*a-n*u,e[2]=n*s-i*a,e}function dl(e,t,r){var n=t[0],i=t[1],o=t[2],a=r[3]*n+r[7]*i+r[11]*o+r[15];return a=a||1,e[0]=(r[0]*n+r[4]*i+r[8]*o+r[12])/a,e[1]=(r[1]*n+r[5]*i+r[9]*o+r[13])/a,e[2]=(r[2]*n+r[6]*i+r[10]*o+r[14])/a,e}function Vv(e,t){var r=e[0],n=e[1],i=e[2],o=t[0],a=t[1],s=t[2],u=Math.sqrt(r*r+n*n+i*i),l=Math.sqrt(o*o+a*a+s*s),f=u*l,c=f&&rP(e,t)/f;return Math.acos(Math.min(Math.max(c,-1),1))}var Hv=eP;(function(){var e=ws();return function(t,r,n,i,o,a){var s,u;for(r||(r=3),n||(n=0),i?u=Math.min(i*r+n,t.length):u=t.length,s=n;s<u;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],o(e,e,a),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}})();function X1(){var e=new Sn(4);return Sn!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function iP(e,t,r,n){var i=new Sn(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}function oP(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function Qd(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*a,e[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*a,e[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*a,e[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*a,e}(function(){var e=X1();return function(t,r,n,i,o,a){var s,u;for(r||(r=4),n||(n=0),i?u=Math.min(i*r+n,t.length):u=t.length,s=n;s<u;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],o(e,e,a),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}})();function Cr(){var e=new Sn(2);return Sn!=Float32Array&&(e[0]=0,e[1]=0),e}function $h(e,t){var r=new Sn(2);return r[0]=e,r[1]=t,r}function vs(e,t){return e[0]=t[0],e[1]=t[1],e}function aP(e,t,r){return e[0]=t,e[1]=r,e}function Nn(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function Fl(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function sP(e,t){return e[0]=-t[0],e[1]=-t[1],e}function Ys(e,t){var r=t[0],n=t[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e}function Dl(e,t){return e[0]*t[0]+e[1]*t[1]}function uP(e,t,r,n){var i=t[0],o=t[1];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e}var Yh=Fl;(function(){var e=Cr();return function(t,r,n,i,o,a){var s,u;for(r||(r=2),n||(n=0),i?u=Math.min(i*r+n,t.length):u=t.length,s=n;s<u;s+=r)e[0]=t[s],e[1]=t[s+1],o(e,e,a),t[s]=e[0],t[s+1]=e[1];return t}})();class lP{constructor(){E(this,"viewport",void 0),E(this,"overridedViewProjectionMatrix",void 0),E(this,"jitteredViewProjectionMatrix",void 0),E(this,"jitteredProjectionMatrix",void 0),E(this,"viewMatrixInverse",void 0),E(this,"cameraPosition",void 0)}init(){}update(t){this.viewport=t,this.viewMatrixInverse=Bn(),V1(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}getProjectionMatrix(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}getModelMatrix(){return this.viewport.getModelMatrix()}getViewMatrix(){return this.viewport.getViewMatrix()}getViewMatrixUncentered(){return this.viewport.getViewMatrixUncentered()}getViewProjectionMatrixUncentered(){return this.viewport.getViewProjectionMatrixUncentered()}getViewProjectionMatrix(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}getZoom(){return this.viewport.getZoom()}getZoomScale(){return this.viewport.getZoomScale()}getCenter(){const[t,r]=this.viewport.getCenter();return[t,r]}getFocalDistance(){return this.viewport.getFocalDistance()}getCameraPosition(){return this.cameraPosition}projectFlat(t,r){return this.viewport.projectFlat(t,r)}setViewProjectionMatrix(t){this.overridedViewProjectionMatrix=t}jitterProjectionMatrix(t,r){const n=KO(Bn(),[t,r,0]);this.jitteredProjectionMatrix=ri(Bn(),n,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=ri(Bn(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}clearJitterProjectionMatrix(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}const cP={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"};class fP{constructor(){E(this,"container",void 0),E(this,"controlCorners",void 0),E(this,"controlContainer",void 0),E(this,"scene",void 0),E(this,"mapsService",void 0),E(this,"controls",[]),E(this,"unAddControls",[])}init(t,r){this.container=t.container,this.scene=r,this.mapsService=r.mapService,this.initControlPos()}addControl(t,r){r.mapService.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}getControlByName(t){return this.controls.find(r=>r.controlOption.name===t)}removeControl(t){const r=this.controls.indexOf(t);return r>-1&&this.controls.splice(r,1),t.remove(),this}addControls(){this.unAddControls.forEach(t=>{t.addTo(this.scene),this.controls.push(t)}),this.unAddControls=[]}destroy(){for(const t of this.controls)t.remove();this.controls=[],this.clearControlPos()}initControlPos(){const t=this.controlCorners={},r="l7-",n=this.controlContainer=pn("div",r+"control-container",this.container);function i(a=[]){const s=a.map(u=>r+u).join(" ");t[a.filter(u=>!["row","column"].includes(u)).join("")]=pn("div",s,n)}function o(a){return[...a.replace(/^(top|bottom|left|right|center)/,"$1-").split("-"),cP[a]]}Object.values(Yl).forEach(a=>{i(o(a))}),this.checkCornerOverlap()}clearControlPos(){for(const t in this.controlCorners)this.controlCorners[t]&&jl(this.controlCorners[t]);this.controlContainer&&jl(this.controlContainer)}checkCornerOverlap(){const t=window.MutationObserver;if(!!t)for(const r of Object.keys(this.controlCorners)){const n=r.match(/^(top|bottom)(left|right)$/);if(n){const[,i,o]=n,a=this.controlCorners[`${i}${o}`];new t(([{target:u}])=>{a&&(a.style[i]=u.clientHeight+"px")}).observe(this.controlCorners[`${o}${i}`],{childList:!0,attributes:!0})}}}}class hP{constructor(){E(this,"container",void 0),E(this,"scene",void 0),E(this,"mapsService",void 0),E(this,"markers",[]),E(this,"markerLayers",[]),E(this,"unAddMarkers",[]),E(this,"unAddMarkerLayers",[])}addMarkerLayer(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}removeMarkerLayer(t){t.destroy(),this.markerLayers.indexOf(t);const r=this.markerLayers.indexOf(t);r>-1&&this.markerLayers.splice(r,1)}addMarker(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}addMarkers(){this.unAddMarkers.forEach(t=>{t.addTo(this.scene),this.markers.push(t)}),this.unAddMarkers=[]}addMarkerLayers(){this.unAddMarkerLayers.forEach(t=>{this.markerLayers.push(t),t.addTo(this.scene)}),this.unAddMarkers=[]}removeMarker(t){t.remove(),this.markers.indexOf(t);const r=this.markers.indexOf(t);r>-1&&this.markers.splice(r,1)}removeAllMarkers(){this.destroy()}init(t){this.scene=t,this.mapsService=t.mapService}destroy(){this.markers.forEach(t=>{t.remove()}),this.markers=[],this.markerLayers.forEach(t=>{t.destroy()}),this.markerLayers=[]}removeMakerLayerMarker(t){t.destroy()}}class dP{constructor(){E(this,"scene",void 0),E(this,"mapsService",void 0),E(this,"popups",[]),E(this,"unAddPopups",[])}get isMarkerReady(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}removePopup(t){t!=null&&t.isOpen()&&t.remove();const r=this.popups.indexOf(t);r>-1&&this.popups.splice(r,1);const n=this.unAddPopups.indexOf(t);n>-1&&this.unAddPopups.splice(n,1)}destroy(){this.popups.forEach(t=>t.remove())}addPopup(t){t&&t.getOptions().autoClose&&[...this.popups,...this.unAddPopups].forEach(r=>{r.getOptions().autoClose&&this.removePopup(r)}),this.isMarkerReady?(t.addTo(this.scene),this.popups.push(t)):this.unAddPopups.push(t),t.on("close",()=>{this.removePopup(t)})}initPopup(){this.unAddPopups.length&&this.unAddPopups.forEach(t=>{this.addPopup(t),this.unAddPopups=[]})}init(t){this.scene=t,this.mapsService=t.mapService}}const pP={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo \u6D4B\u8BD5 Token, \u751F\u4EA7\u73AF\u5883\u52A1\u5FC5\u81EA\u884C\u6CE8\u518C Token \u786E\u4FDD\u670D\u52A1\u7A33\u5B9A \u9AD8\u5FB7\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://lbs.amap.com/api/javascript-api/guide/abc/prepare  Mapbox\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://docs.mapbox.com/help/glossary/access-token/",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},{merge:_P}=Ar,vP={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},mP={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:Mc.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0};class gP{constructor(){E(this,"sceneConfigCache",{}),E(this,"layerConfigCache",{}),E(this,"layerAttributeConfigCache",{})}getSceneConfig(t){return this.sceneConfigCache[t]}getSceneWarninfo(t){return pP[t]}setSceneConfig(t,r){this.sceneConfigCache[t]=he(he({},vP),r)}getLayerConfig(t){return this.layerConfigCache[t]}setLayerConfig(t,r,n){this.layerConfigCache[r]=he({},_P({},this.sceneConfigCache[t],mP,n))}getAttributeConfig(t){return this.layerAttributeConfigCache[t]}setAttributeConfig(t,r){this.layerAttributeConfigCache[t]=he(he({},this.layerAttributeConfigCache[t]),r)}clean(){this.sceneConfigCache={},this.layerConfigCache={}}}const lh=Math.PI/180,EP=512,Xv=4003e4;function Wv({latitude:e=0,zoom:t=0,scale:r,highPrecision:n=!1,flipY:i=!1}){r=r!==void 0?r:Math.pow(2,t);const o={},a=EP*r,s=Math.cos(e*lh),u=a/360,l=u/s,f=a/Xv/s;if(o.pixelsPerMeter=[f,-f,f],o.metersPerPixel=[1/f,-1/f,1/f],o.pixelsPerDegree=[u,-l,f],o.degreesPerPixel=[1/u,-1/l,1/f],n){const c=lh*Math.tan(e*lh)/s,h=u*c/2,d=a/Xv*c,p=d/l*f;o.pixelsPerDegree2=[0,-h,d],o.pixelsPerMeter2=[p,0,p],i&&(o.pixelsPerDegree2[1]=-o.pixelsPerDegree2[1],o.pixelsPerMeter2[1]=-o.pixelsPerMeter2[1])}return i&&(o.pixelsPerMeter[1]=-o.pixelsPerMeter[1],o.metersPerPixel[1]=-o.metersPerPixel[1],o.pixelsPerDegree[1]=-o.pixelsPerDegree[1],o.degreesPerPixel[1]=-o.degreesPerPixel[1]),o}const yP=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];class AP{constructor(t){E(this,"needRefresh",!0),E(this,"coordinateSystem",void 0),E(this,"viewportCenter",void 0),E(this,"viewportCenterProjection",void 0),E(this,"pixelsPerDegree",void 0),E(this,"pixelsPerDegree2",void 0),E(this,"pixelsPerMeter",void 0),this.cameraService=t}refresh(t){const r=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),i=t||this.cameraService.getCenter(),{pixelsPerMeter:o,pixelsPerDegree:a}=Wv({latitude:i[1],zoom:r});this.viewportCenter=i,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=o,this.pixelsPerDegree=a,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Li.LNGLAT||this.coordinateSystem===Li.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Li.LNGLAT_OFFSET?this.calculateLnglatOffset(i,r):this.coordinateSystem===Li.P20_OFFSET&&this.calculateLnglatOffset(i,r,n,!0),this.needRefresh=!1}getCoordinateSystem(){return this.coordinateSystem}setCoordinateSystem(t){this.coordinateSystem=t}getViewportCenter(){return this.viewportCenter}getViewportCenterProjection(){return this.viewportCenterProjection}getPixelsPerDegree(){return this.pixelsPerDegree}getPixelsPerDegree2(){return this.pixelsPerDegree2}getPixelsPerMeter(){return this.pixelsPerMeter}calculateLnglatOffset(t,r,n,i){const{pixelsPerMeter:o,pixelsPerDegree:a,pixelsPerDegree2:s}=Wv({latitude:t[1],zoom:r,scale:n,flipY:i,highPrecision:!0});let u=this.cameraService.getViewMatrix();const l=this.cameraService.getProjectionMatrix();let f=ri([],l,u);const c=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,r));this.viewportCenterProjection=Qd([],[c[0],c[1],0,1],f),u=this.cameraService.getViewMatrixUncentered()||u,f=ri([],l,u),f=ri([],f,yP),this.cameraService.setViewProjectionMatrix(f),this.pixelsPerMeter=o,this.pixelsPerDegree=a,this.pixelsPerDegree2=s}}class TP extends vn.exports.EventEmitter{constructor(...t){super(...t),E(this,"renderMap",new Map),E(this,"enable",!1),E(this,"renderEnable",!1),E(this,"cacheLogs",{})}setEnable(t){this.enable=!!t}log(t,r){if(!this.enable)return;const n=t.split(".");let i=null;n.forEach((o,a)=>{i!==null?(i[o]||(i[o]={}),a!==n.length-1&&(i=i[o])):(this.cacheLogs[o]||(this.cacheLogs[o]={}),a!==n.length-1&&(i=this.cacheLogs[o])),a===n.length-1&&(i[o]=he(he({time:Date.now()},i[o]),r))})}getLog(t){switch(typeof t){case"string":return this.cacheLogs[t];case"object":return t.map(r=>this.cacheLogs[r]).filter(r=>r!==void 0);case"undefined":return this.cacheLogs}}removeLog(t){delete this.cacheLogs[t]}generateRenderUid(){return this.renderEnable?Lb():""}renderDebug(t){this.renderEnable=t}renderStart(t){if(!this.renderEnable||!this.enable)return;const r=this.renderMap.get(t)||{};this.renderMap.set(t,he(he({},r),{},{renderUid:t,renderStart:Date.now()}))}renderEnd(t){if(!this.renderEnable||!this.enable)return;const r=this.renderMap.get(t);if(r){const n=r.renderStart,i=Date.now();this.emit("renderEnd",he(he({},r),{},{renderEnd:i,renderDuration:i-n})),this.renderMap.delete(t)}}destroy(){this.cacheLogs=null,this.renderMap.clear()}}var W1={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(e){(function(t,r,n,i){var o=["","webkit","Moz","MS","ms","o"],a=r.createElement("div"),s="function",u=Math.round,l=Math.abs,f=Date.now;function c(x,I,X){return setTimeout(T(x,X),I)}function h(x,I,X){return Array.isArray(x)?(d(x,X[I],X),!0):!1}function d(x,I,X){var se;if(!!x)if(x.forEach)x.forEach(I,X);else if(x.length!==i)for(se=0;se<x.length;)I.call(X,x[se],se,x),se++;else for(se in x)x.hasOwnProperty(se)&&I.call(X,x[se],se,x)}function p(x,I,X){var se="DEPRECATED METHOD: "+I+`
`+X+` AT 
`;return function(){var Fe=new Error("get-stack-trace"),qe=Fe&&Fe.stack?Fe.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Pt=t.console&&(t.console.warn||t.console.log);return Pt&&Pt.call(t.console,se,qe),x.apply(this,arguments)}}var v;typeof Object.assign!="function"?v=function(I){if(I===i||I===null)throw new TypeError("Cannot convert undefined or null to object");for(var X=Object(I),se=1;se<arguments.length;se++){var Fe=arguments[se];if(Fe!==i&&Fe!==null)for(var qe in Fe)Fe.hasOwnProperty(qe)&&(X[qe]=Fe[qe])}return X}:v=Object.assign;var m=p(function(I,X,se){for(var Fe=Object.keys(X),qe=0;qe<Fe.length;)(!se||se&&I[Fe[qe]]===i)&&(I[Fe[qe]]=X[Fe[qe]]),qe++;return I},"extend","Use `assign`."),y=p(function(I,X){return m(I,X,!0)},"merge","Use `assign`.");function A(x,I,X){var se=I.prototype,Fe;Fe=x.prototype=Object.create(se),Fe.constructor=x,Fe._super=se,X&&v(Fe,X)}function T(x,I){return function(){return x.apply(I,arguments)}}function R(x,I){return typeof x==s?x.apply(I&&I[0]||i,I):x}function b(x,I){return x===i?I:x}function H(x,I,X){d(Z(I),function(se){x.addEventListener(se,X,!1)})}function B(x,I,X){d(Z(I),function(se){x.removeEventListener(se,X,!1)})}function q(x,I){for(;x;){if(x==I)return!0;x=x.parentNode}return!1}function Ee(x,I){return x.indexOf(I)>-1}function Z(x){return x.trim().split(/\s+/g)}function k(x,I,X){if(x.indexOf&&!X)return x.indexOf(I);for(var se=0;se<x.length;){if(X&&x[se][X]==I||!X&&x[se]===I)return se;se++}return-1}function $(x){return Array.prototype.slice.call(x,0)}function K(x,I,X){for(var se=[],Fe=[],qe=0;qe<x.length;){var Pt=I?x[qe][I]:x[qe];k(Fe,Pt)<0&&se.push(x[qe]),Fe[qe]=Pt,qe++}return X&&(I?se=se.sort(function(Ir,Or){return Ir[I]>Or[I]}):se=se.sort()),se}function ce(x,I){for(var X,se,Fe=I[0].toUpperCase()+I.slice(1),qe=0;qe<o.length;){if(X=o[qe],se=X?X+Fe:I,se in x)return se;qe++}return i}var Ne=1;function je(){return Ne++}function Je(x){var I=x.ownerDocument||x;return I.defaultView||I.parentWindow||t}var ht=/mobile|tablet|ip(ad|hone|od)|android/i,$e="ontouchstart"in t,et=ce(t,"PointerEvent")!==i,mt=$e&&ht.test(navigator.userAgent),gt="touch",Ot="pen",Bt="mouse",Et="kinect",Tr=25,$t=1,Gr=2,le=4,Ve=8,nt=1,Te=2,Ut=4,yt=8,Ht=16,bt=Te|Ut,lt=yt|Ht,kt=bt|lt,zr=["x","y"],fr=["clientX","clientY"];function Jt(x,I){var X=this;this.manager=x,this.callback=I,this.element=x.element,this.target=x.options.inputTarget,this.domHandler=function(se){R(x.options.enable,[x])&&X.handler(se)},this.init()}Jt.prototype={handler:function(){},init:function(){this.evEl&&H(this.element,this.evEl,this.domHandler),this.evTarget&&H(this.target,this.evTarget,this.domHandler),this.evWin&&H(Je(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&B(this.element,this.evEl,this.domHandler),this.evTarget&&B(this.target,this.evTarget,this.domHandler),this.evWin&&B(Je(this.element),this.evWin,this.domHandler)}};function nn(x){var I,X=x.options.inputClass;return X?I=X:et?I=Wa:mt?I=Mo:$e?I=Io:I=bo,new I(x,P)}function P(x,I,X){var se=X.pointers.length,Fe=X.changedPointers.length,qe=I&$t&&se-Fe===0,Pt=I&(le|Ve)&&se-Fe===0;X.isFirst=!!qe,X.isFinal=!!Pt,qe&&(x.session={}),X.eventType=I,Ei(x,X),x.emit("hammer.input",X),x.recognize(X),x.session.prevInput=X}function Ei(x,I){var X=x.session,se=I.pointers,Fe=se.length;X.firstInput||(X.firstInput=yi(I)),Fe>1&&!X.firstMultiple?X.firstMultiple=yi(I):Fe===1&&(X.firstMultiple=!1);var qe=X.firstInput,Pt=X.firstMultiple,Sr=Pt?Pt.center:qe.center,Ir=I.center=Kt(se);I.timeStamp=f(),I.deltaTime=I.timeStamp-qe.timeStamp,I.angle=Gi(Sr,Ir),I.distance=on(Sr,Ir),Co(X,I),I.offsetDirection=Un(I.deltaX,I.deltaY);var Or=Kr(I.deltaTime,I.deltaX,I.deltaY);I.overallVelocityX=Or.x,I.overallVelocityY=Or.y,I.overallVelocity=l(Or.x)>l(Or.y)?Or.x:Or.y,I.scale=Pt?$i(Pt.pointers,se):1,I.rotation=Pt?wr(Pt.pointers,se):0,I.maxPointers=X.prevInput?I.pointers.length>X.prevInput.maxPointers?I.pointers.length:X.prevInput.maxPointers:I.pointers.length,ai(X,I);var Cn=x.element;q(I.srcEvent.target,Cn)&&(Cn=I.srcEvent.target),I.target=Cn}function Co(x,I){var X=I.center,se=x.offsetDelta||{},Fe=x.prevDelta||{},qe=x.prevInput||{};(I.eventType===$t||qe.eventType===le)&&(Fe=x.prevDelta={x:qe.deltaX||0,y:qe.deltaY||0},se=x.offsetDelta={x:X.x,y:X.y}),I.deltaX=Fe.x+(X.x-se.x),I.deltaY=Fe.y+(X.y-se.y)}function ai(x,I){var X=x.lastInterval||I,se=I.timeStamp-X.timeStamp,Fe,qe,Pt,Sr;if(I.eventType!=Ve&&(se>Tr||X.velocity===i)){var Ir=I.deltaX-X.deltaX,Or=I.deltaY-X.deltaY,Cn=Kr(se,Ir,Or);qe=Cn.x,Pt=Cn.y,Fe=l(Cn.x)>l(Cn.y)?Cn.x:Cn.y,Sr=Un(Ir,Or),x.lastInterval=I}else Fe=X.velocity,qe=X.velocityX,Pt=X.velocityY,Sr=X.direction;I.velocity=Fe,I.velocityX=qe,I.velocityY=Pt,I.direction=Sr}function yi(x){for(var I=[],X=0;X<x.pointers.length;)I[X]={clientX:u(x.pointers[X].clientX),clientY:u(x.pointers[X].clientY)},X++;return{timeStamp:f(),pointers:I,center:Kt(I),deltaX:x.deltaX,deltaY:x.deltaY}}function Kt(x){var I=x.length;if(I===1)return{x:u(x[0].clientX),y:u(x[0].clientY)};for(var X=0,se=0,Fe=0;Fe<I;)X+=x[Fe].clientX,se+=x[Fe].clientY,Fe++;return{x:u(X/I),y:u(se/I)}}function Kr(x,I,X){return{x:I/x||0,y:X/x||0}}function Un(x,I){return x===I?nt:l(x)>=l(I)?x<0?Te:Ut:I<0?yt:Ht}function on(x,I,X){X||(X=zr);var se=I[X[0]]-x[X[0]],Fe=I[X[1]]-x[X[1]];return Math.sqrt(se*se+Fe*Fe)}function Gi(x,I,X){X||(X=zr);var se=I[X[0]]-x[X[0]],Fe=I[X[1]]-x[X[1]];return Math.atan2(Fe,se)*180/Math.PI}function wr(x,I){return Gi(I[1],I[0],fr)+Gi(x[1],x[0],fr)}function $i(x,I){return on(I[0],I[1],fr)/on(x[0],x[1],fr)}var Ai={mousedown:$t,mousemove:Gr,mouseup:le},Va="mousedown",kc="mousemove mouseup";function bo(){this.evEl=Va,this.evWin=kc,this.pressed=!1,Jt.apply(this,arguments)}A(bo,Jt,{handler:function(I){var X=Ai[I.type];X&$t&&I.button===0&&(this.pressed=!0),X&Gr&&I.which!==1&&(X=le),this.pressed&&(X&le&&(this.pressed=!1),this.callback(this.manager,X,{pointers:[I],changedPointers:[I],pointerType:Bt,srcEvent:I}))}});var zc={pointerdown:$t,pointermove:Gr,pointerup:le,pointercancel:Ve,pointerout:Ve},Vc={2:gt,3:Ot,4:Bt,5:Et},Ha="pointerdown",Xa="pointermove pointerup pointercancel";t.MSPointerEvent&&!t.PointerEvent&&(Ha="MSPointerDown",Xa="MSPointerMove MSPointerUp MSPointerCancel");function Wa(){this.evEl=Ha,this.evWin=Xa,Jt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}A(Wa,Jt,{handler:function(I){var X=this.store,se=!1,Fe=I.type.toLowerCase().replace("ms",""),qe=zc[Fe],Pt=Vc[I.pointerType]||I.pointerType,Sr=Pt==gt,Ir=k(X,I.pointerId,"pointerId");qe&$t&&(I.button===0||Sr)?Ir<0&&(X.push(I),Ir=X.length-1):qe&(le|Ve)&&(se=!0),!(Ir<0)&&(X[Ir]=I,this.callback(this.manager,qe,{pointers:X,changedPointers:[I],pointerType:Pt,srcEvent:I}),se&&X.splice(Ir,1))}});var Hc={touchstart:$t,touchmove:Gr,touchend:le,touchcancel:Ve},Qr="touchstart",Xc="touchstart touchmove touchend touchcancel";function xu(){this.evTarget=Qr,this.evWin=Xc,this.started=!1,Jt.apply(this,arguments)}A(xu,Jt,{handler:function(I){var X=Hc[I.type];if(X===$t&&(this.started=!0),!!this.started){var se=Wc.call(this,I,X);X&(le|Ve)&&se[0].length-se[1].length===0&&(this.started=!1),this.callback(this.manager,X,{pointers:se[0],changedPointers:se[1],pointerType:gt,srcEvent:I})}}});function Wc(x,I){var X=$(x.touches),se=$(x.changedTouches);return I&(le|Ve)&&(X=K(X.concat(se),"identifier",!0)),[X,se]}var jc={touchstart:$t,touchmove:Gr,touchend:le,touchcancel:Ve},Gc="touchstart touchmove touchend touchcancel";function Mo(){this.evTarget=Gc,this.targetIds={},Jt.apply(this,arguments)}A(Mo,Jt,{handler:function(I){var X=jc[I.type],se=$c.call(this,I,X);!se||this.callback(this.manager,X,{pointers:se[0],changedPointers:se[1],pointerType:gt,srcEvent:I})}});function $c(x,I){var X=$(x.touches),se=this.targetIds;if(I&($t|Gr)&&X.length===1)return se[X[0].identifier]=!0,[X,X];var Fe,qe,Pt=$(x.changedTouches),Sr=[],Ir=this.target;if(qe=X.filter(function(Or){return q(Or.target,Ir)}),I===$t)for(Fe=0;Fe<qe.length;)se[qe[Fe].identifier]=!0,Fe++;for(Fe=0;Fe<Pt.length;)se[Pt[Fe].identifier]&&Sr.push(Pt[Fe]),I&(le|Ve)&&delete se[Pt[Fe].identifier],Fe++;if(!!Sr.length)return[K(qe.concat(Sr),"identifier",!0),Sr]}var Yc=2500,ja=25;function Io(){Jt.apply(this,arguments);var x=T(this.handler,this);this.touch=new Mo(this.manager,x),this.mouse=new bo(this.manager,x),this.primaryTouch=null,this.lastTouches=[]}A(Io,Jt,{handler:function(I,X,se){var Fe=se.pointerType==gt,qe=se.pointerType==Bt;if(!(qe&&se.sourceCapabilities&&se.sourceCapabilities.firesTouchEvents)){if(Fe)ar.call(this,X,se);else if(qe&&Zc.call(this,se))return;this.callback(I,X,se)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function ar(x,I){x&$t?(this.primaryTouch=I.changedPointers[0].identifier,Ru.call(this,I)):x&(le|Ve)&&Ru.call(this,I)}function Ru(x){var I=x.changedPointers[0];if(I.identifier===this.primaryTouch){var X={x:I.clientX,y:I.clientY};this.lastTouches.push(X);var se=this.lastTouches,Fe=function(){var qe=se.indexOf(X);qe>-1&&se.splice(qe,1)};setTimeout(Fe,Yc)}}function Zc(x){for(var I=x.srcEvent.clientX,X=x.srcEvent.clientY,se=0;se<this.lastTouches.length;se++){var Fe=this.lastTouches[se],qe=Math.abs(I-Fe.x),Pt=Math.abs(X-Fe.y);if(qe<=ja&&Pt<=ja)return!0}return!1}var Cu=ce(a.style,"touchAction"),bu=Cu!==i,Mu="compute",Iu="auto",Ga="manipulation",si="none",Yi="pan-x",Zi="pan-y",Oo=Kc();function $a(x,I){this.manager=x,this.set(I)}$a.prototype={set:function(x){x==Mu&&(x=this.compute()),bu&&this.manager.element.style&&Oo[x]&&(this.manager.element.style[Cu]=x),this.actions=x.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var x=[];return d(this.manager.recognizers,function(I){R(I.options.enable,[I])&&(x=x.concat(I.getTouchAction()))}),qc(x.join(" "))},preventDefaults:function(x){var I=x.srcEvent,X=x.offsetDirection;if(this.manager.session.prevented){I.preventDefault();return}var se=this.actions,Fe=Ee(se,si)&&!Oo[si],qe=Ee(se,Zi)&&!Oo[Zi],Pt=Ee(se,Yi)&&!Oo[Yi];if(Fe){var Sr=x.pointers.length===1,Ir=x.distance<2,Or=x.deltaTime<250;if(Sr&&Ir&&Or)return}if(!(Pt&&qe)&&(Fe||qe&&X&bt||Pt&&X&lt))return this.preventSrc(I)},preventSrc:function(x){this.manager.session.prevented=!0,x.preventDefault()}};function qc(x){if(Ee(x,si))return si;var I=Ee(x,Yi),X=Ee(x,Zi);return I&&X?si:I||X?I?Yi:Zi:Ee(x,Ga)?Ga:Iu}function Kc(){if(!bu)return!1;var x={},I=t.CSS&&t.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(X){x[X]=I?t.CSS.supports("touch-action",X):!0}),x}var Po=1,an=2,Ti=4,Zn=8,kn=Zn,qi=16,Rn=32;function zn(x){this.options=v({},this.defaults,x||{}),this.id=je(),this.manager=null,this.options.enable=b(this.options.enable,!0),this.state=Po,this.simultaneous={},this.requireFail=[]}zn.prototype={defaults:{},set:function(x){return v(this.options,x),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(x){if(h(x,"recognizeWith",this))return this;var I=this.simultaneous;return x=No(x,this),I[x.id]||(I[x.id]=x,x.recognizeWith(this)),this},dropRecognizeWith:function(x){return h(x,"dropRecognizeWith",this)?this:(x=No(x,this),delete this.simultaneous[x.id],this)},requireFailure:function(x){if(h(x,"requireFailure",this))return this;var I=this.requireFail;return x=No(x,this),k(I,x)===-1&&(I.push(x),x.requireFailure(this)),this},dropRequireFailure:function(x){if(h(x,"dropRequireFailure",this))return this;x=No(x,this);var I=k(this.requireFail,x);return I>-1&&this.requireFail.splice(I,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(x){return!!this.simultaneous[x.id]},emit:function(x){var I=this,X=this.state;function se(Fe){I.manager.emit(Fe,x)}X<Zn&&se(I.options.event+Ou(X)),se(I.options.event),x.additionalEvent&&se(x.additionalEvent),X>=Zn&&se(I.options.event+Ou(X))},tryEmit:function(x){if(this.canEmit())return this.emit(x);this.state=Rn},canEmit:function(){for(var x=0;x<this.requireFail.length;){if(!(this.requireFail[x].state&(Rn|Po)))return!1;x++}return!0},recognize:function(x){var I=v({},x);if(!R(this.options.enable,[this,I])){this.reset(),this.state=Rn;return}this.state&(kn|qi|Rn)&&(this.state=Po),this.state=this.process(I),this.state&(an|Ti|Zn|qi)&&this.tryEmit(I)},process:function(x){},getTouchAction:function(){},reset:function(){}};function Ou(x){return x&qi?"cancel":x&Zn?"end":x&Ti?"move":x&an?"start":""}function Pu(x){return x==Ht?"down":x==yt?"up":x==Te?"left":x==Ut?"right":""}function No(x,I){var X=I.manager;return X?X.get(x):x}function mn(){zn.apply(this,arguments)}A(mn,zn,{defaults:{pointers:1},attrTest:function(x){var I=this.options.pointers;return I===0||x.pointers.length===I},process:function(x){var I=this.state,X=x.eventType,se=I&(an|Ti),Fe=this.attrTest(x);return se&&(X&Ve||!Fe)?I|qi:se||Fe?X&le?I|Zn:I&an?I|Ti:an:Rn}});function Fo(){mn.apply(this,arguments),this.pX=null,this.pY=null}A(Fo,mn,{defaults:{event:"pan",threshold:10,pointers:1,direction:kt},getTouchAction:function(){var x=this.options.direction,I=[];return x&bt&&I.push(Zi),x&lt&&I.push(Yi),I},directionTest:function(x){var I=this.options,X=!0,se=x.distance,Fe=x.direction,qe=x.deltaX,Pt=x.deltaY;return Fe&I.direction||(I.direction&bt?(Fe=qe===0?nt:qe<0?Te:Ut,X=qe!=this.pX,se=Math.abs(x.deltaX)):(Fe=Pt===0?nt:Pt<0?yt:Ht,X=Pt!=this.pY,se=Math.abs(x.deltaY))),x.direction=Fe,X&&se>I.threshold&&Fe&I.direction},attrTest:function(x){return mn.prototype.attrTest.call(this,x)&&(this.state&an||!(this.state&an)&&this.directionTest(x))},emit:function(x){this.pX=x.deltaX,this.pY=x.deltaY;var I=Pu(x.direction);I&&(x.additionalEvent=this.options.event+I),this._super.emit.call(this,x)}});function Si(){mn.apply(this,arguments)}A(Si,mn,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[si]},attrTest:function(x){return this._super.attrTest.call(this,x)&&(Math.abs(x.scale-1)>this.options.threshold||this.state&an)},emit:function(x){if(x.scale!==1){var I=x.scale<1?"in":"out";x.additionalEvent=this.options.event+I}this._super.emit.call(this,x)}});function Do(){zn.apply(this,arguments),this._timer=null,this._input=null}A(Do,zn,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Iu]},process:function(x){var I=this.options,X=x.pointers.length===I.pointers,se=x.distance<I.threshold,Fe=x.deltaTime>I.time;if(this._input=x,!se||!X||x.eventType&(le|Ve)&&!Fe)this.reset();else if(x.eventType&$t)this.reset(),this._timer=c(function(){this.state=kn,this.tryEmit()},I.time,this);else if(x.eventType&le)return kn;return Rn},reset:function(){clearTimeout(this._timer)},emit:function(x){this.state===kn&&(x&&x.eventType&le?this.manager.emit(this.options.event+"up",x):(this._input.timeStamp=f(),this.manager.emit(this.options.event,this._input)))}});function Ya(){mn.apply(this,arguments)}A(Ya,mn,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[si]},attrTest:function(x){return this._super.attrTest.call(this,x)&&(Math.abs(x.rotation)>this.options.threshold||this.state&an)}});function Za(){mn.apply(this,arguments)}A(Za,mn,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:bt|lt,pointers:1},getTouchAction:function(){return Fo.prototype.getTouchAction.call(this)},attrTest:function(x){var I=this.options.direction,X;return I&(bt|lt)?X=x.overallVelocity:I&bt?X=x.overallVelocityX:I&lt&&(X=x.overallVelocityY),this._super.attrTest.call(this,x)&&I&x.offsetDirection&&x.distance>this.options.threshold&&x.maxPointers==this.options.pointers&&l(X)>this.options.velocity&&x.eventType&le},emit:function(x){var I=Pu(x.offsetDirection);I&&this.manager.emit(this.options.event+I,x),this.manager.emit(this.options.event,x)}});function qn(){zn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}A(qn,zn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ga]},process:function(x){var I=this.options,X=x.pointers.length===I.pointers,se=x.distance<I.threshold,Fe=x.deltaTime<I.time;if(this.reset(),x.eventType&$t&&this.count===0)return this.failTimeout();if(se&&Fe&&X){if(x.eventType!=le)return this.failTimeout();var qe=this.pTime?x.timeStamp-this.pTime<I.interval:!0,Pt=!this.pCenter||on(this.pCenter,x.center)<I.posThreshold;this.pTime=x.timeStamp,this.pCenter=x.center,!Pt||!qe?this.count=1:this.count+=1,this._input=x;var Sr=this.count%I.taps;if(Sr===0)return this.hasRequireFailures()?(this._timer=c(function(){this.state=kn,this.tryEmit()},I.interval,this),an):kn}return Rn},failTimeout:function(){return this._timer=c(function(){this.state=Rn},this.options.interval,this),Rn},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==kn&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function gn(x,I){return I=I||{},I.recognizers=b(I.recognizers,gn.defaults.preset),new qa(x,I)}gn.VERSION="2.0.7",gn.defaults={domEvents:!1,touchAction:Mu,enable:!0,inputTarget:null,inputClass:null,preset:[[Ya,{enable:!1}],[Si,{enable:!1},["rotate"]],[Za,{direction:bt}],[Fo,{direction:bt},["swipe"]],[qn],[qn,{event:"doubletap",taps:2},["tap"]],[Do]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Nu=1,Bo=2;function qa(x,I){this.options=v({},gn.defaults,I||{}),this.options.inputTarget=this.options.inputTarget||x,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=x,this.input=nn(this),this.touchAction=new $a(this,this.options.touchAction),Fu(this,!0),d(this.options.recognizers,function(X){var se=this.add(new X[0](X[1]));X[2]&&se.recognizeWith(X[2]),X[3]&&se.requireFailure(X[3])},this)}qa.prototype={set:function(x){return v(this.options,x),x.touchAction&&this.touchAction.update(),x.inputTarget&&(this.input.destroy(),this.input.target=x.inputTarget,this.input.init()),this},stop:function(x){this.session.stopped=x?Bo:Nu},recognize:function(x){var I=this.session;if(!I.stopped){this.touchAction.preventDefaults(x);var X,se=this.recognizers,Fe=I.curRecognizer;(!Fe||Fe&&Fe.state&kn)&&(Fe=I.curRecognizer=null);for(var qe=0;qe<se.length;)X=se[qe],I.stopped!==Bo&&(!Fe||X==Fe||X.canRecognizeWith(Fe))?X.recognize(x):X.reset(),!Fe&&X.state&(an|Ti|Zn)&&(Fe=I.curRecognizer=X),qe++}},get:function(x){if(x instanceof zn)return x;for(var I=this.recognizers,X=0;X<I.length;X++)if(I[X].options.event==x)return I[X];return null},add:function(x){if(h(x,"add",this))return this;var I=this.get(x.options.event);return I&&this.remove(I),this.recognizers.push(x),x.manager=this,this.touchAction.update(),x},remove:function(x){if(h(x,"remove",this))return this;if(x=this.get(x),x){var I=this.recognizers,X=k(I,x);X!==-1&&(I.splice(X,1),this.touchAction.update())}return this},on:function(x,I){if(x!==i&&I!==i){var X=this.handlers;return d(Z(x),function(se){X[se]=X[se]||[],X[se].push(I)}),this}},off:function(x,I){if(x!==i){var X=this.handlers;return d(Z(x),function(se){I?X[se]&&X[se].splice(k(X[se],I),1):delete X[se]}),this}},emit:function(x,I){this.options.domEvents&&Qc(x,I);var X=this.handlers[x]&&this.handlers[x].slice();if(!(!X||!X.length)){I.type=x,I.preventDefault=function(){I.srcEvent.preventDefault()};for(var se=0;se<X.length;)X[se](I),se++}},destroy:function(){this.element&&Fu(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Fu(x,I){var X=x.element;if(!!X.style){var se;d(x.options.cssProps,function(Fe,qe){se=ce(X.style,qe),I?(x.oldCssProps[se]=X.style[se],X.style[se]=Fe):X.style[se]=x.oldCssProps[se]||""}),I||(x.oldCssProps={})}}function Qc(x,I){var X=r.createEvent("Event");X.initEvent(x,!0,!0),X.gesture=I,I.target.dispatchEvent(X)}v(gn,{INPUT_START:$t,INPUT_MOVE:Gr,INPUT_END:le,INPUT_CANCEL:Ve,STATE_POSSIBLE:Po,STATE_BEGAN:an,STATE_CHANGED:Ti,STATE_ENDED:Zn,STATE_RECOGNIZED:kn,STATE_CANCELLED:qi,STATE_FAILED:Rn,DIRECTION_NONE:nt,DIRECTION_LEFT:Te,DIRECTION_RIGHT:Ut,DIRECTION_UP:yt,DIRECTION_DOWN:Ht,DIRECTION_HORIZONTAL:bt,DIRECTION_VERTICAL:lt,DIRECTION_ALL:kt,Manager:qa,Input:Jt,TouchAction:$a,TouchInput:Mo,MouseInput:bo,PointerEventInput:Wa,TouchMouseInput:Io,SingleTouchInput:xu,Recognizer:zn,AttrRecognizer:mn,Tap:qn,Pan:Fo,Swipe:Za,Pinch:Si,Rotate:Ya,Press:Do,on:H,off:B,each:d,merge:y,extend:m,assign:v,inherit:A,bindFn:T,prefixed:ce});var Jc=typeof t<"u"?t:typeof self<"u"?self:{};Jc.Hammer=gn,typeof i=="function"&&i.amd?i(function(){return gn}):e.exports?e.exports=gn:t[n]=gn})(window,document,"Hammer")})(W1);const ms=W1.exports,SP={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"};class xP extends jd{get mapService(){return this.container.mapService}constructor(t){super(),E(this,"indragging",!1),E(this,"hammertime",void 0),E(this,"lastClickTime",0),E(this,"lastClickXY",[-1,-1]),E(this,"clickTimer",void 0),E(this,"$containter",void 0),E(this,"onDrag",r=>{const n=this.interactionEvent(r);n.type=SP[n.type],n.type==="dragging"?this.indragging=!0:this.indragging=!1,this.emit(ln.Drag,n)}),E(this,"onHammer",r=>{r.srcEvent.stopPropagation();const n=this.interactionEvent(r);this.emit(ln.Hover,n)}),E(this,"onTouch",r=>{const n=r.touches[0];this.onHover({clientX:n.clientX,clientY:n.clientY,type:"touchstart"})}),E(this,"onTouchEnd",r=>{if(r.changedTouches.length>0){const n=r.changedTouches[0];this.onHover({clientX:n.clientX,clientY:n.clientY,type:"touchend"})}}),E(this,"onTouchMove",r=>{const n=r.changedTouches[0];this.onHover({clientX:n.clientX,clientY:n.clientY,type:"touchmove"})}),E(this,"onHover",r=>{const{clientX:n,clientY:i}=r;let o=n,a=i;const s=r.type,u=this.mapService.getMapContainer();if(u){const{top:f,left:c}=u.getBoundingClientRect();o=o-c-u.clientLeft,a=a-f-u.clientTop}const l=this.mapService.containerToLngLat([o,a]);if(s==="click"){this.isDoubleTap(o,a,l);return}if(s==="touch"){this.isDoubleTap(o,a,l);return}s!=="click"&&s!=="dblclick"&&this.emit(ln.Hover,{x:o,y:a,lngLat:l,type:s,target:r})}),this.container=t}init(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}destroy(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(ln.Hover)}triggerHover({x:t,y:r}){this.emit(ln.Hover,{x:t,y:r})}triggerSelect(t){this.emit(ln.Select,{featureId:t})}triggerActive(t){this.emit(ln.Active,{featureId:t})}addEventListenerOnMap(){const t=this.mapService.getMapContainer();if(t){const r=new ms.Manager(t);r.add(new ms.Tap({event:"dblclick",taps:2})),r.add(new ms.Tap({event:"click"})),r.add(new ms.Pan({threshold:0,pointers:0})),r.add(new ms.Press({})),r.on("dblclick click",this.onHammer),r.on("panstart panmove panend pancancel",this.onDrag),t.addEventListener("touchstart",this.onTouch),t.addEventListener("touchend",this.onTouchEnd),t.addEventListener("mousemove",this.onHover),t.addEventListener("touchmove",this.onTouchMove),t.addEventListener("mousedown",this.onHover,!0),t.addEventListener("mouseup",this.onHover),t.addEventListener("contextmenu",this.onHover),this.hammertime=r}}removeEventListenerOnMap(){const t=this.mapService.getMapContainer();t&&(t.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),t.removeEventListener("touchstart",this.onTouch),t.removeEventListener("touchend",this.onTouchEnd),t.removeEventListener("mousedown",this.onHover),t.removeEventListener("mouseup",this.onHover),t.removeEventListener("contextmenu",this.onHover))}interactionEvent(t){const{type:r,pointerType:n}=t;let i,o;n==="touch"?(o=Math.floor(t.pointers[0].clientY),i=Math.floor(t.pointers[0].clientX)):(o=Math.floor(t.srcEvent.y),i=Math.floor(t.srcEvent.x));const a=this.mapService.getMapContainer();if(a){const{top:u,left:l}=a.getBoundingClientRect();i-=l,o-=u}const s=this.mapService.containerToLngLat([i,o]);return{x:i,y:o,lngLat:s,type:r,target:t.srcEvent}}isDoubleTap(t,r,n){const i=new Date().getTime();let o="click";i-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-t)<10&&Math.abs(this.lastClickXY[1]-r)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),o="dblclick",this.emit(ln.Hover,{x:t,y:r,lngLat:n,type:o})):(this.lastClickTime=i,this.lastClickXY=[t,r],this.clickTimer=setTimeout(()=>{o="click",this.emit(ln.Hover,{x:t,y:r,lngLat:n,type:o})},400))}}let RP=0;function CP(e){let t=e;if(typeof e=="string"&&(t=document.getElementById(e)),t){const r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id=`l7-scene-${RP++}`,r.classList.add("l7-scene"),t.appendChild(r),r}return null}function bP(e){var t;let r=!0;if((e==null||(t=e.target)===null||t===void 0?void 0:t.target)instanceof HTMLElement){var n;let o=e==null||(n=e.target)===null||n===void 0?void 0:n.target;for(;o;){var i;const a=Array.from(o.classList);if(a.includes("l7-marker")||a.includes("l7-popup")){r=!1;break}o=(i=o)===null||i===void 0?void 0:i.parentElement}}return r}let Zh=function(e){return e[e.SAMPLED=0]="SAMPLED",e[e.RENDER_TARGET=1]="RENDER_TARGET",e}({});class MP{constructor(t){var r=this;E(this,"pickedColors",void 0),E(this,"pickedTileLayers",[]),E(this,"pickingFBO",void 0),E(this,"width",0),E(this,"height",0),E(this,"alreadyInPicking",!1),E(this,"pickBufferScale",1),E(this,"pickFromPickingFBO",function(){var n=pe(function*(i,{x:o,y:a,lngLat:s,type:u,target:l}){let f=!1;const{readPixelsAsync:c,getViewportSize:h}=r.rendererService,{width:d,height:p}=h(),{enableHighlight:v,enableSelect:m}=i.getLayerConfig(),y=o*An,A=a*An;if(y>d-1*An||y<0||A>p-1*An||A<0)return!1;const T=yield c({x:Math.floor(y/r.pickBufferScale),y:Math.floor((p-(a+1)*An)/r.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:r.pickingFBO});if(r.pickedColors=T,T[0]!==0||T[1]!==0||T[2]!==0){const R=_o(T),b=i.layerPickService.getFeatureById(R);R!==i.getCurrentPickId()&&u==="mousemove"&&(u="mouseenter");const H={x:o,y:a,type:u,lngLat:s,featureId:R,feature:b,target:l};b&&(f=!0,i.setCurrentPickId(R),r.triggerHoverOnLayer(i,H))}else{const R={x:o,y:a,lngLat:s,type:i.getCurrentPickId()!==null&&u==="mousemove"?"mouseout":"un"+u,featureId:null,target:l,feature:null};r.triggerHoverOnLayer(i,he(he({},R),{},{type:"unpick"})),r.triggerHoverOnLayer(i,R),i.setCurrentPickId(null)}if(v&&i.layerPickService.highlightPickedFeature(T),m&&u==="click"&&(T==null?void 0:T.toString())!==[0,0,0,0].toString()){const R=_o(T);i.getCurrentSelectedId()===null||R!==i.getCurrentSelectedId()?(i.layerPickService.selectFeature(T),i.setCurrentSelectedId(R)):(i.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),i.setCurrentSelectedId(null))}return f});return function(i,o){return n.apply(this,arguments)}}()),this.container=t}get mapService(){return this.container.mapService}get rendererService(){return this.container.rendererService}get configService(){return this.container.globalConfigService}get interactionService(){return this.container.interactionService}get layerService(){return this.container.layerService}init(t){const{createTexture2D:r,createFramebuffer:n,getViewportSize:i}=this.rendererService;let{width:o,height:a}=i();this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,o=Math.round(o/this.pickBufferScale),a=Math.round(a/this.pickBufferScale);const s=r({width:o,height:a,usage:Zh.RENDER_TARGET,label:"Picking Texture"});this.pickingFBO=n({color:s,depth:!0,width:o,height:a}),this.interactionService.on(ln.Hover,this.pickingAllLayer.bind(this))}boxPickLayer(t,r,n){var i=this;return pe(function*(){const{useFramebufferAsync:o,clear:a}=i.rendererService;i.resizePickingFBO(),t.hooks.beforePickingEncode.call(),yield o(i.pickingFBO,pe(function*(){a({framebuffer:i.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),t.renderModels({ispick:!0})})),t.hooks.afterPickingEncode.call();const s=yield i.pickBox(t,r);n(s)})()}pickBox(t,r){var n=this;return pe(function*(){const[i,o,a,s]=r.map(y=>{const A=y<0?0:y;return Math.floor(A*An/n.pickBufferScale)}),{readPixelsAsync:u,getViewportSize:l}=n.rendererService,{width:f,height:c}=l();if(i>(f-1)*An/n.pickBufferScale||a<0||o>(c-1)*An/n.pickBufferScale||s<0)return[];const h=Math.min(f/n.pickBufferScale,a)-i,d=Math.min(c/n.pickBufferScale,s)-o,p=yield u({x:i,y:Math.floor(c/n.pickBufferScale-(s+1)),width:h,height:d,data:new Uint8Array(h*d*4),framebuffer:n.pickingFBO}),v=[],m={};for(let y=0;y<p.length/4;y=y+1){const A=p.slice(y*4,y*4+4),T=_o(A);if(T!==-1&&!m[T]){const R=t.layerPickService.getFeatureById(T);v.push(he(he({},R),{},{pickedFeatureIdx:T})),m[T]=!0}}return v})()}handleCursor(t,r){const{cursor:n="",cursorEnabled:i}=t.getLayerConfig();if(i){const a=this.mapService.version==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),s=a==null?void 0:a.style.getPropertyValue("cursor");r==="unmousemove"&&s!==""?a==null||a.style.setProperty("cursor",""):r==="mousemove"&&(a==null||a.style.setProperty("cursor",n))}}destroy(){this.pickingFBO.destroy(),this.pickingFBO=null}pickingAllLayer(t){var r=this;return pe(function*(){!r.layerService.needPick(t.type)||!r.isPickingAllLayer()||(r.alreadyInPicking=!0,yield r.pickingLayers(t),r.layerService.renderLayers(),r.alreadyInPicking=!1)})()}isPickingAllLayer(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}resizePickingFBO(){const{getViewportSize:t}=this.rendererService,{width:r,height:n}=t();(this.width!==r||this.height!==n)&&(this.pickingFBO.resize({width:Math.round(r/this.pickBufferScale),height:Math.round(n/this.pickBufferScale)}),this.width=r,this.height=n)}pickingLayers(t){var r=this;return pe(function*(){const{clear:n,useFramebufferAsync:i}=r.rendererService;r.resizePickingFBO();const o=r.layerService.getRenderList();for(const a of o.filter(s=>s.needPick(t.type)).reverse()){yield i(r.pickingFBO,pe(function*(){n({framebuffer:r.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),a.layerPickService.pickRender(t)}));const s=yield r.pickFromPickingFBO(a,t);if(r.layerService.pickedLayerId=s?+a.id:-1,s&&!a.getLayerConfig().enablePropagation)break}})()}triggerHoverOnLayer(t,r){bP(r)&&(this.handleCursor(t,r.type),t.emit(r.type,r))}}class IP{constructor(t=!0){E(this,"autoStart",void 0),E(this,"startTime",0),E(this,"oldTime",0),E(this,"running",!1),E(this,"elapsedTime",0),this.autoStart=t}start(){this.startTime=(typeof performance>"u"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const r=(typeof performance>"u"?Date:performance).now();t=(r-this.oldTime)/1e3,this.oldTime=r,this.elapsedTime+=t}return t}}const{throttle:jv}=Ar;class OP extends vn.exports.EventEmitter{get renderService(){return this.container.rendererService}get mapService(){return this.container.mapService}get debugService(){return this.container.debugService}constructor(t){super(),E(this,"pickedLayerId",-1),E(this,"clock",new IP),E(this,"alreadyInRendering",!1),E(this,"layers",[]),E(this,"layerList",[]),E(this,"layerRenderID",void 0),E(this,"sceneInited",!1),E(this,"animateInstanceCount",0),E(this,"shaderPicking",!0),E(this,"enableRender",!0),E(this,"reRender",jv(()=>{this.renderLayers()},32)),E(this,"throttleRenderLayers",jv(()=>{this.renderLayers()},16)),this.container=t}needPick(t){return this.updateLayerRenderList(),this.layerList.some(r=>r.needPick(t))}add(t){this.layers.push(t),this.sceneInited&&t.init().then(()=>{this.renderLayers()})}addMask(t){this.sceneInited&&t.init().then(()=>{this.renderLayers()})}initLayers(){var t=this;return pe(function*(){t.sceneInited=!0,t.layers.forEach(function(){var r=pe(function*(n){n.startInit||(yield n.init(),t.updateLayerRenderList())});return function(n){return r.apply(this,arguments)}}())})()}getSceneInited(){return this.sceneInited}getRenderList(){return this.layerList}getLayers(){return this.layers}getLayer(t){return this.layers.find(r=>r.id===t)}getLayerByName(t){return this.layers.find(r=>r.name===t)}remove(t,r){var n=this;return pe(function*(){r?r.layerChildren=r.layerChildren.filter(i=>i!==t):n.layers=n.layers.filter(i=>i!==t),t.destroy(),n.reRender(),n.emit("layerChange",n.layers)})()}removeAllLayers(){var t=this;return pe(function*(){t.destroy(),t.reRender()})()}setEnableRender(t){this.enableRender=t}renderLayers(){var t=this;return pe(function*(){if(t.alreadyInRendering||!t.enableRender)return;t.updateLayerRenderList();const r=t.debugService.generateRenderUid();t.debugService.renderStart(r),t.alreadyInRendering=!0,t.clear();for(const n of t.layerList)n.prerender();t.renderService.beginFrame();for(const n of t.layerList){const{enableMask:i}=n.getLayerConfig();n.masks.filter(o=>o.inited).length>0&&i&&t.renderMask(n.masks),n.getLayerConfig().enableMultiPassRenderer?yield n.renderMultiPass():n.render()}t.renderService.endFrame(),t.debugService.renderEnd(r),t.alreadyInRendering=!1})()}renderMask(t){let r=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});const n=t.length>1?ho.MULTIPLE:ho.SINGLE;for(const i of t)i.render({isStencil:!0,stencilType:n,stencilIndex:r++})}beforeRenderData(t){var r=this;return pe(function*(){(yield t.hooks.beforeRenderData.promise())&&r.renderLayers()})()}renderTileLayerMask(t){let r=0;const{enableMask:n=!0}=t.getLayerConfig();let i=t.tileMask?1:0;const o=t.masks.filter(s=>s.inited);i=i+(n?o.length:1);const a=i>1?ho.MULTIPLE:ho.SINGLE;if((t.tileMask||o.length&&n)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),o.length&&n)for(const s of o)s.render({isStencil:!0,stencilType:a,stencilIndex:r++});t.tileMask&&t.tileMask.render({isStencil:!0,stencilType:a,stencilIndex:r++,stencilOperation:Mc.OR})}renderTileLayer(t){var r=this;return pe(function*(){r.renderTileLayerMask(t),t.getLayerConfig().enableMultiPassRenderer?yield t.renderMultiPass():yield t.render()})()}updateLayerRenderList(){this.layerList=[],this.layers.filter(t=>t.inited).filter(t=>t.isVisible()).sort((t,r)=>t.zIndex-r.zIndex).forEach(t=>{this.layerList.push(t)})}destroy(){this.layers.forEach(t=>{t.destroy()}),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}startAnimate(){this.animateInstanceCount++===0&&(this.clock.start(),this.runRender())}stopAnimate(){--this.animateInstanceCount===0&&(this.stopRender(),this.clock.stop())}getOESTextureFloat(){return this.renderService.extensionObject.OES_texture_float}enableShaderPick(){this.shaderPicking=!0}disableShaderPick(){this.shaderPicking=!1}getShaderPickStat(){return this.shaderPicking}clear(){const t=Zt(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}runRender(){this.renderLayers(),this.layerRenderID=window.requestAnimationFrame(this.runRender.bind(this))}stopRender(){window.cancelAnimationFrame(this.layerRenderID)}}const{isNil:PP}=Ar;class NP{constructor(t){E(this,"name",void 0),E(this,"type",void 0),E(this,"scale",void 0),E(this,"descriptor",void 0),E(this,"featureBufferLayout",[]),E(this,"needRescale",!1),E(this,"needRemapping",!1),E(this,"needRegenerateVertices",!1),E(this,"featureRange",{startIndex:0,endIndex:1/0}),E(this,"vertexAttribute",void 0),E(this,"defaultCallback",r=>{if(r.length===0){var n;return((n=this.scale)===null||n===void 0?void 0:n.defaultValues)||[]}return r.map((i,o)=>{var a;return((a=this.scale)===null||a===void 0?void 0:a.scalers[o].func)(i)})}),this.setProps(t)}setProps(t){Object.assign(this,t)}mapping(t){var r;if((r=this.scale)!==null&&r!==void 0&&r.callback){var n;const i=(n=this.scale)===null||n===void 0?void 0:n.callback(...t);if(!PP(i))return[i]}return this.defaultCallback(t)}resetDescriptor(){this.descriptor&&(this.descriptor.buffer.data=[])}}const FP=["buffer","update","name"],DP=["buffer","update","name"],BP={[g.FLOAT]:4,[g.UNSIGNED_BYTE]:1,[g.UNSIGNED_SHORT]:2};class wP{constructor(t){E(this,"attributesAndIndices",void 0),E(this,"attributes",[]),E(this,"triangulation",void 0),E(this,"featureLayout",{sizePerElement:0,elements:[]}),this.rendererService=t}registerStyleAttribute(t){let r=this.getLayerStyleAttribute(t.name||"");return r?r.setProps(t):(r=new NP(t),this.attributes.push(r)),r}unRegisterStyleAttribute(t){const r=this.attributes.findIndex(n=>n.name===t);r>-1&&this.attributes.splice(r,1)}updateScaleAttribute(t){this.attributes.forEach(r=>{var n;const i=r.name,o=(n=r.scale)===null||n===void 0?void 0:n.field;(t[i]||o&&t[o])&&(r.needRescale=!0,r.needRemapping=!0,r.needRegenerateVertices=!0)})}updateStyleAttribute(t,r,n){let i=this.getLayerStyleAttribute(t);i||(i=this.registerStyleAttribute(he(he({},r),{},{name:t})));const{scale:o}=r;o&&i&&(i.scale=o,i.needRescale=!0,i.needRemapping=!0,i.needRegenerateVertices=!0,n&&n.featureRange&&(i.featureRange=n.featureRange))}getLayerStyleAttributes(){return this.attributes}getLayerStyleAttribute(t){return this.attributes.find(r=>r.name===t)}getLayerAttributeScale(t){var r;const n=this.getLayerStyleAttribute(t),i=n==null||(r=n.scale)===null||r===void 0?void 0:r.scalers;return i&&i[0]?i[0].func:null}updateAttributeByFeatureRange(t,r,n=0,i,o){const a=this.attributes.find(s=>s.name===t);if(a&&a.descriptor){const{descriptor:s}=a,{update:u,buffer:l,size:f=0}=s,c=BP[l.type||g.FLOAT];if(u){const{elements:h,sizePerElement:d}=this.featureLayout,p=h.slice(n,i);if(!p.length)return;const{offset:v}=p[0],m=v*f*c,y=p.map(({featureIdx:A,vertices:T,normals:R},b)=>{const H=T.length/d,B=[];for(let q=0;q<H;q++){const Ee=R?R.slice(q*3,q*3+3):[];B.push(...u(r[A],A,T.slice(q*d,q*d+d),b,Ee))}return B}).flat();a.vertexAttribute.updateBuffer({data:y,offset:m}),o==null||o.emit(`legend:${t}`,o.getLegend(t))}}}createAttributesAndIndices(t,r,n,i){this.featureLayout={sizePerElement:0,elements:[]},r&&(this.triangulation=r);const o=this.attributes.map(v=>(v.resetDescriptor(),v.descriptor));let a=0,s=0;const u=[];let l=3;t.forEach((v,m)=>{const{indices:y,vertices:A,normals:T,size:R,indexes:b,count:H}=this.triangulation(v,n);typeof H=="number"&&(s+=H),y.forEach(q=>{u.push(q+a)}),l=R;const B=A.length/R;this.featureLayout.sizePerElement=l,this.featureLayout.elements.push({featureIdx:m,vertices:A,normals:T,offset:a}),a+=B;for(let q=0;q<B;q++){const Ee=(T==null?void 0:T.slice(q*3,q*3+3))||[],Z=A.slice(q*R,q*R+R);let k=0;b&&b[q]!==void 0&&(k=b[q]),o.forEach(($,K)=>{$&&$.update&&$.buffer.data.push(...$.update(v,m,Z,q,Ee,k))})}});const{createAttribute:f,createBuffer:c,createElements:h}=this.rendererService,d={};o.forEach((v,m)=>{if(v){const{buffer:y,update:A,name:T}=v,R=$n(v,FP),b=f(he({buffer:c(y)},R));d[v.name||""]=b,this.attributes[m].vertexAttribute=b}});const p=h({data:u,type:g.UNSIGNED_INT,count:u.length});return this.attributesAndIndices={attributes:d,elements:p,count:s},Object.values(this.attributes).filter(v=>v.scale).forEach(v=>{const m=v.name;i==null||i.emit(`legend:${m}`,i.getLegend(m))}),this.attributesAndIndices}createAttributes(t,r){this.featureLayout={sizePerElement:0,elements:[]},r&&(this.triangulation=r);const n=this.attributes.map(l=>(l.resetDescriptor(),l.descriptor));let i=0,o=3;t.forEach((l,f)=>{const{indices:c,vertices:h,normals:d,size:p,indexes:v}=this.triangulation(l);c.forEach(y=>{}),o=p;const m=h.length/p;this.featureLayout.sizePerElement=o,this.featureLayout.elements.push({featureIdx:f,vertices:h,normals:d,offset:i}),i+=m;for(let y=0;y<m;y++){const A=(d==null?void 0:d.slice(y*3,y*3+3))||[],T=h.slice(y*p,y*p+p);let R=0;v&&v[y]!==void 0&&(R=v[y]),n.forEach((b,H)=>{b&&b.update&&b.buffer.data.push(...b.update(l,f,T,y,A,R))})}});const{createAttribute:a,createBuffer:s}=this.rendererService,u={};return n.forEach((l,f)=>{if(l){const{buffer:c,update:h,name:d}=l,p=$n(l,DP),v=a(he({buffer:s(c)},p));u[l.name||""]=v,this.attributes[f].vertexAttribute=v}}),{attributes:u}}clearAllAttributes(){var t;this.attributes.forEach(r=>{r.vertexAttribute&&r.vertexAttribute.destroy()}),(t=this.attributesAndIndices)===null||t===void 0||t.elements.destroy(),this.attributes=[]}}function j1(e,t,r,n){function i(o){return o instanceof r?o:new r(function(a){a(o)})}return new(r||(r=Promise))(function(o,a){function s(f){try{l(n.next(f))}catch(c){a(c)}}function u(f){try{l(n.throw(f))}catch(c){a(c)}}function l(f){f.done?o(f.value):i(f.value).then(s,u)}l((n=n.apply(e,t||[])).next())})}function G1(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(l){return function(f){return u([l,f])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){r.label=l[1];break}if(l[0]===6&&r.label<o[1]){r.label=o[1],o=l;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(l);break}o[2]&&r.ops.pop(),r.trys.pop();continue}l=t.call(e,r)}catch(f){l=[6,f],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Jd(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,o=[],a;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(s){a={error:s}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return o}function ep(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,o;n<i;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))}function tp(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var qh={exports:{}},Zl={exports:{}},nu={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1===0}e.exports=t.default})(nu,nu.exports);var _n={},Kh={exports:{}},Qh={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(r){return function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var o=n.pop();return r.call(this,n,o)}},e.exports=t.default})(Qh,Qh.exports);var Wi={};Object.defineProperty(Wi,"__esModule",{value:!0});Wi.fallback=$1;Wi.wrap=Y1;var LP=Wi.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,UP=Wi.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,kP=Wi.hasNextTick=typeof process=="object"&&typeof process.nextTick=="function";function $1(e){setTimeout(e,0)}function Y1(e){return function(t){for(var r=[],n=arguments.length-1;n-- >0;)r[n]=arguments[n+1];return e(function(){return t.apply(void 0,r)})}}var Us;LP?Us=queueMicrotask:UP?Us=setImmediate:kP?Us=process.nextTick:Us=$1;Wi.default=Y1(Us);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=u;var r=Qh.exports,n=s(r),i=Wi,o=s(i),a=_n;function s(c){return c&&c.__esModule?c:{default:c}}function u(c){return(0,a.isAsync)(c)?function(){for(var h=[],d=arguments.length;d--;)h[d]=arguments[d];var p=h.pop(),v=c.apply(this,h);return l(v,p)}:(0,n.default)(function(h,d){var p;try{p=c.apply(this,h)}catch(v){return d(v)}if(p&&typeof p.then=="function")return l(p,d);d(null,p)})}function l(c,h){return c.then(function(d){f(h,null,d)},function(d){f(h,d&&d.message?d:new Error(d))})}function f(c,h,d){try{c(h,d)}catch(p){(0,o.default)(function(v){throw v},p)}}e.exports=t.default})(Kh,Kh.exports);Object.defineProperty(_n,"__esModule",{value:!0});_n.isAsyncIterable=_n.isAsyncGenerator=_n.isAsync=void 0;var zP=Kh.exports,VP=HP(zP);function HP(e){return e&&e.__esModule?e:{default:e}}function Z1(e){return e[Symbol.toStringTag]==="AsyncFunction"}function XP(e){return e[Symbol.toStringTag]==="AsyncGenerator"}function WP(e){return typeof e[Symbol.asyncIterator]=="function"}function jP(e){if(typeof e!="function")throw new Error("expected a function");return Z1(e)?(0,VP.default)(e):e}_n.default=jP;_n.isAsync=Z1;_n.isAsyncGenerator=XP;_n.isAsyncIterable=WP;var mo={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(n,i){if(i===void 0&&(i=n.length),!i)throw new Error("arity is undefined");function o(){for(var a=this,s=[],u=arguments.length;u--;)s[u]=arguments[u];return typeof s[i-1]=="function"?n.apply(this,s):new Promise(function(l,f){s[i-1]=function(c){for(var h=[],d=arguments.length-1;d-- >0;)h[d]=arguments[d+1];if(c)return f(c);l(h.length>1?h:h[0])},n.apply(a,s)})}return o}e.exports=t.default})(mo,mo.exports);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=nu.exports,n=u(r),i=_n,o=u(i),a=mo.exports,s=u(a);function u(l){return l&&l.__esModule?l:{default:l}}t.default=(0,s.default)(function(l,f,c){var h=(0,n.default)(f)?[]:{};l(f,function(d,p,v){(0,o.default)(d)(function(m){for(var y,A=[],T=arguments.length-1;T-- >0;)A[T]=arguments[T+1];A.length<2&&(y=A,A=y[0]),h[p]=A,v(m)})},function(d){return c(d,h)})},3),e.exports=t.default})(Zl,Zl.exports);var Jh={exports:{}},ql={exports:{}},ed={exports:{}},iu={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(n){function i(){for(var o=[],a=arguments.length;a--;)o[a]=arguments[a];if(n!==null){var s=n;n=null,s.apply(this,o)}}return Object.assign(i,n),i}e.exports=t.default})(iu,iu.exports);var td={exports:{}},rd={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=t.default})(rd,rd.exports);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=f;var r=nu.exports,n=a(r),i=rd.exports,o=a(i);function a(c){return c&&c.__esModule?c:{default:c}}function s(c){var h=-1,d=c.length;return function(){return++h<d?{value:c[h],key:h}:null}}function u(c){var h=-1;return function(){var p=c.next();return p.done?null:(h++,{value:p.value,key:h})}}function l(c){var h=c?Object.keys(c):[],d=-1,p=h.length;return function v(){var m=h[++d];return m==="__proto__"?v():d<p?{value:c[m],key:m}:null}}function f(c){if((0,n.default)(c))return s(c);var h=(0,o.default)(c);return h?u(h):l(c)}e.exports=t.default})(td,td.exports);var ou={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;function r(n){return function(){for(var i=[],o=arguments.length;o--;)i[o]=arguments[o];if(n===null)throw new Error("Callback was already called.");var a=n;n=null,a.apply(this,i)}}e.exports=t.default})(ou,ou.exports);var nd={exports:{}},au={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r={};t.default=r,e.exports=t.default})(au,au.exports);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var r=au.exports,n=i(r);function i(a){return a&&a.__esModule?a:{default:a}}function o(a,s,u,l){var f=!1,c=!1,h=!1,d=0,p=0;function v(){d>=s||h||f||(h=!0,a.next().then(function(A){var T=A.value,R=A.done;if(!(c||f)){if(h=!1,R){f=!0,d<=0&&l(null);return}d++,u(T,p,m),p++,v()}}).catch(y))}function m(A,T){if(d-=1,!c){if(A)return y(A);if(A===!1){f=!0,c=!0;return}if(T===n.default||f&&d<=0)return f=!0,l(null);v()}}function y(A){c||(h=!1,f=!0,l(A))}v()}e.exports=t.default})(nd,nd.exports);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=iu.exports,n=d(r),i=td.exports,o=d(i),a=ou.exports,s=d(a),u=_n,l=nd.exports,f=d(l),c=au.exports,h=d(c);function d(p){return p&&p.__esModule?p:{default:p}}t.default=function(p){return function(v,m,y){if(y=(0,n.default)(y),p<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!v)return y(null);if((0,u.isAsyncGenerator)(v))return(0,f.default)(v,p,m,y);if((0,u.isAsyncIterable)(v))return(0,f.default)(v[Symbol.asyncIterator](),p,m,y);var A=(0,o.default)(v),T=!1,R=!1,b=0,H=!1;function B(Ee,Z){if(!R)if(b-=1,Ee)T=!0,y(Ee);else if(Ee===!1)T=!0,R=!0;else{if(Z===h.default||T&&b<=0)return T=!0,y(null);H||q()}}function q(){for(H=!0;b<p&&!T;){var Ee=A();if(Ee===null){T=!0,b<=0&&y(null);return}b+=1,m(Ee.value,Ee.key,(0,s.default)(B))}H=!1}q()}},e.exports=t.default})(ed,ed.exports);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=ed.exports,n=u(r),i=_n,o=u(i),a=mo.exports,s=u(a);function u(f){return f&&f.__esModule?f:{default:f}}function l(f,c,h,d){return(0,n.default)(c)(f,(0,o.default)(h),d)}t.default=(0,s.default)(l,4),e.exports=t.default})(ql,ql.exports);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=ql.exports,n=a(r),i=mo.exports,o=a(i);function a(u){return u&&u.__esModule?u:{default:u}}function s(u,l,f){return(0,n.default)(u,1,l,f)}t.default=(0,o.default)(s,3),e.exports=t.default})(Jh,Jh.exports);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var r=Zl.exports,n=a(r),i=Jh.exports,o=a(i);function a(u){return u&&u.__esModule?u:{default:u}}function s(u,l){return(0,n.default)(o.default,u,l)}e.exports=t.default})(qh,qh.exports);var Oc=tp(qh.exports),Jn=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var t=arguments,r=[],n=0;n<arguments.length;n++)r[n]=t[n];return this.args=r,Oc(this.tasks)},e.prototype.tap=function(t,r){var n=this;this.tasks.push(function(i){r.apply(void 0,ep([],Jd(n.args),!1)),i(null,t)})},e}(),id={exports:{}},od={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=nu.exports,n=m(r),i=au.exports,o=m(i),a=ql.exports,s=m(a),u=iu.exports,l=m(u),f=ou.exports,c=m(f),h=_n,d=m(h),p=mo.exports,v=m(p);function m(R){return R&&R.__esModule?R:{default:R}}function y(R,b,H){H=(0,l.default)(H);var B=0,q=0,Ee=R.length,Z=!1;Ee===0&&H(null);function k($,K){$===!1&&(Z=!0),Z!==!0&&($?H($):(++q===Ee||K===o.default)&&H(null))}for(;B<Ee;B++)b(R[B],B,(0,c.default)(k))}function A(R,b,H){return(0,s.default)(R,1/0,b,H)}function T(R,b,H){var B=(0,n.default)(R)?y:A;return B(R,(0,d.default)(b),H)}t.default=(0,v.default)(T,3),e.exports=t.default})(od,od.exports);(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var r=od.exports,n=a(r),i=Zl.exports,o=a(i);function a(u){return u&&u.__esModule?u:{default:u}}function s(u,l){return(0,o.default)(n.default,u,l)}e.exports=t.default})(id,id.exports);id.exports;var ad={exports:{}};(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=iu.exports,n=f(r),i=ou.exports,o=f(i),a=_n,s=f(a),u=mo.exports,l=f(u);function f(h){return h&&h.__esModule?h:{default:h}}function c(h,d){if(d=(0,n.default)(d),!Array.isArray(h))return d(new Error("First argument to waterfall must be an array of functions"));if(!h.length)return d();var p=0;function v(y){var A=(0,s.default)(h[p++]);A.apply(void 0,y.concat([(0,o.default)(m)]))}function m(y){for(var A=[],T=arguments.length-1;T-- >0;)A[T]=arguments[T+1];if(y!==!1){if(y||p===h.length)return d.apply(void 0,[y].concat(A));v(A)}}v([])}t.default=(0,l.default)(c),e.exports=t.default})(ad,ad.exports);var GP=tp(ad.exports),Gv=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return Oc(this.tasks)},e.prototype.tap=function(t,r){this.tasks.push(function(n){var i=r();n(i,t)})},e}(),$P=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var t=arguments,r=[],n=0;n<arguments.length;n++)r[n]=t[n];return this.args=r,Oc(this.tasks)},e.prototype.tapPromise=function(t,r){var n=this;this.tasks.push(function(i){return j1(n,void 0,void 0,function(){return G1(this,function(o){switch(o.label){case 0:return[4,r.apply(void 0,ep([],Jd(this.args),!1))];case 1:return o.sent(),i(null,t),[2]}})})})},e}(),YP=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var t=arguments,r=[],n=0;n<arguments.length;n++)r[n]=t[n];return this.args=r,Oc(this.tasks)},e.prototype.tapPromise=function(t,r){var n=this;this.tasks.push(function(i){return j1(n,void 0,void 0,function(){var o;return G1(this,function(a){switch(a.label){case 0:return[4,r.apply(void 0,ep([],Jd(this.args),!1))];case 1:return o=a.sent(),i(o,t),[2]}})})})},e}(),ZP=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return GP(this.tasks)},e.prototype.tapPromise=function(t,r){this.tasks.length===0?this.tasks.push(function(n){r().then(function(i){n(null,i)})}):this.tasks.push(function(n,i){r(n).then(function(o){i(null,o)})})},e}(),rp={exports:{}},qP=rp.exports={};qP.forEach=function(e,t){for(var r=0;r<e.length;r++){var n=t(e[r]);if(n)return n}};var KP=function(e){var t=e.stateHandler.getState;function r(a){var s=t(a);return s&&!!s.isDetectable}function n(a){t(a).isDetectable=!0}function i(a){return!!t(a).busy}function o(a,s){t(a).busy=!!s}return{isDetectable:r,markAsDetectable:n,isBusy:i,markBusy:o}},QP=function(e){var t={};function r(a){var s=e.get(a);return s===void 0?[]:t[s]||[]}function n(a,s){var u=e.get(a);t[u]||(t[u]=[]),t[u].push(s)}function i(a,s){for(var u=r(a),l=0,f=u.length;l<f;++l)if(u[l]===s){u.splice(l,1);break}}function o(a){var s=r(a);!s||(s.length=0)}return{get:r,add:n,removeListener:i,removeAllListeners:o}},JP=function(){var e=1;function t(){return e++}return{generate:t}},e4=function(e){var t=e.idGenerator,r=e.stateHandler.getState;function n(o){var a=r(o);return a&&a.id!==void 0?a.id:null}function i(o){var a=r(o);if(!a)throw new Error("setId required the element to have a resize detection state.");var s=t.generate();return a.id=s,s}return{get:n,set:i}},t4=function(e){function t(){}var r={log:t,warn:t,error:t};if(!e&&window.console){var n=function(i,o){i[o]=function(){var s=console[o];if(s.apply)s.apply(console,arguments);else for(var u=0;u<arguments.length;u++)s(arguments[u])}};n(r,"log"),n(r,"warn"),n(r,"error")}return r},np={exports:{}},q1=np.exports={};q1.isIE=function(e){function t(){var n=navigator.userAgent.toLowerCase();return n.indexOf("msie")!==-1||n.indexOf("trident")!==-1||n.indexOf(" edge/")!==-1}if(!t())return!1;if(!e)return!0;var r=function(){var n,i=3,o=document.createElement("div"),a=o.getElementsByTagName("i");do o.innerHTML="<!--[if gt IE "+ ++i+"]><i></i><![endif]-->";while(a[0]);return i>4?i:n}();return e===r};q1.isLegacyOpera=function(){return!!window.opera};var K1={exports:{}},r4=K1.exports={};r4.getOption=n4;function n4(e,t,r){var n=e[t];return n==null&&r!==void 0?r:n}var $v=K1.exports,i4=function(t){t=t||{};var r=t.reporter,n=$v.getOption(t,"async",!0),i=$v.getOption(t,"auto",!0);i&&!n&&(r&&r.warn("Invalid options combination. auto=true and async=false is invalid. Setting async=true."),n=!0);var o=Yv(),a,s=!1;function u(p,v){!s&&i&&n&&o.size()===0&&c(),o.add(p,v)}function l(){for(s=!0;o.size();){var p=o;o=Yv(),p.process()}s=!1}function f(p){s||(p===void 0&&(p=n),a&&(h(a),a=null),p?c():l())}function c(){a=d(l)}function h(p){var v=clearTimeout;return v(p)}function d(p){var v=function(m){return setTimeout(m,0)};return v(p)}return{add:u,force:f}};function Yv(){var e={},t=0,r=0,n=0;function i(s,u){u||(u=s,s=0),s>r?r=s:s<n&&(n=s),e[s]||(e[s]=[]),e[s].push(u),t++}function o(){for(var s=n;s<=r;s++)for(var u=e[s],l=0;l<u.length;l++){var f=u[l];f()}}function a(){return t}return{add:i,process:o,size:a}}var ip="_erd";function o4(e){return e[ip]={},Q1(e)}function Q1(e){return e[ip]}function a4(e){delete e[ip]}var s4={initState:o4,getState:Q1,cleanState:a4},gs=np.exports,u4=function(e){e=e||{};var t=e.reporter,r=e.batchProcessor,n=e.stateHandler.getState;if(!t)throw new Error("Missing required dependency: reporter.");function i(l,f){function c(){f(l)}if(gs.isIE(8))n(l).object={proxy:c},l.attachEvent("onresize",c);else{var h=s(l);if(!h)throw new Error("Element is not detectable by this strategy.");h.contentDocument.defaultView.addEventListener("resize",c)}}function o(l){var f=e.important?" !important; ":"; ";return(l.join(f)+f).trim()}function a(l,f,c){c||(c=f,f=l,l=null),l=l||{},l.debug;function h(d,p){var v=o(["display: block","position: absolute","top: 0","left: 0","width: 100%","height: 100%","border: none","padding: 0","margin: 0","opacity: 0","z-index: -1000","pointer-events: none"]),m=!1,y=window.getComputedStyle(d),A=d.offsetWidth,T=d.offsetHeight;n(d).startSize={width:A,height:T};function R(){function b(){if(y.position==="static"){d.style.setProperty("position","relative",l.important?"important":"");var q=function(Ee,Z,k,$){function K(Ne){return Ne.replace(/[^-\d\.]/g,"")}var ce=k[$];ce!=="auto"&&K(ce)!=="0"&&(Ee.warn("An element that is positioned static has style."+$+"="+ce+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+$+" will be set to 0. Element: ",Z),Z.style.setProperty($,"0",l.important?"important":""))};q(t,d,y,"top"),q(t,d,y,"right"),q(t,d,y,"bottom"),q(t,d,y,"left")}}function H(){m||b();function q(Z,k){if(!Z.contentDocument){var $=n(Z);$.checkForObjectDocumentTimeoutId&&window.clearTimeout($.checkForObjectDocumentTimeoutId),$.checkForObjectDocumentTimeoutId=setTimeout(function(){$.checkForObjectDocumentTimeoutId=0,q(Z,k)},100);return}k(Z.contentDocument)}var Ee=this;q(Ee,function(k){p(d)})}y.position!==""&&(b(),m=!0);var B=document.createElement("object");B.style.cssText=v,B.tabIndex=-1,B.type="text/html",B.setAttribute("aria-hidden","true"),B.onload=H,gs.isIE()||(B.data="about:blank"),n(d)&&(d.appendChild(B),n(d).object=B,gs.isIE()&&(B.data="about:blank"))}r?r.add(R):R()}gs.isIE(8)?c(f):h(f,c)}function s(l){return n(l).object}function u(l){if(!!n(l)){var f=s(l);!f||(gs.isIE(8)?l.detachEvent("onresize",f.proxy):l.removeChild(f),n(l).checkForObjectDocumentTimeoutId&&window.clearTimeout(n(l).checkForObjectDocumentTimeoutId),delete n(l).object)}}return{makeDetectable:a,addListener:i,uninstall:u}},l4=rp.exports.forEach,c4=function(e){e=e||{};var t=e.reporter,r=e.batchProcessor,n=e.stateHandler.getState;e.stateHandler.hasState;var i=e.idHandler;if(!r)throw new Error("Missing required dependency: batchProcessor");if(!t)throw new Error("Missing required dependency: reporter.");var o=f(),a="erd_scroll_detection_scrollbar_style",s="erd_scroll_detection_container";function u(R){c(R,a,s)}u(window.document);function l(R){var b=e.important?" !important; ":"; ";return(R.join(b)+b).trim()}function f(){var R=500,b=500,H=document.createElement("div");H.style.cssText=l(["position: absolute","width: "+R*2+"px","height: "+b*2+"px","visibility: hidden","margin: 0","padding: 0"]);var B=document.createElement("div");B.style.cssText=l(["position: absolute","width: "+R+"px","height: "+b+"px","overflow: scroll","visibility: none","top: "+-R*3+"px","left: "+-b*3+"px","visibility: hidden","margin: 0","padding: 0"]),B.appendChild(H),document.body.insertBefore(B,document.body.firstChild);var q=R-B.clientWidth,Ee=b-B.clientHeight;return document.body.removeChild(B),{width:q,height:Ee}}function c(R,b,H){function B(k,$){$=$||function(ce){R.head.appendChild(ce)};var K=R.createElement("style");return K.innerHTML=k,K.id=b,$(K),K}if(!R.getElementById(b)){var q=H+"_animation",Ee=H+"_animation_active",Z=`/* Created by the element-resize-detector library. */
`;Z+="."+H+" > div::-webkit-scrollbar { "+l(["display: none"])+` }

`,Z+="."+Ee+" { "+l(["-webkit-animation-duration: 0.1s","animation-duration: 0.1s","-webkit-animation-name: "+q,"animation-name: "+q])+` }
`,Z+="@-webkit-keyframes "+q+` { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }
`,Z+="@keyframes "+q+" { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }",B(Z)}}function h(R){R.className+=" "+s+"_animation_active"}function d(R,b,H){if(R.addEventListener)R.addEventListener(b,H);else if(R.attachEvent)R.attachEvent("on"+b,H);else return t.error("[scroll] Don't know how to add event listeners.")}function p(R,b,H){if(R.removeEventListener)R.removeEventListener(b,H);else if(R.detachEvent)R.detachEvent("on"+b,H);else return t.error("[scroll] Don't know how to remove event listeners.")}function v(R){return n(R).container.childNodes[0].childNodes[0].childNodes[0]}function m(R){return n(R).container.childNodes[0].childNodes[0].childNodes[1]}function y(R,b){var H=n(R).listeners;if(!H.push)throw new Error("Cannot add listener to an element that is not detectable.");n(R).listeners.push(b)}function A(R,b,H){H||(H=b,b=R,R=null),R=R||{};function B(){if(R.debug){var le=Array.prototype.slice.call(arguments);if(le.unshift(i.get(b),"Scroll: "),t.log.apply)t.log.apply(null,le);else for(var Ve=0;Ve<le.length;Ve++)t.log(le[Ve])}}function q(le){function Ve(nt){var Te=nt.getRootNode&&nt.getRootNode().contains(nt);return nt===nt.ownerDocument.body||nt.ownerDocument.body.contains(nt)||Te}return!Ve(le)||window.getComputedStyle(le)===null}function Ee(le){var Ve=n(le).container.childNodes[0],nt=window.getComputedStyle(Ve);return!nt.width||nt.width.indexOf("px")===-1}function Z(){var le=window.getComputedStyle(b),Ve={};return Ve.position=le.position,Ve.width=b.offsetWidth,Ve.height=b.offsetHeight,Ve.top=le.top,Ve.right=le.right,Ve.bottom=le.bottom,Ve.left=le.left,Ve.widthCSS=le.width,Ve.heightCSS=le.height,Ve}function k(){var le=Z();n(b).startSize={width:le.width,height:le.height},B("Element start size",n(b).startSize)}function $(){n(b).listeners=[]}function K(){if(B("storeStyle invoked."),!n(b)){B("Aborting because element has been uninstalled");return}var le=Z();n(b).style=le}function ce(le,Ve,nt){n(le).lastWidth=Ve,n(le).lastHeight=nt}function Ne(le){return v(le).childNodes[0]}function je(){return 2*o.width+1}function Je(){return 2*o.height+1}function ht(le){return le+10+je()}function $e(le){return le+10+Je()}function et(le){return le*2+je()}function mt(le){return le*2+Je()}function gt(le,Ve,nt){var Te=v(le),Ut=m(le),yt=ht(Ve),Ht=$e(nt),bt=et(Ve),lt=mt(nt);Te.scrollLeft=yt,Te.scrollTop=Ht,Ut.scrollLeft=bt,Ut.scrollTop=lt}function Ot(){var le=n(b).container;if(!le){le=document.createElement("div"),le.className=s,le.style.cssText=l(["visibility: hidden","display: inline","width: 0px","height: 0px","z-index: -1","overflow: hidden","margin: 0","padding: 0"]),n(b).container=le,h(le),b.appendChild(le);var Ve=function(){n(b).onRendered&&n(b).onRendered()};d(le,"animationstart",Ve),n(b).onAnimationStart=Ve}return le}function Bt(){function le(){var Kt=n(b).style;if(Kt.position==="static"){b.style.setProperty("position","relative",R.important?"important":"");var Kr=function(Un,on,Gi,wr){function $i(Va){return Va.replace(/[^-\d\.]/g,"")}var Ai=Gi[wr];Ai!=="auto"&&$i(Ai)!=="0"&&(Un.warn("An element that is positioned static has style."+wr+"="+Ai+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+wr+" will be set to 0. Element: ",on),on.style[wr]=0)};Kr(t,b,Kt,"top"),Kr(t,b,Kt,"right"),Kr(t,b,Kt,"bottom"),Kr(t,b,Kt,"left")}}function Ve(Kt,Kr,Un,on){return Kt=Kt?Kt+"px":"0",Kr=Kr?Kr+"px":"0",Un=Un?Un+"px":"0",on=on?on+"px":"0",["left: "+Kt,"top: "+Kr,"right: "+on,"bottom: "+Un]}if(B("Injecting elements"),!n(b)){B("Aborting because element has been uninstalled");return}le();var nt=n(b).container;nt||(nt=Ot());var Te=o.width,Ut=o.height,yt=l(["position: absolute","flex: none","overflow: hidden","z-index: -1","visibility: hidden","width: 100%","height: 100%","left: 0px","top: 0px"]),Ht=l(["position: absolute","flex: none","overflow: hidden","z-index: -1","visibility: hidden"].concat(Ve(-(1+Te),-(1+Ut),-Ut,-Te))),bt=l(["position: absolute","flex: none","overflow: scroll","z-index: -1","visibility: hidden","width: 100%","height: 100%"]),lt=l(["position: absolute","flex: none","overflow: scroll","z-index: -1","visibility: hidden","width: 100%","height: 100%"]),kt=l(["position: absolute","left: 0","top: 0"]),zr=l(["position: absolute","width: 200%","height: 200%"]),fr=document.createElement("div"),Jt=document.createElement("div"),nn=document.createElement("div"),P=document.createElement("div"),Ei=document.createElement("div"),Co=document.createElement("div");fr.dir="ltr",fr.style.cssText=yt,fr.className=s,Jt.className=s,Jt.style.cssText=Ht,nn.style.cssText=bt,P.style.cssText=kt,Ei.style.cssText=lt,Co.style.cssText=zr,nn.appendChild(P),Ei.appendChild(Co),Jt.appendChild(nn),Jt.appendChild(Ei),fr.appendChild(Jt),nt.appendChild(fr);function ai(){var Kt=n(b);Kt&&Kt.onExpand?Kt.onExpand():B("Aborting expand scroll handler: element has been uninstalled")}function yi(){var Kt=n(b);Kt&&Kt.onShrink?Kt.onShrink():B("Aborting shrink scroll handler: element has been uninstalled")}d(nn,"scroll",ai),d(Ei,"scroll",yi),n(b).onExpandScroll=ai,n(b).onShrinkScroll=yi}function Et(){function le(bt,lt,kt){var zr=Ne(bt),fr=ht(lt),Jt=$e(kt);zr.style.setProperty("width",fr+"px",R.important?"important":""),zr.style.setProperty("height",Jt+"px",R.important?"important":"")}function Ve(bt){var lt=b.offsetWidth,kt=b.offsetHeight,zr=lt!==n(b).lastWidth||kt!==n(b).lastHeight;B("Storing current size",lt,kt),ce(b,lt,kt),r.add(0,function(){if(!!zr){if(!n(b)){B("Aborting because element has been uninstalled");return}if(!nt()){B("Aborting because element container has not been initialized");return}if(R.debug){var Jt=b.offsetWidth,nn=b.offsetHeight;(Jt!==lt||nn!==kt)&&t.warn(i.get(b),"Scroll: Size changed before updating detector elements.")}le(b,lt,kt)}}),r.add(1,function(){if(!n(b)){B("Aborting because element has been uninstalled");return}if(!nt()){B("Aborting because element container has not been initialized");return}gt(b,lt,kt)}),zr&&bt&&r.add(2,function(){if(!n(b)){B("Aborting because element has been uninstalled");return}if(!nt()){B("Aborting because element container has not been initialized");return}bt()})}function nt(){return!!n(b).container}function Te(){function bt(){return n(b).lastNotifiedWidth===void 0}B("notifyListenersIfNeeded invoked");var lt=n(b);if(bt()&&lt.lastWidth===lt.startSize.width&&lt.lastHeight===lt.startSize.height)return B("Not notifying: Size is the same as the start size, and there has been no notification yet.");if(lt.lastWidth===lt.lastNotifiedWidth&&lt.lastHeight===lt.lastNotifiedHeight)return B("Not notifying: Size already notified");B("Current size not notified, notifying..."),lt.lastNotifiedWidth=lt.lastWidth,lt.lastNotifiedHeight=lt.lastHeight,l4(n(b).listeners,function(kt){kt(b)})}function Ut(){if(B("startanimation triggered."),Ee(b)){B("Ignoring since element is still unrendered...");return}B("Element rendered.");var bt=v(b),lt=m(b);(bt.scrollLeft===0||bt.scrollTop===0||lt.scrollLeft===0||lt.scrollTop===0)&&(B("Scrollbars out of sync. Updating detector elements..."),Ve(Te))}function yt(){if(B("Scroll detected."),Ee(b)){B("Scroll event fired while unrendered. Ignoring...");return}Ve(Te)}if(B("registerListenersAndPositionElements invoked."),!n(b)){B("Aborting because element has been uninstalled");return}n(b).onRendered=Ut,n(b).onExpand=yt,n(b).onShrink=yt;var Ht=n(b).style;le(b,Ht.width,Ht.height)}function Tr(){if(B("finalizeDomMutation invoked."),!n(b)){B("Aborting because element has been uninstalled");return}var le=n(b).style;ce(b,le.width,le.height),gt(b,le.width,le.height)}function $t(){H(b)}function Gr(){B("Installing..."),$(),k(),r.add(0,K),r.add(1,Bt),r.add(2,Et),r.add(3,Tr),r.add(4,$t)}B("Making detectable..."),q(b)?(B("Element is detached"),Ot(),B("Waiting until element is attached..."),n(b).onRendered=function(){B("Element is now attached"),Gr()}):Gr()}function T(R){var b=n(R);!b||(b.onExpandScroll&&p(v(R),"scroll",b.onExpandScroll),b.onShrinkScroll&&p(m(R),"scroll",b.onShrinkScroll),b.onAnimationStart&&p(b.container,"animationstart",b.onAnimationStart),b.container&&R.removeChild(b.container))}return{makeDetectable:A,addListener:y,uninstall:T,initDocument:u}},ks=rp.exports.forEach,f4=KP,h4=QP,d4=JP,p4=e4,_4=t4,Zv=np.exports,v4=i4,Ii=s4,m4=u4,g4=c4;function qv(e){return Array.isArray(e)||e.length!==void 0}function Kv(e){if(Array.isArray(e))return e;var t=[];return ks(e,function(r){t.push(r)}),t}function Qv(e){return e&&e.nodeType===1}var E4=function(e){e=e||{};var t;if(e.idHandler)t={get:function(A){return e.idHandler.get(A,!0)},set:e.idHandler.set};else{var r=d4(),n=p4({idGenerator:r,stateHandler:Ii});t=n}var i=e.reporter;if(!i){var o=i===!1;i=_4(o)}var a=Oi(e,"batchProcessor",v4({reporter:i})),s={};s.callOnAdd=!!Oi(e,"callOnAdd",!0),s.debug=!!Oi(e,"debug",!1);var u=h4(t),l=f4({stateHandler:Ii}),f,c=Oi(e,"strategy","object"),h=Oi(e,"important",!1),d={reporter:i,batchProcessor:a,stateHandler:Ii,idHandler:t,important:h};if(c==="scroll"&&(Zv.isLegacyOpera()?(i.warn("Scroll strategy is not supported on legacy Opera. Changing to object strategy."),c="object"):Zv.isIE(9)&&(i.warn("Scroll strategy is not supported on IE9. Changing to object strategy."),c="object")),c==="scroll")f=g4(d);else if(c==="object")f=m4(d);else throw new Error("Invalid strategy name: "+c);var p={};function v(A,T,R){function b(k){var $=u.get(k);ks($,function(ce){ce(k)})}function H(k,$,K){u.add($,K),k&&K($)}if(R||(R=T,T=A,A={}),!T)throw new Error("At least one element required.");if(!R)throw new Error("Listener required.");if(Qv(T))T=[T];else if(qv(T))T=Kv(T);else return i.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");var B=0,q=Oi(A,"callOnAdd",s.callOnAdd),Ee=Oi(A,"onReady",function(){}),Z=Oi(A,"debug",s.debug);ks(T,function($){Ii.getState($)||(Ii.initState($),t.set($));var K=t.get($);if(Z&&i.log("Attaching listener to element",K,$),!l.isDetectable($)){if(Z&&i.log(K,"Not detectable."),l.isBusy($)){Z&&i.log(K,"System busy making it detectable"),H(q,$,R),p[K]=p[K]||[],p[K].push(function(){B++,B===T.length&&Ee()});return}return Z&&i.log(K,"Making detectable..."),l.markBusy($,!0),f.makeDetectable({debug:Z,important:h},$,function(Ne){if(Z&&i.log(K,"onElementDetectable"),Ii.getState(Ne)){l.markAsDetectable(Ne),l.markBusy(Ne,!1),f.addListener(Ne,b),H(q,Ne,R);var je=Ii.getState(Ne);if(je&&je.startSize){var Je=Ne.offsetWidth,ht=Ne.offsetHeight;(je.startSize.width!==Je||je.startSize.height!==ht)&&b(Ne)}p[K]&&ks(p[K],function($e){$e()})}else Z&&i.log(K,"Element uninstalled before being detectable.");delete p[K],B++,B===T.length&&Ee()})}Z&&i.log(K,"Already detecable, adding listener."),H(q,$,R),B++}),B===T.length&&Ee()}function m(A){if(!A)return i.error("At least one element is required.");if(Qv(A))A=[A];else if(qv(A))A=Kv(A);else return i.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");ks(A,function(T){u.removeAllListeners(T),f.uninstall(T),Ii.cleanState(T)})}function y(A){f.initDocument&&f.initDocument(A)}return{listenTo:v,removeListener:u.removeListener,removeAllListeners:u.removeAllListeners,uninstall:m,initDocument:y}};function Oi(e,t,r){var n=e[t];return n==null&&r!==void 0?r:n}class y4 extends vn.exports.EventEmitter{get iconService(){return this.container.iconService}get fontService(){return this.container.fontService}get controlService(){return this.container.controlService}get configService(){return this.container.globalConfigService}get map(){return this.container.mapService}get coordinateSystemService(){return this.container.coordinateSystemService}get rendererService(){return this.container.rendererService}get layerService(){return this.container.layerService}get debugService(){return this.container.debugService}get cameraService(){return this.container.cameraService}get interactionService(){return this.container.interactionService}get pickingService(){return this.container.pickingService}get shaderModuleService(){return this.container.shaderModuleService}get markerService(){return this.container.markerService}get popupService(){return this.container.popupService}constructor(t){super(),E(this,"destroyed",!1),E(this,"loaded",!1),E(this,"id",void 0),E(this,"inited",!1),E(this,"rendering",!1),E(this,"$container",void 0),E(this,"canvas",void 0),E(this,"markerContainer",void 0),E(this,"resizeDetector",void 0),E(this,"hooks",void 0),E(this,"handleWindowResized",()=>{this.emit("resize"),this.$container&&(this.initContainer(),this.coordinateSystemService.needRefresh=!0,this.render())}),E(this,"handleMapCameraChanged",r=>{this.cameraService.update(r),this.render()}),this.container=t,this.hooks={init:new $P},this.id=t.id}init(t){var r=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",()=>this.render()),this.fontService.init(),this.hooks.init.tapPromise("initMap",pe(function*(){r.debugService.log("map.mapInitStart",{type:r.map.version}),yield new Promise(n=>{r.map.onCameraChanged(i=>{r.cameraService.init(),r.cameraService.update(i),n()}),r.map.init()}),r.map.onCameraChanged(r.handleMapCameraChanged),r.map.addMarkerContainer(),r.markerService.addMarkers(),r.markerService.addMarkerLayers(),r.popupService.initPopup(),r.interactionService.init(),r.interactionService.on(ln.Drag,r.addSceneEvent.bind(r))})),this.hooks.init.tapPromise("initRenderer",pe(function*(){var n;const i=((n=r.map)===null||n===void 0?void 0:n.getOverlayContainer())||void 0;if(i?r.$container=i:r.$container=CP(r.configService.getSceneConfig(r.id).id||""),r.$container){if(r.canvas=pn("canvas","",r.$container),r.setCanvas(),yield r.rendererService.init(r.canvas,r.configService.getSceneConfig(r.id),t.gl),r.registerContextLost(),r.initContainer(),r.resizeDetector=E4({strategy:"scroll"}),r.resizeDetector.listenTo(r.$container,r.handleWindowResized),window.matchMedia){var o;(o=window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||o===void 0||o.addListener(r.handleWindowResized.bind("screen"))}}else console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");r.pickingService.init(r.id)})),this.render()}registerContextLost(){const t=this.rendererService.getCanvas();t&&t.addEventListener("webglcontextlost",()=>this.emit("webglcontextlost"))}addLayer(t){this.layerService.sceneService=this,this.layerService.add(t)}addMask(t){this.layerService.sceneService=this,this.layerService.addMask(t)}render(){var t=this;return pe(function*(){t.rendering||t.destroyed||(t.rendering=!0,t.inited?(yield t.layerService.initLayers(),yield t.layerService.renderLayers()):(yield t.hooks.init.promise(),t.destroyed&&t.destroy(),yield t.layerService.initLayers(),t.layerService.renderLayers(),t.controlService.addControls(),t.loaded=!0,t.emit("loaded"),t.inited=!0),t.rendering=!1)})()}addFontFace(t,r){this.fontService.addFontFace(t,r)}getSceneContainer(){return this.$container}exportPng(t){var r=this;return pe(function*(){var n;const i=(n=r.$container)===null||n===void 0?void 0:n.getElementsByTagName("canvas")[0];return yield r.render(),t==="jpg"?i==null?void 0:i.toDataURL("image/jpeg"):i==null?void 0:i.toDataURL("image/png")})()}getSceneConfig(){return this.configService.getSceneConfig(this.id)}getPointSizeRange(){return this.rendererService.getPointSizeRange()}addMarkerContainer(){const t=this.$container.parentElement;t!==null&&(this.markerContainer=pn("div","l7-marker-container",t))}getMarkerContainer(){return this.markerContainer}destroy(){var t;if(!this.inited){this.destroyed=!0;return}this.resizeDetector.removeListener(this.$container,this.handleWindowResized),this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout(()=>{var r;(r=this.$container)===null||r===void 0||r.removeChild(this.canvas),this.canvas=null,this.rendererService.destroy()}),(t=this.$container)===null||t===void 0||(t=t.parentNode)===null||t===void 0||t.removeChild(this.$container),this.emit("destroy")}initContainer(){var t,r;const n=An,i=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,o=((r=this.$container)===null||r===void 0?void 0:r.clientHeight)||300,a=this.canvas;a&&(a.width=i*n,a.height=o*n),this.rendererService.viewport({x:0,y:0,width:n*i,height:n*o})}setCanvas(){var t,r;const n=An,i=((t=this.$container)===null||t===void 0?void 0:t.clientWidth)||400,o=((r=this.$container)===null||r===void 0?void 0:r.clientHeight)||300,a=this.canvas;a.width=i*n,a.height=o*n,a.style.width="100%",a.style.height="100%"}addSceneEvent(t){this.emit(t.type,t)}}const{uniq:A4}=Ar,Jv="#define PI 3.14159265359",T4=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,S4=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,x4=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}


vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  return weight;
}
`,R4=`
in vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  float activeType = v_PickingResult.a;
  if(activeType > 0.0) {
    vec4 highLightColor =  activeType > 1.5 ? u_SelectColor : u_HighlightColor;
    highLightColor = highLightColor * COLOR_SCALE;
    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));
    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  }
  else {
    return color;
  }

  
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,C4=`layout(location = 3) in vec3 a_PickingColor;
out vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return distance(vertexColor,u_PickingColor.rgb) < 0.01;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return distance(vertexColor,u_CurrentSelectedId.rgb) < 0.01;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  if(u_PickingStage == PICKING_HIGHLIGHT) {
    if(isVertexPicked(pickingColor)) {
       v_PickingResult = vec4(pickingColor.rgb * COLOR_SCALE,HIGHLIGHT);
       return;
    }
    if(isVertexSelected(pickingColor)) {
     v_PickingResult = vec4(u_CurrentSelectedId.rgb * COLOR_SCALE,SELECT);
      return;
    }

  } else {
      v_PickingResult= vec4(pickingColor.rgb * COLOR_SCALE,NORMAL);
      return;
  }

  // // v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && (isVertexPicked(pickingColor) || isVertexPicked(u_CurrentSelectedId)));

  // // Stores the picking color so that the fragment shader can render it during picking
  // v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,em=`layout(std140) uniform PickingUniforms {
  vec4 u_HighlightColor;
  vec4 u_SelectColor;
  vec3 u_PickingColor;
  float u_PickingStage;
  vec3 u_CurrentSelectedId;
  float u_PickingThreshold;
  float u_PickingBuffer;
  float u_shaderPick;
  float u_activeMix;
};`,b4=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,tm=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)
#define EARTH_CIRCUMFERENCE 40.03e6

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0
#pragma include "scene_uniforms"


// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
   if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return lnglat;
  }
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  // if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
 

  //    return vec4(
  //     position.xy,
  //     project_scale(position.z),
  //     position.w);
  // }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}



float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel * u_FocalDistance ;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom) * u_FocalDistance ;
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom)* u_FocalDistance ;
  }

  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * 2.0 *  u_FocalDistance;;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom))  * u_FocalDistance ;
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}

// Project meter into the unit of pixel which used in the camera world space
float project_float_meter(float meter) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Since the zoom level uniform is updated by mapservice and it's alread been subtracted by 1
    // Not sure if we are supposed to do that again
   return meter;
  } else  {
    return project_float_pixel(meter);
  }

  // TODO: change the following code to make adaptations for amap
  // return u_FocalDistance * TILE_SIZE * pow(2.0, u_Zoom) * meter / EARTH_CIRCUMFERENCE;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) *  u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))  * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}

// \u652F\u6301 GaodeV2\u3001Mapbox
vec4 project_common_position_to_clipspace_v2(vec4 position) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    return u_Mvp * position;
  } else {
    return project_common_position_to_clipspace(position);
  }
}
`,M4=`vec2 rotate_matrix(vec2 v, float a) {
    float b = a / 180.0 * 3.1415926535897932384626433832795;
    float s = sin(b);
    float c = cos(b);
    mat2 m = mat2(c, s, -s, c);
    return m * v;
}`,rm=`layout(std140) uniform SceneUniforms {
  mat4 u_ViewMatrix;
  mat4 u_ProjectionMatrix;
  mat4 u_ViewProjectionMatrix;
  mat4 u_ModelMatrix;
  vec4 u_ViewportCenterProjection;
  vec3 u_PixelsPerDegree;
  float u_Zoom;
  vec3 u_PixelsPerDegree2;
  float u_ZoomScale;
  vec3 u_PixelsPerMeter;
  float u_CoordinateSystem;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_ViewportCenter;
  vec2 u_ViewportSize;
  float u_FocalDistance;
};

layout(std140) uniform LayerUniforms {
  mat4 u_Mvp;
  vec2 u_sceneCenterMercator;
};
`,I4=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,nm=/precision\s+(high|low|medium)p\s+float/,im=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,O4=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,P4=/void\s+main\s*\([^)]*\)\s*\{\n?/;class N4{constructor(){E(this,"moduleCache",{}),E(this,"rawContentCache",{})}registerBuiltinModules(){this.destroy(),this.registerModule("common",{vs:Jv,fs:Jv}),this.registerModule("decode",{vs:S4,fs:""}),this.registerModule("scene_uniforms",{vs:rm,fs:rm}),this.registerModule("picking_uniforms",{vs:em,fs:em}),this.registerModule("projection",{vs:tm,fs:tm}),this.registerModule("project",{vs:b4,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:I4}),this.registerModule("lighting",{vs:x4,fs:""}),this.registerModule("light",{vs:T4,fs:""}),this.registerModule("picking",{vs:C4,fs:R4}),this.registerModule("rotation_2d",{vs:M4,fs:""})}registerModule(t,r){r.vs=r.vs.replace(/\r\n/g,`
`),r.fs=r.fs.replace(/\r\n/g,`
`);const{vs:n,fs:i,uniforms:o,inject:a}=r,{content:s,uniforms:u}=uh(n),{content:l,uniforms:f}=uh(i);this.rawContentCache[t]={fs:l,inject:a,uniforms:he(he(he({},u),f),o),vs:s}}destroy(){this.moduleCache={},this.rawContentCache={}}getModule(t){let r=this.rawContentCache[t].vs,n=this.rawContentCache[t].fs;const i=this.rawContentCache[t].inject;let o={};i!=null&&i["vs:#decl"]&&(r=(i==null?void 0:i["vs:#decl"])+r,o=uh(i==null?void 0:i["vs:#decl"]).uniforms),i!=null&&i["vs:#main-start"]&&(r=r.replace(P4,d=>d+(i==null?void 0:i["vs:#main-start"]))),i!=null&&i["fs:#decl"]&&(n=(i==null?void 0:i["fs:#decl"])+n);const{content:a,includeList:s}=this.processModule(r,[],"vs"),{content:u,includeList:l}=this.processModule(n,[],"fs");let f="";const c=A4(s.concat(l).concat(t)).reduce((d,p)=>he(he({},d),this.rawContentCache[p].uniforms),he({},o));nm.test(u)||(f=f+im),f=f+u;let h="";return nm.test(a)||(h=h+im),h=h+a,this.moduleCache[t]={fs:f.trim(),uniforms:c,vs:h.trim()},this.moduleCache[t]}processModule(t,r,n){return{content:t.replace(O4,(o,a)=>{const u=a.split(" ")[0].replace(/"/g,"");if(r.indexOf(u)>-1)return"";const l=this.rawContentCache[u][n];r.push(u);const{content:f}=this.processModule(l,r,n);return f}),includeList:r}}injectDefines(t){return Object.keys(t).reduce((n,i)=>n+`#define ${i.toUpperCase()} ${t[i]};
`,`
`)}}class Pc{constructor(){E(this,"shaderModuleService",void 0),E(this,"rendererService",void 0),E(this,"cameraService",void 0),E(this,"mapService",void 0),E(this,"interactionService",void 0),E(this,"layerService",void 0),E(this,"config",void 0)}getName(){return""}getType(){return ka.Normal}init(t,r){this.config=r,this.rendererService=t.getContainer().rendererService,this.cameraService=t.getContainer().cameraService,this.mapService=t.getContainer().mapService,this.interactionService=t.getContainer().interactionService,this.layerService=t.getContainer().layerService,this.shaderModuleService=t.getContainer().shaderModuleService}render(t){}}class F4 extends Pc{getName(){return"clear"}init(t,r){super.init(t,r)}render(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}class D4{constructor(t){E(this,"passes",[]),E(this,"layer",void 0),E(this,"renderFlag",void 0),E(this,"width",0),E(this,"height",0),this.postProcessor=t}setLayer(t){this.layer=t}setRenderFlag(t){this.renderFlag=t}getRenderFlag(){return this.renderFlag}getPostProcessor(){return this.postProcessor}render(){var t=this;return pe(function*(){for(const r of t.passes)yield r.render(t.layer);yield t.postProcessor.render(t.layer)})()}resize(t,r){(this.width!==t||this.height!==r)&&(this.postProcessor.resize(t,r),this.width=t,this.height=r)}add(t,r){t.getType()===ka.PostProcessing?this.postProcessor.add(t,this.layer,r):(t.init(this.layer,r),this.passes.push(t))}insert(t,r,n){t.init(this.layer,r),this.passes.splice(n,0,t)}destroy(){this.passes.length=0}}class B4 extends Pc{constructor(...t){var r;super(...t),r=this,E(this,"pickingFBO",void 0),E(this,"layer",void 0),E(this,"width",0),E(this,"height",0),E(this,"alreadyInRendering",!1),E(this,"pickFromPickingFBO",({x:n,y:i,lngLat:o,type:a})=>{if(!this.layer.isVisible()||!this.layer.needPick(a))return;const{getViewportSize:s,readPixelsAsync:u,useFramebuffer:l}=this.rendererService,{width:f,height:c}=s(),{enableHighlight:h,enableSelect:d}=this.layer.getLayerConfig(),p=n*An,v=i*An;if(p>f||p<0||v>c||v<0)return;let m;l(this.pickingFBO,pe(function*(){var y;if(m=yield u({x:Math.round(p),y:Math.round(c-(i+1)*An),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:r.pickingFBO}),m[0]!==0||m[1]!==0||m[2]!==0){const A=_o(m),T=r.layer.getSource().getFeatureById(A),R={x:n,y:i,type:a,lngLat:o,featureId:A,feature:T};T&&(r.layer.setCurrentPickId(A),r.triggerHoverOnLayer(R))}else{const A={x:n,y:i,lngLat:o,type:r.layer.getCurrentPickId()===null?"un"+a:"mouseout",featureId:null,feature:null};r.triggerHoverOnLayer(he(he({},A),{},{type:"unpick"})),r.triggerHoverOnLayer(A),r.layer.setCurrentPickId(null)}h&&r.highlightPickedFeature(m),d&&a==="click"&&((y=m)===null||y===void 0?void 0:y.toString())!==[0,0,0,0].toString()&&r.selectFeature(m)}))})}getType(){return ka.Normal}getName(){return"pixelPicking"}init(t,r){super.init(t,r),this.layer=t;const{createTexture2D:n,createFramebuffer:i,getViewportSize:o}=this.rendererService,{width:a,height:s}=o(),u=n({width:a,height:s,wrapS:g.CLAMP_TO_EDGE,wrapT:g.CLAMP_TO_EDGE,label:"Picking Texture"});this.pickingFBO=i({color:u}),this.interactionService.on(ln.Hover,this.pickFromPickingFBO),this.interactionService.on(ln.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(ln.Active,this.highlightFeatureHandle.bind(this))}render(t){if(this.alreadyInRendering)return;const{getViewportSize:r,useFramebuffer:n,clear:i}=this.rendererService,{width:o,height:a}=r();this.alreadyInRendering=!0,(this.width!==o||this.height!==a)&&(this.pickingFBO.resize({width:o,height:a}),this.width=o,this.height=a),n(this.pickingFBO,()=>{i({framebuffer:this.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});const s=this.layer.multiPassRenderer.getRenderFlag();this.layer.multiPassRenderer.setRenderFlag(!1),t.hooks.beforePickingEncode.call(),t.render(),t.hooks.afterPickingEncode.call(),this.layer.multiPassRenderer.setRenderFlag(s),this.alreadyInRendering=!1})}triggerHoverOnLayer(t){this.layer.emit(t.type,t)}highlightPickedFeature(t){const[r,n,i]=t;this.layer.hooks.beforeHighlight.call([r,n,i]),this.layerService.renderLayers()}selectFeature(t){const[r,n,i]=t;this.layer.hooks.beforeSelect.call([r,n,i]),this.layerService.renderLayers()}selectFeatureHandle({featureId:t}){const r=Ra(t);this.selectFeature(new Uint8Array(r))}highlightFeatureHandle({featureId:t}){const r=Ra(t);this.highlightPickedFeature(new Uint8Array(r))}}class w4{constructor(t){E(this,"passes",[]),E(this,"readFBO",void 0),E(this,"writeFBO",void 0),this.rendererService=t,this.init()}getReadFBO(){return this.readFBO}getWriteFBO(){return this.writeFBO}getCurrentFBOTex(){const{getViewportSize:t,createTexture2D:r}=this.rendererService,{width:n,height:i}=t();return r({x:0,y:0,width:n,height:i,copy:!0})}getReadFBOTex(){var t=this;const{useFramebuffer:r}=this.rendererService;return new Promise(n=>{r(this.readFBO,pe(function*(){n(t.getCurrentFBOTex())}))})}renderBloomPass(t,r){var n=this;return pe(function*(){const i=yield n.getReadFBOTex();let o=0;for(;o<4;)yield r.render(t,i),n.swap(),o++})()}render(t){var r=this;return pe(function*(){for(let n=0;n<r.passes.length;n++){const i=r.passes[n];i.setRenderToScreen(r.isLastEnabledPass(n)),i.getName()==="bloom"?yield r.renderBloomPass(t,i):(yield i.render(t),n!==r.passes.length-1&&r.swap())}})()}resize(t,r){this.readFBO.resize({width:t,height:r}),this.writeFBO.resize({width:t,height:r})}add(t,r,n){t.init(r,n),this.passes.push(t)}insert(t,r,n,i){t.init(n,i),this.passes.splice(r,0,t)}getPostProcessingPassByName(t){return this.passes.find(r=>r.getName()===t)}init(){const{createFramebuffer:t,createTexture2D:r}=this.rendererService;this.readFBO=t({color:r({width:1,height:1,wrapS:g.CLAMP_TO_EDGE,wrapT:g.CLAMP_TO_EDGE})}),this.writeFBO=t({color:r({width:1,height:1,wrapS:g.CLAMP_TO_EDGE,wrapT:g.CLAMP_TO_EDGE})})}isLastEnabledPass(t){for(let r=t+1;r<this.passes.length;r++)if(this.passes[r].isEnabled())return!1;return!0}swap(){const t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}class L4 extends Pc{getType(){return ka.Normal}getName(){return"render"}init(t,r){super.init(t,r)}render(t){const{useFramebuffer:r,clear:n}=this.rendererService,i=t.multiPassRenderer.getPostProcessor().getReadFBO();r(i,()=>{n({color:[0,0,0,0],depth:1,stencil:0,framebuffer:i}),t.multiPassRenderer.setRenderFlag(!1),t.models.forEach(o=>{o.draw({uniforms:t.layerModel.getUninforms()})}),t.multiPassRenderer.setRenderFlag(!0)})}}const U4=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,om=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,k4=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function am(e,t){let r=0,n=1/t,i=e;for(;i>0;)r=r+n*(i%t),i=Math.floor(i/t),n=n/t;return r}let z4=1;class V4 extends Pc{constructor(t){super(),E(this,"haltonSequence",[]),E(this,"accumulatingId",0),E(this,"frame",0),E(this,"timer",void 0),E(this,"sampleRenderTarget",void 0),E(this,"prevRenderTarget",void 0),E(this,"outputRenderTarget",void 0),E(this,"copyRenderTarget",void 0),E(this,"blendModel",void 0),E(this,"outputModel",void 0),E(this,"copyModel",void 0),this.shaderModuleService=t}getType(){return ka.Normal}getName(){return"taa"}init(t,r){super.init(t,r);const{createFramebuffer:n,createTexture2D:i}=this.rendererService;this.sampleRenderTarget=n({color:i({width:1,height:1,wrapS:g.CLAMP_TO_EDGE,wrapT:g.CLAMP_TO_EDGE})}),this.prevRenderTarget=n({color:i({width:1,height:1,wrapS:g.CLAMP_TO_EDGE,wrapT:g.CLAMP_TO_EDGE})}),this.outputRenderTarget=n({color:i({width:1,height:1,wrapS:g.CLAMP_TO_EDGE,wrapT:g.CLAMP_TO_EDGE})}),this.copyRenderTarget=n({color:i({width:1,height:1,wrapS:g.CLAMP_TO_EDGE,wrapT:g.CLAMP_TO_EDGE})});for(let o=0;o<30;o++)this.haltonSequence.push([am(o,2),am(o,3)]);this.blendModel=this.createTriangleModel("blend-pass",U4),this.outputModel=this.createTriangleModel("copy-pass",om,{blend:{enable:!0,func:{srcRGB:g.ONE,dstRGB:g.ONE_MINUS_SRC_ALPHA,srcAlpha:g.ONE,dstAlpha:g.ONE_MINUS_SRC_ALPHA},equation:{rgb:g.FUNC_ADD,alpha:g.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",om)}render(t){const{clear:r,getViewportSize:n,useFramebuffer:i}=this.rendererService,{width:o,height:a}=n();this.sampleRenderTarget.resize({width:o,height:a}),this.prevRenderTarget.resize({width:o,height:a}),this.outputRenderTarget.resize({width:o,height:a}),this.copyRenderTarget.resize({width:o,height:a}),this.resetFrame(),this.stopAccumulating();const s=t.multiPassRenderer.getPostProcessor().getReadFBO();i(s,()=>{r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:s}),t.multiPassRenderer.setRenderFlag(!1),t.render(),t.multiPassRenderer.setRenderFlag(!0)});const u=l=>{!this.accumulatingId||l!==this.accumulatingId||this.isFinished()||(this.doRender(t),window.requestAnimationFrame(()=>{u(l)}))};this.accumulatingId=z4++,this.timer=window.setTimeout(()=>{u(this.accumulatingId)},50)}doRender(t){const{clear:r,getViewportSize:n,useFramebuffer:i}=this.rendererService,{width:o,height:a}=n(),{jitterScale:s=1}=t.getLayerConfig(),u=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((u[0]*2-1)/o*s,(u[1]*2-1)/a*s),t.multiPassRenderer.setRenderFlag(!1),t.hooks.beforeRender.call(),i(this.sampleRenderTarget,()=>{r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.sampleRenderTarget}),t.render()}),t.hooks.afterRender.call(),t.multiPassRenderer.setRenderFlag(!0);const l=t.getLayerConfig();i(this.outputRenderTarget,()=>{this.blendModel.draw({uniforms:{u_opacity:l.opacity||1,u_MixRatio:this.frame===0?1:.9,u_Diffuse1:this.sampleRenderTarget,u_Diffuse2:this.frame===0?t.multiPassRenderer.getPostProcessor().getReadFBO():this.prevRenderTarget}})}),this.frame===0&&r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(i(this.copyRenderTarget,()=>{this.outputModel.draw({uniforms:{u_Texture:this.outputRenderTarget}})}),i(t.multiPassRenderer.getPostProcessor().getReadFBO(),()=>{this.copyModel.draw({uniforms:{u_Texture:this.copyRenderTarget}})}),t.multiPassRenderer.getPostProcessor().render(t));const f=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=f,this.frame++,this.cameraService.clearJitterProjectionMatrix()}isFinished(){return this.frame>=this.haltonSequence.length}resetFrame(){this.frame=0}stopAccumulating(){this.accumulatingId=0,window.clearTimeout(this.timer)}createTriangleModel(t,r,n){this.shaderModuleService.registerModule(t,{vs:k4,fs:r});const{vs:i,fs:o,uniforms:a}=this.shaderModuleService.getModule(t),{createAttribute:s,createBuffer:u,createModel:l}=this.rendererService;return l(he({vs:i,fs:o,attributes:{a_Position:s({buffer:u({data:[-4,-4,4,-4,0,4],type:g.FLOAT}),size:2})},uniforms:he({},a),depth:{enable:!1},count:3},n))}}const H4=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,X4=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,{isNil:ch}=Ar;class W4 extends gi{setupShaders(){this.shaderModuleService.registerModule("blur-pass",{vs:X4,fs:H4});const{vs:t,fs:r,uniforms:n}=this.shaderModuleService.getModule("blur-pass"),{width:i,height:o}=this.rendererService.getViewportSize();return{vs:t,fs:r,uniforms:he(he({},n),{},{u_ViewportSize:[i,o]})}}convertOptionsToUniforms(t){const r={};return ch(t.bloomRadius)||(r.u_radius=t.bloomRadius),ch(t.bloomIntensity)||(r.u_intensity=t.bloomIntensity),ch(t.bloomBaseRadio)||(r.u_baseRadio=t.bloomBaseRadio),r}}const j4=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,G4=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,{isNil:$4}=Ar;class Y4 extends gi{setupShaders(){this.shaderModuleService.registerModule("blur-pass",{vs:G4,fs:j4});const{vs:t,fs:r,uniforms:n}=this.shaderModuleService.getModule("blur-pass"),{width:i,height:o}=this.rendererService.getViewportSize();return{vs:t,fs:r,uniforms:he(he({},n),{},{u_ViewportSize:[i,o]})}}convertOptionsToUniforms(t){const r={};return $4(t.blurRadius)||(r.u_BlurDir=[t.blurRadius,0]),r}}const Z4=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,q4=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,{isNil:K4}=Ar;class Q4 extends gi{setupShaders(){this.shaderModuleService.registerModule("blur-pass",{vs:q4,fs:Z4});const{vs:t,fs:r,uniforms:n}=this.shaderModuleService.getModule("blur-pass"),{width:i,height:o}=this.rendererService.getViewportSize();return{vs:t,fs:r,uniforms:he(he({},n),{},{u_ViewportSize:[i,o]})}}convertOptionsToUniforms(t){const r={};return K4(t.blurRadius)||(r.u_BlurDir=[0,t.blurRadius]),r}}const J4=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,eN=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class tN extends gi{setupShaders(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:eN,fs:J4});const{vs:t,fs:r,uniforms:n}=this.shaderModuleService.getModule("colorhalftone-pass"),{width:i,height:o}=this.rendererService.getViewportSize();return{vs:t,fs:r,uniforms:he(he({},n),{},{u_ViewportSize:[i,o]})}}}const rN=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,nN=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class iN extends gi{setupShaders(){return this.shaderModuleService.registerModule("copy-pass",{vs:nN,fs:rN}),this.shaderModuleService.getModule("copy-pass")}}const oN=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,aN=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class sN extends gi{setupShaders(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:aN,fs:oN});const{vs:t,fs:r,uniforms:n}=this.shaderModuleService.getModule("hexagonalpixelate-pass"),{width:i,height:o}=this.rendererService.getViewportSize();return{vs:t,fs:r,uniforms:he(he({},n),{},{u_ViewportSize:[i,o]})}}}const uN=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,lN=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class cN extends gi{setupShaders(){this.shaderModuleService.registerModule("ink-pass",{vs:lN,fs:uN});const{vs:t,fs:r,uniforms:n}=this.shaderModuleService.getModule("ink-pass"),{width:i,height:o}=this.rendererService.getViewportSize();return{vs:t,fs:r,uniforms:he(he({},n),{},{u_ViewportSize:[i,o]})}}}const fN=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,hN=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;class dN extends gi{setupShaders(){return this.shaderModuleService.registerModule("noise-pass",{vs:hN,fs:fN}),this.shaderModuleService.getModule("noise-pass")}}const pN=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,_N=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`;class vN extends gi{setupShaders(){return this.shaderModuleService.registerModule("sepia-pass",{vs:pN,fs:_N}),this.shaderModuleService.getModule("sepia-pass")}}const J1=new gP;let mN=0;function gN(){const e=new N4,t=new TP,r=new lP,n=new AP(r),i=new jO,o=new $O,a=new hP,s=new dP,u=new fP,l={id:`${mN++}`,globalConfigService:J1,shaderModuleService:e,debugService:t,cameraService:r,coordinateSystemService:n,fontService:i,iconService:o,markerService:a,popupService:s,controlService:u,customRenderService:{}},f=new OP(l);l.layerService=f;const c=new y4(l);l.sceneService=c;const h=new xP(l);l.interactionService=h;const d=new MP(l);l.pickingService=d;const p={clear:new F4,pixelPicking:new B4,render:new L4,taa:new V4(e)};l.normalPassFactory=m=>p[m];const v={copy:new iN,bloom:new W4,blurH:new Y4,blurV:new Q4,noise:new dN,sepia:new vN,colorHalftone:new tN,hexagonalPixelate:new sN,ink:new cN};return l.postProcessingPass=v,l.postProcessingPassFactory=m=>v[m],l}function Zs(e){const t=he({},e);return t.postProcessor=new w4(t.rendererService),t.multiPassRenderer=new D4(t.postProcessor),t.styleAttributeService=new wP(t.rendererService),t}const pl=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"];let Xr=function(e){return e.IMAGE="image",e.CUSTOMIMAGE="customImage",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb",e.TERRAINRGB="terrainRGB",e.CUSTOMRGB="customRGB",e.CUSTOMARRAYBUFFER="customArrayBuffer",e.CUSTOMTERRAINRGB="customTerrainRGB",e}({});var ey=(e,t,r)=>new Promise((n,i)=>{var o=u=>{try{s(r.next(u))}catch(l){i(l)}},a=u=>{try{s(r.throw(u))}catch(l){i(l)}},s=u=>u.done?n(u.value):Promise.resolve(u.value).then(o,a);s((r=r.apply(e,t)).next())}),EN=(e,t,r,n)=>ey(void 0,null,function*(){return new Promise((i,o)=>{t({x:e.x,y:e.y,z:e.z},(a,s)=>{if(a||s.length===0){o(a);return}s&&Gh([{data:s,bands:[0]}],r,n,(u,l)=>{u?o(u):l&&i(l)})})})}),yN=(e,t)=>ey(void 0,null,function*(){return new Promise((r,n)=>{t({x:e.x,y:e.y,z:e.z},(i,o)=>{if(i||!o){n(i);return}o instanceof ArrayBuffer?f2(o,(a,s)=>{a&&n(a),r(s)}):o instanceof HTMLImageElement?r(o):n(i)})})});function AN(e,t){return Array.isArray(e)?typeof e[0]=="string"?e.map(r=>ma(r,t)):e.map(r=>({url:ma(r.url,t),bands:r.bands||[0]})):ma(e,t)}function TN(e){return typeof e=="string"?[{url:e,bands:[0]}]:typeof e[0]=="string"?e.map(t=>({url:t,bands:[0]})):e}function sm(e,t){e.xhrCancel=()=>{t.map(r=>{r.abort()})}}var SN=Object.defineProperty,xN=Object.defineProperties,RN=Object.getOwnPropertyDescriptors,um=Object.getOwnPropertySymbols,CN=Object.prototype.hasOwnProperty,bN=Object.prototype.propertyIsEnumerable,lm=(e,t,r)=>t in e?SN(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,cm=(e,t)=>{for(var r in t||(t={}))CN.call(t,r)&&lm(e,r,t[r]);if(um)for(var r of um(t))bN.call(t,r)&&lm(e,r,t[r]);return e},fm=(e,t)=>xN(e,RN(t)),ty=(e,t,r)=>new Promise((n,i)=>{var o=u=>{try{s(r.next(u))}catch(l){i(l)}},a=u=>{try{s(r.throw(u))}catch(l){i(l)}},s=u=>u.done?n(u.value):Promise.resolve(u.value).then(o,a);s((r=r.apply(e,t)).next())}),MN=(e,t,r,n,i)=>ty(void 0,null,function*(){const o=TN(t.url);if(o.length>1){const{rasterFiles:a,xhrList:s,errList:u}=yield IN(o,t);if(sm(e,s),u.length>0){r(u,null);return}Gh(a,n,i,r)}else{const a=Ld(t,(s,u)=>{if(s)r(s);else if(u){const l=[{data:u,bands:o[0].bands}];Gh(l,n,i,r)}});sm(e,[a])}});function IN(e,t){return ty(this,null,function*(){const r=[],n=[],i=[];for(let o=0;o<e.length;o++){const a=e[o],s=fm(cm({},t),{url:a.url}),u=a.bands,{err:l,data:f,xhr:c}=yield u2(fm(cm({},s),{type:"arrayBuffer"}));l&&i.push(l),n.push(c),r.push({data:f,bands:u})}return{rasterFiles:r,xhrList:n,errList:i}})}var ON=Object.defineProperty,PN=Object.defineProperties,NN=Object.getOwnPropertyDescriptors,hm=Object.getOwnPropertySymbols,FN=Object.prototype.hasOwnProperty,DN=Object.prototype.propertyIsEnumerable,dm=(e,t,r)=>t in e?ON(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Bl=(e,t)=>{for(var r in t||(t={}))FN.call(t,r)&&dm(e,r,t[r]);if(hm)for(var r of hm(t))DN.call(t,r)&&dm(e,r,t[r]);return e},ry=(e,t)=>PN(e,NN(t)),ny=(e,t,r)=>new Promise((n,i)=>{var o=u=>{try{s(r.next(u))}catch(l){i(l)}},a=u=>{try{s(r.throw(u))}catch(l){i(l)}},s=u=>u.done?n(u.value):Promise.resolve(u.value).then(o,a);s((r=r.apply(e,t)).next())}),BN=(e,t,r,n)=>ny(void 0,null,function*(){const{format:i=iy,operation:o,requestParameters:a={}}=n,s=ry(Bl({},a),{url:AN(e,t)});return new Promise((u,l)=>{MN(r,s,(f,c)=>{f?l(f):c&&u(c)},i,o)})}),pm=(e,t,r,n)=>ny(void 0,null,function*(){let i;const o=Array.isArray(e)?e[0]:e;return n.wmtsOptions?i=((n==null?void 0:n.getURLFromTemplate)||fM)(o,Bl(Bl({},t),n.wmtsOptions)):i=((n==null?void 0:n.getURLFromTemplate)||ma)(o,t),new Promise((a,s)=>{var u;const l=Nh(ry(Bl({},n==null?void 0:n.requestParameters),{url:i,type:((u=n==null?void 0:n.requestParameters)==null?void 0:u.type)||"arrayBuffer"}),(f,c)=>{f?s(f):c&&a(c)},n.transformResponse);r.xhrCancel=()=>l.cancel()})}),iy=()=>({rasterData:new Uint8Array([0]),width:1,height:1}),wN=Object.defineProperty,LN=Object.defineProperties,UN=Object.getOwnPropertyDescriptors,_m=Object.getOwnPropertySymbols,kN=Object.prototype.hasOwnProperty,zN=Object.prototype.propertyIsEnumerable,vm=(e,t,r)=>t in e?wN(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,mm=(e,t)=>{for(var r in t||(t={}))kN.call(t,r)&&vm(e,r,t[r]);if(_m)for(var r of _m(t))zN.call(t,r)&&vm(e,r,t[r]);return e},VN=(e,t)=>LN(e,UN(t)),HN={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0};Xr.ARRAYBUFFER,Xr.RGB;function XN(e){return!!(Array.isArray(e)&&e.length===0||!Array.isArray(e)&&typeof e!="string")}function WN(e,t={}){if(XN(e))throw new Error("tile server url is error");let r=(t==null?void 0:t.dataType)||Xr.IMAGE;r===Xr.RGB&&(r=Xr.ARRAYBUFFER);const n=(o,a)=>{switch(r){case Xr.IMAGE:return pm(e,o,a,t);case Xr.CUSTOMIMAGE:case Xr.CUSTOMTERRAINRGB:return yN(a,t==null?void 0:t.getCustomData);case Xr.ARRAYBUFFER:return BN(e,o,a,t);case Xr.CUSTOMARRAYBUFFER:case Xr.CUSTOMRGB:return EN(a,t==null?void 0:t.getCustomData,(t==null?void 0:t.format)||iy,t==null?void 0:t.operation);default:return pm(e,o,a,t)}},i=VN(mm(mm({},HN),t),{getTileData:n});return{data:e,dataArray:[],tilesetOptions:i,isTile:!0}}var jN=Object.defineProperty,GN=Object.defineProperties,$N=Object.getOwnPropertyDescriptors,Kl=Object.getOwnPropertySymbols,oy=Object.prototype.hasOwnProperty,ay=Object.prototype.propertyIsEnumerable,gm=(e,t,r)=>t in e?jN(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,YN=(e,t)=>{for(var r in t||(t={}))oy.call(t,r)&&gm(e,r,t[r]);if(Kl)for(var r of Kl(t))ay.call(t,r)&&gm(e,r,t[r]);return e},ZN=(e,t)=>GN(e,$N(t)),qN=(e,t)=>{var r={};for(var n in e)oy.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&Kl)for(var n of Kl(e))t.indexOf(n)<0&&ay.call(e,n)&&(r[n]=e[n]);return r};function KN(e,t){const r=t,{extent:n=[121.168,30.2828,121.384,30.4219],coordinates:i,width:o,height:a}=r,s=qN(r,["extent","coordinates","width","height"]);e.length<2&&console.warn("RGB\u89E3\u6790\u9700\u89812\u4E2A\u6CE2\u6BB5\u7684\u6570\u636E");const[u,l]=s.bands||[0,1],f=[e[u],e[l]],c=[];for(let p=0;p<f[0].length;p++)c.push((f[1][p]-f[0][p])/(f[1][p]+f[0][p]));const h=Eu(i,n);return{_id:1,dataArray:[ZN(YN({_id:1,data:c,width:o,height:a},s),{coordinates:h})]}}var QN=Object.defineProperty,JN=Object.defineProperties,eF=Object.getOwnPropertyDescriptors,Ql=Object.getOwnPropertySymbols,sy=Object.prototype.hasOwnProperty,uy=Object.prototype.propertyIsEnumerable,Em=(e,t,r)=>t in e?QN(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,tF=(e,t)=>{for(var r in t||(t={}))sy.call(t,r)&&Em(e,r,t[r]);if(Ql)for(var r of Ql(t))uy.call(t,r)&&Em(e,r,t[r]);return e},rF=(e,t)=>JN(e,eF(t)),nF=(e,t)=>{var r={};for(var n in e)sy.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&Ql)for(var n of Ql(e))t.indexOf(n)<0&&uy.call(e,n)&&(r[n]=e[n]);return r};function iF(e,t){const r=t,{extent:n,coordinates:i,width:o,height:a}=r,s=nF(r,["extent","coordinates","width","height"]);e.length<3&&console.warn("RGB\u89E3\u6790\u9700\u8981\u4E09\u4E2A\u6CE2\u6BB5\u7684\u6570\u636E");const[u,l,f]=s.bands||[0,1,2],c=[e[u],e[l],e[f]],h=[],[d,p]=(s==null?void 0:s.countCut)||[2,98],v=(s==null?void 0:s.RMinMax)||Ea(c[0],d,p),m=(s==null?void 0:s.GMinMax)||Ea(c[1],d,p),y=(s==null?void 0:s.BMinMax)||Ea(c[2],d,p);for(let R=0;R<c[0].length;R++)h.push(Math.max(0,c[0][R]-v[0])),h.push(Math.max(0,c[1][R]-m[0])),h.push(Math.max(0,c[2][R]-y[0]));const A=Eu(i,n);return{_id:1,dataArray:[rF(tF({_id:1,data:h,width:o,height:a,rMinMax:v,gMinMax:m,bMinMax:y},s),{coordinates:A})]}}var oF=Object.defineProperty,aF=Object.defineProperties,sF=Object.getOwnPropertyDescriptors,Jl=Object.getOwnPropertySymbols,ly=Object.prototype.hasOwnProperty,cy=Object.prototype.propertyIsEnumerable,ym=(e,t,r)=>t in e?oF(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,uF=(e,t)=>{for(var r in t||(t={}))ly.call(t,r)&&ym(e,r,t[r]);if(Jl)for(var r of Jl(t))cy.call(t,r)&&ym(e,r,t[r]);return e},lF=(e,t)=>aF(e,sF(t)),cF=(e,t)=>{var r={};for(var n in e)ly.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&Jl)for(var n of Jl(e))t.indexOf(n)<0&&cy.call(e,n)&&(r[n]=e[n]);return r};function fF(e,t){const r=t,{extent:n,coordinates:i,min:o,max:a,width:s,height:u,format:l,operation:f}=r,c=cF(r,["extent","coordinates","min","max","width","height","format","operation"]);let h;if(l===void 0||C1(e))h=Array.from(e);else{const v=Array.isArray(e)?e:[e];h=Yd(v,l,f)}const d=Eu(i,n);return{_id:1,dataArray:[lF(uF({_id:1,data:h,width:s,height:u},c),{min:o,max:a,coordinates:d})]}}var hF=Object.defineProperty,dF=Object.defineProperties,pF=Object.getOwnPropertyDescriptors,Am=Object.getOwnPropertySymbols,_F=Object.prototype.hasOwnProperty,vF=Object.prototype.propertyIsEnumerable,Tm=(e,t,r)=>t in e?hF(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Sm=(e,t)=>{for(var r in t||(t={}))_F.call(t,r)&&Tm(e,r,t[r]);if(Am)for(var r of Am(t))vF.call(t,r)&&Tm(e,r,t[r]);return e},mF=(e,t)=>dF(e,pF(t)),gF=(e,t,r)=>new Promise((n,i)=>{var o=u=>{try{s(r.next(u))}catch(l){i(l)}},a=u=>{try{s(r.throw(u))}catch(l){i(l)}},s=u=>u.done?n(u.value):Promise.resolve(u.value).then(o,a);s((r=r.apply(e,t)).next())}),EF={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},yF=e=>gF(void 0,null,function*(){return new Promise(t=>{const[r,n,i,o]=e.bounds,a={layers:{testTile:{features:[{type:"Feature",properties:{key:e.x+"/"+e.y+"/"+e.z,x:(r+i)/2,y:(n+o)/2},geometry:{type:"LineString",coordinates:[[i,o],[i,n],[r,n],[r,n]]}}]}}};t(a)})});function AF(e,t){const r=i=>yF(i),n=mF(Sm(Sm({},EF),t),{getTileData:r});return{data:e,dataArray:[],tilesetOptions:n,isTile:!0}}var fy={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(Pd,function(){function r(Z,k,$,K,ce,Ne){if(!(ce-K<=$)){var je=K+ce>>1;n(Z,k,je,K,ce,Ne%2),r(Z,k,$,K,je-1,Ne+1),r(Z,k,$,je+1,ce,Ne+1)}}function n(Z,k,$,K,ce,Ne){for(;ce>K;){if(ce-K>600){var je=ce-K+1,Je=$-K+1,ht=Math.log(je),$e=.5*Math.exp(2*ht/3),et=.5*Math.sqrt(ht*$e*(je-$e)/je)*(Je-je/2<0?-1:1),mt=Math.max(K,Math.floor($-Je*$e/je+et)),gt=Math.min(ce,Math.floor($+(je-Je)*$e/je+et));n(Z,k,$,mt,gt,Ne)}var Ot=k[2*$+Ne],Bt=K,Et=ce;for(i(Z,k,K,$),k[2*ce+Ne]>Ot&&i(Z,k,K,ce);Bt<Et;){for(i(Z,k,Bt,Et),Bt++,Et--;k[2*Bt+Ne]<Ot;)Bt++;for(;k[2*Et+Ne]>Ot;)Et--}k[2*K+Ne]===Ot?i(Z,k,K,Et):(Et++,i(Z,k,Et,ce)),Et<=$&&(K=Et+1),$<=Et&&(ce=Et-1)}}function i(Z,k,$,K){o(Z,$,K),o(k,2*$,2*K),o(k,2*$+1,2*K+1)}function o(Z,k,$){var K=Z[k];Z[k]=Z[$],Z[$]=K}function a(Z,k,$,K,ce,Ne,je){for(var Je=[0,Z.length-1,0],ht=[],$e,et;Je.length;){var mt=Je.pop(),gt=Je.pop(),Ot=Je.pop();if(gt-Ot<=je){for(var Bt=Ot;Bt<=gt;Bt++)$e=k[2*Bt],et=k[2*Bt+1],$e>=$&&$e<=ce&&et>=K&&et<=Ne&&ht.push(Z[Bt]);continue}var Et=Math.floor((Ot+gt)/2);$e=k[2*Et],et=k[2*Et+1],$e>=$&&$e<=ce&&et>=K&&et<=Ne&&ht.push(Z[Et]);var Tr=(mt+1)%2;(mt===0?$<=$e:K<=et)&&(Je.push(Ot),Je.push(Et-1),Je.push(Tr)),(mt===0?ce>=$e:Ne>=et)&&(Je.push(Et+1),Je.push(gt),Je.push(Tr))}return ht}function s(Z,k,$,K,ce,Ne){for(var je=[0,Z.length-1,0],Je=[],ht=ce*ce;je.length;){var $e=je.pop(),et=je.pop(),mt=je.pop();if(et-mt<=Ne){for(var gt=mt;gt<=et;gt++)u(k[2*gt],k[2*gt+1],$,K)<=ht&&Je.push(Z[gt]);continue}var Ot=Math.floor((mt+et)/2),Bt=k[2*Ot],Et=k[2*Ot+1];u(Bt,Et,$,K)<=ht&&Je.push(Z[Ot]);var Tr=($e+1)%2;($e===0?$-ce<=Bt:K-ce<=Et)&&(je.push(mt),je.push(Ot-1),je.push(Tr)),($e===0?$+ce>=Bt:K+ce>=Et)&&(je.push(Ot+1),je.push(et),je.push(Tr))}return Je}function u(Z,k,$,K){var ce=Z-$,Ne=k-K;return ce*ce+Ne*Ne}var l=function(Z){return Z[0]},f=function(Z){return Z[1]},c=function(k,$,K,ce,Ne){$===void 0&&($=l),K===void 0&&(K=f),ce===void 0&&(ce=64),Ne===void 0&&(Ne=Float64Array),this.nodeSize=ce,this.points=k;for(var je=k.length<65536?Uint16Array:Uint32Array,Je=this.ids=new je(k.length),ht=this.coords=new Ne(k.length*2),$e=0;$e<k.length;$e++)Je[$e]=$e,ht[2*$e]=$(k[$e]),ht[2*$e+1]=K(k[$e]);r(Je,ht,ce,0,Je.length-1,0)};c.prototype.range=function(k,$,K,ce){return a(this.ids,this.coords,k,$,K,ce,this.nodeSize)},c.prototype.within=function(k,$,K){return s(this.ids,this.coords,k,$,K,this.nodeSize)};var h={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Z){return Z}},d=Math.fround||function(Z){return function(k){return Z[0]=+k,Z[0]}}(new Float32Array(1)),p=function(k){this.options=B(Object.create(h),k),this.trees=new Array(this.options.maxZoom+1)};p.prototype.load=function(k){var $=this.options,K=$.log,ce=$.minZoom,Ne=$.maxZoom,je=$.nodeSize;K&&console.time("total time");var Je="prepare "+k.length+" points";K&&console.time(Je),this.points=k;for(var ht=[],$e=0;$e<k.length;$e++)!k[$e].geometry||ht.push(m(k[$e],$e));this.trees[Ne+1]=new c(ht,q,Ee,je,Float32Array),K&&console.timeEnd(Je);for(var et=Ne;et>=ce;et--){var mt=+Date.now();ht=this._cluster(ht,et),this.trees[et]=new c(ht,q,Ee,je,Float32Array),K&&console.log("z%d: %d clusters in %dms",et,ht.length,+Date.now()-mt)}return K&&console.timeEnd("total time"),this},p.prototype.getClusters=function(k,$){var K=((k[0]+180)%360+360)%360-180,ce=Math.max(-90,Math.min(90,k[1])),Ne=k[2]===180?180:((k[2]+180)%360+360)%360-180,je=Math.max(-90,Math.min(90,k[3]));if(k[2]-k[0]>=360)K=-180,Ne=180;else if(K>Ne){var Je=this.getClusters([K,ce,180,je],$),ht=this.getClusters([-180,ce,Ne,je],$);return Je.concat(ht)}for(var $e=this.trees[this._limitZoom($)],et=$e.range(T(K),R(je),T(Ne),R(ce)),mt=[],gt=0,Ot=et;gt<Ot.length;gt+=1){var Bt=Ot[gt],Et=$e.points[Bt];mt.push(Et.numPoints?y(Et):this.points[Et.index])}return mt},p.prototype.getChildren=function(k){var $=this._getOriginId(k),K=this._getOriginZoom(k),ce="No cluster with the specified id.",Ne=this.trees[K];if(!Ne)throw new Error(ce);var je=Ne.points[$];if(!je)throw new Error(ce);for(var Je=this.options.radius/(this.options.extent*Math.pow(2,K-1)),ht=Ne.within(je.x,je.y,Je),$e=[],et=0,mt=ht;et<mt.length;et+=1){var gt=mt[et],Ot=Ne.points[gt];Ot.parentId===k&&$e.push(Ot.numPoints?y(Ot):this.points[Ot.index])}if($e.length===0)throw new Error(ce);return $e},p.prototype.getLeaves=function(k,$,K){$=$||10,K=K||0;var ce=[];return this._appendLeaves(ce,k,$,K,0),ce},p.prototype.getTile=function(k,$,K){var ce=this.trees[this._limitZoom(k)],Ne=Math.pow(2,k),je=this.options,Je=je.extent,ht=je.radius,$e=ht/Je,et=(K-$e)/Ne,mt=(K+1+$e)/Ne,gt={features:[]};return this._addTileFeatures(ce.range(($-$e)/Ne,et,($+1+$e)/Ne,mt),ce.points,$,K,Ne,gt),$===0&&this._addTileFeatures(ce.range(1-$e/Ne,et,1,mt),ce.points,Ne,K,Ne,gt),$===Ne-1&&this._addTileFeatures(ce.range(0,et,$e/Ne,mt),ce.points,-1,K,Ne,gt),gt.features.length?gt:null},p.prototype.getClusterExpansionZoom=function(k){for(var $=this._getOriginZoom(k)-1;$<=this.options.maxZoom;){var K=this.getChildren(k);if($++,K.length!==1)break;k=K[0].properties.cluster_id}return $},p.prototype._appendLeaves=function(k,$,K,ce,Ne){for(var je=this.getChildren($),Je=0,ht=je;Je<ht.length;Je+=1){var $e=ht[Je],et=$e.properties;if(et&&et.cluster?Ne+et.point_count<=ce?Ne+=et.point_count:Ne=this._appendLeaves(k,et.cluster_id,K,ce,Ne):Ne<ce?Ne++:k.push($e),k.length===K)break}return Ne},p.prototype._addTileFeatures=function(k,$,K,ce,Ne,je){for(var Je=0,ht=k;Je<ht.length;Je+=1){var $e=ht[Je],et=$[$e],mt=et.numPoints,gt=void 0,Ot=void 0,Bt=void 0;if(mt)gt=A(et),Ot=et.x,Bt=et.y;else{var Et=this.points[et.index];gt=Et.properties,Ot=T(Et.geometry.coordinates[0]),Bt=R(Et.geometry.coordinates[1])}var Tr={type:1,geometry:[[Math.round(this.options.extent*(Ot*Ne-K)),Math.round(this.options.extent*(Bt*Ne-ce))]],tags:gt},$t=void 0;mt?$t=et.id:this.options.generateId?$t=et.index:this.points[et.index].id&&($t=this.points[et.index].id),$t!==void 0&&(Tr.id=$t),je.features.push(Tr)}},p.prototype._limitZoom=function(k){return Math.max(this.options.minZoom,Math.min(Math.floor(+k),this.options.maxZoom+1))},p.prototype._cluster=function(k,$){for(var K=[],ce=this.options,Ne=ce.radius,je=ce.extent,Je=ce.reduce,ht=ce.minPoints,$e=Ne/(je*Math.pow(2,$)),et=0;et<k.length;et++){var mt=k[et];if(!(mt.zoom<=$)){mt.zoom=$;for(var gt=this.trees[$+1],Ot=gt.within(mt.x,mt.y,$e),Bt=mt.numPoints||1,Et=Bt,Tr=0,$t=Ot;Tr<$t.length;Tr+=1){var Gr=$t[Tr],le=gt.points[Gr];le.zoom>$&&(Et+=le.numPoints||1)}if(Et>Bt&&Et>=ht){for(var Ve=mt.x*Bt,nt=mt.y*Bt,Te=Je&&Bt>1?this._map(mt,!0):null,Ut=(et<<5)+($+1)+this.points.length,yt=0,Ht=Ot;yt<Ht.length;yt+=1){var bt=Ht[yt],lt=gt.points[bt];if(!(lt.zoom<=$)){lt.zoom=$;var kt=lt.numPoints||1;Ve+=lt.x*kt,nt+=lt.y*kt,lt.parentId=Ut,Je&&(Te||(Te=this._map(mt,!0)),Je(Te,this._map(lt)))}}mt.parentId=Ut,K.push(v(Ve/Et,nt/Et,Ut,Et,Te))}else if(K.push(mt),Et>1)for(var zr=0,fr=Ot;zr<fr.length;zr+=1){var Jt=fr[zr],nn=gt.points[Jt];nn.zoom<=$||(nn.zoom=$,K.push(nn))}}}return K},p.prototype._getOriginId=function(k){return k-this.points.length>>5},p.prototype._getOriginZoom=function(k){return(k-this.points.length)%32},p.prototype._map=function(k,$){if(k.numPoints)return $?B({},k.properties):k.properties;var K=this.points[k.index].properties,ce=this.options.map(K);return $&&ce===K?B({},ce):ce};function v(Z,k,$,K,ce){return{x:d(Z),y:d(k),zoom:1/0,id:$,parentId:-1,numPoints:K,properties:ce}}function m(Z,k){var $=Z.geometry.coordinates,K=$[0],ce=$[1];return{x:d(T(K)),y:d(R(ce)),zoom:1/0,index:k,parentId:-1}}function y(Z){return{type:"Feature",id:Z.id,properties:A(Z),geometry:{type:"Point",coordinates:[b(Z.x),H(Z.y)]}}}function A(Z){var k=Z.numPoints,$=k>=1e4?Math.round(k/1e3)+"k":k>=1e3?Math.round(k/100)/10+"k":k;return B(B({},Z.properties),{cluster:!0,cluster_id:Z.id,point_count:k,point_count_abbreviated:$})}function T(Z){return Z/360+.5}function R(Z){var k=Math.sin(Z*Math.PI/180),$=.5-.25*Math.log((1+k)/(1-k))/Math.PI;return $<0?0:$>1?1:$}function b(Z){return(Z-.5)*360}function H(Z){var k=(180-Z*360)*Math.PI/180;return 360*Math.atan(Math.exp(k))/Math.PI-90}function B(Z,k){for(var $ in k)Z[$]=k[$];return Z}function q(Z){return Z.x}function Ee(Z){return Z.y}return p})})(fy);const TF=fy.exports;var SF=Object.defineProperty,xm=Object.getOwnPropertySymbols,xF=Object.prototype.hasOwnProperty,RF=Object.prototype.propertyIsEnumerable,Rm=(e,t,r)=>t in e?SF(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,hy=(e,t)=>{for(var r in t||(t={}))xF.call(t,r)&&Rm(e,r,t[r]);if(xm)for(var r of xm(t))RF.call(t,r)&&Rm(e,r,t[r]);return e};function dy(e,t){const{radius:r=40,maxZoom:n=18,minZoom:i=0,zoom:o=2}=t;if(e.pointIndex){const u=e.pointIndex.getClusters(e.extent,Math.floor(o));return e.dataArray=CF(u),e}const a=new TF({radius:r,minZoom:i,maxZoom:n}),s={type:"FeatureCollection",features:[]};return s.features=e.dataArray.map(u=>({type:"Feature",geometry:{type:"Point",coordinates:u.coordinates},properties:hy({},u)})),a.load(s.features),a}function CF(e){return e.map((t,r)=>hy({coordinates:t.geometry.coordinates,_id:r+1},t.properties))}function bF(e){if(e.length===0)throw new Error("max requires at least one data point");let t=e[0];for(let r=1;r<e.length;r++)e[r]>t&&(t=e[r]);return t}function MF(e){if(e.length===0)throw new Error("min requires at least one data point");let t=e[0];for(let r=1;r<e.length;r++)e[r]<t&&(t=e[r]);return t}function py(e){if(e.length===0)return 0;let t=e[0],r=0,n;for(let i=1;i<e.length;i++)n=t+e[i]*1,Math.abs(t)>=Math.abs(e[i])?r+=t-n+e[i]:r+=e[i]-n+t,t=n;return t+r*1}function IF(e){if(e.length===0)throw new Error("mean requires at least one data point");return py(e)/e.length}var OF={min:MF,max:bF,mean:IF,sum:py},PF=Object.defineProperty,Cm=Object.getOwnPropertySymbols,NF=Object.prototype.hasOwnProperty,FF=Object.prototype.propertyIsEnumerable,bm=(e,t,r)=>t in e?PF(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Es=(e,t)=>{for(var r in t||(t={}))NF.call(t,r)&&bm(e,r,t[r]);if(Cm)for(var r of Cm(t))FF.call(t,r)&&bm(e,r,t[r]);return e},Mm=(e,t,r)=>new Promise((n,i)=>{var o=u=>{try{s(r.next(u))}catch(l){i(l)}},a=u=>{try{s(r.throw(u))}catch(l){i(l)}},s=u=>u.done?n(u.value):Promise.resolve(u.value).then(o,a);s((r=r.apply(e,t)).next())}),{cloneDeep:DF,isFunction:Im,isString:BF,mergeWith:wF}=Ar;function LF(e,t){if(Array.isArray(t))return t}var UF=class extends vn.exports.EventEmitter{constructor(e,t){super(),this.type="source",this.isTile=!1,this.inited=!1,this.hooks={init:new Jn},this.parser={type:"geojson"},this.transforms=[],this.cluster=!1,this.clusterOptions={enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"},this.invalidExtent=!1,this.dataArrayChanged=!1,this.cfg={autoRender:!0},this.originData=e,this.initCfg(t),this.init().then(()=>{this.inited=!0,this.emit("update",{type:"inited"})})}getSourceCfg(){return this.cfg}getClusters(e){return this.clusterIndex.getClusters(this.caculClusterExtent(2),e)}getClustersLeaves(e){return this.clusterIndex.getLeaves(e,1/0)}getParserType(){return this.parser.type}updateClusterData(e){const{method:t="sum",field:r}=this.clusterOptions;let n=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(e));this.clusterOptions.zoom=e,n.forEach(i=>{i.id||(i.properties.point_count=1)}),(r||Im(t))&&(n=n.map(i=>{const o=i.id;if(o){const s=this.clusterIndex.getLeaves(o,1/0).map(l=>l.properties);let u;if(BF(t)&&r){const l=dM(s,r);u=OF[t](l)}Im(t)&&(u=t(s)),i.properties.stat=u}else i.properties.point_count=1;return i})),this.data=g0("geojson")({type:"FeatureCollection",features:n}),this.executeTrans()}getFeatureById(e){const{type:t="geojson",geometry:r}=this.parser;if(t==="geojson"&&!this.cluster){const n=e<this.originData.features.length?this.originData.features[e]:"null",i=DF(n);if((i==null?void 0:i.properties)&&(this.transforms.length!==0||this.dataArrayChanged)){const o=this.data.dataArray.find(a=>a._id===e);i.properties=o}return i}else return t==="json"&&r?this.data.dataArray.find(n=>n._id===e):e<this.data.dataArray.length?this.data.dataArray[e]:"null"}updateFeaturePropertiesById(e,t){this.data.dataArray=this.data.dataArray.map(r=>r._id===e?Es(Es({},r),t):r),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}getFeatureId(e,t){const r=this.data.dataArray.find(n=>n[e]===t);return r==null?void 0:r._id}setData(e,t){this.originData=e,this.dataArrayChanged=!1,this.initCfg(t),this.init().then(()=>{this.emit("update",{type:"update"})})}reloadAllTile(){var e;(e=this.tileset)==null||e.reloadAll()}reloadTilebyId(e,t,r){var n;(n=this.tileset)==null||n.reloadTileById(e,t,r)}reloadTileByLnglat(e,t,r){var n;(n=this.tileset)==null||n.reloadTileByLnglat(e,t,r)}getTileExtent(e,t){var r;return(r=this.tileset)==null?void 0:r.getTileExtent(e,t)}getTileByZXY(e,t,r){var n;return(n=this.tileset)==null?void 0:n.getTileByZXY(e,t,r)}reloadTileByExtent(e,t){var r;(r=this.tileset)==null||r.reloadTileByExtent(e,t)}destroy(){var e;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(e=this.tileset)==null||e.destroy()}processData(){return Mm(this,null,function*(){return new Promise((e,t)=>{try{this.excuteParser(),this.initCluster(),this.executeTrans(),e({})}catch(r){t(r)}})})}initCfg(e){this.cfg=wF(this.cfg,e,LF);const t=this.cfg;t&&(t.parser&&(this.parser=t.parser),t.transforms&&(this.transforms=t.transforms),this.cluster=t.cluster||!1,t.clusterOptions&&(this.cluster=!0,this.clusterOptions=Es(Es({},this.clusterOptions),t.clusterOptions)))}init(){return Mm(this,null,function*(){this.inited=!1,yield this.processData(),this.inited=!0})}excuteParser(){const e=this.parser,t=e.type||"geojson",r=g0(t);this.data=r(this.originData,e),this.tileset=this.initTileset(),!e.cancelExtent&&(this.extent=Ib(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}setCenter(e){this.center=[(e[0]+e[2])/2,(e[1]+e[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}initTileset(){const{tilesetOptions:e}=this.data;return e?(this.isTile=!0,this.tileset?(this.tileset.updateOptions(e),this.tileset):new cM(Es({},e))):void 0}executeTrans(){this.transforms.forEach(t=>{const{type:r}=t,n=jx(r)(this.data,t);Object.assign(this.data,n)})}initCluster(){if(!this.cluster)return;const e=this.clusterOptions||{};this.clusterIndex=dy(this.data,e)}caculClusterExtent(e){let t=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(t=Wd(Gl(this.extent),e)),t[0].concat(t[1])}};function kF(e,t){const{callback:r}=t;return r&&(e.dataArray=e.dataArray.filter(r)),e}var op=6378e3;function zF(e,t){const r=e.dataArray,{size:n=10}=t,i=n/(2*Math.PI*op)*(256<<20)/2,{gridHash:o,gridOffset:a}=VF(r,n),s=jF(o,a,t);return{yOffset:i,xOffset:i,radius:i,type:"grid",dataArray:s}}function VF(e,t){let r=1/0,n=-1/0,i;for(const u of e)i=u.coordinates[1],Number.isFinite(i)&&(r=i<r?i:r,n=i>n?i:n);const o=(r+n)/2,a=HF(t,o);if(a.xOffset<=0||a.yOffset<=0)return{gridHash:{},gridOffset:a};const s={};for(const u of e){const l=u.coordinates[1],f=u.coordinates[0];if(Number.isFinite(l)&&Number.isFinite(f)){const c=Math.floor((l+90)/a.yOffset),h=Math.floor((f+180)/a.xOffset),d=`${c}-${h}`;s[d]=s[d]||{count:0,points:[]},s[d].count+=1,s[d].points.push(u)}}return{gridHash:s,gridOffset:a}}function HF(e,t){const r=XF(e),n=WF(t,e);return{yOffset:r,xOffset:n}}function XF(e){return e/op*(180/Math.PI)}function WF(e,t){return t/op*(180/Math.PI)/Math.cos(e*Math.PI/180)}function jF(e,t,r){return Object.keys(e).reduce((n,i,o)=>{const a=i.split("-"),s=parseInt(a[0],10),u=parseInt(a[1],10),l={};if(r.field&&r.method){const f=y1(e[i].points,r.field);l[r.method]=E1[r.method](f)}return Object.assign(l,{_id:o,coordinates:fn([-180+t.xOffset*(u+.5),-90+t.yOffset*(s+.5)]),rawData:e[i].points,count:e[i].count}),n.push(l),n},[])}var ca=Math.PI/3,GF=[0,ca,2*ca,3*ca,4*ca,5*ca];function $F(e){return e[0]}function YF(e){return e[1]}function ZF(){var e=0,t=0,r=1,n=1,i=$F,o=YF,a,s,u;function l(c){var h={},d=[],p,v=c.length;for(p=0;p<v;++p)if(!(isNaN(y=+i.call(null,m=c[p],p,c))||isNaN(A=+o.call(null,m,p,c)))){var m,y,A,T=Math.round(A=A/u),R=Math.round(y=y/s-(T&1)/2),b=A-T;if(Math.abs(b)*3>1){var H=y-R,B=R+(y<R?-1:1)/2,q=T+(A<T?-1:1),Ee=y-B,Z=A-q;H*H+b*b>Ee*Ee+Z*Z&&(R=B+(T&1?1:-1)/2,T=q)}var k=R+"-"+T,$=h[k];$?$.push(m):(d.push($=h[k]=[m]),$.x=(R+(T&1)/2)*s,$.y=T*u)}return d}function f(c){var h=0,d=0;return GF.map(function(p){var v=Math.sin(p)*c,m=-Math.cos(p)*c,y=v-h,A=m-d;return h=v,d=m,[y,A]})}return l.hexagon=function(c){return"m"+f(c==null?a:+c).join("l")+"z"},l.centers=function(){for(var c=[],h=Math.round(t/u),d=Math.round(e/s),p=h*u;p<n+a;p+=u,++h)for(var v=d*s+(h&1)*s/2;v<r+s/2;v+=s)c.push([v,p]);return c},l.mesh=function(){var c=f(a).slice(0,4).join("l");return l.centers().map(function(h){return"M"+h+"m"+c}).join("")},l.x=function(c){return arguments.length?(i=c,l):i},l.y=function(c){return arguments.length?(o=c,l):o},l.radius=function(c){return arguments.length?(a=+c,s=a*2*Math.sin(ca),u=a*1.5,l):a},l.size=function(c){return arguments.length?(e=t=0,r=+c[0],n=+c[1],l):[r-e,n-t]},l.extent=function(c){return arguments.length?(e=+c[0][0],t=+c[0][1],r=+c[1][0],n=+c[1][1],l):[[e,t],[r,n]]},l.radius(1)}var qF=Object.defineProperty,KF=Object.defineProperties,QF=Object.getOwnPropertyDescriptors,Om=Object.getOwnPropertySymbols,JF=Object.prototype.hasOwnProperty,eD=Object.prototype.propertyIsEnumerable,Pm=(e,t,r)=>t in e?qF(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,tD=(e,t)=>{for(var r in t||(t={}))JF.call(t,r)&&Pm(e,r,t[r]);if(Om)for(var r of Om(t))eD.call(t,r)&&Pm(e,r,t[r]);return e},rD=(e,t)=>KF(e,QF(t)),nD=6378e3;function iD(e,t){const r=e.dataArray,{size:n=10,method:i="sum"}=t,o=n/(2*Math.PI*nD)*(256<<20)/2,a=r.map(f=>{const[c,h]=fn(f.coordinates);return rD(tD({},f),{coordinates:[c,h]})});return{dataArray:ZF().radius(o).x(f=>f.coordinates[0]).y(f=>f.coordinates[1])(a).map((f,c)=>{if(t.field&&i){const h=y1(f,t.field);f[i]=E1[i](h)}return{[t.method]:f[i],count:f.length,rawData:f,coordinates:[f.x,f.y],_id:c}}),radius:o,xOffset:o,yOffset:o,type:"hexagon"}}var oD=Object.defineProperty,Nm=Object.getOwnPropertySymbols,aD=Object.prototype.hasOwnProperty,sD=Object.prototype.propertyIsEnumerable,Fm=(e,t,r)=>t in e?oD(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Dm=(e,t)=>{for(var r in t||(t={}))aD.call(t,r)&&Fm(e,r,t[r]);if(Nm)for(var r of Nm(t))sD.call(t,r)&&Fm(e,r,t[r]);return e};function uD(e,t){const{sourceField:r,targetField:n,data:i}=t,o={};return i.forEach(a=>{o[a[r]]=a}),e.dataArray=e.dataArray.map(a=>{const s=a[n];return Dm(Dm({},a),o[s])}),e}function lD(e,t){const{callback:r}=t;return r&&(e.dataArray=e.dataArray.map(r)),e}xn("rasterTile",WN);xn("mvt",fO);xn("geojsonvt",rI);xn("testTile",AF);xn("geojson",IM);xn("jsonTile",vI);xn("image",P1);xn("csv",EM);xn("json",b1);xn("raster",RO);xn("rasterRgb",fF);xn("rgb",iF);xn("ndi",KN);Ua("cluster",dy);Ua("filter",kF);Ua("join",uD);Ua("map",lD);Ua("grid",zF);Ua("hexagon",iD);var cD=UF;window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(e){try{let l=function(){s||(s=!0,o())},f=function(){try{a.documentElement.doScroll("left")}catch(c){return void setTimeout(f,50)}l()};var r=(r=document.getElementsByTagName("script"))[r.length-1],t=r.getAttribute("data-injectcss"),r=r.getAttribute("data-disable-injectsvg");if(!r){var n,i,o,a,s,u=function(c,h){h.parentNode.insertBefore(c,h)};if(t&&!e.__iconfont__svg__cssinject__){e.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(c){console&&console.log(c)}}n=function(){var c,h=document.createElement("div");h.innerHTML=e._iconfont_svg_string_3580659,(h=h.getElementsByTagName("svg")[0])&&(h.setAttribute("aria-hidden","true"),h.style.position="absolute",h.style.width=0,h.style.height=0,h.style.overflow="hidden",h=h,(c=document.body).firstChild?u(h,c.firstChild):c.appendChild(h))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(n,0):(i=function(){document.removeEventListener("DOMContentLoaded",i,!1),n()},document.addEventListener("DOMContentLoaded",i,!1)):document.attachEvent&&(o=n,a=e.document,s=!1,f(),a.onreadystatechange=function(){a.readyState=="complete"&&(a.onreadystatechange=null,l())})}}catch(l){}}(window);class su extends jd{constructor(t){super(),E(this,"controlOption",void 0),E(this,"container",void 0),E(this,"isShow",void 0),E(this,"sceneContainer",void 0),E(this,"scene",void 0),E(this,"mapsService",void 0),E(this,"renderService",void 0),E(this,"layerService",void 0),E(this,"controlService",void 0),E(this,"configService",void 0),su.controlCount++,this.controlOption=he(he({},this.getDefault(t)),t||{})}getOptions(){return this.controlOption}setOptions(t){const r=this.getDefault(t);Object.entries(t).forEach(([n,i])=>{i===void 0&&(t[n]=r[n])}),"position"in t&&this.setPosition(t.position),"className"in t&&this.setClassName(t.className),"style"in t&&this.setStyle(t.style),this.controlOption=he(he({},this.controlOption),t)}addTo(t){this.mapsService=t.mapService,this.renderService=t.rendererService,this.layerService=t.layerService,this.controlService=t.controlService,this.configService=t.globalConfigService,this.scene=t.sceneService,this.sceneContainer=t,this.isShow=!0,this.container=this.onAdd(),js(this.container,"l7-control");const{className:r,style:n}=this.controlOption;return r&&this.setClassName(r),n&&this.setStyle(n),this.insertContainer(),this.emit("add",this),this}remove(){if(!this.mapsService)return this;jl(this.container),this.onRemove(),this.emit("remove",this)}onAdd(){return pn("div")}onRemove(){}show(){const t=this.container;Bh(t,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}hide(){const t=this.container;js(t,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}getDefault(t){return{position:Yl.TOPRIGHT,name:`${su.controlCount}`}}getContainer(){return this.container}getIsShow(){return this.isShow}_refocusOnMap(t){if(this.mapsService&&t&&t.screenX>0&&t.screenY>0){const r=this.mapsService.getContainer();r!==null&&r.focus()}}setPosition(t=Yl.TOPLEFT){const r=this.controlService;return r&&r.removeControl(this),this.controlOption.position=t,r&&r.addControl(this,this.sceneContainer),this}setClassName(t){const r=this.container,{className:n}=this.controlOption;n&&Bh(r,n),t&&js(r,t)}setStyle(t){const r=this.container;t?r.setAttribute("style",t):r.removeAttribute("style")}insertContainer(){const t=this.controlOption.position,r=this.container;if(t instanceof Element)t.appendChild(r);else{const n=this.controlService.controlCorners[t];["bottomleft","bottomright","righttop","rightbottom"].includes(t)?n.insertBefore(r,n.firstChild):n.appendChild(r)}}checkUpdateOption(t,r){return r.some(n=>n in t)}}E(su,"controlCount",0);class ec extends vn.exports.EventEmitter{get buttonRect(){return this.button.getBoundingClientRect()}constructor(t,r){super(),E(this,"popperDOM",void 0),E(this,"contentDOM",void 0),E(this,"button",void 0),E(this,"option",void 0),E(this,"isShow",!1),E(this,"content",void 0),E(this,"timeout",null),E(this,"show",()=>this.isShow||!this.contentDOM.innerHTML?this:(this.resetPopperPosition(),Bh(this.popperDOM,"l7-popper-hide"),this.isShow=!0,this.option.unique&&ec.conflictPopperList.forEach(n=>{n!==this&&n.isShow&&n.hide()}),this.emit("show"),window.addEventListener("pointerdown",this.onPopperUnClick),this)),E(this,"hide",()=>this.isShow?(js(this.popperDOM,"l7-popper-hide"),this.isShow=!1,this.emit("hide"),window.removeEventListener("pointerdown",this.onPopperUnClick),this):this),E(this,"setHideTimeout",()=>{this.timeout||(this.timeout=window.setTimeout(()=>{!this.isShow||(this.hide(),this.timeout=null)},300))}),E(this,"clearHideTimeout",()=>{this.timeout&&(window.clearTimeout(this.timeout),this.timeout=null)}),E(this,"onBtnClick",()=>{this.isShow?this.hide():this.show()}),E(this,"onPopperUnClick",n=>{Cb(n.target,[".l7-button-control",".l7-popper-content"])||this.hide()}),E(this,"onBtnMouseLeave",()=>{this.setHideTimeout()}),E(this,"onBtnMouseMove",()=>{this.clearHideTimeout(),!this.isShow&&this.show()}),this.button=t,this.option=r,this.init(),r.unique&&ec.conflictPopperList.push(this)}getPopperDOM(){return this.popperDOM}getIsShow(){return this.isShow}getContent(){return this.content}setContent(t){typeof t=="string"?this.contentDOM.innerHTML=t:t instanceof HTMLElement&&(p1(this.contentDOM),this.contentDOM.appendChild(t)),this.content=t}init(){const{trigger:t}=this.option;this.popperDOM=this.createPopper(),t==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}destroy(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),jl(this.popperDOM)}resetPopperPosition(){const t={},{container:r,offset:n=[0,0],placement:i}=this.option,[o,a]=n,s=this.button.getBoundingClientRect(),u=r.getBoundingClientRect(),{left:l,right:f,top:c,bottom:h}=xb(s,u);let d=!1,p=!1;/^(left|right)/.test(i)?(i.includes("left")?t.right=`${s.width+f}px`:i.includes("right")&&(t.left=`${s.width+l}px`),i.includes("start")?t.top=`${c}px`:i.includes("end")?t.bottom=`${h}px`:(t.top=`${c+s.height/2}px`,p=!0,t.transform=`translate(${o}px, calc(${a}px - 50%))`)):/^(top|bottom)/.test(i)&&(i.includes("top")?t.bottom=`${s.height+h}px`:i.includes("bottom")&&(t.top=`${s.height+c}px`),i.includes("start")?t.left=`${l}px`:i.includes("end")?t.right=`${f}px`:(t.left=`${l+s.width/2}px`,d=!0,t.transform=`translate(calc(${o}px - 50%), ${a}px)`)),t.transform=`translate(calc(${o}px - ${d?"50%":"0%"}), calc(${a}px - ${p?"50%":"0%"})`;const v=i.split("-");v.length&&js(this.popperDOM,v.map(m=>`l7-popper-${m}`).join(" ")),Tb(this.popperDOM,Sb(t))}createPopper(){const{container:t,className:r="",content:n}=this.option,i=pn("div",`l7-popper l7-popper-hide ${r}`),o=pn("div","l7-popper-content"),a=pn("div","l7-popper-arrow");return i.appendChild(o),i.appendChild(a),t.appendChild(i),this.popperDOM=i,this.contentDOM=o,n&&this.setContent(n),i}}E(ec,"conflictPopperList",[]);const Bm=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],mi=(()=>{if(typeof document>"u")return!1;const e=Bm[0],t={};for(const r of Bm)if((r==null?void 0:r[1])in document){for(const[i,o]of r.entries())t[e[i]]=o;return t}return!1})(),wm={change:mi.fullscreenchange,error:mi.fullscreenerror};let Pn={request(e=document.documentElement,t){return new Promise((r,n)=>{const i=()=>{Pn.off("change",i),r()};Pn.on("change",i);const o=e[mi.requestFullscreen](t);o instanceof Promise&&o.then(i).catch(n)})},exit(){return new Promise((e,t)=>{if(!Pn.isFullscreen){e();return}const r=()=>{Pn.off("change",r),e()};Pn.on("change",r);const n=document[mi.exitFullscreen]();n instanceof Promise&&n.then(r).catch(t)})},toggle(e,t){return Pn.isFullscreen?Pn.exit():Pn.request(e,t)},onchange(e){Pn.on("change",e)},onerror(e){Pn.on("error",e)},on(e,t){const r=wm[e];r&&document.addEventListener(r,t,!1)},off(e,t){const r=wm[e];r&&document.removeEventListener(r,t,!1)},raw:mi};Object.defineProperties(Pn,{isFullscreen:{get:()=>Boolean(document[mi.fullscreenElement])},element:{enumerable:!0,get:()=>{var e;return(e=document[mi.fullscreenElement])!==null&&e!==void 0?e:void 0}},isEnabled:{enumerable:!0,get:()=>Boolean(document[mi.fullscreenEnabled])}});mi||(Pn={isEnabled:!1});class fD extends su{getDefault(){return{position:Yl.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}onAdd(){const t=pn("div","l7-control-logo");return this.setLogoContent(t),t}onRemove(){return null}setOptions(t){super.setOptions(t),this.checkUpdateOption(t,["img","href"])&&(p1(this.container),this.setLogoContent(this.container))}setLogoContent(t){const{href:r,img:n}=this.controlOption,i=pn("img");if(i.setAttribute("src",n),i.setAttribute("aria-label","AntV logo"),Rb(i),r){const o=pn("a","l7-control-logo-link");o.target="_blank",o.href=r,o.rel="noopener nofollow",o.setAttribute("rel","noopener nofollow"),o.appendChild(i),t.appendChild(o)}else t.appendChild(i)}}const{cloneDeep:hD}=Ar;class dD{constructor(){E(this,"mapService",void 0),E(this,"fontService",void 0)}apply(t,{styleAttributeService:r,mapService:n,fontService:i}){var o=this;this.mapService=n,this.fontService=i,t.hooks.init.tapPromise("DataMappingPlugin",pe(function*(){t.log(Br.MappingStart,jr.INIT),o.generateMaping(t,{styleAttributeService:r}),t.log(Br.MappingEnd,jr.INIT)})),t.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var a=pe(function*(s){if(!s)return s;t.dataState.dataMappingNeedUpdate=!1,t.log(Br.MappingStart,jr.UPDATE);const u=o.generateMaping(t,{styleAttributeService:r});return t.log(Br.MappingEnd,jr.UPDATE),u});return function(s){return a.apply(this,arguments)}}()),t.hooks.beforeRender.tap("DataMappingPlugin",()=>{const a=t.getSource();if(t.layerModelNeedUpdate||!a||!a.inited)return;const s=r.getLayerStyleAttributes()||[],u=r.getLayerStyleAttribute("filter"),{dataArray:l}=a.data;if(Array.isArray(l)&&l.length===0)return;const f=s.filter(h=>h.needRemapping);let c=l;if(u!=null&&u.needRemapping&&u!==null&&u!==void 0&&u.scale&&(c=l.filter(h=>this.applyAttributeMapping(u,h)[0])),f.length){const h=this.mapping(t,f,c,t.getEncodedData());t.setEncodedData(h)}})}generateMaping(t,{styleAttributeService:r}){const n=r.getLayerStyleAttributes()||[],i=r.getLayerStyleAttribute("filter"),{dataArray:o}=t.getSource().data;let a=o;i!=null&&i.scale&&(a=o.filter(u=>this.applyAttributeMapping(i,u)[0])),a=t.processData(a);const s=this.mapping(t,n,a,void 0);return t.setEncodedData(s),t.emit("dataUpdate",null),!0}mapping(t,r,n,i){const o=r.filter(s=>s.scale!==void 0).filter(s=>s.name!=="filter"),a=n.map((s,u)=>{const l=i?i[u]:{},f=he({id:s._id,coordinates:s.coordinates},l);return o.forEach(c=>{let h=this.applyAttributeMapping(c,s);(c.name==="color"||c.name==="stroke")&&(h=h.map(d=>Zt(d))),f[c.name]=Array.isArray(h)&&h.length===1?h[0]:h,c.name==="shape"&&(f.shape=this.fontService.getIconFontKey(f[c.name]))}),f});return r.forEach(s=>{s.needRemapping=!1}),this.adjustData2Amap2Coordinates(a,t),this.adjustData2SimpleCoordinates(a),a}adjustData2Amap2Coordinates(t,r){if(t.length>0&&this.mapService.version==="GAODE2.x"){const n=r.coordCenter||r.getSource().center;t.filter(i=>!i.originCoordinates).map(i=>{i.version="GAODE2.x",i.originCoordinates=hD(i.coordinates),i.coordinates=this.mapService.coordToAMap2RelativeCoordinates(i.coordinates,n)})}}adjustData2SimpleCoordinates(t){t.length>0&&this.mapService.version==="SIMPLE"&&t.map(r=>{r.simpleCoordinate||(r.coordinates=this.unProjectCoordinates(r.coordinates),r.simpleCoordinate=!0)})}unProjectCoordinates(t){if(typeof t[0]=="number")return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){const r=[];return t.map(n=>{const i=[];n.map(o=>{i.push(this.mapService.simpleMapCoord.unproject(o))}),r.push(i)}),r}else{const r=[];return t.map(n=>{r.push(this.mapService.simpleMapCoord.unproject(n))}),r}}applyAttributeMapping(t,r){var n;if(!t.scale)return[];const i=(t==null||(n=t.scale)===null||n===void 0?void 0:n.scalers)||[],o=[];return i.forEach(({field:s})=>{var u;(r.hasOwnProperty(s)||((u=t.scale)===null||u===void 0?void 0:u.type)==="variable")&&o.push(r[s])}),t.mapping?t.mapping(o):[]}getArrowPoints(t,r){const n=[r[0]-t[0],r[1]-t[1]],i=Fb(n);return[t[0]+i[0]*1e-4,t[1]+i[1]*1e-4]}}class pD{constructor(){E(this,"mapService",void 0)}apply(t){var r=this;this.mapService=t.getContainer().mapService,t.hooks.init.tapPromise("DataSourcePlugin",pe(function*(){t.log(Br.SourceInitStart,jr.INIT);let n=t.getSource();if(!n){const{data:i,options:o}=t.sourceOption||t.defaultSourceConfig;n=new cD(i,o),t.setSource(n)}n.inited?(r.updateClusterData(t),t.log(Br.SourceInitEnd,jr.INIT)):yield new Promise(i=>{n.on("update",o=>{o.type==="inited"&&(r.updateClusterData(t),t.log(Br.SourceInitEnd,jr.INIT)),i(null)})})})),t.hooks.beforeRenderData.tapPromise("DataSourcePlugin",pe(function*(){const n=r.updateClusterData(t),i=t.dataState.dataSourceNeedUpdate;return t.dataState.dataSourceNeedUpdate=!1,n||i}))}updateClusterData(t){if(t.isTileLayer||t.tileLayer||!t.getSource())return!1;const r=t.getSource(),n=r.cluster,{zoom:i=0}=r.clusterOptions,o=this.mapService.getZoom()-1,a=t.dataState.dataSourceNeedUpdate;return n&&a&&r.updateClusterData(Math.floor(o)),n&&Math.abs(t.clusterZoom-o)>=1?(i!==Math.floor(o)&&r.updateClusterData(Math.floor(o)),t.clusterZoom=o,!0):!1}}function ap(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function _y(e){return e.length===1&&(e=_D(e)),{left:function(t,r,n,i){for(n==null&&(n=0),i==null&&(i=t.length);n<i;){var o=n+i>>>1;e(t[o],r)<0?n=o+1:i=o}return n},right:function(t,r,n,i){for(n==null&&(n=0),i==null&&(i=t.length);n<i;){var o=n+i>>>1;e(t[o],r)>0?i=o:n=o+1}return n}}}function _D(e){return function(t,r){return ap(e(t),r)}}var vD=_y(ap),Nc=vD.right;function mD(e){return e===null?NaN:+e}function Lm(e,t){var r=e.length,n=-1,i,o,a;if(t==null){for(;++n<r;)if((i=e[n])!=null&&i>=i)for(o=a=i;++n<r;)(i=e[n])!=null&&(o>i&&(o=i),a<i&&(a=i))}else for(;++n<r;)if((i=t(e[n],n,e))!=null&&i>=i)for(o=a=i;++n<r;)(i=t(e[n],n,e))!=null&&(o>i&&(o=i),a<i&&(a=i));return[o,a]}var sd=Math.sqrt(50),ud=Math.sqrt(10),ld=Math.sqrt(2);function vy(e,t,r){var n,i=-1,o,a,s;if(t=+t,e=+e,r=+r,e===t&&r>0)return[e];if((n=t<e)&&(o=e,e=t,t=o),(s=wl(e,t,r))===0||!isFinite(s))return[];if(s>0)for(e=Math.ceil(e/s),t=Math.floor(t/s),a=new Array(o=Math.ceil(t-e+1));++i<o;)a[i]=(e+i)*s;else for(e=Math.floor(e*s),t=Math.ceil(t*s),a=new Array(o=Math.ceil(e-t+1));++i<o;)a[i]=(e-i)/s;return n&&a.reverse(),a}function wl(e,t,r){var n=(t-e)/Math.max(0,r),i=Math.floor(Math.log(n)/Math.LN10),o=n/Math.pow(10,i);return i>=0?(o>=sd?10:o>=ud?5:o>=ld?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=sd?10:o>=ud?5:o>=ld?2:1)}function cd(e,t,r){var n=Math.abs(t-e)/Math.max(0,r),i=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),o=n/i;return o>=sd?i*=10:o>=ud?i*=5:o>=ld&&(i*=2),t<e?-i:i}function gD(e,t,r){if(r==null&&(r=mD),!!(n=e.length)){if((t=+t)<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,i=(n-1)*t,o=Math.floor(i),a=+r(e[o],o,e),s=+r(e[o+1],o+1,e);return a+(s-a)*(i-o)}}function ED(e,t,r,n,i){var o=e*e,a=o*e;return((1-3*e+3*o-a)*t+(4-6*o+3*a)*r+(1+3*e+3*o-3*a)*n+a*i)/6}function yD(e){var t=e.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,t-1):Math.floor(r*t),i=e[n],o=e[n+1],a=n>0?e[n-1]:2*i-o,s=n<t-1?e[n+2]:2*o-i;return ED((r-n/t)*t,a,i,o,s)}}function sp(e){return function(){return e}}function AD(e,t){return function(r){return e+r*t}}function TD(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function SD(e){return(e=+e)==1?gy:function(t,r){return r-t?TD(t,r,e):sp(isNaN(t)?r:t)}}function gy(e,t){var r=t-e;return r?AD(e,r):sp(isNaN(e)?t:e)}const Um=function e(t){var r=SD(t);function n(i,o){var a=r((i=Wl(i)).r,(o=Wl(o)).r),s=r(i.g,o.g),u=r(i.b,o.b),l=gy(i.opacity,o.opacity);return function(f){return i.r=a(f),i.g=s(f),i.b=u(f),i.opacity=l(f),i+""}}return n.gamma=e,n}(1);function xD(e){return function(t){var r=t.length,n=new Array(r),i=new Array(r),o=new Array(r),a,s;for(a=0;a<r;++a)s=Wl(t[a]),n[a]=s.r||0,i[a]=s.g||0,o[a]=s.b||0;return n=e(n),i=e(i),o=e(o),s.opacity=1,function(u){return s.r=n(u),s.g=i(u),s.b=o(u),s+""}}}var RD=xD(yD);function CD(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),i;return function(o){for(i=0;i<r;++i)n[i]=e[i]*(1-o)+t[i]*o;return n}}function bD(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function MD(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,i=new Array(n),o=new Array(r),a;for(a=0;a<n;++a)i[a]=up(e[a],t[a]);for(;a<r;++a)o[a]=t[a];return function(s){for(a=0;a<n;++a)o[a]=i[a](s);return o}}function ID(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function tc(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function OD(e,t){var r={},n={},i;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(i in t)i in e?r[i]=up(e[i],t[i]):n[i]=t[i];return function(o){for(i in r)n[i]=r[i](o);return n}}var fd=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,fh=new RegExp(fd.source,"g");function PD(e){return function(){return e}}function ND(e){return function(t){return e(t)+""}}function FD(e,t){var r=fd.lastIndex=fh.lastIndex=0,n,i,o,a=-1,s=[],u=[];for(e=e+"",t=t+"";(n=fd.exec(e))&&(i=fh.exec(t));)(o=i.index)>r&&(o=t.slice(r,o),s[a]?s[a]+=o:s[++a]=o),(n=n[0])===(i=i[0])?s[a]?s[a]+=i:s[++a]=i:(s[++a]=null,u.push({i:a,x:tc(n,i)})),r=fh.lastIndex;return r<t.length&&(o=t.slice(r),s[a]?s[a]+=o:s[++a]=o),s.length<2?u[0]?ND(u[0].x):PD(t):(t=u.length,function(l){for(var f=0,c;f<t;++f)s[(c=u[f]).i]=c.x(l);return s.join("")})}function up(e,t){var r=typeof t,n;return t==null||r==="boolean"?sp(t):(r==="number"?tc:r==="string"?(n=xa(t))?(t=n,Um):FD:t instanceof xa?Um:t instanceof Date?ID:bD(t)?CD:Array.isArray(t)?MD:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?OD:tc)(e,t)}function DD(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function ji(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Ey(e,t){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(t).domain(e);break}return this}var On="$";function rc(){}rc.prototype=nc.prototype={constructor:rc,has:function(e){return On+e in this},get:function(e){return this[On+e]},set:function(e,t){return this[On+e]=t,this},remove:function(e){var t=On+e;return t in this&&delete this[t]},clear:function(){for(var e in this)e[0]===On&&delete this[e]},keys:function(){var e=[];for(var t in this)t[0]===On&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)t[0]===On&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)t[0]===On&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)t[0]===On&&++e;return e},empty:function(){for(var e in this)if(e[0]===On)return!1;return!0},each:function(e){for(var t in this)t[0]===On&&e(this[t],t.slice(1),this)}};function nc(e,t){var r=new rc;if(e instanceof rc)e.each(function(s,u){r.set(u,s)});else if(Array.isArray(e)){var n=-1,i=e.length,o;if(t==null)for(;++n<i;)r.set(n,e[n]);else for(;++n<i;)r.set(t(o=e[n],n,e),o)}else if(e)for(var a in e)r.set(a,e[a]);return r}function km(){}var co=nc.prototype;km.prototype={constructor:km,has:co.has,add:function(e){return e+="",this[On+e]=e,this},remove:co.remove,clear:co.clear,values:co.keys,size:co.size,empty:co.empty,each:co.each};var yy=Array.prototype,Ay=yy.map,go=yy.slice,zm={name:"implicit"};function ic(){var e=nc(),t=[],r=[],n=zm;function i(o){var a=o+"",s=e.get(a);if(!s){if(n!==zm)return n;e.set(a,s=t.push(o))}return r[(s-1)%r.length]}return i.domain=function(o){if(!arguments.length)return t.slice();t=[],e=nc();for(var a=-1,s=o.length,u,l;++a<s;)e.has(l=(u=o[a])+"")||e.set(l,t.push(u));return i},i.range=function(o){return arguments.length?(r=go.call(o),i):r.slice()},i.unknown=function(o){return arguments.length?(n=o,i):n},i.copy=function(){return ic(t,r).unknown(n)},ji.apply(i,arguments),i}function BD(e){return function(){return e}}function wD(e){return+e}var Vm=[0,1];function Zr(e){return e}function hd(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:BD(isNaN(t)?NaN:.5)}function Hm(e){var t=e[0],r=e[e.length-1],n;return t>r&&(n=t,t=r,r=n),function(i){return Math.max(t,Math.min(r,i))}}function LD(e,t,r){var n=e[0],i=e[1],o=t[0],a=t[1];return i<n?(n=hd(i,n),o=r(a,o)):(n=hd(n,i),o=r(o,a)),function(s){return o(n(s))}}function UD(e,t,r){var n=Math.min(e.length,t.length)-1,i=new Array(n),o=new Array(n),a=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<n;)i[a]=hd(e[a],e[a+1]),o[a]=r(t[a],t[a+1]);return function(s){var u=Nc(e,s,1,n)-1;return o[u](i[u](s))}}function Fc(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function lp(){var e=Vm,t=Vm,r=up,n,i,o,a=Zr,s,u,l;function f(){return s=Math.min(e.length,t.length)>2?UD:LD,u=l=null,c}function c(h){return isNaN(h=+h)?o:(u||(u=s(e.map(n),t,r)))(n(a(h)))}return c.invert=function(h){return a(i((l||(l=s(t,e.map(n),tc)))(h)))},c.domain=function(h){return arguments.length?(e=Ay.call(h,wD),a===Zr||(a=Hm(e)),f()):e.slice()},c.range=function(h){return arguments.length?(t=go.call(h),f()):t.slice()},c.rangeRound=function(h){return t=go.call(h),r=DD,f()},c.clamp=function(h){return arguments.length?(a=h?Hm(e):Zr,c):a!==Zr},c.interpolate=function(h){return arguments.length?(r=h,f()):r},c.unknown=function(h){return arguments.length?(o=h,c):o},function(h,d){return n=h,i=d,f()}}function Ty(e,t){return lp()(e,t)}function kD(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function oc(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function Ma(e){return e=oc(Math.abs(e)),e?e[1]:NaN}function zD(e,t){return function(r,n){for(var i=r.length,o=[],a=0,s=e[0],u=0;i>0&&s>0&&(u+s+1>n&&(s=Math.max(1,n-u)),o.push(r.substring(i-=s,i+s)),!((u+=s+1)>n));)s=e[a=(a+1)%e.length];return o.reverse().join(t)}}function VD(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var HD=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ac(e){if(!(t=HD.exec(e)))throw new Error("invalid format: "+e);var t;return new cp({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}ac.prototype=cp.prototype;function cp(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}cp.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function XD(e){e:for(var t=e.length,r=1,n=-1,i;r<t;++r)switch(e[r]){case".":n=i=r;break;case"0":n===0&&(n=r),i=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(i+1):e}var Sy;function WD(e,t){var r=oc(e,t);if(!r)return e+"";var n=r[0],i=r[1],o=i-(Sy=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,a=n.length;return o===a?n:o>a?n+new Array(o-a+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+oc(e,Math.max(0,t+o-1))[0]}function Xm(e,t){var r=oc(e,t);if(!r)return e+"";var n=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}const Wm={"%":function(e,t){return(e*100).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:kD,e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return Xm(e*100,t)},r:Xm,s:WD,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function jm(e){return e}var Gm=Array.prototype.map,$m=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function jD(e){var t=e.grouping===void 0||e.thousands===void 0?jm:zD(Gm.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",o=e.numerals===void 0?jm:VD(Gm.call(e.numerals,String)),a=e.percent===void 0?"%":e.percent+"",s=e.minus===void 0?"-":e.minus+"",u=e.nan===void 0?"NaN":e.nan+"";function l(c){c=ac(c);var h=c.fill,d=c.align,p=c.sign,v=c.symbol,m=c.zero,y=c.width,A=c.comma,T=c.precision,R=c.trim,b=c.type;b==="n"?(A=!0,b="g"):Wm[b]||(T===void 0&&(T=12),R=!0,b="g"),(m||h==="0"&&d==="=")&&(m=!0,h="0",d="=");var H=v==="$"?r:v==="#"&&/[boxX]/.test(b)?"0"+b.toLowerCase():"",B=v==="$"?n:/[%p]/.test(b)?a:"",q=Wm[b],Ee=/[defgprs%]/.test(b);T=T===void 0?6:/[gprs]/.test(b)?Math.max(1,Math.min(21,T)):Math.max(0,Math.min(20,T));function Z(k){var $=H,K=B,ce,Ne,je;if(b==="c")K=q(k)+K,k="";else{k=+k;var Je=k<0||1/k<0;if(k=isNaN(k)?u:q(Math.abs(k),T),R&&(k=XD(k)),Je&&+k==0&&p!=="+"&&(Je=!1),$=(Je?p==="("?p:s:p==="-"||p==="("?"":p)+$,K=(b==="s"?$m[8+Sy/3]:"")+K+(Je&&p==="("?")":""),Ee){for(ce=-1,Ne=k.length;++ce<Ne;)if(je=k.charCodeAt(ce),48>je||je>57){K=(je===46?i+k.slice(ce+1):k.slice(ce))+K,k=k.slice(0,ce);break}}}A&&!m&&(k=t(k,1/0));var ht=$.length+k.length+K.length,$e=ht<y?new Array(y-ht+1).join(h):"";switch(A&&m&&(k=t($e+k,$e.length?y-K.length:1/0),$e=""),d){case"<":k=$+k+K+$e;break;case"=":k=$+$e+k+K;break;case"^":k=$e.slice(0,ht=$e.length>>1)+$+k+K+$e.slice(ht);break;default:k=$e+$+k+K;break}return o(k)}return Z.toString=function(){return c+""},Z}function f(c,h){var d=l((c=ac(c),c.type="f",c)),p=Math.max(-8,Math.min(8,Math.floor(Ma(h)/3)))*3,v=Math.pow(10,-p),m=$m[8+p/3];return function(y){return d(v*y)+m}}return{format:l,formatPrefix:f}}var _l,fp,xy;GD({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function GD(e){return _l=jD(e),fp=_l.format,xy=_l.formatPrefix,_l}function $D(e){return Math.max(0,-Ma(Math.abs(e)))}function YD(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ma(t)/3)))*3-Ma(Math.abs(e)))}function ZD(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Ma(t)-Ma(e))+1}function qD(e,t,r,n){var i=cd(e,t,r),o;switch(n=ac(n==null?",f":n),n.type){case"s":{var a=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(o=YD(i,a))&&(n.precision=o),xy(n,a)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(o=ZD(i,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=o-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(o=$D(i))&&(n.precision=o-(n.type==="%")*2);break}}return fp(n)}function Au(e){var t=e.domain;return e.ticks=function(r){var n=t();return vy(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var i=t();return qD(i[0],i[i.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=t(),i=0,o=n.length-1,a=n[i],s=n[o],u;return s<a&&(u=a,a=s,s=u,u=i,i=o,o=u),u=wl(a,s,r),u>0?(a=Math.floor(a/u)*u,s=Math.ceil(s/u)*u,u=wl(a,s,r)):u<0&&(a=Math.ceil(a*u)/u,s=Math.floor(s*u)/u,u=wl(a,s,r)),u>0?(n[i]=Math.floor(a/u)*u,n[o]=Math.ceil(s/u)*u,t(n)):u<0&&(n[i]=Math.ceil(a*u)/u,n[o]=Math.floor(s*u)/u,t(n)),e},e}function Ry(){var e=Ty(Zr,Zr);return e.copy=function(){return Fc(e,Ry())},ji.apply(e,arguments),Au(e)}function Cy(e,t){e=e.slice();var r=0,n=e.length-1,i=e[r],o=e[n],a;return o<i&&(a=r,r=n,n=a,a=i,i=o,o=a),e[r]=t.floor(i),e[n]=t.ceil(o),e}function Ym(e){return Math.log(e)}function Zm(e){return Math.exp(e)}function KD(e){return-Math.log(-e)}function QD(e){return-Math.exp(-e)}function JD(e){return isFinite(e)?+("1e"+e):e<0?0:e}function eB(e){return e===10?JD:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}function tB(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}function qm(e){return function(t){return-e(-t)}}function rB(e){var t=e(Ym,Zm),r=t.domain,n=10,i,o;function a(){return i=tB(n),o=eB(n),r()[0]<0?(i=qm(i),o=qm(o),e(KD,QD)):e(Ym,Zm),t}return t.base=function(s){return arguments.length?(n=+s,a()):n},t.domain=function(s){return arguments.length?(r(s),a()):r()},t.ticks=function(s){var u=r(),l=u[0],f=u[u.length-1],c;(c=f<l)&&(h=l,l=f,f=h);var h=i(l),d=i(f),p,v,m,y=s==null?10:+s,A=[];if(!(n%1)&&d-h<y){if(h=Math.round(h)-1,d=Math.round(d)+1,l>0){for(;h<d;++h)for(v=1,p=o(h);v<n;++v)if(m=p*v,!(m<l)){if(m>f)break;A.push(m)}}else for(;h<d;++h)for(v=n-1,p=o(h);v>=1;--v)if(m=p*v,!(m<l)){if(m>f)break;A.push(m)}}else A=vy(h,d,Math.min(d-h,y)).map(o);return c?A.reverse():A},t.tickFormat=function(s,u){if(u==null&&(u=n===10?".0e":","),typeof u!="function"&&(u=fp(u)),s===1/0)return u;s==null&&(s=10);var l=Math.max(1,n*s/t.ticks().length);return function(f){var c=f/o(Math.round(i(f)));return c*n<n-.5&&(c*=n),c<=l?u(f):""}},t.nice=function(){return r(Cy(r(),{floor:function(s){return o(Math.floor(i(s)))},ceil:function(s){return o(Math.ceil(i(s)))}}))},t}function by(){var e=rB(lp()).domain([1,10]);return e.copy=function(){return Fc(e,by()).base(e.base())},ji.apply(e,arguments),e}function Km(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function nB(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function iB(e){return e<0?-e*e:e*e}function oB(e){var t=e(Zr,Zr),r=1;function n(){return r===1?e(Zr,Zr):r===.5?e(nB,iB):e(Km(r),Km(1/r))}return t.exponent=function(i){return arguments.length?(r=+i,n()):r},Au(t)}function My(){var e=oB(lp());return e.copy=function(){return Fc(e,My()).exponent(e.exponent())},ji.apply(e,arguments),e}function Iy(){var e=[],t=[],r=[],n;function i(){var a=0,s=Math.max(1,t.length);for(r=new Array(s-1);++a<s;)r[a-1]=gD(e,a/s);return o}function o(a){return isNaN(a=+a)?n:t[Nc(r,a)]}return o.invertExtent=function(a){var s=t.indexOf(a);return s<0?[NaN,NaN]:[s>0?r[s-1]:e[0],s<r.length?r[s]:e[e.length-1]]},o.domain=function(a){if(!arguments.length)return e.slice();e=[];for(var s=0,u=a.length,l;s<u;++s)l=a[s],l!=null&&!isNaN(l=+l)&&e.push(l);return e.sort(ap),i()},o.range=function(a){return arguments.length?(t=go.call(a),i()):t.slice()},o.unknown=function(a){return arguments.length?(n=a,o):n},o.quantiles=function(){return r.slice()},o.copy=function(){return Iy().domain(e).range(t).unknown(n)},ji.apply(o,arguments)}function Oy(){var e=0,t=1,r=1,n=[.5],i=[0,1],o;function a(u){return u<=u?i[Nc(n,u,0,r)]:o}function s(){var u=-1;for(n=new Array(r);++u<r;)n[u]=((u+1)*t-(u-r)*e)/(r+1);return a}return a.domain=function(u){return arguments.length?(e=+u[0],t=+u[1],s()):[e,t]},a.range=function(u){return arguments.length?(r=(i=go.call(u)).length-1,s()):i.slice()},a.invertExtent=function(u){var l=i.indexOf(u);return l<0?[NaN,NaN]:l<1?[e,n[0]]:l>=r?[n[r-1],t]:[n[l-1],n[l]]},a.unknown=function(u){return arguments.length&&(o=u),a},a.thresholds=function(){return n.slice()},a.copy=function(){return Oy().domain([e,t]).range(i).unknown(o)},ji.apply(Au(a),arguments)}function Py(){var e=[.5],t=[0,1],r,n=1;function i(o){return o<=o?t[Nc(e,o,0,n)]:r}return i.domain=function(o){return arguments.length?(e=go.call(o),n=Math.min(e.length,t.length-1),i):e.slice()},i.range=function(o){return arguments.length?(t=go.call(o),n=Math.min(e.length,t.length-1),i):t.slice()},i.invertExtent=function(o){var a=t.indexOf(o);return[e[a-1],e[a]]},i.unknown=function(o){return arguments.length?(r=o,i):r},i.copy=function(){return Py().domain(e).range(t).unknown(r)},ji.apply(i,arguments)}var hh=new Date,dh=new Date;function rn(e,t,r,n){function i(o){return e(o=arguments.length===0?new Date:new Date(+o)),o}return i.floor=function(o){return e(o=new Date(+o)),o},i.ceil=function(o){return e(o=new Date(o-1)),t(o,1),e(o),o},i.round=function(o){var a=i(o),s=i.ceil(o);return o-a<s-o?a:s},i.offset=function(o,a){return t(o=new Date(+o),a==null?1:Math.floor(a)),o},i.range=function(o,a,s){var u=[],l;if(o=i.ceil(o),s=s==null?1:Math.floor(s),!(o<a)||!(s>0))return u;do u.push(l=new Date(+o)),t(o,s),e(o);while(l<o&&o<a);return u},i.filter=function(o){return rn(function(a){if(a>=a)for(;e(a),!o(a);)a.setTime(a-1)},function(a,s){if(a>=a)if(s<0)for(;++s<=0;)for(;t(a,-1),!o(a););else for(;--s>=0;)for(;t(a,1),!o(a););})},r&&(i.count=function(o,a){return hh.setTime(+o),dh.setTime(+a),e(hh),e(dh),Math.floor(r(hh,dh))},i.every=function(o){return o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?i.filter(n?function(a){return n(a)%o===0}:function(a){return i.count(0,a)%o===0}):i}),i}var sc=rn(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});sc.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?rn(function(t){t.setTime(Math.floor(t/e)*e)},function(t,r){t.setTime(+t+r*e)},function(t,r){return(r-t)/e}):sc};const aB=sc;sc.range;var uc=1e3,uu=6e4,Qm=36e5,Ny=864e5,Fy=6048e5,Dy=rn(function(e){e.setTime(e-e.getMilliseconds())},function(e,t){e.setTime(+e+t*uc)},function(e,t){return(t-e)/uc},function(e){return e.getUTCSeconds()});const sB=Dy;Dy.range;var By=rn(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*uc)},function(e,t){e.setTime(+e+t*uu)},function(e,t){return(t-e)/uu},function(e){return e.getMinutes()});const uB=By;By.range;var wy=rn(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*uc-e.getMinutes()*uu)},function(e,t){e.setTime(+e+t*Qm)},function(e,t){return(t-e)/Qm},function(e){return e.getHours()});const lB=wy;wy.range;var Ly=rn(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*uu)/Ny},function(e){return e.getDate()-1});const hp=Ly;Ly.range;function So(e){return rn(function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},function(t,r){t.setDate(t.getDate()+r*7)},function(t,r){return(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*uu)/Fy})}var dp=So(0),lc=So(1),cB=So(2),fB=So(3),Ia=So(4),hB=So(5),dB=So(6);dp.range;lc.range;cB.range;fB.range;Ia.range;hB.range;dB.range;var Uy=rn(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()});const pB=Uy;Uy.range;var pp=rn(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});pp.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:rn(function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,r){t.setFullYear(t.getFullYear()+r*e)})};const Oa=pp;pp.range;var ky=rn(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/Ny},function(e){return e.getUTCDate()-1});const zy=ky;ky.range;function xo(e){return rn(function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},function(t,r){t.setUTCDate(t.getUTCDate()+r*7)},function(t,r){return(r-t)/Fy})}var Vy=xo(0),cc=xo(1),_B=xo(2),vB=xo(3),Pa=xo(4),mB=xo(5),gB=xo(6);Vy.range;cc.range;_B.range;vB.range;Pa.range;mB.range;gB.range;var _p=rn(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});_p.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:rn(function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,r){t.setUTCFullYear(t.getUTCFullYear()+r*e)})};const lu=_p;_p.range;function ph(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function _h(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function ys(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function EB(e){var t=e.dateTime,r=e.date,n=e.time,i=e.periods,o=e.days,a=e.shortDays,s=e.months,u=e.shortMonths,l=As(i),f=Ts(i),c=As(o),h=Ts(o),d=As(a),p=Ts(a),v=As(s),m=Ts(s),y=As(u),A=Ts(u),T={a:Je,A:ht,b:$e,B:et,c:null,d:ig,e:ig,f:HB,g:QB,G:ew,H:kB,I:zB,j:VB,L:Hy,m:XB,M:WB,p:mt,q:gt,Q:sg,s:ug,S:jB,u:GB,U:$B,V:YB,w:ZB,W:qB,x:null,X:null,y:KB,Y:JB,Z:tw,"%":ag},R={a:Ot,A:Bt,b:Et,B:Tr,c:null,d:og,e:og,f:ow,g:_w,G:mw,H:rw,I:nw,j:iw,L:Wy,m:aw,M:sw,p:$t,q:Gr,Q:sg,s:ug,S:uw,u:lw,U:cw,V:fw,w:hw,W:dw,x:null,X:null,y:pw,Y:vw,Z:gw,"%":ag},b={a:Z,A:k,b:$,B:K,c:ce,d:rg,e:rg,f:BB,g:tg,G:eg,H:ng,I:ng,j:PB,L:DB,m:OB,M:NB,p:Ee,q:IB,Q:LB,s:UB,S:FB,u:xB,U:RB,V:CB,w:SB,W:bB,x:Ne,X:je,y:tg,Y:eg,Z:MB,"%":wB};T.x=H(r,T),T.X=H(n,T),T.c=H(t,T),R.x=H(r,R),R.X=H(n,R),R.c=H(t,R);function H(le,Ve){return function(nt){var Te=[],Ut=-1,yt=0,Ht=le.length,bt,lt,kt;for(nt instanceof Date||(nt=new Date(+nt));++Ut<Ht;)le.charCodeAt(Ut)===37&&(Te.push(le.slice(yt,Ut)),(lt=Jm[bt=le.charAt(++Ut)])!=null?bt=le.charAt(++Ut):lt=bt==="e"?" ":"0",(kt=Ve[bt])&&(bt=kt(nt,lt)),Te.push(bt),yt=Ut+1);return Te.push(le.slice(yt,Ut)),Te.join("")}}function B(le,Ve){return function(nt){var Te=ys(1900,void 0,1),Ut=q(Te,le,nt+="",0),yt,Ht;if(Ut!=nt.length)return null;if("Q"in Te)return new Date(Te.Q);if("s"in Te)return new Date(Te.s*1e3+("L"in Te?Te.L:0));if(Ve&&!("Z"in Te)&&(Te.Z=0),"p"in Te&&(Te.H=Te.H%12+Te.p*12),Te.m===void 0&&(Te.m="q"in Te?Te.q:0),"V"in Te){if(Te.V<1||Te.V>53)return null;"w"in Te||(Te.w=1),"Z"in Te?(yt=_h(ys(Te.y,0,1)),Ht=yt.getUTCDay(),yt=Ht>4||Ht===0?cc.ceil(yt):cc(yt),yt=zy.offset(yt,(Te.V-1)*7),Te.y=yt.getUTCFullYear(),Te.m=yt.getUTCMonth(),Te.d=yt.getUTCDate()+(Te.w+6)%7):(yt=ph(ys(Te.y,0,1)),Ht=yt.getDay(),yt=Ht>4||Ht===0?lc.ceil(yt):lc(yt),yt=hp.offset(yt,(Te.V-1)*7),Te.y=yt.getFullYear(),Te.m=yt.getMonth(),Te.d=yt.getDate()+(Te.w+6)%7)}else("W"in Te||"U"in Te)&&("w"in Te||(Te.w="u"in Te?Te.u%7:"W"in Te?1:0),Ht="Z"in Te?_h(ys(Te.y,0,1)).getUTCDay():ph(ys(Te.y,0,1)).getDay(),Te.m=0,Te.d="W"in Te?(Te.w+6)%7+Te.W*7-(Ht+5)%7:Te.w+Te.U*7-(Ht+6)%7);return"Z"in Te?(Te.H+=Te.Z/100|0,Te.M+=Te.Z%100,_h(Te)):ph(Te)}}function q(le,Ve,nt,Te){for(var Ut=0,yt=Ve.length,Ht=nt.length,bt,lt;Ut<yt;){if(Te>=Ht)return-1;if(bt=Ve.charCodeAt(Ut++),bt===37){if(bt=Ve.charAt(Ut++),lt=b[bt in Jm?Ve.charAt(Ut++):bt],!lt||(Te=lt(le,nt,Te))<0)return-1}else if(bt!=nt.charCodeAt(Te++))return-1}return Te}function Ee(le,Ve,nt){var Te=l.exec(Ve.slice(nt));return Te?(le.p=f[Te[0].toLowerCase()],nt+Te[0].length):-1}function Z(le,Ve,nt){var Te=d.exec(Ve.slice(nt));return Te?(le.w=p[Te[0].toLowerCase()],nt+Te[0].length):-1}function k(le,Ve,nt){var Te=c.exec(Ve.slice(nt));return Te?(le.w=h[Te[0].toLowerCase()],nt+Te[0].length):-1}function $(le,Ve,nt){var Te=y.exec(Ve.slice(nt));return Te?(le.m=A[Te[0].toLowerCase()],nt+Te[0].length):-1}function K(le,Ve,nt){var Te=v.exec(Ve.slice(nt));return Te?(le.m=m[Te[0].toLowerCase()],nt+Te[0].length):-1}function ce(le,Ve,nt){return q(le,t,Ve,nt)}function Ne(le,Ve,nt){return q(le,r,Ve,nt)}function je(le,Ve,nt){return q(le,n,Ve,nt)}function Je(le){return a[le.getDay()]}function ht(le){return o[le.getDay()]}function $e(le){return u[le.getMonth()]}function et(le){return s[le.getMonth()]}function mt(le){return i[+(le.getHours()>=12)]}function gt(le){return 1+~~(le.getMonth()/3)}function Ot(le){return a[le.getUTCDay()]}function Bt(le){return o[le.getUTCDay()]}function Et(le){return u[le.getUTCMonth()]}function Tr(le){return s[le.getUTCMonth()]}function $t(le){return i[+(le.getUTCHours()>=12)]}function Gr(le){return 1+~~(le.getUTCMonth()/3)}return{format:function(le){var Ve=H(le+="",T);return Ve.toString=function(){return le},Ve},parse:function(le){var Ve=B(le+="",!1);return Ve.toString=function(){return le},Ve},utcFormat:function(le){var Ve=H(le+="",R);return Ve.toString=function(){return le},Ve},utcParse:function(le){var Ve=B(le+="",!0);return Ve.toString=function(){return le},Ve}}}var Jm={"-":"",_:" ",0:"0"},kr=/^\s*\d+/,yB=/^%/,AB=/[\\^$*+?|[\]().{}]/g;function Xt(e,t,r){var n=e<0?"-":"",i=(n?-e:e)+"",o=i.length;return n+(o<r?new Array(r-o+1).join(t)+i:i)}function TB(e){return e.replace(AB,"\\$&")}function As(e){return new RegExp("^(?:"+e.map(TB).join("|")+")","i")}function Ts(e){for(var t={},r=-1,n=e.length;++r<n;)t[e[r].toLowerCase()]=r;return t}function SB(e,t,r){var n=kr.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function xB(e,t,r){var n=kr.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function RB(e,t,r){var n=kr.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function CB(e,t,r){var n=kr.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function bB(e,t,r){var n=kr.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function eg(e,t,r){var n=kr.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function tg(e,t,r){var n=kr.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function MB(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function IB(e,t,r){var n=kr.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function OB(e,t,r){var n=kr.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function rg(e,t,r){var n=kr.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function PB(e,t,r){var n=kr.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function ng(e,t,r){var n=kr.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function NB(e,t,r){var n=kr.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function FB(e,t,r){var n=kr.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function DB(e,t,r){var n=kr.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function BB(e,t,r){var n=kr.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function wB(e,t,r){var n=yB.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function LB(e,t,r){var n=kr.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function UB(e,t,r){var n=kr.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function ig(e,t){return Xt(e.getDate(),t,2)}function kB(e,t){return Xt(e.getHours(),t,2)}function zB(e,t){return Xt(e.getHours()%12||12,t,2)}function VB(e,t){return Xt(1+hp.count(Oa(e),e),t,3)}function Hy(e,t){return Xt(e.getMilliseconds(),t,3)}function HB(e,t){return Hy(e,t)+"000"}function XB(e,t){return Xt(e.getMonth()+1,t,2)}function WB(e,t){return Xt(e.getMinutes(),t,2)}function jB(e,t){return Xt(e.getSeconds(),t,2)}function GB(e){var t=e.getDay();return t===0?7:t}function $B(e,t){return Xt(dp.count(Oa(e)-1,e),t,2)}function Xy(e){var t=e.getDay();return t>=4||t===0?Ia(e):Ia.ceil(e)}function YB(e,t){return e=Xy(e),Xt(Ia.count(Oa(e),e)+(Oa(e).getDay()===4),t,2)}function ZB(e){return e.getDay()}function qB(e,t){return Xt(lc.count(Oa(e)-1,e),t,2)}function KB(e,t){return Xt(e.getFullYear()%100,t,2)}function QB(e,t){return e=Xy(e),Xt(e.getFullYear()%100,t,2)}function JB(e,t){return Xt(e.getFullYear()%1e4,t,4)}function ew(e,t){var r=e.getDay();return e=r>=4||r===0?Ia(e):Ia.ceil(e),Xt(e.getFullYear()%1e4,t,4)}function tw(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Xt(t/60|0,"0",2)+Xt(t%60,"0",2)}function og(e,t){return Xt(e.getUTCDate(),t,2)}function rw(e,t){return Xt(e.getUTCHours(),t,2)}function nw(e,t){return Xt(e.getUTCHours()%12||12,t,2)}function iw(e,t){return Xt(1+zy.count(lu(e),e),t,3)}function Wy(e,t){return Xt(e.getUTCMilliseconds(),t,3)}function ow(e,t){return Wy(e,t)+"000"}function aw(e,t){return Xt(e.getUTCMonth()+1,t,2)}function sw(e,t){return Xt(e.getUTCMinutes(),t,2)}function uw(e,t){return Xt(e.getUTCSeconds(),t,2)}function lw(e){var t=e.getUTCDay();return t===0?7:t}function cw(e,t){return Xt(Vy.count(lu(e)-1,e),t,2)}function jy(e){var t=e.getUTCDay();return t>=4||t===0?Pa(e):Pa.ceil(e)}function fw(e,t){return e=jy(e),Xt(Pa.count(lu(e),e)+(lu(e).getUTCDay()===4),t,2)}function hw(e){return e.getUTCDay()}function dw(e,t){return Xt(cc.count(lu(e)-1,e),t,2)}function pw(e,t){return Xt(e.getUTCFullYear()%100,t,2)}function _w(e,t){return e=jy(e),Xt(e.getUTCFullYear()%100,t,2)}function vw(e,t){return Xt(e.getUTCFullYear()%1e4,t,4)}function mw(e,t){var r=e.getUTCDay();return e=r>=4||r===0?Pa(e):Pa.ceil(e),Xt(e.getUTCFullYear()%1e4,t,4)}function gw(){return"+0000"}function ag(){return"%"}function sg(e){return+e}function ug(e){return Math.floor(+e/1e3)}var ra,Gy;Ew({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Ew(e){return ra=EB(e),Gy=ra.format,ra.parse,ra.utcFormat,ra.utcParse,ra}var zs=1e3,Vs=zs*60,Hs=Vs*60,cu=Hs*24,yw=cu*7,lg=cu*30,vh=cu*365;function Aw(e){return new Date(e)}function Tw(e){return e instanceof Date?+e:+new Date(+e)}function $y(e,t,r,n,i,o,a,s,u){var l=Ty(Zr,Zr),f=l.invert,c=l.domain,h=u(".%L"),d=u(":%S"),p=u("%I:%M"),v=u("%I %p"),m=u("%a %d"),y=u("%b %d"),A=u("%B"),T=u("%Y"),R=[[a,1,zs],[a,5,5*zs],[a,15,15*zs],[a,30,30*zs],[o,1,Vs],[o,5,5*Vs],[o,15,15*Vs],[o,30,30*Vs],[i,1,Hs],[i,3,3*Hs],[i,6,6*Hs],[i,12,12*Hs],[n,1,cu],[n,2,2*cu],[r,1,yw],[t,1,lg],[t,3,3*lg],[e,1,vh]];function b(B){return(a(B)<B?h:o(B)<B?d:i(B)<B?p:n(B)<B?v:t(B)<B?r(B)<B?m:y:e(B)<B?A:T)(B)}function H(B,q,Ee,Z){if(B==null&&(B=10),typeof B=="number"){var k=Math.abs(Ee-q)/B,$=_y(function(K){return K[2]}).right(R,k);$===R.length?(Z=cd(q/vh,Ee/vh,B),B=e):$?($=R[k/R[$-1][2]<R[$][2]/k?$-1:$],Z=$[1],B=$[0]):(Z=Math.max(cd(q,Ee,B),1),B=s)}return Z==null?B:B.every(Z)}return l.invert=function(B){return new Date(f(B))},l.domain=function(B){return arguments.length?c(Ay.call(B,Tw)):c().map(Aw)},l.ticks=function(B,q){var Ee=c(),Z=Ee[0],k=Ee[Ee.length-1],$=k<Z,K;return $&&(K=Z,Z=k,k=K),K=H(B,Z,k,q),K=K?K.range(Z,k+1):[],$?K.reverse():K},l.tickFormat=function(B,q){return q==null?b:u(q)},l.nice=function(B,q){var Ee=c();return(B=H(B,Ee[0],Ee[Ee.length-1],q))?c(Cy(Ee,B)):l},l.copy=function(){return Fc(l,$y(e,t,r,n,i,o,a,s,u))},l}function Sw(){return ji.apply($y(Oa,pB,dp,hp,lB,uB,sB,aB,Gy).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function xw(){var e=0,t=1,r,n,i,o,a=Zr,s=!1,u;function l(f){return isNaN(f=+f)?u:a(i===0?.5:(f=(o(f)-r)*i,s?Math.max(0,Math.min(1,f)):f))}return l.domain=function(f){return arguments.length?(r=o(e=+f[0]),n=o(t=+f[1]),i=r===n?0:1/(n-r),l):[e,t]},l.clamp=function(f){return arguments.length?(s=!!f,l):s},l.interpolator=function(f){return arguments.length?(a=f,l):a},l.unknown=function(f){return arguments.length?(u=f,l):u},function(f){return o=f,r=f(e),n=f(t),i=r===n?0:1/(n-r),l}}function Yy(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Zy(){var e=Au(xw()(Zr));return e.copy=function(){return Yy(e,Zy())},Ey.apply(e,arguments)}function Rw(){var e=0,t=.5,r=1,n,i,o,a,s,u=Zr,l,f=!1,c;function h(d){return isNaN(d=+d)?c:(d=.5+((d=+l(d))-i)*(d<i?a:s),u(f?Math.max(0,Math.min(1,d)):d))}return h.domain=function(d){return arguments.length?(n=l(e=+d[0]),i=l(t=+d[1]),o=l(r=+d[2]),a=n===i?0:.5/(i-n),s=i===o?0:.5/(o-i),h):[e,t,r]},h.clamp=function(d){return arguments.length?(f=!!d,h):f},h.interpolator=function(d){return arguments.length?(u=d,h):u},h.unknown=function(d){return arguments.length?(c=d,h):c},function(d){return l=d,n=d(e),i=d(t),o=d(r),a=n===i?0:.5/(i-n),s=i===o?0:.5/(o-i),h}}function qy(){var e=Au(Rw()(Zr));return e.copy=function(){return Yy(e,qy())},Ey.apply(e,arguments)}function Ky(e){let t,r=[];function n(i){return i==null?t:i}return n.invert=n,n.domain=n.range=i=>i?(r=i,i):r,n.unknown=i=>i?(t=i,i):t,n.copy=()=>Ky().unknown(t),n}const{isNil:mh,isString:Cw,uniq:bw}=Ar,Mw=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,Iw={[jt.LINEAR]:Ry,[jt.POWER]:My,[jt.LOG]:by,[jt.IDENTITY]:Ky,[jt.SEQUENTIAL]:Zy,[jt.TIME]:Sw,[jt.QUANTILE]:Iy,[jt.QUANTIZE]:Oy,[jt.THRESHOLD]:Py,[jt.CAT]:ic,[jt.DIVERGING]:qy};class Ow{constructor(){E(this,"scaleOptions",{})}apply(t,{styleAttributeService:r}){var n=this;t.hooks.init.tapPromise("FeatureScalePlugin",pe(function*(){var i;t.log(Br.ScaleInitStart,jr.INIT),n.scaleOptions=t.getScaleOptions();const o=r.getLayerStyleAttributes(),a=(i=t.getSource())===null||i===void 0?void 0:i.data.dataArray;Array.isArray(a)&&a.length===0||(n.caculateScalesForAttributes(o||[],a),t.log(Br.ScaleInitEnd,jr.INIT))})),t.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var i=pe(function*(o){if(!o)return o;t.log(Br.ScaleInitStart,jr.UPDATE),n.scaleOptions=t.getScaleOptions();const a=r.getLayerStyleAttributes(),s=t.getSource().data.dataArray;return Array.isArray(s)&&s.length===0||(n.caculateScalesForAttributes(a||[],s),t.log(Br.ScaleInitEnd,jr.UPDATE),t.layerModelNeedUpdate=!0),!0});return function(o){return i.apply(this,arguments)}}()),t.hooks.beforeRender.tap("FeatureScalePlugin",()=>{if(t.layerModelNeedUpdate)return;this.scaleOptions=t.getScaleOptions();const i=r.getLayerStyleAttributes(),o=t.getSource().data.dataArray;if(!(Array.isArray(o)&&o.length===0)&&i){const a=i.filter(s=>s.needRescale);a.length&&this.caculateScalesForAttributes(a,o)}})}isNumber(t){return!isNaN(parseFloat(t))&&isFinite(t)}caculateScalesForAttributes(t,r){t.forEach(n=>{if(n.scale){const i=n.scale,o=n.scale.field;i.names=this.parseFields(mh(o)?[]:o);const a=[];i.names.forEach(s=>{var u;a.push(this.createScale(s,n.name,(u=n.scale)===null||u===void 0?void 0:u.values,r))}),a.some(s=>s.type===ta.VARIABLE)?(i.type=ta.VARIABLE,a.forEach(s=>{if(!i.callback&&i.values!=="text"){var u;switch((u=s.option)===null||u===void 0?void 0:u.type){case jt.LOG:case jt.LINEAR:case jt.POWER:if(i.values&&i.values.length>2){const f=s.scale.ticks(i.values.length);s.scale.domain(f)}i.values?s.scale.range(i.values):s.scale.range(s.option.domain);break;case jt.QUANTILE:case jt.QUANTIZE:case jt.THRESHOLD:s.scale.range(i.values);break;case jt.IDENTITY:break;case jt.CAT:i.values?s.scale.range(i.values):s.scale.range(s.option.domain);break;case jt.DIVERGING:case jt.SEQUENTIAL:s.scale.interpolator(RD(i.values));break}}if(i.values==="text"){var l;s.scale.range((l=s.option)===null||l===void 0?void 0:l.domain)}})):(i.type=ta.CONSTANT,i.defaultValues=a.map((s,u)=>s.scale(i.names[u]))),i.scalers=a.map(s=>({field:s.field,func:s.scale,option:s.option})),n.needRescale=!1}})}parseFields(t){return Array.isArray(t)?t:Cw(t)?t.split("*"):[t]}createScale(t,r,n,i){var o,a;const s=this.scaleOptions[r]&&((o=this.scaleOptions[r])===null||o===void 0?void 0:o.field)===t?this.scaleOptions[r]:this.scaleOptions[t],u={field:t,scale:void 0,type:ta.VARIABLE,option:s};if(!i||!i.length)return s&&s.type?u.scale=this.createDefaultScale(s):(u.scale=ic([t]),u.type=ta.CONSTANT),u;const l=(a=i.find(f=>!mh(f[t])))===null||a===void 0?void 0:a[t];if(this.isNumber(t)||mh(l)&&!s)u.scale=ic([t]),u.type=ta.CONSTANT;else{let f=s&&s.type||this.getDefaultType(l);n==="text"&&(f=jt.CAT),n===void 0&&(f=jt.IDENTITY);const c=this.createScaleConfig(f,t,s,i);u.scale=this.createDefaultScale(c),u.option=c}return u}getDefaultType(t){let r=jt.LINEAR;return typeof t=="string"&&(r=Mw.test(t)?jt.TIME:jt.CAT),r}createScaleConfig(t,r,n,i){const o={type:t};let a=[];if(t===jt.QUANTILE){const s=new Map;i==null||i.forEach(u=>{s.set(u._id,u[r])}),a=Array.from(s.values())}else a=(i==null?void 0:i.map(s=>s[r]))||[];if(n!=null&&n.domain)o.domain=n==null?void 0:n.domain;else if(t===jt.CAT||t===jt.IDENTITY)o.domain=bw(a);else if(t===jt.QUANTILE)o.domain=a;else if(t===jt.DIVERGING){const s=Lm(a),u=(n==null?void 0:n.neutral)!==void 0?n==null?void 0:n.neutral:(s[0]+s[1])/2;o.domain=[s[0],u,s[1]]}else o.domain=Lm(a);return he(he({},o),n)}createDefaultScale({type:t,domain:r,unknown:n,clamp:i,nice:o}){const a=Iw[t]();return r&&a.domain&&a.domain(r),n&&a.unknown(n),i!==void 0&&a.clamp&&a.clamp(i),o!==void 0&&a.nice&&a.nice(o),a}}class Pw{apply(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",()=>{t.animateStatus&&t.models.forEach(n=>{n.addUniforms(he({},t.layerModel.getAnimateUniforms()))})})}}class Nw{apply(t){t.hooks.afterInit.tap("LayerMaskPlugin",()=>{const{maskLayers:r,enableMask:n}=t.getLayerConfig();!t.tileLayer&&r&&r.length>0&&t.updateLayerConfig({mask:n})})}}class Fw{build(t){return pe(function*(){t.prepareBuildModel(),yield t.buildModels()})()}initLayerModel(t){var r=this;return pe(function*(){yield r.build(t),t.styleNeedUpdate=!1})()}prepareLayerModel(t){var r=this;return pe(function*(){yield r.build(t),t.styleNeedUpdate=!1})()}apply(t){var r=this;t.hooks.init.tapPromise("LayerModelPlugin",pe(function*(){if(t.getSource().isTile){t.prepareBuildModel();return}t.log(Br.BuildModelStart,jr.INIT),yield r.initLayerModel(t),t.log(Br.BuildModelEnd,jr.INIT)})),t.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var n=pe(function*(i){return!i||t.getSource().isTile?!1:(t.log(Br.BuildModelStart,jr.UPDATE),yield r.prepareLayerModel(t),t.log(Br.BuildModelEnd,jr.UPDATE),!0)});return function(i){return n.apply(this,arguments)}}())}}class Dw{apply(t){t.hooks.afterInit.tap("LayerStylePlugin",()=>{const{autoFit:r,fitBoundsOptions:n}=t.getLayerConfig();r&&t.fitBounds(n),t.styleNeedUpdate=!1})}}const Bw=["type"],cg={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},ww={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},Lw={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},Uw={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function kw(e){const t={u_DirectionalLights:new Array(3).fill(he({},Lw)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(he({},Uw)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[ww]),e.forEach(r=>{let{type:n="directional"}=r,i=$n(r,Bw);const o=cg[n].lights,a=cg[n].num,s=t[a];t[o][s]=he(he({},t[o][s]),i),t[a]++}),t}class zw{apply(t){t.hooks.beforeRender.tap("LightingPlugin",()=>{const{enableLighting:r}=t.getLayerConfig();r&&t.models.forEach(n=>n.addUniforms(he({},kw())))})}}function Qy(e){return e.map(t=>(typeof t=="string"&&(t=[t,{}]),t))}function Jy(e,t,r,n){const i=e.multiPassRenderer,{enableTAA:o}=e.getLayerConfig();return o?i.add(n("taa")):i.add(n("render")),Qy(t).forEach(a=>{const[s,u]=a;i.add(r(s),u)}),i.add(r("copy")),i}class Vw{constructor(){E(this,"enabled",void 0)}apply(t,{rendererService:r,postProcessingPassFactory:n,normalPassFactory:i}){t.hooks.init.tapPromise("MultiPassRendererPlugin",()=>{const{enableMultiPassRenderer:o,passes:a=[]}=t.getLayerConfig();this.enabled=!!o&&t.getLayerConfig().enableMultiPassRenderer!==!1,this.enabled&&(t.multiPassRenderer=Jy(t,a,n,i),t.multiPassRenderer.setRenderFlag(!0))}),t.hooks.beforeRender.tap("MultiPassRendererPlugin",()=>{if(this.enabled){const{width:o,height:a}=r.getViewportSize();t.multiPassRenderer.resize(o,a)}})}}let at=function(e){return e[e.POSITION=0]="POSITION",e[e.COLOR=1]="COLOR",e[e.VERTEX_ID=2]="VERTEX_ID",e[e.PICKING_COLOR=3]="PICKING_COLOR",e[e.STROKE=4]="STROKE",e[e.OPACITY=5]="OPACITY",e[e.OFFSETS=6]="OFFSETS",e[e.ROTATION=7]="ROTATION",e[e.EXTRUSION_BASE=8]="EXTRUSION_BASE",e[e.SIZE=9]="SIZE",e[e.SHAPE=10]="SHAPE",e[e.EXTRUDE=11]="EXTRUDE",e[e.MAX=12]="MAX",e[e.NORMAL=13]="NORMAL",e[e.UV=14]="UV",e[e.LINEAR=15]="LINEAR",e}({});function Hw(e){switch(e){case"rotation":return{name:"Rotation",type:Qe.Attribute,descriptor:{name:"a_Rotation",shaderLocation:at.ROTATION,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:t=>{const{rotation:r=0}=t;return Array.isArray(r)?[r[0]]:[r]}}};case"stroke":return{name:"stroke",type:Qe.Attribute,descriptor:{name:"a_Stroke",shaderLocation:at.STROKE,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:4,update:t=>{const{stroke:r=[1,1,1,1]}=t;return r}}};case"opacity":return{name:"opacity",type:Qe.Attribute,descriptor:{name:"a_Opacity",shaderLocation:at.OPACITY,buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:1,update:t=>{const{opacity:r=1}=t;return[r]}}};case"extrusionBase":return{name:"extrusionBase",type:Qe.Attribute,descriptor:{name:"a_ExtrusionBase",shaderLocation:at.EXTRUSION_BASE,buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:1,update:t=>{const{extrusionBase:r=0}=t;return[r]}}};case"offsets":return{name:"offsets",type:Qe.Attribute,descriptor:{name:"a_Offsets",shaderLocation:at.OFFSETS,buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:2,update:t=>{const{offsets:r}=t;return r}}};case"thetaOffset":return{name:"thetaOffset",type:Qe.Attribute,descriptor:{name:"a_ThetaOffset",shaderLocation:15,buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:1,update:t=>{const{thetaOffset:r=1}=t;return[r]}}};default:return}}const{isNumber:Xw}=Ar,na={NONE:0,ENCODE:1,HIGHLIGHT:2};class Ww{constructor(){E(this,"pickingUniformMap",void 0)}pickOption2Array(){const t=[];return this.pickingUniformMap.forEach(r=>{Xw(r)?t.push(r):t.push(...r)}),t}updatePickOption(t,r){Object.keys(t).forEach(a=>{this.pickingUniformMap.set(a,t[a])});const n=r.getLayerConfig().pickingBuffer||0,i=Number(r.getShaderPickStat());this.pickingUniformMap.set("u_PickingBuffer",n),this.pickingUniformMap.set("u_shaderPick",i),r.getPickingUniformBuffer().subData({offset:0,data:this.pickOption2Array()})}apply(t,{styleAttributeService:r}){this.pickingUniformMap=new Map([["u_HighlightColor",[1,0,0,1]],["u_SelectColor",[1,0,0,1]],["u_PickingColor",[0,0,0]],["u_PickingStage",0],["u_CurrentSelectedId",[0,0,0]],["u_PickingThreshold",10],["u_PickingBuffer",0],["u_shaderPick",0],["u_activeMix",0]]),t.hooks.init.tapPromise("PixelPickingPlugin",()=>{const{enablePicking:n}=t.getLayerConfig();r.registerStyleAttribute({name:"pickingColor",type:Qe.Attribute,descriptor:{name:"a_PickingColor",shaderLocation:at.PICKING_COLOR,buffer:{data:[],type:g.FLOAT},size:3,update:i=>{const{id:o}=i;return n?Ra(o):[0,0,0]}}})}),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",()=>{const{enablePicking:n}=t.getLayerConfig();n&&t.isVisible()&&(this.updatePickOption({u_PickingStage:na.ENCODE},t),t.models.forEach(i=>i.addUniforms({u_PickingStage:na.ENCODE})))}),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",()=>{const{enablePicking:n}=t.getLayerConfig();n&&t.isVisible()&&(this.updatePickOption({u_PickingStage:na.HIGHLIGHT},t),t.models.forEach(i=>i.addUniforms({u_PickingStage:na.HIGHLIGHT})))}),t.hooks.beforeHighlight.tap("PixelPickingPlugin",n=>{const{highlightColor:i,activeMix:o=0}=t.getLayerConfig(),a=typeof i=="string"?Zt(i):i||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:_o(new Uint8Array(n))});const s={u_PickingStage:na.HIGHLIGHT,u_PickingColor:n,u_HighlightColor:a.map(u=>u*255),u_activeMix:o};this.updatePickOption(s,t),t.models.forEach(u=>u.addUniforms(s))}),t.hooks.beforeSelect.tap("PixelPickingPlugin",n=>{const{selectColor:i,selectMix:o=0}=t.getLayerConfig(),a=typeof i=="string"?Zt(i):i||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:_o(new Uint8Array(n))});const s={u_PickingStage:na.HIGHLIGHT,u_PickingColor:n,u_HighlightColor:a.map(u=>u*255),u_activeMix:o,u_CurrentSelectedId:n,u_SelectColor:a.map(u=>u*255)};this.updatePickOption(s,t),t.models.forEach(u=>u.addUniforms(s))})}}const jw=["mvt","geojsonvt","testTile"];function Gw(e){const t=e.getSource();return jw.includes(t.parser.type)}class $w{apply(t,{styleAttributeService:r}){t.hooks.init.tapPromise("RegisterStyleAttributePlugin",()=>{Gw(t)||this.registerBuiltinAttributes(r,t)})}registerBuiltinAttributes(t,r){if(r.type==="MaskLayer"){this.registerPositionAttribute(t);return}this.registerPositionAttribute(t),this.registerColorAttribute(t),this.registerVertexIdAttribute(t)}registerPositionAttribute(t){t.registerStyleAttribute({name:"position",type:Qe.Attribute,descriptor:{name:"a_Position",shaderLocation:at.POSITION,buffer:{data:[],type:g.FLOAT},size:3,update:(r,n,i)=>i.length===2?[i[0],i[1],0]:[i[0],i[1],i[2]]}})}registerColorAttribute(t){t.registerStyleAttribute({name:"color",type:Qe.Attribute,descriptor:{name:"a_Color",shaderLocation:at.COLOR,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:4,update:r=>{const{color:n}=r;return!n||!n.length?[1,1,1,1]:n}}})}registerVertexIdAttribute(t){t.registerStyleAttribute({name:"vertexId",type:Qe.Attribute,descriptor:{name:"a_vertexId",shaderLocation:at.VERTEX_ID,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:(r,n)=>[n]}})}}class Yw{constructor(){E(this,"cameraService",void 0),E(this,"coordinateSystemService",void 0),E(this,"rendererService",void 0),E(this,"mapService",void 0),E(this,"layerService",void 0)}apply(t,{rendererService:r,mapService:n,layerService:i,coordinateSystemService:o,cameraService:a}){this.rendererService=r,this.mapService=n,this.layerService=i,this.coordinateSystemService=o,this.cameraService=a;const s=this.mapService.version;let u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],l=[0,0],f;this.rendererService.uniformBuffers[0]||(f=this.rendererService.createBuffer({data:new Float32Array(16*4+4*7),isUBO:!0}),this.rendererService.uniformBuffers[0]=f),t.hooks.beforeRender.tap("ShaderUniformPlugin",()=>{const c=t.getLayerConfig().tileOrigin;this.coordinateSystemService.refresh(c),s==="GAODE2.x"&&(this.setLayerCenter(t),u=this.mapService.map.customCoords.getMVPMatrix(),l=this.mapService.getCustomCoordCenter(),t.getLayerUniformBuffer().subData({offset:0,data:new Uint8Array(new Float32Array([...u,...l]).buffer)}));const{width:h,height:d}=this.rendererService.getViewportSize(),{data:p,uniforms:v}=this.generateUBO(u,l,h,d);this.layerService.alreadyInRendering&&this.rendererService.uniformBuffers[0]&&this.rendererService.uniformBuffers[0].subData({offset:0,data:p}),this.rendererService.queryVerdorInfo()==="WebGL1"&&t.models.forEach(y=>{y.addUniforms(he(he({},v),{},{u_PickingBuffer:t.getLayerConfig().pickingBuffer||0,u_shaderPick:Number(t.getShaderPickStat())}))})})}setLayerCenter(t){t.coordCenter===void 0&&(t.coordCenter=t.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(t.coordCenter)}generateUBO(t,r,n,i){const o=this.cameraService.getProjectionMatrix(),a=this.cameraService.getViewMatrix(),s=this.cameraService.getViewProjectionMatrix(),u=this.cameraService.getModelMatrix(),l=this.coordinateSystemService.getViewportCenterProjection(),f=this.coordinateSystemService.getPixelsPerDegree(),c=this.cameraService.getZoom(),h=this.coordinateSystemService.getPixelsPerDegree2(),d=this.cameraService.getZoomScale(),p=this.coordinateSystemService.getPixelsPerMeter(),v=this.coordinateSystemService.getCoordinateSystem(),m=this.cameraService.getCameraPosition(),y=window.devicePixelRatio,A=this.coordinateSystemService.getViewportCenter(),T=[n,i],R=this.cameraService.getFocalDistance();return{data:[...a,...o,...s,...u,...l,...f,c,...h,d,...p,v,...m,y,...A,...T,R,0,0,0],uniforms:{[uo.ProjectionMatrix]:o,[uo.ViewMatrix]:a,[uo.ViewProjectionMatrix]:s,[uo.Zoom]:c,[uo.ZoomScale]:d,[uo.FocalDistance]:R,[uo.CameraPosition]:m,[lo.CoordinateSystem]:v,[lo.ViewportCenter]:A,[lo.ViewportCenterProjection]:l,[lo.PixelsPerDegree]:f,[lo.PixelsPerDegree2]:h,[lo.PixelsPerMeter]:p,[lo.Mvp]:t,u_sceneCenterMercator:r,u_ViewportSize:T,u_ModelMatrix:u,u_DevicePixelRatio:y}}}}class Zw{apply(t){t.hooks.beforeRender.tap("UpdateModelPlugin",()=>{t.layerModel&&t.layerModel.needUpdate().then(r=>{r&&t.renderLayers()})}),t.hooks.afterRender.tap("UpdateModelPlugin",()=>{t.layerModelNeedUpdate=!1})}}class qw{apply(t,{styleAttributeService:r}){t.hooks.init.tapPromise("UpdateStyleAttributePlugin",()=>{this.initStyleAttribute(t,{styleAttributeService:r})}),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",()=>{t.layerModelNeedUpdate||t.inited&&this.updateStyleAttribute(t,{styleAttributeService:r})})}updateStyleAttribute(t,{styleAttributeService:r}){const n=r.getLayerStyleAttributes()||[],i=r.getLayerStyleAttribute("filter");if(i&&i.needRegenerateVertices){t.layerModelNeedUpdate=!0,n.forEach(o=>o.needRegenerateVertices=!1);return}n.filter(o=>o.needRegenerateVertices).forEach(o=>{r.updateAttributeByFeatureRange(o.name,t.getEncodedData(),o.featureRange.startIndex,o.featureRange.endIndex,t),o.needRegenerateVertices=!1})}initStyleAttribute(t,{styleAttributeService:r}){(r.getLayerStyleAttributes()||[]).filter(i=>i.needRegenerateVertices).forEach(i=>{r.updateAttributeByFeatureRange(i.name,t.getEncodedData(),i.featureRange.startIndex,i.featureRange.endIndex),i.needRegenerateVertices=!1})}}function Kw(){return[new pD,new $w,new Ow,new dD,new Dw,new Nw,new qw,new Zw,new Vw,new Yw,new Pw,new zw,new Ww,new Fw]}const eA={[Bi.additive]:{enable:!0,func:{srcRGB:g.ONE,dstRGB:g.ONE,srcAlpha:1,dstAlpha:1}},[Bi.none]:{enable:!1},[Bi.normal]:{enable:!0,func:{srcRGB:g.SRC_ALPHA,dstRGB:g.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}},[Bi.subtractive]:{enable:!0,func:{srcRGB:g.ONE,dstRGB:g.ONE,srcAlpha:g.ZERO,dstAlpha:g.ONE_MINUS_SRC_COLOR},equation:{rgb:g.FUNC_SUBTRACT,alpha:g.FUNC_SUBTRACT}},[Bi.max]:{enable:!0,func:{srcRGB:g.ONE,dstRGB:g.ONE},equation:{rgb:g.MAX_EXT}},[Bi.min]:{enable:!0,func:{srcRGB:g.ONE,dstRGB:g.ONE},equation:{rgb:g.MIN_EXT}}};class Qw{constructor(t){E(this,"layer",void 0),this.layer=t}pickRender(t){const n=this.layer.getContainer().layerService,i=this.layer;if(i.tileLayer)return i.tileLayer.pickRender(t);i.hooks.beforePickingEncode.call(),n.renderTileLayerMask(i),i.renderModels({ispick:!0}),i.hooks.afterPickingEncode.call()}pick(t,r){var n=this;return pe(function*(){const o=n.layer.getContainer().pickingService;return t.type==="RasterLayer"?n.pickRasterLayer(t,r):(n.pickRender(r),o.pickFromPickingFBO(t,r))})()}pickRasterLayer(t,r,n){const i=this.layer.getContainer(),o=i.pickingService,a=i.mapService,s=this.layer.getSource().extent,u=Mb(r.lngLat,s),l={x:r.x,y:r.y,type:r.type,lngLat:r.lngLat,target:r,rasterValue:null},f=n||t;if(u){const c=this.readRasterValue(t,s,a,r.x,r.y);return l.rasterValue=c,o.triggerHoverOnLayer(f,l),!0}else return l.type=r.type==="mousemove"?"mouseout":"un"+r.type,o.triggerHoverOnLayer(f,he(he({},l),{},{type:"unpick"})),o.triggerHoverOnLayer(f,l),!1}readRasterValue(t,r,n,i,o){const a=t.getSource().data.dataArray[0],[s=0,u=0,l=10,f=-10]=r,c=n.lngLatToContainer([s,u]),h=n.lngLatToContainer([l,f]),d=h.x-c.x,p=c.y-h.y,v=[(i-c.x)/d,(o-h.y)/p],m=a.width||1,y=a.height||1,A=Math.floor(v[0]*m),T=Math.floor(v[1]*y),R=Math.max(0,T-1)*m+A;return a.data[R]}selectFeature(t){const r=this.layer,[n,i,o]=t;r.hooks.beforeSelect.call([n,i,o])}highlightPickedFeature(t){const[r,n,i]=t;this.layer.hooks.beforeHighlight.call([r,n,i])}getFeatureById(t){return this.layer.getSource().getFeatureById(t)}}class Jw{constructor(t){E(this,"layer",void 0),E(this,"rendererService",void 0),E(this,"colorTexture",void 0),E(this,"key",void 0),this.layer=t;const r=this.layer.getContainer();this.rendererService=r.rendererService}getColorTexture(t,r){const n=this.getTextureKey(t,r);return this.key===n?this.colorTexture:(this.createColorTexture(t,r),this.key=n,this.colorTexture)}createColorTexture(t,r){const{createTexture2D:n}=this.rendererService,i=this.getColorRampBar(t,r),o=n({data:new Uint8Array(i.data),width:i.width,height:i.height,flipY:!1,unorm:!0});return this.colorTexture=o,o}setColorTexture(t,r,n){this.key=this.getTextureKey(r,n),this.colorTexture=t}destroy(){var t;(t=this.colorTexture)===null||t===void 0||t.destroy()}getColorRampBar(t,r){switch(t.type){case"cat":return x2(t);case"quantize":return R2(t);case"custom":return C2(t,r);case"linear":return S2(t,r);default:return T2(t)}}getTextureKey(t,r){var n;return`${t.colors.join("_")}_${t==null||(n=t.positions)===null||n===void 0?void 0:n.join("_")}_${t.type}_${r==null?void 0:r.join("_")}`}}const e6=["passes"],t6=["moduleName","vertexShader","fragmentShader","inject","triangulation","styleOption","pickingEnabled"],{isEqual:gh,isFunction:fg,isNumber:hg,isObject:Hr,isPlainObject:r6,isUndefined:n6}=Ar;let dg=0;class za extends vn.exports.EventEmitter{get shaderModuleService(){return this.container.shaderModuleService}get cameraService(){return this.container.cameraService}get coordinateService(){return this.container.coordinateSystemService}get iconService(){return this.container.iconService}get fontService(){return this.container.fontService}get pickingService(){return this.container.pickingService}get rendererService(){return this.container.rendererService}get layerService(){return this.container.layerService}get debugService(){return this.container.debugService}get interactionService(){return this.container.interactionService}get mapService(){return this.container.mapService}get normalPassFactory(){return this.container.normalPassFactory}constructor(t={}){super(),E(this,"id",`${dg++}`),E(this,"name",`${dg}`),E(this,"parent",void 0),E(this,"coordCenter",void 0),E(this,"type",void 0),E(this,"visible",!0),E(this,"zIndex",0),E(this,"minZoom",void 0),E(this,"maxZoom",void 0),E(this,"inited",!1),E(this,"layerModelNeedUpdate",!1),E(this,"pickedFeatureID",null),E(this,"selectedFeatureID",null),E(this,"styleNeedUpdate",!1),E(this,"rendering",void 0),E(this,"forceRender",!1),E(this,"clusterZoom",0),E(this,"layerType",void 0),E(this,"triangulation",void 0),E(this,"layerPickService",void 0),E(this,"textureService",void 0),E(this,"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),E(this,"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),E(this,"hooks",{init:new YP,afterInit:new Gv,beforeRender:new Gv,beforeRenderData:new ZP,afterRender:new Jn,beforePickingEncode:new Jn,afterPickingEncode:new Jn,beforeHighlight:new Jn(["pickedColor"]),afterHighlight:new Jn,beforeSelect:new Jn(["pickedColor"]),afterSelect:new Jn,beforeDestroy:new Jn,afterDestroy:new Jn}),E(this,"models",[]),E(this,"multiPassRenderer",void 0),E(this,"plugins",void 0),E(this,"startInit",!1),E(this,"sourceOption",void 0),E(this,"layerModel",void 0),E(this,"shapeOption",void 0),E(this,"tileLayer",void 0),E(this,"layerChildren",[]),E(this,"masks",[]),E(this,"configService",J1),E(this,"styleAttributeService",void 0),E(this,"layerSource",void 0),E(this,"postProcessingPassFactory",void 0),E(this,"animateOptions",{enable:!1}),E(this,"container",void 0),E(this,"encodedData",void 0),E(this,"currentPickId",null),E(this,"rawConfig",void 0),E(this,"needUpdateConfig",void 0),E(this,"encodeStyleAttribute",{}),E(this,"enableShaderEncodeStyles",[]),E(this,"enableDataEncodeStyles",[]),E(this,"pendingStyleAttributes",[]),E(this,"scaleOptions",{}),E(this,"animateStartTime",void 0),E(this,"animateStatus",!1),E(this,"isDestroyed",!1),E(this,"uniformBuffers",[]),E(this,"encodeDataLength",0),E(this,"sourceEvent",()=>{this.dataState.dataSourceNeedUpdate=!0;const r=this.getLayerConfig();r&&r.autoFit&&this.fitBounds(r.fitBoundsOptions),this.layerSource.getSourceCfg().autoRender&&setTimeout(()=>{this.reRender()},10)}),this.name=t.name||this.id,this.zIndex=t.zIndex||0,this.rawConfig=t,this.masks=t.maskLayers||[]}addMask(t){this.masks.push(t),this.updateLayerConfig({maskLayers:this.masks}),this.enableMask()}removeMask(t){const r=this.masks.indexOf(t);r>-1&&this.masks.splice(r,1),this.updateLayerConfig({maskLayers:this.masks})}disableMask(){this.updateLayerConfig({enableMask:!1})}enableMask(){this.updateLayerConfig({enableMask:!0})}addMaskLayer(t){this.masks.push(t)}removeMaskLayer(t){const r=this.masks.indexOf(t);r>-1&&this.masks.splice(r,1),t.destroy()}getAttribute(t){return this.styleAttributeService.getLayerStyleAttribute(t)}getLayerConfig(){return this.configService.getLayerConfig(this.id)}updateLayerConfig(t){if(Object.keys(t).map(r=>{r in this.rawConfig&&(this.rawConfig[r]=t[r])}),!this.startInit)this.needUpdateConfig=he(he({},this.needUpdateConfig),t);else{const r=this.container.id;this.configService.setLayerConfig(r,this.id,he(he(he({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),t)),this.needUpdateConfig={}}}setContainer(t){this.container=t}getContainer(){return this.container}addPlugin(t){return this.plugins.push(t),this}init(){var t=this;return pe(function*(){const r=t.container.id;t.startInit=!0,t.configService.setLayerConfig(r,t.id,t.rawConfig),t.layerType=t.rawConfig.layerType;const{enableMultiPassRenderer:n,passes:i}=t.getLayerConfig();n&&i!==null&&i!==void 0&&i.length&&i.length>0&&t.mapService.on("mapAfterFrameChange",()=>{t.renderLayers()}),t.postProcessingPassFactory=t.container.postProcessingPassFactory,t.styleAttributeService=t.container.styleAttributeService,n&&(t.multiPassRenderer=t.container.multiPassRenderer,t.multiPassRenderer.setLayer(t)),t.pendingStyleAttributes.forEach(({attributeName:o,attributeField:a,attributeValues:s,updateOptions:u})=>{t.styleAttributeService.updateStyleAttribute(o,{scale:he({field:a},t.splitValuesAndCallbackInAttribute(s,a?void 0:t.getLayerConfig()[o]))},u)}),t.pendingStyleAttributes=[],t.plugins=Kw();for(const o of t.plugins)o.apply(t,t.container);t.layerPickService=new Qw(t),t.textureService=new Jw(t),t.log(Br.LayerInitStart),yield t.hooks.init.promise(),t.log(Br.LayerInitEnd),t.inited=!0,t.emit("inited",{target:t,type:"inited"}),t.emit("add",{target:t,type:"add"}),t.hooks.afterInit.call()})()}log(t,r="init"){var n;if(this.tileLayer||this.isTileLayer)return;const i=`${this.id}.${r}.${t}`,o={id:this.id,type:this.type};(n=this.debugService)===null||n===void 0||n.log(i,o)}updateModelData(t){t.attributes&&t.elements?this.models.map(r=>{r.updateAttributesAndElements(t.attributes,t.elements)}):console.warn("data error")}setLayerPickService(t){this.layerPickService=t}prepareBuildModel(){Object.keys(this.needUpdateConfig||{}).length!==0&&this.updateLayerConfig({});const{animateOption:t}=this.getLayerConfig();t!=null&&t.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}color(t,r,n){return this.updateStyleAttribute("color",t,r,n),this}texture(t,r,n){return this.updateStyleAttribute("texture",t,r,n),this}rotate(t,r,n){return this.updateStyleAttribute("rotate",t,r,n),this}size(t,r,n){return this.updateStyleAttribute("size",t,r,n),this}filter(t,r,n){const i=this.updateStyleAttribute("filter",t,r,n);return this.dataState.dataSourceNeedUpdate=i&&this.inited,this}shape(t,r,n){this.shapeOption={field:t,values:r};const i=this.updateStyleAttribute("shape",t,r,n);return this.dataState.dataSourceNeedUpdate=i&&this.inited,this}label(t,r,n){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:t,attributeValues:r,updateOptions:n}),this}animate(t){let r={};return Hr(t)?(r.enable=!0,r=he(he({},r),t)):r.enable=t,this.updateLayerConfig({animateOption:r}),this}source(t,r){return(t==null?void 0:t.type)==="source"?(this.setSource(t),this):(this.sourceOption={data:t,options:r},this.clusterZoom=0,this)}setData(t,r){return this.inited?(this.dataUpdatelog(),this.layerSource.setData(t,r)):this.on("inited",()=>{this.dataUpdatelog(),this.layerSource.setData(t,r)}),this}dataUpdatelog(){this.log(Br.SourceInitStart,jr.UPDATE),this.layerSource.once("update",()=>{this.log(Br.SourceInitEnd,jr.UPDATE)})}style(t){const{passes:r}=t,n=$n(t,e6);r&&Qy(r).forEach(o=>{const a=this.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(o[0]);a&&a.updateOptions(o[1])}),n.borderColor&&(n.stroke=n.borderColor),n.borderWidth&&(n.strokeWidth=n.borderWidth);const i=n;return Object.keys(n).forEach(o=>{const a=n[o];Array.isArray(a)&&a.length===2&&!hg(a[0])&&!hg(a[1])&&(i[o]={field:a[0],value:a[1]})}),this.encodeStyle(i),this.updateLayerConfig(i),this}encodeStyle(t){Object.keys(t).forEach(r=>{[...this.enableShaderEncodeStyles,...this.enableDataEncodeStyles].includes(r)&&r6(t[r])&&(t[r].field||t[r].value)&&!gh(this.encodeStyleAttribute[r],t[r])?(this.encodeStyleAttribute[r]=t[r],this.updateStyleAttribute(r,t[r].field,t[r].value),this.inited&&(this.dataState.dataMappingNeedUpdate=!0)):this.encodeStyleAttribute[r]&&(delete this.encodeStyleAttribute[r],this.dataState.dataSourceNeedUpdate=!0)})}scale(t,r){const n=he({},this.scaleOptions);if(Hr(t)?this.scaleOptions=he(he({},this.scaleOptions),t):this.scaleOptions[t]=r,this.styleAttributeService&&!gh(n,this.scaleOptions)){const i=Hr(t)?t:{[t]:r};this.styleAttributeService.updateScaleAttribute(i)}return this}renderLayers(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}prerender(){}render(t={}){return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(t),this))}renderMultiPass(){var t=this;return pe(function*(){t.encodeDataLength<=0&&!t.forceRender||(t.multiPassRenderer&&t.multiPassRenderer.getRenderFlag()?yield t.multiPassRenderer.render():(t.multiPassRenderer,t.renderModels()))})()}active(t){const r={};return r.enableHighlight=Hr(t)?!0:t,Hr(t)?(r.enableHighlight=!0,t.color&&(r.highlightColor=t.color),t.mix&&(r.activeMix=t.mix)):r.enableHighlight=!!t,this.updateLayerConfig(r),this}setActive(t,r){if(Hr(t)){const{x:n=0,y:i=0}=t;this.updateLayerConfig({highlightColor:Hr(r)?r.color:this.getLayerConfig().highlightColor,activeMix:Hr(r)?r.mix:this.getLayerConfig().activeMix}),this.pick({x:n,y:i})}else this.updateLayerConfig({pickedFeatureID:t,highlightColor:Hr(r)?r.color:this.getLayerConfig().highlightColor,activeMix:Hr(r)?r.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(Ra(t)).then(()=>{setTimeout(()=>{this.reRender()},1)})}select(t){const r={};return r.enableSelect=Hr(t)?!0:t,Hr(t)?(r.enableSelect=!0,t.color&&(r.selectColor=t.color),t.mix&&(r.selectMix=t.mix)):r.enableSelect=!!t,this.updateLayerConfig(r),this}setSelect(t,r){if(Hr(t)){const{x:n=0,y:i=0}=t;this.updateLayerConfig({selectColor:Hr(r)?r.color:this.getLayerConfig().selectColor,selectMix:Hr(r)?r.mix:this.getLayerConfig().selectMix}),this.pick({x:n,y:i})}else this.updateLayerConfig({pickedFeatureID:t,selectColor:Hr(r)?r.color:this.getLayerConfig().selectColor,selectMix:Hr(r)?r.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Ra(t)).then(()=>{setTimeout(()=>{this.reRender()},1)})}setBlend(t){return this.updateLayerConfig({blend:t}),this.reRender(),this}show(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}hide(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}setIndex(t){return this.zIndex=t,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}setCurrentPickId(t){this.currentPickId=t}getCurrentPickId(){return this.currentPickId}setCurrentSelectedId(t){this.selectedFeatureID=t}getCurrentSelectedId(){return this.selectedFeatureID}isVisible(){const t=this.mapService.getZoom(),{visible:r,minZoom:n=-1/0,maxZoom:i=1/0}=this.getLayerConfig();return!!r&&t>=n&&t<i}setMultiPass(t,r){if(this.updateLayerConfig({enableMultiPassRenderer:t}),r&&this.updateLayerConfig({passes:r}),t){const{passes:n=[]}=this.getLayerConfig();this.multiPassRenderer=Jy(this,n,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);const{width:i,height:o}=this.rendererService.getViewportSize();this.multiPassRenderer.resize(i,o)}return this}setMinZoom(t){return this.updateLayerConfig({minZoom:t}),this}getMinZoom(){const{minZoom:t}=this.getLayerConfig();return t}getMaxZoom(){const{maxZoom:t}=this.getLayerConfig();return t}get(t){return this.getLayerConfig()[t]}setMaxZoom(t){return this.updateLayerConfig({maxZoom:t}),this}setAutoFit(t){return this.updateLayerConfig({autoFit:t}),this}fitBounds(t){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;const n=this.getSource().extent;return n.some(o=>Math.abs(o)===1/0)?this:(this.mapService.fitBounds([[n[0],n[1]],[n[2],n[3]]],t),this)}destroy(t=!0){var r,n,i,o,a;if(this.isDestroyed)return;(r=this.layerModel)===null||r===void 0||r.uniformBuffers.forEach(u=>{u.destroy()}),this.layerChildren.map(u=>u.destroy(!1)),this.layerChildren=[];const{maskfence:s}=this.getLayerConfig();s&&(this.masks.map(u=>u.destroy(!1)),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(n=this.multiPassRenderer)===null||n===void 0||n.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(i=this.layerModel)===null||i===void 0||i.clearModels(t),(o=this.tileLayer)===null||o===void 0||o.destroy(),this.models=[],(a=this.debugService)===null||a===void 0||a.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}clear(){this.styleAttributeService.clearAllAttributes()}clearModels(){var t;this.models.forEach(r=>r.destroy()),(t=this.layerModel)===null||t===void 0||t.clearModels(),this.models=[]}isDirty(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(t=>t.needRescale||t.needRemapping||t.needRegenerateVertices).length}setSource(t){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=t,this.clusterZoom=0,this.inited&&this.layerSource.cluster){const r=this.mapService.getZoom();this.layerSource.updateClusterData(r)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",({type:r})=>{if(this.coordCenter===void 0){var n;const i=this.layerSource.center;this.coordCenter=i,(n=this.mapService)!==null&&n!==void 0&&n.setCoordCenter&&this.mapService.setCoordCenter(i)}if(r==="update"){if(this.tileLayer){this.tileLayer.reload();return}this.sourceEvent()}})}getSource(){return this.layerSource}getScaleOptions(){return this.scaleOptions}setEncodedData(t){this.encodedData=t,this.encodeDataLength=t.length}getEncodedData(){return this.encodedData}getScale(t){return this.styleAttributeService.getLayerAttributeScale(t)}getLegend(t){var r,n,i;const o=this.styleAttributeService.getLayerStyleAttribute(t);return{type:(n=((o==null||(r=o.scale)===null||r===void 0?void 0:r.scalers)||[])[0])===null||n===void 0||(n=n.option)===null||n===void 0?void 0:n.type,field:o==null||(i=o.scale)===null||i===void 0?void 0:i.field,items:this.getLegendItems(t)}}getLegendItems(t){const r=this.styleAttributeService.getLayerAttributeScale(t);return r?r.invertExtent?r.range().map(i=>({value:r.invertExtent(i),[t]:i})):r.ticks?r.ticks().map(i=>({value:i,[t]:r(i)})):r!=null&&r.domain?r.domain().filter(i=>!n6(i)).map(i=>({value:i,[t]:r(i)})):[]:[]}pick({x:t,y:r}){this.interactionService.triggerHover({x:t,y:r})}boxSelect(t,r){this.pickingService.boxPickLayer(this,t,r)}buildLayerModel(t){var r=this;return pe(function*(){const{moduleName:n,vertexShader:i,fragmentShader:o,inject:a,triangulation:s,styleOption:u,pickingEnabled:l=!0}=t,f=$n(t,t6);r.shaderModuleService.registerModule(n,{vs:i,fs:o,inject:a});const{vs:c,fs:h,uniforms:d}=r.shaderModuleService.getModule(n),{createModel:p}=r.rendererService;return new Promise(v=>{const{attributes:m,elements:y,count:A}=r.styleAttributeService.createAttributesAndIndices(r.encodedData,s,u,r),T=[...r.layerModel.uniformBuffers,...r.rendererService.uniformBuffers,r.getLayerUniformBuffer()];l&&T.push(r.getPickingUniformBuffer());const R=he({attributes:m,uniforms:d,fs:h,vs:c,elements:y,blend:eA[Bi.normal],uniformBuffers:T,textures:r.layerModel.textures},f);A&&(R.count=A);const b=p(R);v(b)})})()}createAttributes(t){const{triangulation:r}=t,{attributes:n}=this.styleAttributeService.createAttributes(this.encodedData,r);return n}getTime(){return this.layerService.clock.getDelta()}setAnimateStartTime(){this.animateStartTime=this.layerService.clock.getElapsedTime()}stopAnimate(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}getLayerAnimateTime(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}needPick(t){const{enableHighlight:r=!0,enableSelect:n=!0}=this.getLayerConfig();let i=this.eventNames().indexOf(t)!==-1||this.eventNames().indexOf("un"+t)!==-1;return(t==="click"||t==="dblclick")&&n&&(i=!0),t==="mousemove"&&(r||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(i=!0),this.isVisible()&&i}buildModels(){return pe(function*(){throw new Error("Method not implemented.")})()}rebuildModels(){var t=this;return pe(function*(){yield t.buildModels()})()}renderMulPass(t){return pe(function*(){yield t.render()})()}renderModels(t={}){return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach(r=>{r.draw({uniforms:this.layerModel.getUninforms(),blend:this.layerModel.getBlend(),stencil:this.layerModel.getStencil(t),textures:this.layerModel.textures},(t==null?void 0:t.ispick)||!1)}),this.hooks.afterRender.call(),this)}updateStyleAttribute(t,r,n,i){const o=this.configService.getAttributeConfig(this.id)||{};return gh(o[t],{field:r,values:n})?!1:(["color","size","texture","rotate","filter","label","shape"].indexOf(t)!==-1&&this.configService.setAttributeConfig(this.id,{[t]:{field:r,values:n}}),this.startInit?this.styleAttributeService.updateStyleAttribute(t,{scale:he({field:r},this.splitValuesAndCallbackInAttribute(n,this.getLayerConfig()[r]))},i):this.pendingStyleAttributes.push({attributeName:t,attributeField:r,attributeValues:n,updateOptions:i}),!0)}getLayerAttributeConfig(){return this.configService.getAttributeConfig(this.id)}getShaderPickStat(){return this.layerService.getShaderPickStat()}setEarthTime(t){console.warn("empty fn")}processData(t){return t}getModelType(){throw new Error("Method not implemented.")}getDefaultConfig(){return{}}initLayerModels(){var t=this;return pe(function*(){t.models.forEach(i=>i.destroy()),t.models=[],t.uniformBuffers.forEach(i=>{i.destroy()}),t.uniformBuffers=[];const r=t.rendererService.createBuffer({data:new Float32Array(16+4).fill(0),isUBO:!0});t.uniformBuffers.push(r);const n=t.rendererService.createBuffer({data:new Float32Array(20).fill(0),isUBO:!0});t.uniformBuffers.push(n),t.models=yield t.layerModel.initModels()})()}getLayerUniformBuffer(){return this.uniformBuffers[0]}getPickingUniformBuffer(){return this.uniformBuffers[1]}reRender(){this.inited&&this.layerService.reRender()}splitValuesAndCallbackInAttribute(t){return{values:fg(t)?void 0:t,callback:fg(t)?t:void 0}}}function i6(e,t){return{enable:e,mask:255,func:{cmp:g.EQUAL,ref:t?1:0,mask:1}}}function pg(e){return e.maskOperation===Mc.OR?{enable:!0,mask:255,func:{cmp:g.ALWAYS,ref:1,mask:255},opFront:{fail:g.KEEP,zfail:g.REPLACE,zpass:g.REPLACE}}:{enable:!0,mask:255,func:{cmp:e.stencilType===ho.SINGLE||e.stencilIndex===0?g.ALWAYS:g.LESS,ref:e.stencilType===ho.SINGLE?1:e.stencilIndex===0?2:1,mask:255},opFront:{fail:g.KEEP,zfail:g.REPLACE,zpass:g.REPLACE}}}const o6={opacity:1,stroke:[1,0,0,1],offsets:[0,0],rotation:0,extrusionBase:0,strokeOpacity:1,thetaOffset:.314},vl={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2",rotation:"float",extrusionBase:"float",strokeOpacity:"float",thetaOffset:"float"};function _g(e){return Math.max(Math.ceil(e/4)*4,4)}const Eh={opacity:at.OPACITY,stroke:at.STROKE,offsets:at.OFFSETS,rotation:at.ROTATION,extrusionBase:at.EXTRUSION_BASE,thetaOffset:15};class Qt{constructor(t){E(this,"triangulation",void 0),E(this,"uniformBuffers",[]),E(this,"textures",[]),E(this,"createTexture2D",void 0),E(this,"preStyleAttribute",{}),E(this,"encodeStyleAttribute",{}),E(this,"layer",void 0),E(this,"dataTexture",void 0),E(this,"DATA_TEXTURE_WIDTH",void 0),E(this,"dataTextureTest",void 0),E(this,"configService",void 0),E(this,"shaderModuleService",void 0),E(this,"rendererService",void 0),E(this,"iconService",void 0),E(this,"fontService",void 0),E(this,"styleAttributeService",void 0),E(this,"mapService",void 0),E(this,"cameraService",void 0),E(this,"layerService",void 0),E(this,"pickingService",void 0),E(this,"attributeUnifoms",void 0),E(this,"commonUnifoms",void 0),this.layer=t,this.configService=t.getContainer().globalConfigService,this.rendererService=t.getContainer().rendererService,this.pickingService=t.getContainer().pickingService,this.shaderModuleService=t.getContainer().shaderModuleService,this.styleAttributeService=t.getContainer().styleAttributeService,this.mapService=t.getContainer().mapService,this.iconService=t.getContainer().iconService,this.fontService=t.getContainer().fontService,this.cameraService=t.getContainer().cameraService,this.layerService=t.getContainer().layerService,this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();const{createTexture2D:r}=this.rendererService;this.createTexture2D=r}getBlend(){const{blend:t="normal"}=this.layer.getLayerConfig();return eA[Bi[t]]}getStencil(t){const{mask:r=!1,maskInside:n=!0,enableMask:i,maskOperation:o=Mc.AND}=this.layer.getLayerConfig();if(this.layer.type==="MaskLayer")return pg({isStencil:!0,stencilType:ho.SINGLE});if(t.isStencil)return pg(he(he({},t),{},{maskOperation:o}));const a=r||i&&this.layer.masks.length!==0||this.layer.tileMask!==void 0;return i6(a,n)}getDefaultStyle(){return{}}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());this.updateStyleUnifoms();const n=he(he({},r.uniformsOption),t.uniformsOption);return Object.keys(n).forEach(i=>{typeof n[i]=="boolean"&&(n[i]=n[i]?1:0)}),!this.rendererService.hasOwnProperty("device")&&this.textures&&this.textures.length===1&&(n.u_texture=this.textures[0]),n}getAnimateUniforms(){return{}}needUpdate(){return pe(function*(){return!1})()}buildModels(){return pe(function*(){throw new Error("Method not implemented.")})()}initModels(){return pe(function*(){throw new Error("Method not implemented.")})()}clearModels(t=!0){}getAttribute(){throw new Error("Method not implemented.")}prerender(){}render(t){throw new Error("Method not implemented.")}registerBuiltinAttributes(){throw new Error("Method not implemented.")}animateOption2Array(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}startModelAnimate(){const{animateOption:t}=this.layer.getLayerConfig();t.enable&&this.layer.setAnimateStartTime()}getInject(){const t=this.layer.encodeStyleAttribute;let r="";const n=[];this.layer.enableShaderEncodeStyles.forEach(a=>{t[a]?r+=`#define USE_ATTRIBUTE_${a.toUpperCase()} 0.0; 

`:n.push(`  ${vl[a]} u_${a};`),Eh[a],r+=`
          #ifdef USE_ATTRIBUTE_${a.toUpperCase()}
          layout(location = ${Eh[a]}) in ${vl[a]} a_${a.charAt(0).toUpperCase()+a.slice(1)};
        #endif

        `});const i=n.length?`
layout(std140) uniform AttributeUniforms {
${n.join(`
`)}
};
    `:"";r+=i;let o="";return this.layer.enableShaderEncodeStyles.forEach(a=>{o+=`

    #ifdef USE_ATTRIBUTE_${a.toUpperCase()}
      ${vl[a]} ${a}  = a_${a.charAt(0).toUpperCase()+a.slice(1)};
    #else
      ${vl[a]} ${a} = u_${a};
    #endif

    `}),{"vs:#decl":r,"fs:#decl":i,"vs:#main-start":o}}getStyleAttribute(){const t={};return this.layer.enableShaderEncodeStyles.forEach(r=>{if(!this.layer.encodeStyleAttribute[r]){const n=this.layer.getLayerConfig()[r];let i=typeof n>"u"?o6[r]:n;r==="stroke"&&(i=Zt(i)),t["u_"+r]=i}}),t}registerStyleAttribute(){Object.keys(this.layer.encodeStyleAttribute).forEach(t=>{const r=Hw(t);r&&(this.styleAttributeService.registerStyleAttribute(r),r.descriptor&&(r.descriptor.shaderLocation=Eh[t]))})}updateEncodeAttribute(t,r){this.encodeStyleAttribute[t]=r}initUniformsBuffer(){const t=this.getUniformsBufferInfo(this.getStyleAttribute()),r=this.getCommonUniformsInfo();t.uniformsLength!==0&&(this.attributeUnifoms=this.rendererService.createBuffer({data:new Float32Array(_g(t.uniformsLength)).fill(0),isUBO:!0}),this.uniformBuffers.push(this.attributeUnifoms)),r.uniformsLength!==0&&(this.commonUnifoms=this.rendererService.createBuffer({data:new Float32Array(_g(r.uniformsLength)).fill(0),isUBO:!0}),this.uniformBuffers.push(this.commonUnifoms))}getUniformsBufferInfo(t){let r=0;const n=[];return Object.values(t).forEach(i=>{Array.isArray(i)?(n.push(...i),r+=i.length):typeof i=="number"?(n.push(i),r+=1):typeof i=="boolean"&&(n.push(Number(i)),r+=1)}),{uniformsOption:t,uniformsLength:r,uniformsArray:n}}getCommonUniformsInfo(){return{uniformsLength:0,uniformsArray:[],uniformsOption:{}}}updateStyleUnifoms(){var t,r;const{uniformsArray:n}=this.getUniformsBufferInfo(this.getStyleAttribute()),{uniformsArray:i}=this.getCommonUniformsInfo();(t=this.attributeUnifoms)===null||t===void 0||t.subData({offset:0,data:new Uint8Array(new Float32Array(n).buffer)}),(r=this.commonUnifoms)===null||r===void 0||r.subData({offset:0,data:new Uint8Array(new Float32Array(i).buffer)})}}let vg=function(e){return e.VERTICAL="vertical",e.HORIZONTAL="horizontal",e}({}),a6=function(e){return e.NORMAL="normal",e.REPLACE="replace",e}({}),vp=function(e){return e[e.pixel=0]="pixel",e[e.meter=1]="meter",e}({});var ii={exports:{}};ii.exports=Dc;ii.exports.default=Dc;function Dc(e,t,r){r=r||2;var n=t&&t.length,i=n?t[0]*r:e.length,o=tA(e,0,i,r,!0),a=[];if(!o||o.next===o.prev)return a;var s,u,l,f,c,h,d;if(n&&(o=f6(e,t,o,r)),e.length>80*r){s=l=e[0],u=f=e[1];for(var p=r;p<i;p+=r)c=e[p],h=e[p+1],c<s&&(s=c),h<u&&(u=h),c>l&&(l=c),h>f&&(f=h);d=Math.max(l-s,f-u),d=d!==0?32767/d:0}return fu(o,a,r,s,u,d,0),a}function tA(e,t,r,n,i){var o,a;if(i===_d(e,t,r,n)>0)for(o=t;o<r;o+=n)a=mg(o,e[o],e[o+1],a);else for(o=r-n;o>=t;o-=n)a=mg(o,e[o],e[o+1],a);return a&&Bc(a,a.next)&&(du(a),a=a.next),a}function Eo(e,t){if(!e)return e;t||(t=e);var r=e,n;do if(n=!1,!r.steiner&&(Bc(r,r.next)||cr(r.prev,r,r.next)===0)){if(du(r),r=t=r.prev,r===r.next)break;n=!0}else r=r.next;while(n||r!==t);return t}function fu(e,t,r,n,i,o,a){if(!!e){!a&&o&&v6(e,n,i,o);for(var s=e,u,l;e.prev!==e.next;){if(u=e.prev,l=e.next,o?u6(e,n,i,o):s6(e)){t.push(u.i/r|0),t.push(e.i/r|0),t.push(l.i/r|0),du(e),e=l.next,s=l.next;continue}if(e=l,e===s){a?a===1?(e=l6(Eo(e),t,r),fu(e,t,r,n,i,o,2)):a===2&&c6(e,t,r,n,i,o):fu(Eo(e),t,r,n,i,o,1);break}}}}function s6(e){var t=e.prev,r=e,n=e.next;if(cr(t,r,n)>=0)return!1;for(var i=t.x,o=r.x,a=n.x,s=t.y,u=r.y,l=n.y,f=i<o?i<a?i:a:o<a?o:a,c=s<u?s<l?s:l:u<l?u:l,h=i>o?i>a?i:a:o>a?o:a,d=s>u?s>l?s:l:u>l?u:l,p=n.next;p!==t;){if(p.x>=f&&p.x<=h&&p.y>=c&&p.y<=d&&ha(i,s,o,u,a,l,p.x,p.y)&&cr(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function u6(e,t,r,n){var i=e.prev,o=e,a=e.next;if(cr(i,o,a)>=0)return!1;for(var s=i.x,u=o.x,l=a.x,f=i.y,c=o.y,h=a.y,d=s<u?s<l?s:l:u<l?u:l,p=f<c?f<h?f:h:c<h?c:h,v=s>u?s>l?s:l:u>l?u:l,m=f>c?f>h?f:h:c>h?c:h,y=dd(d,p,t,r,n),A=dd(v,m,t,r,n),T=e.prevZ,R=e.nextZ;T&&T.z>=y&&R&&R.z<=A;){if(T.x>=d&&T.x<=v&&T.y>=p&&T.y<=m&&T!==i&&T!==a&&ha(s,f,u,c,l,h,T.x,T.y)&&cr(T.prev,T,T.next)>=0||(T=T.prevZ,R.x>=d&&R.x<=v&&R.y>=p&&R.y<=m&&R!==i&&R!==a&&ha(s,f,u,c,l,h,R.x,R.y)&&cr(R.prev,R,R.next)>=0))return!1;R=R.nextZ}for(;T&&T.z>=y;){if(T.x>=d&&T.x<=v&&T.y>=p&&T.y<=m&&T!==i&&T!==a&&ha(s,f,u,c,l,h,T.x,T.y)&&cr(T.prev,T,T.next)>=0)return!1;T=T.prevZ}for(;R&&R.z<=A;){if(R.x>=d&&R.x<=v&&R.y>=p&&R.y<=m&&R!==i&&R!==a&&ha(s,f,u,c,l,h,R.x,R.y)&&cr(R.prev,R,R.next)>=0)return!1;R=R.nextZ}return!0}function l6(e,t,r){var n=e;do{var i=n.prev,o=n.next.next;!Bc(i,o)&&rA(i,n,n.next,o)&&hu(i,o)&&hu(o,i)&&(t.push(i.i/r|0),t.push(n.i/r|0),t.push(o.i/r|0),du(n),du(n.next),n=e=o),n=n.next}while(n!==e);return Eo(n)}function c6(e,t,r,n,i,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&E6(a,s)){var u=nA(a,s);a=Eo(a,a.next),u=Eo(u,u.next),fu(a,t,r,n,i,o,0),fu(u,t,r,n,i,o,0);return}s=s.next}a=a.next}while(a!==e)}function f6(e,t,r,n){var i=[],o,a,s,u,l;for(o=0,a=t.length;o<a;o++)s=t[o]*n,u=o<a-1?t[o+1]*n:e.length,l=tA(e,s,u,n,!1),l===l.next&&(l.steiner=!0),i.push(g6(l));for(i.sort(h6),o=0;o<i.length;o++)r=d6(i[o],r);return r}function h6(e,t){return e.x-t.x}function d6(e,t){var r=p6(e,t);if(!r)return t;var n=nA(r,e);return Eo(n,n.next),Eo(r,r.next)}function p6(e,t){var r=t,n=e.x,i=e.y,o=-1/0,a;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var s=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=n&&s>o&&(o=s,a=r.x<r.next.x?r:r.next,s===n))return a}r=r.next}while(r!==t);if(!a)return null;var u=a,l=a.x,f=a.y,c=1/0,h;r=a;do n>=r.x&&r.x>=l&&n!==r.x&&ha(i<f?n:o,i,l,f,i<f?o:n,i,r.x,r.y)&&(h=Math.abs(i-r.y)/(n-r.x),hu(r,e)&&(h<c||h===c&&(r.x>a.x||r.x===a.x&&_6(a,r)))&&(a=r,c=h)),r=r.next;while(r!==u);return a}function _6(e,t){return cr(e.prev,e,t.prev)<0&&cr(t.next,e,e.next)<0}function v6(e,t,r,n){var i=e;do i.z===0&&(i.z=dd(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,m6(i)}function m6(e){var t,r,n,i,o,a,s,u,l=1;do{for(r=e,e=null,o=null,a=0;r;){for(a++,n=r,s=0,t=0;t<l&&(s++,n=n.nextZ,!!n);t++);for(u=l;s>0||u>0&&n;)s!==0&&(u===0||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,u--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;r=n}o.nextZ=null,l*=2}while(a>1);return e}function dd(e,t,r,n,i){return e=(e-r)*i|0,t=(t-n)*i|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function g6(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function ha(e,t,r,n,i,o,a,s){return(i-a)*(t-s)>=(e-a)*(o-s)&&(e-a)*(n-s)>=(r-a)*(t-s)&&(r-a)*(o-s)>=(i-a)*(n-s)}function E6(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!y6(e,t)&&(hu(e,t)&&hu(t,e)&&A6(e,t)&&(cr(e.prev,e,t.prev)||cr(e,t.prev,t))||Bc(e,t)&&cr(e.prev,e,e.next)>0&&cr(t.prev,t,t.next)>0)}function cr(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Bc(e,t){return e.x===t.x&&e.y===t.y}function rA(e,t,r,n){var i=gl(cr(e,t,r)),o=gl(cr(e,t,n)),a=gl(cr(r,n,e)),s=gl(cr(r,n,t));return!!(i!==o&&a!==s||i===0&&ml(e,r,t)||o===0&&ml(e,n,t)||a===0&&ml(r,e,n)||s===0&&ml(r,t,n))}function ml(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function gl(e){return e>0?1:e<0?-1:0}function y6(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&rA(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function hu(e,t){return cr(e.prev,e,e.next)<0?cr(e,t,e.next)>=0&&cr(e,e.prev,t)>=0:cr(e,t,e.prev)<0||cr(e,e.next,t)<0}function A6(e,t){var r=e,n=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==e);return n}function nA(e,t){var r=new pd(e.i,e.x,e.y),n=new pd(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function mg(e,t,r,n){var i=new pd(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function du(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function pd(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Dc.deviation=function(e,t,r,n){var i=t&&t.length,o=i?t[0]*r:e.length,a=Math.abs(_d(e,0,o,r));if(i)for(var s=0,u=t.length;s<u;s++){var l=t[s]*r,f=s<u-1?t[s+1]*r:e.length;a-=Math.abs(_d(e,l,f,r))}var c=0;for(s=0;s<n.length;s+=3){var h=n[s]*r,d=n[s+1]*r,p=n[s+2]*r;c+=Math.abs((e[h]-e[p])*(e[d+1]-e[h+1])-(e[h]-e[d])*(e[p+1]-e[h+1]))}return a===0&&c===0?0:Math.abs((c-a)/a)};function _d(e,t,r,n){for(var i=0,o=t,a=r-n;o<r;o+=n)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}Dc.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)r.vertices.push(e[i][o][a]);i>0&&(n+=e[i-1].length,r.holes.push(n))}return r};const iA=100;function gg(e){return e/180*Math.acos(-1)}function oA(e){const t=gg(e[0])+Math.PI/2,r=gg(e[1]),n=iA+Math.random()*.4,i=n*Math.cos(r)*Math.cos(t),o=n*Math.cos(r)*Math.sin(t),a=n*Math.sin(r);return[o,a,i]}const El=Cr();Cr();const Rr=Cr(),Pi=Cr(),ia=Cr();function yh(e,t,r,n,i){Nn(e,r,n),Ys(e,e),t=$h(-e[1],e[0]);const o=$h(-r[1],r[0]);return[i/Dl(t,o),t]}function Ni(e,t){return aP(e,-t[1],t[0])}function oa(e,t,r){return Yh(e,t,r),Ys(e,e),e}function Ah(e,t){return e[0]===t[0]&&e[1]===t[1]}class T6{constructor(t={}){E(this,"complex",void 0),E(this,"join",void 0),E(this,"cap",void 0),E(this,"miterLimit",void 0),E(this,"thickness",void 0),E(this,"normal",void 0),E(this,"lastFlip",-1),E(this,"miter",$h(0,0)),E(this,"started",!1),E(this,"dash",!1),E(this,"totalDistance",0),E(this,"currentIndex",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}simpleExtrude(t){const r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;const n=t.length;let i=r.startIndex;for(let o=1;o<n;o++){const a=t[o-1],s=t[o],u=o<t.length-1?t[o+1]:null,l=this.simpleSegment(r,i,a,s,u);i+=l}if(this.dash)for(let o=0;o<r.positions.length/6;o++)r.positions[o*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}simpleExtrude_gaode2(t,r){const n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;const i=t.length;let o=n.startIndex;for(let l=1;l<i;l++){var a,s,u;const f=t[l-1];f.push((a=r[l-1][2])!==null&&a!==void 0?a:0);const c=r[l-1],h=t[l];h.push((s=r[l][2])!==null&&s!==void 0?s:0);const d=r[l],p=l<t.length-1?[...t[l+1],(u=r[l+1][2])!==null&&u!==void 0?u:0]:null,v=l<r.length-1?r[l+1]:null,m=this.simpleSegment(n,o,f,h,p,c,d,v);o+=m}if(this.dash)for(let l=0;l<n.positions.length/6;l++)n.positions[l*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}extrude_gaode2(t,r){const n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;const i=t.length;let o=n.startIndex;for(let l=1;l<i;l++){var a,s,u;const f=t[l-1];f.push((a=r[l-1][2])!==null&&a!==void 0?a:0);const c=r[l-1],h=t[l];h.push((s=r[l][2])!==null&&s!==void 0?s:0);const d=r[l],p=l<t.length-1?[...t[l+1],(u=r[l+1][2])!==null&&u!==void 0?u:0]:null,v=l<r.length-1?r[l+1]:null,m=this.segment_gaode2(n,o,f,h,p,c,d,v);o+=m}if(this.dash)for(let l=0;l<n.positions.length/6;l++)n.positions[l*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}extrude(t){const r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;const n=t.length;let i=r.startIndex;for(let o=1;o<n;o++){const a=t[o-1],s=t[o],u=o<t.length-1?t[o+1]:null,l=this.segment(r,i,a,s,u);i+=l}if(this.dash)for(let o=0;o<r.positions.length/6;o++)r.positions[o*6+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}simpleSegment(t,r,n,i,o){let a=0;const s=t.indices,u=t.positions,l=t.normals,f=fn([i[0],i[1]]),c=fn([n[0],n[1]]);oa(Rr,f,c);let h=0;if(this.dash&&(h=this.lineSegmentDistance(f,c),this.totalDistance+=h),this.normal||(this.normal=Cr(),Ni(this.normal,Rr)),this.started||(this.started=!0,this.extrusions(u,l,n,this.normal,this.thickness,this.totalDistance-h)),s.push(r+0,r+1,r+2),!o)Ni(this.normal,Rr),this.extrusions(u,l,i,this.normal,this.thickness,this.totalDistance),s.push(...this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3]),a+=2;else{const d=fn([o[0],o[1]]);Ah(f,d)&&Nn(d,f,Ys(d,Fl(d,f,c))),oa(Pi,d,f);const[p,v]=yh(ia,Cr(),Rr,Pi,this.thickness);let m=Dl(ia,this.normal)<0?-1:1;this.extrusions(u,l,i,v,p,this.totalDistance),s.push(...this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3]),m=-1,vs(this.normal,v),a+=2,this.lastFlip=m}return a}segment_gaode2(t,r,n,i,o,a,s,u){let l=0;const f=t.indices,c=t.positions,h=t.normals,d=this.cap==="square",p=this.join==="bevel",v=fn([s[0],s[1]]),m=fn([a[0],a[1]]);oa(Rr,i,n);let y=0;if(this.dash&&(y=this.lineSegmentDistance(v,m),this.totalDistance+=y),this.normal||(this.normal=Cr(),Ni(this.normal,Rr)),!this.started)if(this.started=!0,d){const A=Cr(),T=Cr();Nn(A,this.normal,Rr),Nn(T,this.normal,Rr),h.push(T[0],T[1],0),h.push(A[0],A[1],0),c.push(n[0],n[1],n[2]|0,this.totalDistance-y,-this.thickness,n[2]|0),this.complex.indexes.push(this.currentIndex),c.push(n[0],n[1],n[2]|0,this.totalDistance-y,this.thickness,n[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,h,n,this.normal,this.thickness,this.totalDistance-y);if(f.push(r+0,r+1,r+2),o){Ah(i,o)&&Nn(o,i,Ys(o,Fl(o,i,n))),oa(Pi,o,i);const[A,T]=yh(ia,Cr(),Rr,Pi,this.thickness);let R=Dl(ia,this.normal)<0?-1:1,b=p;!b&&this.join==="miter"&&A>this.miterLimit&&(b=!0),b?(h.push(this.normal[0],this.normal[1],0),h.push(T[0],T[1],0),c.push(i[0],i[1],i[2]|0,this.totalDistance,-this.thickness*R,i[2]|0),this.complex.indexes.push(this.currentIndex),c.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness*R,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,f.push(...this.lastFlip!==-R?[r,r+2,r+3]:[r+2,r+1,r+3]),f.push(r+2,r+3,r+4),Ni(El,Pi),vs(this.normal,El),h.push(this.normal[0],this.normal[1],0),c.push(i[0],i[1],i[2]|0,this.totalDistance,-this.thickness*R,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(c,h,i,T,A,this.totalDistance),f.push(...this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3]),R=-1,vs(this.normal,T),l+=2),this.lastFlip=R}else{if(Ni(this.normal,Rr),d){const A=Cr(),T=Cr();Yh(T,Rr,this.normal),Nn(A,Rr,this.normal),h.push(T[0],T[1],0),h.push(A[0],A[1],0),c.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),c.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,h,i,this.normal,this.thickness,this.totalDistance);f.push(...this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3]),l+=2}return l}segment(t,r,n,i,o){let a=0;const s=t.indices,u=t.positions,l=t.normals,f=this.cap==="square",c=this.join==="bevel",h=fn([i[0],i[1]]),d=fn([n[0],n[1]]);oa(Rr,h,d);let p=0;if(this.dash&&(p=this.lineSegmentDistance(h,d),this.totalDistance+=p),this.normal||(this.normal=Cr(),Ni(this.normal,Rr)),!this.started)if(this.started=!0,f){const v=Cr(),m=Cr();Nn(v,this.normal,Rr),Nn(m,this.normal,Rr),l.push(m[0],m[1],0),l.push(v[0],v[1],0),u.push(n[0],n[1],n[2]|0,this.totalDistance-p,-this.thickness,n[2]|0),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],n[2]|0,this.totalDistance-p,this.thickness,n[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,l,n,this.normal,this.thickness,this.totalDistance-p);if(s.push(r+0,r+1,r+2),o){const v=fn([o[0],o[1]]);Ah(h,v)&&Nn(v,h,Ys(v,Fl(v,h,d))),oa(Pi,v,h);const[m,y]=yh(ia,Cr(),Rr,Pi,this.thickness);let A=Dl(ia,this.normal)<0?-1:1,T=c;!T&&this.join==="miter"&&m>this.miterLimit&&(T=!0),T?(l.push(this.normal[0],this.normal[1],0),l.push(y[0],y[1],0),u.push(i[0],i[1],i[2]|0,this.totalDistance,-this.thickness*A,i[2]|0),this.complex.indexes.push(this.currentIndex),u.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness*A,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,s.push(...this.lastFlip!==-A?[r,r+2,r+3]:[r+2,r+1,r+3]),s.push(r+2,r+3,r+4),Ni(El,Pi),vs(this.normal,El),l.push(this.normal[0],this.normal[1],0),u.push(i[0],i[1],i[2]|0,this.totalDistance,-this.thickness*A,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a+=3):(this.extrusions(u,l,i,y,m,this.totalDistance),s.push(...this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3]),A=-1,vs(this.normal,y),a+=2),this.lastFlip=A}else{if(Ni(this.normal,Rr),f){const v=Cr(),m=Cr();Yh(m,Rr,this.normal),Nn(v,Rr,this.normal),l.push(m[0],m[1],0),l.push(v[0],v[1],0),u.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),u.push(i[0],i[1],i[2]|0,this.totalDistance,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,l,i,this.normal,this.thickness,this.totalDistance);s.push(...this.lastFlip===1?[r,r+2,r+3]:[r+2,r+1,r+3]),a+=2}return a}extrusions(t,r,n,i,o,a){r.push(i[0],i[1],0),r.push(i[0],i[1],0),t.push(n[0],n[1],n[2]|0,a,-o,n[2]|0),this.complex.indexes.push(this.currentIndex),t.push(n[0],n[1],n[2]|0,a,o,n[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}lineSegmentDistance(t,r){const n=r[0]-t[0],i=r[1]-t[1];return Math.sqrt(n*n+i*i)}}function aA(e,t=!1){const r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));const i=e[0].length,o=ii.exports.flatten(e),{vertices:a,dimensions:s}=o,u=[],l=[],f=[];for(let h=0;h<a.length/s;h++)u.push(a[h*s],a[h*s+1],1,-1,-1),f.push(0,0,1);const c=ii.exports(o.vertices,o.holes,o.dimensions);l.push(...c);for(let h=0;h<i;h++){const d=o.vertices.slice(h*s,(h+1)*s);let p=o.vertices.slice((h+1)*s,(h+2)*s);p.length===0&&(p=o.vertices.slice(0,s));const v=u.length/5;u.push(d[0],d[1],1,0,0,p[0],p[1],1,.1,0,d[0],d[1],0,0,.8,p[0],p[1],0,.1,.8);const m=S6([p[0],p[1],1],[d[0],d[1],0],[d[0],d[1],1],t);f.push(...m,...m,...m,...m),l.push(...[1,2,0,3,2,1].map(y=>y+v))}return{positions:u,index:l,normals:f}}function S6(e,t,r,n=!1){const i=ws(),o=ws(),a=ws();n&&(e=th(e),t=th(t),r=th(r));const s=Wr(...e),u=Wr(...t),l=Wr(...r);Hv(i,l,u),Hv(o,s,u),nP(a,i,o);const f=ws();return Ls(f,a),f}let Ss=function(e){return e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn",e}({}),xs=function(e){return e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon",e}({});function Tu(e,t=0){const r=Math.PI*2/e,n=[];for(let o=0;o<e;o++)n.push(r*o+t*Math.PI/12);return n.map(o=>{const a=Math.sin(o+Math.PI/4),s=Math.cos(o+Math.PI/4);return[a,s,0]})}function vd(){return Tu(30)}function Eg(){return Tu(4)}function yg(){return Tu(3)}function Ag(){return Tu(6,1)}function Tg(){return Tu(5)}const Th={[xs.CIRCLE]:vd,[xs.HEXAGON]:Ag,[xs.TRIANGLE]:yg,[xs.SQUARE]:Eg,[xs.PENTAGON]:Tg,[Ss.CYLINDER]:vd,[Ss.HEXAGONCOLUMN]:Ag,[Ss.TRIANGLECOLUMN]:yg,[Ss.SQUARECOLUMN]:Eg,[Ss.PENTAGONCOLUMN]:Tg},yl={};function vo(e){const t=zi(e.coordinates);return{vertices:[...t,...t,...t,...t],indices:[0,1,2,2,3,0],size:t.length}}function Sg(e){const t=zi(e.coordinates),r=oA(t);return{vertices:[...r,...r,...r,...r],indices:[0,1,2,2,3,0],size:r.length}}function sA(e){const{shape:t}=e,{positions:r,index:n,normals:i}=I6(t,!1);return{vertices:r,indices:n,normals:i,size:5}}function x6(e){const t=zi(e.coordinates);return{vertices:[...t],indices:[0],size:t.length}}function md(e){const{coordinates:t,originCoordinates:r,version:n}=e,i=new T6({dash:!0,join:"bevel"});if(n==="GAODE2.x"){let a=t;Array.isArray(a[0][0])||(a=[t]);let s=r;Array.isArray(s[0][0])||(s=[r]);for(let u=0;u<a.length;u++){const l=a[u],f=s[u];i.extrude_gaode2(l,f)}}else{let a=t;a[0]&&!Array.isArray(a[0][0])&&(a=[t]),a.forEach(s=>{i.extrude(s)})}const o=i.complex;return{vertices:o.positions,indices:o.indices,normals:o.normals,indexes:o.indexes,size:6}}function R6(e){const{coordinates:t,originCoordinates:r}=e,n=[];if(!Array.isArray(t[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};const{results:i,totalDistance:o}=C6(t,r);return i.map(a=>{n.push(a[0],a[1],a[2],a[3],0,o)}),{vertices:n,indices:[],normals:[],size:6,count:i.length}}function xg(e,t){const r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)}function Sh(e,t){return e.length<3&&e.push(0),t!==void 0&&e.push(t),e}function C6(e,t){let r=e,n=t||e;Array.isArray(r)&&Array.isArray(r[0])&&Array.isArray(r[0][0])&&(r=t.flat(),n=t.flat());let i=0;if(r.length<2)return{results:r,totalDistance:0};{const o=[],a=Sh(r[0],i);o.push(a);for(let u=1;u<r.length-1;u++){const l=xg(fn(n[u-1]),fn(n[u]));i+=l;const f=Sh(r[u],i);o.push(f),o.push(f)}const s=xg(fn(n[n.length-2]),fn(n[n.length-1]));return i+=s,o.push(Sh(r[r.length-1],i)),{results:o,totalDistance:i}}}function wc(e){const{coordinates:t}=e,r=ii.exports.flatten(t),{vertices:n,dimensions:i,holes:o}=r;return{indices:ii.exports(n,o,i),vertices:n,size:i}}function b6(e){const{coordinates:t}=e,r=ii.exports.flatten(t),{vertices:n,dimensions:i,holes:o}=r;return{indices:ii.exports(n,o,i),vertices:M6(n),size:i+4}}function M6(e){const t=[],{center:r,radius:n}=Bb(e);for(let i=0;i<e.length;i+=2){const o=e[i],a=e[i+1];t.push(o,a,0,...r,n)}return t}function uA(e){const t=e.coordinates,{positions:r,index:n,normals:i}=aA(t,!0);return{vertices:r,indices:n,normals:i,size:5}}function Lc(e){const t=e.coordinates;return{vertices:[...t[0],0,0,0,...t[1],0,1,0,...t[2],0,1,1,...t[3],0,0,1],indices:[0,1,2,0,2,3],size:5}}function mp(e,t){const{segmentNumber:r=30}=t,n=e.coordinates,i=[],o=[];for(let a=0;a<r;a++)i.push(a,1,a,n[0][0],n[0][1],n[1][0],n[1][1],a,-1,a,n[0][0],n[0][1],n[1][0],n[1][1]),a!==r-1&&o.push(...[0,1,2,1,3,2].map(s=>a*2+s));return{vertices:i,indices:o,size:7}}function I6(e,t=!1){if(yl&&yl[e])return yl[e];const r=Th[e]?Th[e]():Th.cylinder(),n=aA([r],t);return yl[e]=n,n}function O6(e,t){return{type:e.type,field:"value",items:e.positions.map((r,n)=>({[t]:n>=e.colors.length?null:e.colors[n],value:r}))}}const P6=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
    float u_opacity:1.0;
    float u_brightness:1.0;
    float u_contrast:1.0;
    float u_saturation:1.0;
    float u_gamma:1.0;
};

in vec2 v_texCoord;
out vec4 outputColor;
vec3 setContrast(vec3 rgb, float contrast) {
  vec3 color = mix(vec3(0.5), rgb, contrast);
  color = clamp(color, 0.0, 1.0);
  return color;
}
vec3 setSaturation(vec3 rgb, float adjustment) {
  const vec3 grayVector = vec3(0.2125, 0.7154, 0.0721);
  vec3 intensity = vec3(dot(rgb, grayVector));
  vec3 color = mix(intensity, rgb, adjustment);
  color = clamp(color, 0.0, 1.0);
  return color;
}
void main() {
  vec4 color = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y));
  //brightness
  color.rgb = mix(vec3(0.0, 0.0, 0.0), color.rgb, u_brightness);
  //contrast
  color.rgb = setContrast(color.rgb, u_contrast);
  // saturation
  color.rgb = setSaturation(color.rgb, u_saturation);
  // gamma
  color.rgb = pow(color.rgb, vec3(u_gamma));
  outputColor = color;
  outputColor.a *= u_opacity;
  if(outputColor.a < 0.01)
    discard;
}
`,N6=`layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
    float u_opacity:1.0;
    float u_brightness:1.0;
    float u_contrast:1.0;
    float u_saturation:1.0;
    float u_gamma:1.0;
};

out vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
 
}
`;class F6 extends Qt{constructor(...t){super(...t),E(this,"texture",void 0)}getCommonUniformsInfo(){const{opacity:t,brightness:r,contrast:n,saturation:i,gamma:o}=this.layer.getLayerConfig(),a={u_opacity:ds(t,1),u_brightness:ds(r,1),u_contrast:ds(n,1),u_saturation:ds(i,1),u_gamma:ds(o,1)};return this.textures=[this.texture],this.getUniformsBufferInfo(a)}initModels(){var t=this;return pe(function*(){return yield t.loadTexture(),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}loadTexture(){var t=this;return pe(function*(){const{createTexture2D:r}=t.rendererService;t.texture=r({height:1,width:1});const i=yield t.layer.getSource().data.images;t.texture=r({data:i[0],width:i[0].width,height:i[0].height,mag:g.LINEAR,min:g.LINEAR})})()}buildModels(){var t=this;return pe(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:N6,fragmentShader:P6,triangulation:Lc,primitive:g.TRIANGLES,blend:{enable:!0},depth:{enable:!1},pickingEnabled:!1})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Qe.Attribute,descriptor:{name:"a_Uv",shaderLocation:at.UV,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:(t,r,n)=>[n[3],n[4]]}})}}const D6={image:F6},B6=D6;class w6 extends za{constructor(...t){super(...t),E(this,"type","ImageLayer")}buildModels(){var t=this;return pe(function*(){const r=t.getModelType();t.layerModel=new B6[r](t),yield t.initLayerModels()})()}getDefaultConfig(){const t=this.getModelType();return{image:{}}[t]}getModelType(){return"image"}}const L6=`
#define Animate 0.0
#define LineTexture 1.0
uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_lineDir: 1.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_blur : 0.9;
  float u_line_type: 0.0;
  float u_time;
  float u_linearColor: 0.0;
};

in vec4 v_color;
in vec2 v_iconMapUV;
in vec4 v_lineData;
//dash
in vec4 v_dash_array;
in float v_distance_ratio;

out vec4 outputColor;
#pragma include "picking"

void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      discard;
    };
  }
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  outputColor = v_color;
  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      outputColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = v_lineData.g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = v_lineData.a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
    
  } else {
     outputColor = filterColor(outputColor);
  }
}`,U6=`#define Animate 0.0
#define LineTexture 1.0
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 14) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_lineDir: 1.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_blur : 0.9;
  float u_line_type: 0.0;
  float u_time;
  float u_linearColor: 0.0;
};
out vec4 v_color;
out vec2 v_iconMapUV;
out vec4 v_lineData;
//dash
out vec4 v_dash_array;
out float v_distance_ratio;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // dash: index / (segmentNumber - 1.);
    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    //  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  //vs\u4E2D\u8BA1\u7B97\u6E10\u53D8\u8272
  if(u_linearColor==1.0){
    float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  }
  else{
    v_color = a_Color;
  }
  v_color.a = v_color.a * opacity;

  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9



  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  //\u8BA1\u7B97dashArray\u548CdistanceRatio \u8F93\u51FA\u5230\u7247\u5143
  vec2 s = source;
  vec2 t = target;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  v_distance_ratio = segmentIndex / segmentNumber;

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

  v_lineData.b = d_distance_ratio;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, thetaOffset), 0.0, 1.0));

  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  v_lineData.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    v_lineData.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
    v_lineData.a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  setPickingColor(a_PickingColor);
}
`,k6={solid:0,dash:1};class z6 extends Qt{constructor(...t){super(...t),E(this,"texture",void 0),E(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=r({data:this.iconService.getCanvas(),mag:g.NEAREST,min:g.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:r,textureBlend:n="normal",lineType:i="solid",dashArray:o=[10,5],forward:a=!0,lineTexture:s=!1,iconStep:u=100,segmentNumber:l=30}=this.layer.getLayerConfig(),{animateOption:f}=this.layer.getLayerConfig();let c=o;i!=="dash"&&(c=[0,0]),c.length===2&&c.push(0,0);let h=0,d=[0,0,0,0],p=[0,0,0,0];if(t&&r&&(d=Zt(t),p=Zt(r),h=1),this.rendererService.getDirty()){var v;(v=this.texture)===null||v===void 0||v.bind()}const m={u_animate:this.animateOption2Array(f),u_dash_array:c,u_sourceColor:d,u_targetColor:p,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:l,u_lineDir:a?1:-1,u_icon_step:u,u_line_texture:s?1:0,u_textureBlend:n==="normal"?0:1,u_blur:.9,u_line_type:k6[i||"solid"],u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:h};return this.getUniformsBufferInfo(m)}initModels(){var t=this;return pe(function*(){return t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}getShaders(){return{frag:L6,vert:U6,type:""}}buildModels(){var t=this;return pe(function*(){t.initUniformsBuffer();const{segmentNumber:r=30}=t.layer.getLayerConfig(),{frag:n,vert:i,type:o}=t.getShaders();return[yield t.layer.buildLayerModel({moduleName:"lineArc2d"+o,vertexShader:i,fragmentShader:n,inject:t.getInject(),triangulation:mp,depth:{enable:!1},styleOption:{segmentNumber:r}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Qe.Attribute,descriptor:{name:"a_Size",shaderLocation:at.SIZE,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0]]:[r]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Qe.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:4,update:(t,r,n)=>[n[3],n[4],n[5],n[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Qe.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{texture:n}=t,{x:i,y:o}=r[n]||{x:0,y:0};return[i,o]}}})}}const V6=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_globel;
  float u_globel_radius;
  float u_global_height: 10;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0.0;
};

// varying vec2 v_normal;
in vec4 v_dash_array;
in vec4 v_color;
in vec4 v_line_data;
in float v_segmentIndex;
in vec2 v_iconMapUV;

out vec4 outputColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_line_data.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  outputColor = v_color;

  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    outputColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      outputColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          outputColor = filterColor(pattern);
        }
    }

  } else {
    outputColor = filterColor(outputColor);
  }
}
`,H6=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 14) in vec2 a_iconMapUV;


layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_globel;
  float u_globel_radius;
  float u_global_height: 10;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0.0;
};
out vec4 v_color;
out vec4 v_dash_array;
out float v_segmentIndex;
out vec2 v_iconMapUV;
out vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  //vs\u4E2D\u8BA1\u7B97\u6E10\u53D8\u8272
  if(u_linearColor==1.0){
    float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  }
  else{
    v_color = a_Color;
  }
  v_color.a = v_color.a * opacity;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z * thetaOffset, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,X6={solid:0,dash:1};class Rg extends Qt{constructor(...t){super(...t),E(this,"texture",void 0),E(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=r({data:this.iconService.getCanvas(),mag:g.NEAREST,min:g.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:r,textureBlend:n="normal",lineType:i="solid",dashArray:o=[10,5],lineTexture:a=!1,iconStep:s=100,segmentNumber:u=30,globalArcHeight:l=10}=this.layer.getLayerConfig(),{animateOption:f}=this.layer.getLayerConfig();o.length===2&&o.push(0,0);let c=0,h=[0,0,0,0],d=[0,0,0,0];if(t&&r&&(h=Zt(t),d=Zt(r),c=1),this.rendererService.getDirty()){var p;(p=this.texture)===null||p===void 0||p.bind()}const v={u_animate:this.animateOption2Array(f),u_dash_array:o,u_sourceColor:h,u_targetColor:d,u_textSize:[1024,this.iconService.canvasHeight||128],u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:iA,u_global_height:l,segmentNumber:u,u_line_type:X6[i]||0,u_icon_step:s,u_line_texture:a?1:0,u_textureBlend:n==="normal"?0:1,u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:c};return this.getUniformsBufferInfo(v)}initModels(){var t=this;return pe(function*(){return t.initUniformsBuffer(),t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}getShaders(){return{frag:V6,vert:H6,type:""}}buildModels(){var t=this;return pe(function*(){const{segmentNumber:r=30}=t.layer.getLayerConfig(),{frag:n,vert:i,type:o}=t.getShaders();return[yield t.layer.buildLayerModel({moduleName:"lineArc3d"+o,vertexShader:i,fragmentShader:n,inject:t.getInject(),triangulation:mp,styleOption:{segmentNumber:r}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Qe.Attribute,descriptor:{name:"a_Size",shaderLocation:at.SIZE,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0]]:[r]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Qe.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:4,update:(t,r,n)=>[n[3],n[4],n[5],n[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Qe.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{texture:n}=t,{x:i,y:o}=r[n]||{x:0,y:0};return[i,o]}}})}}const Cg={circle:2,triangle:2,diamond:4,rect:2,classic:3,halfTriangle:2,none:0},hn=1/2;function W6(e,t){const{width:r=2,height:n=1}=t;return{vertices:[0,hn*e,1*e*r,-(n+hn)*e,1*e*r,(n-hn)*e,0,hn*e,1*e*r,-(n+hn)*e,1*e*r,(n-hn)*e],indices:[3,4,5],outLineIndices:[0,1,2],normals:[1*e,-2*e,1,-2*e,1.5*e,1,1*e,1.5*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function j6(e,t){const{width:r=2,height:n=3}=t;return{vertices:[0,0,1*e*r,1*n,1*e*r,-1*n,0,0,1*e*r,1*n,1*e*r,-1*n],outLineIndices:[0,1,2],indices:[3,4,5],normals:[0,-1.5*e,1,2,1*e,1,-2,1*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function G6(e,t){const{width:r=2,height:n=2}=t;return{vertices:[0,n/2,e*r*1,n/2,e*r*1,-n/2,0,-n/2,0,n/2,e*r*1,n/2,e*r*1,-n/2,0,-n/2],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function $6(e,t){const{width:r=2,height:n=3}=t;return{vertices:[0,0,1*r*e,.5*n,2*r*e,0,1*r*e,-.5*n,0,0,1*r*e,.5*n,2*r*e,0,1*r*e,-.5*n],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function Y6(e,t){const{width:r=2,height:n=3}=t;return{vertices:[0,0,2*e*r,1*n,1.5*e*r,0,2*e*r,-1*n,0,0,2*e*r,1*n,1.5*e*r,0,2*e*r,-1*n],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function Z6(e,t){const{width:r=2,height:n=2}=t,i=vd(),o=ii.exports.flatten([i]),a=ii.exports(o.vertices,o.holes,o.dimensions),s=i.map(u=>[u[0]*r*e,u[1]*n]).flat();return{vertices:[...s,...s],dimensions:2,indices:a.map(u=>u+i.length),outLineIndices:a,normals:[...i.map(u=>[u[1]*n,u[0]*r*e,1]).flat(),...new Array(i.length*3).fill(0)]}}function q6(e,t=0,r){const n=typeof r.source=="object"?r.source.type:r.source,i=typeof r.target=="object"?r.target.type:r.target,{width:o=n?Cg[n]:0}=typeof r.source=="object"?r.source:{},{width:a=i?Cg[i]:0}=typeof r.target=="object"?r.target:{};return{vertices:[0,hn,1*o,...e,1,hn,-1*a,...e,1,-hn,-1*a,...e,0,-hn,1*o,...e,0,hn,1*o,...e,1,hn,-1*a,...e,1,-hn,-1*a,...e,0,-hn,1*o,...e],outLineIndices:[0,1,2,0,2,3].map(s=>s+t),indices:[4,5,6,4,6,7].map(s=>s+t),normals:[1,-1,1,1,1,1,-1,0,1,-1,0,1,0,0,0,0,0,0,0,0,0,0,0,0],dimensions:2}}function bg(e,t){const r=typeof e=="object"?e.type:e,n=t==="source"?1:-1,i=typeof e=="object"?e:{};switch(r){case"circle":return Z6(n,i);case"triangle":return j6(n,i);case"diamond":return $6(n,i);case"rect":return G6(n,i);case"classic":return Y6(n,i);case"halfTriangle":return W6(n,i);default:return{vertices:[],indices:[],normals:[],dimensions:2,outLineIndices:[],outLineNormals:[]}}}function K6(e){const t=e.coordinates.flat(),r=1,n=1;return{vertices:[1,0,0,...t,1,2,-3,...t,1,1,-3,...t,0,1,0,...t,0,0,0,...t,1,0,0,...t,1,2,-3,...t,1,1,-3,...t,0,1,0,...t,0,0,0,...t],normals:[-r,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-r,-n,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function Q6(e,t){return t?J6(e,t):K6(e)}function J6(e,t){const r=e.coordinates.flat(),{target:n="classic",source:i="circle"}=t,o=Mg(bg(i,"source"),r,0,0),a=q6(r,o.vertices.length/7,t),s=Mg(bg(n,"target"),r,1,o.vertices.length/7+a.vertices.length/7);return{vertices:[...o.vertices,...a.vertices,...s.vertices],indices:[...o.outLineIndices,...a.outLineIndices,...s.outLineIndices,...o.indices,...a.indices,...s.indices],normals:[...o.normals,...a.normals,...s.normals],size:7}}function Mg(e,t,r=1,n=0){const i=[],{vertices:o,indices:a,dimensions:s,outLineIndices:u}=e;for(let l=0;l<o.length;l+=s)i.push(r,o[l+1],o[l],...t);return he(he({},e),{},{vertices:i,indices:a.map(l=>l+n),outLineIndices:u.map(l=>l+n)})}const e5=`// #extension GL_OES_standard_derivatives : enable

in vec4 v_color;
out vec4 outputColor;


// line texture

#pragma include "picking"

void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,t5=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec2 a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 13) in vec3 a_Normal;

layout(std140) uniform commonUniorm {
  float u_gap_width: 1.0;
  float u_stroke_width: 1.0;
  float u_stroke_opacity: 1.0;
};

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

out vec4 v_color;

vec2 project_pixel_offset(vec2 offsets) {

   vec2 data = project_pixel(offsets);
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return data;
  }

  return vec2(data.x, -data.y);;
}

vec2 line_dir(vec2 target, vec2 source) {

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
     return normalize(target - source);
  }
  return normalize(ProjectFlat(target) - ProjectFlat(source));
}

float flag_gap() {
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
     return 1.;
  }
  return -1.;

}


void main() {

// \u900F\u660E\u5EA6\u8BA1\u7B97
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  vec2 flowlineDir = line_dir(target,source);
  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x); // mapbox || \u9AD8\u5FB7
   
  vec2 position = mix(source, target, a_Position.x);
  
  float lengthCommon = length(project_position(vec4(target,0,1)) - project_position(vec4(source,0,1)));  //    
  vec2 offsetDistances = a_Size.x * project_pixel_offset(vec2(a_Position.y, a_Position.z)); // Mapbox || \u9AD8\u5FB7
  vec2 limitedOffsetDistances = clamp(   
   offsetDistances,
   project_pixel(-lengthCommon*.2), project_pixel(lengthCommon*.2)
  );


  float startOffsetCommon = project_pixel(offsets[0]);
  float endOffsetCommon = project_pixel(offsets[1]);
  float endpointOffset = mix(
    clamp(startOffsetCommon, 0.0, lengthCommon*.2),
    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),
    a_Position.x
  );

  vec2 normalsCommon =  u_stroke_width * project_pixel_offset(vec2(a_Normal.x, a_Normal.y)); // mapbox || \u9AD8\u5FB7

  float gapCommon = flag_gap() * project_pixel(u_gap_width);
  vec3 offsetCommon = vec3(
    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -
    perpendicularDir *  (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),
    0.0
  );

  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0));

  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);
  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy +  offsetCommon.xy, 0., 1.0));



  setPickingColor(a_PickingColor);
}
`;class r5 extends Qt{getCommonUniformsInfo(){const{gapWidth:t=2,strokeWidth:r=1,strokeOpacity:n=1}=this.layer.getLayerConfig(),i={u_gap_width:t,u_stroke_width:r,u_stroke_opacity:n};return this.getUniformsBufferInfo(i)}initModels(){var t=this;return pe(function*(){return t.initUniformsBuffer(),t.buildModels()})()}buildModels(){var t=this;return pe(function*(){return[yield t.layer.buildLayerModel({moduleName:"flow_line",vertexShader:t5,fragmentShader:e5,inject:t.getInject(),triangulation:Q6,styleOption:t.layer.getLayerConfig().symbol,primitive:g.TRIANGLES,depth:{enable:!1},pick:!1})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Qe.Attribute,descriptor:{name:"a_Size",shaderLocation:at.SIZE,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0],r[1]]:[r,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Qe.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:4,update:(t,r,n)=>[n[3],n[4],n[5],n[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Qe.Attribute,descriptor:{name:"a_Normal",shaderLocation:at.NORMAL,buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:3,update:(t,r,n,i,o)=>o}})}}const n5=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0;
};

in vec4 v_line_data;
in vec2 v_iconMapUV;
in vec4 v_dash_array;
in float v_distance_ratio;
in vec4 v_color;

out vec4 outputColor;
#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {

  float animateSpeed = 0.0;
  float d_segmentIndex = v_line_data.g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    outputColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
    outputColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
    outputColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = outputColor.a/v_color.a;
    }

    float v = v_line_data.a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
  } else {
    outputColor = filterColor(outputColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,i5=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 14) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0;
};

out vec4 v_dash_array;
out vec4 v_color;
out vec2 v_iconMapUV;
out vec4 v_line_data;
out float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
  mix(source, target, segmentRatio),
  sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }
  else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  v_color = a_Color;
  v_color.a = v_color.a * opacity;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_line_data.g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    v_line_data.b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));
  setPickingColor(a_PickingColor);
}

`,o5={solid:0,dash:1};class a5 extends Qt{constructor(...t){super(...t),E(this,"texture",void 0),E(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=r({data:this.iconService.getCanvas(),mag:g.NEAREST,min:g.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:r,textureBlend:n="normal",lineType:i="solid",dashArray:o=[10,5],lineTexture:a=!1,iconStep:s=100,segmentNumber:u=30}=this.layer.getLayerConfig(),{animateOption:l}=this.layer.getLayerConfig();if(o.length===2&&o.push(0,0),this.rendererService.getDirty()){var f;(f=this.texture)===null||f===void 0||f.bind()}let c=0,h=[0,0,0,0],d=[0,0,0,0];t&&r&&(h=Zt(t),d=Zt(r),c=1);let p=this.layer.getLayerAnimateTime();isNaN(p)&&(p=0);const v={u_animate:this.animateOption2Array(l),u_dash_array:o,u_sourceColor:h,u_targetColor:d,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:u,u_line_type:o5[i]||0,u_icon_step:s,u_line_texture:a?1:0,u_textureBlend:n==="normal"?0:1,u_time:p,u_linearColor:c};return this.getUniformsBufferInfo(v)}initModels(){var t=this;return pe(function*(){return t.initUniformsBuffer(),t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return pe(function*(){const{segmentNumber:r=30}=t.layer.getLayerConfig();return[yield t.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:i5,fragmentShader:n5,triangulation:mp,styleOption:{segmentNumber:r},inject:t.getInject(),depth:{enable:!1}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Qe.Attribute,descriptor:{name:"a_Size",shaderLocation:at.SIZE,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0]]:[r]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Qe.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:4,update:(t,r,n)=>[n[3],n[4],n[5],n[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Qe.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{texture:n}=t,{x:i,y:o}=r[n]||{x:0,y:0};return[i,o]}}})}}const s5=`// #extension GL_OES_standard_derivatives : enable
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_blur;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed: 0.0;
  float u_vertexScale: 1.0;
  float u_raisingHeight: 0.0;
  float u_strokeWidth: 0.0;
  float u_textureBlend;
  float u_line_texture;
  float u_linearDir: 1.0;
  float u_linearColor: 0;
  float u_time;
};

in vec4 v_color;
in vec4 v_stroke;
// dash
in vec4 v_dash_array;
in float v_d_distance_ratio;
in vec2 v_iconMapUV;
in vec4 v_texture_data;

out vec4 outputColor;
#pragma include "picking"

// [animate, duration, interval, trailLength],
void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_texture_data.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    d_distance_ratio = v_texture_data.a;
  }
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    outputColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
    outputColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     outputColor = v_color;
  }
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_texture_data.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_texture_data.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_texture_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
     vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor += pattern;
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = pattern;
    }
  } 

  float v = v_texture_data.a;
  float strokeWidth = min(0.5, u_strokeWidth);
  // \u7ED8\u5236 border
  if(strokeWidth > 0.01) {
    float borderOuterWidth = strokeWidth / 2.0;


    if(v >= 1.0 - strokeWidth || v <= strokeWidth) {
      if(v > strokeWidth) { // \u5916\u4FA7
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - strokeWidth))/strokeWidth);
        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);
        outputColor.rgb = mix(outputColor.rgb, v_stroke.rgb, linear);
      } else if(v <= strokeWidth) {
        float linear = smoothstep(0.0, 1.0, v/strokeWidth);
        outputColor.rgb = mix(v_stroke.rgb, outputColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      outputColor.a = mix(0.0, outputColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = v_texture_data.a;
  if(blurV < 0.5) {
    outputColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    outputColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  outputColor = filterColor(outputColor);
}
`,u5=`
#define Animate 0.0

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec2 a_Size;
layout(location = 10) in vec3 a_DistanceAndIndexAndMiter;
layout(location = 13) in vec4 a_Normal_Total_Distance;
layout(location = 14) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_blur;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed: 0.0;
  float u_vertexScale: 1.0;
  float u_raisingHeight: 0.0;
  float u_strokeWidth: 0.0;
  float u_textureBlend;
  float u_line_texture;
  float u_linearDir: 1.0;
  float u_linearColor: 0;
  float u_time;
};


out vec4 v_color;
out vec4 v_stroke;
//dash
out vec4 v_dash_array;
out float v_d_distance_ratio;
// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
out vec2 v_iconMapUV;
out vec4 v_texture_data;

#pragma include "projection"
#pragma include "picking"

void main() {
  vec2 a_DistanceAndIndex = a_DistanceAndIndexAndMiter.xy;
  float a_Miter = a_DistanceAndIndexAndMiter.z;
  vec3 a_Normal = a_Normal_Total_Distance.xyz;
  float a_Total_Distance = a_Normal_Total_Distance.w;
  //dash\u8F93\u51FA
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;
  v_color.a *= opacity;
  v_stroke = stroke;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  
  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`;class lA extends Qt{constructor(...t){super(...t),E(this,"textureEventFlag",!1),E(this,"texture",this.createTexture2D({data:new Uint8Array([0,0,0,0]),width:1,height:1})),E(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.textures.length===0&&(this.textures=[this.texture]),this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=r({data:this.iconService.getCanvas(),mag:g.NEAREST,min:g.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128})})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:r,textureBlend:n="normal",lineType:i="solid",dashArray:o=[10,5,0,0],lineTexture:a=!1,iconStep:s=100,vertexHeightScale:u=20,strokeWidth:l=0,raisingHeight:f=0,heightfixed:c=!1,linearDir:h=vg.VERTICAL,blur:d=[1,1,1,0]}=this.layer.getLayerConfig();let p=o;if(i!=="dash"&&(p=[0,0,0,0]),p.length===2&&p.push(0,0),this.rendererService.getDirty()&&this.texture){var v;(v=this.texture)===null||v===void 0||v.bind()}const{animateOption:m}=this.layer.getLayerConfig();let y=0,A=[0,0,0,0],T=[0,0,0,0];t&&r&&(A=Zt(t),T=Zt(r),y=1);const R={u_animate:this.animateOption2Array(m),u_dash_array:p,u_blur:d,u_sourceColor:A,u_targetColor:T,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:s,u_heightfixed:Number(c),u_vertexScale:u,u_raisingHeight:Number(f),u_strokeWidth:l,u_textureBlend:n===a6.NORMAL?0:1,u_line_texture:a?1:0,u_linearDir:h===vg.VERTICAL?1:0,u_linearColor:y,u_time:this.layer.getLayerAnimateTime()||0};return this.getUniformsBufferInfo(R)}initModels(){var t=this;return pe(function*(){return t.initUniformsBuffer(),t.textureEventFlag||(t.textureEventFlag=!0,t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture)),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return pe(function*(){const{depth:r=!1}=t.layer.getLayerConfig(),{frag:n,vert:i,type:o}=t.getShaders();return t.layer.triangulation=md,[yield t.layer.buildLayerModel({moduleName:"line"+o,vertexShader:i,fragmentShader:n,triangulation:md,inject:t.getInject(),depth:{enable:r}})]})()}getShaders(){return{frag:s5,vert:u5,type:""}}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Qe.Attribute,descriptor:{name:"a_DistanceAndIndexAndMiter",shaderLocation:10,buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:3,update:(t,r,n,i,o,a)=>a===void 0?[n[3],10,n[4]]:[n[3],a,n[4]]}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Qe.Attribute,descriptor:{name:"a_Size",shaderLocation:at.SIZE,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0],r[1]]:[r,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal_total_distance",type:Qe.Attribute,descriptor:{name:"a_Normal_Total_Distance",shaderLocation:at.NORMAL,buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:4,update:(t,r,n,i,o)=>[...o,n[5]]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Qe.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:at.UV,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{texture:n}=t,{x:i,y:o}=r[n]||{x:0,y:0};return[i,o]}}})}}const l5=`
layout(std140) uniform commonUniorm {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec4 u_dash_array;
  float u_vertexScale: 1.0;
  float u_linearColor: 0;
};
in float v_distanceScale;
in vec4 v_color;
//dash
in vec4 v_dash_array;

out vec4 outputColor;
void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_distanceScale, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }
  if(u_linearColor==1.0){
    outputColor = mix(u_sourceColor, u_targetColor, v_distanceScale);
    outputColor.a *= v_color.a; // \u5168\u5C40\u900F\u660E\u5EA6
  }
  else{
    outputColor = v_color;
  }
}
`,c5=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec4 a_SizeDistanceAndTotalDistance;

layout(std140) uniform commonUniorm {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec4 u_dash_array;
  float u_vertexScale: 1.0;
  float u_linearColor: 0;
};

#pragma include "projection"
#pragma include "picking"

out vec4 v_color;
out float v_distanceScale;
out vec4 v_dash_array;

void main() {
  //dash\u8F93\u51FA
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_SizeDistanceAndTotalDistance.a;

  v_color = a_Color; 
  v_distanceScale = a_SizeDistanceAndTotalDistance.b / a_SizeDistanceAndTotalDistance.a;
  v_color.a = v_color.a * opacity;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_SizeDistanceAndTotalDistance.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_SizeDistanceAndTotalDistance.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`;class f5 extends Qt{getCommonUniformsInfo(){const{sourceColor:t,targetColor:r,lineType:n="solid",dashArray:i=[10,5,0,0],vertexHeightScale:o=20}=this.layer.getLayerConfig();let a=i;n!=="dash"&&(a=[0,0,0,0]),a.length===2&&a.push(0,0);let s=0,u=[0,0,0,0],l=[0,0,0,0];t&&r&&(u=Zt(t),l=Zt(r),s=1);const f={u_sourceColor:u,u_targetColor:l,u_dash_array:a,u_vertexScale:o,u_linearColor:s};return this.getUniformsBufferInfo(f)}initModels(){var t=this;return pe(function*(){return t.buildModels()})()}getShaders(){return{frag:l5,vert:c5,type:"lineSimpleNormal"}}buildModels(){var t=this;return pe(function*(){t.initUniformsBuffer();const{frag:r,vert:n,type:i}=t.getShaders();return[yield t.layer.buildLayerModel({moduleName:i,vertexShader:n,fragmentShader:r,triangulation:R6,inject:t.getInject(),primitive:g.LINES,depth:{enable:!1},pick:!1})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"sizeDistanceAndTotalDistance",type:Qe.Attribute,descriptor:{name:"a_SizeDistanceAndTotalDistance",shaderLocation:at.SIZE,buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:4,update:(t,r,n)=>{const{size:i=1}=t,o=Array.isArray(i)?[i[0],i[1]]:[i,0];return[o[0],o[1],n[3],n[5]]}}})}}const h5=`#define Animate 0.0
#define LineTexture 1.0

// line texture

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed;
  float u_linearColor: 0;
  float u_line_texture;
  float u_textureBlend;
  float u_iconStepCount;
  float u_time;
};
in vec2 v_iconMapUV;
in float v_blur;
in float v_radio;
in vec4 v_color;
in vec4 v_dataset;

out vec4 outputColor;
#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    outputColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     outputColor = v_color;
  }

  outputColor.a *= v_color.a; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    outputColor.a = mix(0.0, outputColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  outputColor = filterColor(outputColor);
}
`,d5=`#define Animate 0.0
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec2 a_Size;
layout(location = 10) in float a_Miter;
layout(location = 11) in float a_Total_Distance;
layout(location = 12) in vec4 a_Instance;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec2 a_iconMapUV;
layout(location = 15) in float a_Distance;


layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed;
  float u_linearColor: 0;
  float u_line_texture;
  float u_textureBlend;
  float u_iconStepCount;
  float u_time;
};
#pragma include "projection"
#pragma include "light"
#pragma include "picking"

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
out vec2 v_iconMapUV;
out vec4 v_color;
out float v_blur;
out float v_radio;
out vec4 v_dataset;

void main() {


  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_animate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset[0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset[1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset[2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset[3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {    
     originSize = project_float_meter(a_Size.x); // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
  }


  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
// \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);
      if(u_heightfixed > 0.0) {
        wallHeight *= mapboxZoomScale;
      }
      
    } else {
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        wallHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`;class p5 extends Qt{constructor(...t){super(...t),E(this,"texture",void 0),E(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas()}),this.layer.render();return}this.texture=r({data:this.iconService.getCanvas(),mag:g.NEAREST,min:g.NEAREST,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128}),this.textures=[this.texture]})}getCommonUniformsInfo(){const{sourceColor:t,targetColor:r,textureBlend:n="normal",heightfixed:i=!1,lineTexture:o=!1,iconStep:a=100,iconStepCount:s=1}=this.layer.getLayerConfig(),{animateOption:u}=this.layer.getLayerConfig();if(this.rendererService.getDirty()){var l;(l=this.texture)===null||l===void 0||l.bind()}let f=0,c=[0,0,0,0],h=[0,0,0,0];t&&r&&(c=Zt(t),h=Zt(r),f=1);const d={u_animate:this.animateOption2Array(u),u_sourceColor:c,u_targetColor:h,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:a,u_heightfixed:Number(i),u_linearColor:f,u_line_texture:o?1:0,u_textureBlend:n==="normal"?0:1,u_iconStepCount:s,u_time:this.layer.getLayerAnimateTime()||0};return this.getUniformsBufferInfo(d)}initModels(){var t=this;return pe(function*(){return t.initUniformsBuffer(),t.updateTexture(),t.iconService.on("imageUpdate",t.updateTexture),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return pe(function*(){return[yield t.layer.buildLayerModel({moduleName:"lineWall",vertexShader:d5,fragmentShader:h5,triangulation:md,inject:t.getInject(),depth:{enable:!1},blend:t.getBlend()})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:Qe.Attribute,descriptor:{name:"a_Distance",shaderLocation:15,buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:1,update:(t,r,n)=>[n[3]]}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Qe.Attribute,descriptor:{name:"a_Total_Distance",shaderLocation:11,buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:1,update:(t,r,n)=>[n[5]]}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Qe.Attribute,descriptor:{name:"a_Size",shaderLocation:at.SIZE,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0],r[1]]:[r,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Qe.Attribute,descriptor:{name:"a_Normal",shaderLocation:at.NORMAL,buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:3,update:(t,r,n,i,o)=>o}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Qe.Attribute,descriptor:{name:"a_Miter",shaderLocation:10,buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:1,update:(t,r,n)=>[n[4]]}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Qe.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{texture:n}=t,{x:i,y:o}=r[n]||{x:0,y:0};return[i,o]}}})}}const _5={arc:z6,arc3d:Rg,greatcircle:a5,wall:p5,line:lA,simple:f5,flowline:r5,earthArc3d:Rg},v5=_5;class gp extends za{constructor(...t){super(...t),E(this,"type","LineLayer"),E(this,"enableShaderEncodeStyles",["stroke","offsets","opacity","thetaOffset"]),E(this,"arrowInsertCount",0),E(this,"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}})}buildModels(){var t=this;return pe(function*(){const r=t.getModelType();t.layerModel=new v5[r](t),yield t.initLayerModels()})()}getDefaultConfig(){const t=this.getModelType();return{line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{},arrow:{}}[t]}getModelType(){var t;if(this.layerType)return this.layerType;const r=this.styleAttributeService.getLayerStyleAttribute("shape");return(r==null||(t=r.scale)===null||t===void 0?void 0:t.field)||"line"}processData(t){if(this.getModelType()!=="simple")return t;const r=[];return t.map(n=>{if(Array.isArray(n.coordinates)&&Array.isArray(n.coordinates[0])&&Array.isArray(n.coordinates[0][0])){const i=he({},n);n.coordinates.map(o=>{r.push(he(he({},i),{},{coordinates:o}))})}else r.push(n)}),r}}const m5=`
layout(std140) uniform commonUniorm {
  vec4 u_stroke_color;
  float u_additive;
  float u_stroke_opacity;
  float u_stroke_width;
};

in vec4 v_color;
in float v_blur;
in float v_innerRadius;

out vec4 outputColor;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      outputColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      outputColor = mix(v_color, stroke, mixR);
    } else {
      outputColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    outputColor = v_color;
  }

  outputColor = filterColor(outputColor);
  
  if(u_additive > 0.0) {
    outputColor *= circleClipOpacity;
  } else {
    outputColor.a *= circleClipOpacity;
  }

}
`,g5=`
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;

layout(std140) uniform commonUniorm {
  vec4 u_stroke_color;
  float u_additive;
  float u_stroke_opacity;
  float u_stroke_width;
};

out vec4 v_color;
out float v_blur;
out float v_innerRadius;

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);
  
  vec2 offset = project_pixel(u_offsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }
  
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Ig(e){const t=e.coordinates;return{vertices:[...t],indices:[0],size:t.length}}class E5 extends Qt{getDefaultStyle(){return{blend:"additive"}}getCommonUniformsInfo(){const{blend:t,strokeOpacity:r=1,strokeWidth:n=0,stroke:i="#fff"}=this.layer.getLayerConfig(),o={u_stroke_color:Zt(i),u_additive:t==="additive"?1:0,u_stroke_opacity:r,u_stroke_width:n};return this.getUniformsBufferInfo(o)}initModels(){var t=this;return pe(function*(){return t.buildModels()})()}buildModels(){var t=this;return pe(function*(){return t.layer.triangulation=Ig,t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:g5,fragmentShader:m5,inject:t.getInject(),triangulation:Ig,depth:{enable:!1},primitive:g.POINTS})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Qe.Attribute,descriptor:{name:"a_Size",shaderLocation:at.SIZE,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0]]:[r]}}})}}const y5=`precision highp float;
in vec4 v_color;

#pragma include "picking"

layout(std140) uniform commonUniform {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor: 0;
  float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_globel;
  float u_r;
  float u_pickLight: 0.0;
  float u_opacitylinear: 0.0;
  float u_opacitylinear_dir: 1.0;
  float u_lightEnable: 1.0;
};
in float v_lightWeight;
in float v_barLinearZ;
out vec4 outputColor;
void main() {

   outputColor = v_color;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    outputColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,A5=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec3 a_Size;
layout(location = 11) in vec3 a_Pos;
layout(location = 13) in vec3 a_Normal;


layout(std140) uniform commonUniform {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor: 0;
  float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_globel;
  float u_r;
  float u_pickLight: 0.0;
  float u_opacitylinear: 0.0;
  float u_opacitylinear_dir: 1.0;
  float u_lightEnable: 1.0;
};

out vec4 v_color;
out float v_lightWeight;
out float v_barLinearZ;
// \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_barLinearZ =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;
  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, v_barLinearZ);
    v_color.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     v_color = a_Color;
  }
  v_color.a *= u_opacity;

    
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,{isNumber:T5}=Ar;class S5 extends Qt{constructor(...t){super(...t),E(this,"raiseCount",0),E(this,"raiseRepeat",0)}getCommonUniformsInfo(){const{animateOption:t={enable:!1,speed:.01,repeat:!1},opacity:r=1,sourceColor:n,targetColor:i,pickLight:o=!1,heightfixed:a=!0,opacityLinear:s={enable:!1,dir:"up"},lightEnable:u=!0}=this.layer.getLayerConfig();let l=0,f=[0,0,0,0],c=[0,0,0,0];if(n&&i&&(f=Zt(n),c=Zt(i),l=1),this.raiseCount<1&&this.raiseRepeat>0&&t.enable){const{speed:p=.01}=t;this.raiseCount+=p,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}const h={u_sourceColor:f,u_targetColor:c,u_linearColor:l,u_pickLight:Number(o),u_heightfixed:Number(a),u_r:t.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:T5(r)?r:1,u_opacitylinear:Number(s.enable),u_opacitylinear_dir:s.dir==="up"?1:0,u_lightEnable:Number(u)};return this.getUniformsBufferInfo(h)}initModels(){var t=this;return pe(function*(){return t.initUniformsBuffer(),t.buildModels()})()}buildModels(){var t=this;return pe(function*(){const{animateOption:{repeat:r=1}}=t.layer.getLayerConfig();return t.raiseRepeat=r,[yield t.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:A5,fragmentShader:y5,triangulation:sA,depth:{enable:!0},inject:t.getInject(),cull:{enable:!0,face:Vd(t.mapService.version)},blend:t.getBlend()})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Qe.Attribute,descriptor:{name:"a_Size",shaderLocation:at.SIZE,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:3,update:t=>{const{size:r}=t;if(r){let n=[];return Array.isArray(r)&&(n=r.length===2?[r[0],r[0],r[1]]:r),Array.isArray(r)||(n=[r,r,r]),n}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Qe.Attribute,descriptor:{name:"a_Normal",shaderLocation:at.NORMAL,buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:3,update:(t,r,n,i,o)=>o}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Qe.Attribute,descriptor:{name:"a_Pos",shaderLocation:15,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:3,update:t=>{const r=zi(t.coordinates);return oA([r[0],r[1]])}}})}}const x5=`in vec4 v_data;
in vec4 v_color;
in float v_radius;

layout(std140) uniform commonUniform {
  float u_additive;
  float u_stroke_opacity : 1;
  float u_stroke_width : 2;
  float u_blur : 0.0;
};
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 strokeColor = u_stroke == vec4(0.0) ? v_color : u_stroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    outputColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    outputColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor = filterColor(outputColor);
  }
}
`,R5=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 10) in float a_Shape;
layout(location = 11) in vec3 a_Extrude;

layout(std140) uniform commonUniform {
  float u_additive;
  float u_stroke_opacity : 1;
  float u_stroke_width : 2;
  float u_blur : 0.0;
};
out vec4 v_data;
out vec4 v_color;
out float v_radius;

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + vec3(u_offsets,0.0), 1.0);

  setPickingColor(a_PickingColor);
}`;class C5 extends Qt{getCommonUniformsInfo(){const{strokeOpacity:t=1,strokeWidth:r=0,blend:n,blur:i=0}=this.layer.getLayerConfig();this.layer.getLayerConfig();const o={u_additive:n==="additive"?1:0,u_stroke_opacity:t,u_stroke_width:r,u_blur:i};return this.getUniformsBufferInfo(o)}initModels(){var t=this;return pe(function*(){return t.initUniformsBuffer(),t.buildModels()})()}buildModels(){var t=this;return pe(function*(){return t.layer.triangulation=Sg,[yield t.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:R5,fragmentShader:x5,triangulation:Sg,inject:t.getInject(),depth:{enable:!0},blend:t.getBlend()})]})()}animateOption2Array(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Qe.Attribute,descriptor:{name:"a_Extrude",shaderLocation:at.EXTRUDE,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:3,update:(t,r,n,i)=>{const[o,a,s]=n,u=Wr(0,0,1),l=Wr(o,0,s),f=o>=0?Vv(u,l):Math.PI*2-Vv(u,l),c=Math.PI*2-Math.asin(a/100),h=Bn();qd(h,h,f),Ic(h,h,c);const d=Wr(1,1,0);dl(d,d,h),Ls(d,d);const p=Wr(-1,1,0);dl(p,p,h),Ls(p,p);const v=Wr(-1,-1,0);dl(v,v,h),Ls(v,v);const m=Wr(1,-1,0);dl(m,m,h),Ls(m,m);const y=[...d,...p,...v,...m],A=i%4*3;return[y[A],y[A+1],y[A+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Qe.Attribute,descriptor:{name:"a_Size",shaderLocation:at.SIZE,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:t=>{const{size:r=5}=t;return Array.isArray(r)?[r[0]]:[r]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Qe.Attribute,descriptor:{name:"a_Shape",shaderLocation:at.SHAPE,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:t=>{const{shape:r=2}=t;return[this.layer.getLayerConfig().shape2d.indexOf(r)]}}})}}const b5=`
in vec4 v_color;
in float v_lightWeight;
out vec4 outputColor;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};

#pragma include "scene_uniforms"
#pragma include "picking"

void main() {

  outputColor = v_color;
  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,M5=`#define pi 3.1415926535

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec3 a_Size;
layout(location = 11) in vec3 a_Extrude;
layout(location = 13) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};
out vec4 v_color;
out float v_lightWeight;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {


  vec3 size = a_Size * a_Position;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB

  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Extrude.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;

  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }

  v_lightWeight = lightWeight;

  v_color = a_Color;

    // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);
    v_color.a =  v_color.a * opacity;
  } else {
    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);
  }

    if(u_opacitylinear > 0.0) {
    v_color.a *= u_opacitylinear_dir > 0.0 ? (1.0 - a_Position.z): a_Position.z;
  }


  gl_Position = project_common_position_to_clipspace_v2(pos);

  setPickingColor(a_PickingColor);
}
`;class cA extends Qt{constructor(...t){super(...t),E(this,"raiseCount",0),E(this,"raiseRepeat",0)}getCommonUniformsInfo(){const{animateOption:t={enable:!1,speed:.01,repeat:!1},sourceColor:r,targetColor:n,pickLight:i=!1,heightfixed:o=!1,opacityLinear:a={enable:!1,dir:"up"},lightEnable:s=!0}=this.layer.getLayerConfig();let u=0,l=[0,0,0,0],f=[0,0,0,0];if(r&&n&&(l=Zt(r),f=Zt(n),u=1),this.raiseCount<1&&this.raiseRepeat>0&&t.enable){const{speed:d=.01}=t;this.raiseCount+=d,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}const c={u_pickLight:Number(i),u_heightfixed:Number(o),u_r:t.enable&&this.raiseRepeat>0?this.raiseCount:1,u_linearColor:u,u_sourceColor:l,u_targetColor:f,u_opacitylinear:Number(a.enable),u_opacitylinear_dir:a.dir==="up"?1:0,u_lightEnable:Number(s)};return this.getUniformsBufferInfo(c)}initModels(){var t=this;return pe(function*(){return t.buildModels()})()}buildModels(){var t=this;return pe(function*(){const{depth:r=!0,animateOption:{repeat:n=1}}=t.layer.getLayerConfig();return t.raiseRepeat=n,t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:M5,fragmentShader:b5,triangulation:sA,inject:t.getInject(),cull:{enable:!0,face:Vd(t.mapService.version)},depth:{enable:r}})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Qe.Attribute,descriptor:{name:"a_Size",shaderLocation:at.SIZE,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:3,update:t=>{const{size:r}=t;if(r){let n=[];return Array.isArray(r)&&(n=r.length===2?[r[0],r[0],r[1]]:r),Array.isArray(r)||(n=[r,r,r]),n}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Qe.Attribute,descriptor:{name:"a_Normal",shaderLocation:at.NORMAL,buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:3,update:(t,r,n,i,o)=>o}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Qe.Attribute,descriptor:{name:"a_Extrude",shaderLocation:at.EXTRUDE,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:3,update:t=>{const r=zi(t.coordinates);return[r[0],r[1],0]}}})}}const I5=`
layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
  float u_time;
  vec4 u_animate;
};

in vec4 v_color;
in vec4 v_stroke;
in vec4 v_data;
in float v_radius;

#pragma include "scene_uniforms"
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));
  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  if(u_stroke_width < 0.01) {
    outputColor = v_color;
  } else {
    outputColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);
  }
  float intensity = 1.0;
  if(u_time!=-1.0){
    //wave\u76F8\u5173\u903B\u8F91
    float d = length(v_data.xy);
    if(d > 0.5) {
      discard;
    }
    intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor *= intensity;//wave
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor.a *= intensity;//wave 
    outputColor = filterColor(outputColor);
  }
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if(outputColor.a < 0.01) {
    discard;
  } 
}
`,O5=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 10) in float a_Shape;
layout(location = 11) in vec3 a_Extrude;

layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
  float u_time;
  vec4 u_animate;   
};

out vec4 v_color;
out vec4 v_stroke;
out vec4 v_data;
out float v_radius;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // \u900F\u660E\u5EA6\u8BA1\u7B97
   v_stroke = stroke;  
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;



  // unpack color(vec2)
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if(u_size_unit == 1.0) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

   v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);
  vec3 aPosition = a_Position;

  offset = project_pixel(offset);
  offset = rotate_matrix(offset,rotation);
  
  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_blur_height_fixed.y;

  if(u_blur_height_fixed.z < 1.0) { // false
    raisingHeight = project_pixel(u_blur_height_fixed.y);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;
    }
  }
  
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  setPickingColor(a_PickingColor);
}
`;class fA extends Qt{getCommonUniformsInfo(){const{strokeOpacity:t=1,strokeWidth:r=0,blend:n,blur:i=0,raisingHeight:o=0,heightfixed:a=!1,unit:s="pixel"}=this.layer.getLayerConfig();let u=this.getAnimateUniforms().u_time;isNaN(u)&&(u=-1);const l={u_blur_height_fixed:[i,Number(o),Number(a)],u_stroke_width:r,u_additive:n==="additive"?1:0,u_stroke_opacity:t,u_size_unit:vp[s],u_time:u,u_animate:this.getAnimateUniforms().u_animate};return this.getUniformsBufferInfo(l)}getAnimateUniforms(){const{animateOption:t={enable:!1}}=this.layer.getLayerConfig();return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}getAttribute(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),vo)}initModels(){var t=this;return pe(function*(){return t.buildModels()})()}buildModels(){var t=this;return pe(function*(){const{frag:r,vert:n,type:i}=t.getShaders();return t.layer.triangulation=vo,t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:i,vertexShader:n,fragmentShader:r,inject:t.getInject(),triangulation:vo,depth:{enable:!1}})]})()}getShaders(){return{frag:I5,vert:O5,type:"pointFill"}}animateOption2Array(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}registerBuiltinAttributes(){const t=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Qe.Attribute,descriptor:{name:"a_Extrude",shaderLocation:at.EXTRUDE,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:3,update:(r,n,i,o)=>{const a=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],s=o%4*3;return[a[s],a[s+1],a[s+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Qe.Attribute,descriptor:{name:"a_Size",shaderLocation:at.SIZE,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:r=>{const{size:n=5}=r;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Qe.Attribute,descriptor:{name:"a_Shape",shaderLocation:at.SHAPE,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:r=>{const{shape:n=2}=r;return[t.indexOf(n)]}}})}}const P5=`in vec2 v_uv;// \u672C\u8EAB\u7684 uv \u5750\u6807
in vec2 v_Iconuv;
in float v_opacity;
out vec4 outputColor;

uniform sampler2D u_texture;
layout(std140) uniform commonUniform {
  vec2 u_textSize;
  float u_heightfixed: 0.0;
  float u_raisingHeight: 0.0;
  float u_size_unit;
};

#pragma include "scene_uniforms"
#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  outputColor = texture(SAMPLER_2D(u_texture), pos);
  outputColor.a *= v_opacity;
  outputColor = filterColor(outputColor);
}
`,N5=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 11) in vec3 a_Extrude;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniform {
  vec2 u_textSize;
  float u_heightfixed: 0.0;
  float u_raisingHeight: 0.0;
  float u_size_unit;
};

out vec2 v_uv;
out vec2 v_Iconuv;
out float v_opacity;


#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  vec3 extrude = a_Extrude;
  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;
  v_opacity = opacity;
  float newSize = a_Size;
  if(u_size_unit == 1.0) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  
  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (extrude.xy * (newSize) + offsets);

  offset = rotate_matrix(offset,rotation);

  vec3 aPosition = a_Position;

  offset = project_pixel(offset);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`;class F5 extends Qt{constructor(...t){super(...t),E(this,"meter2coord",1),E(this,"texture",void 0),E(this,"isMeter",!1),E(this,"radian",0),E(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),this.layerService.throttleRenderLayers();return}this.texture=r({data:this.iconService.getCanvas(),mag:g.LINEAR,min:g.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128,mipmap:!0}),this.textures=[this.texture]})}getCommonUniformsInfo(){const{raisingHeight:t=0,heightfixed:r=!1,unit:n="pixel"}=this.layer.getLayerConfig();if(this.rendererService.getDirty()){var i;(i=this.texture)===null||i===void 0||i.bind()}const o={u_textSize:[1024,this.iconService.canvasHeight||128],u_heightfixed:Number(r),u_raisingHeight:Number(t),u_size_unit:vp[n]};return this.getUniformsBufferInfo(o)}getAttribute(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),vo)}initModels(){var t=this;return pe(function*(){return t.iconService.on("imageUpdate",t.updateTexture),t.updateTexture(),t.buildModels()})()}buildModels(){var t=this;return pe(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:N5,fragmentShader:P5,triangulation:vo,depth:{enable:!1},inject:t.getInject(),cull:{enable:!0,face:Vd(t.mapService.version)}})]})()}clearModels(){var t;this.iconService.off("imageUpdate",this.updateTexture),(t=this.texture)===null||t===void 0||t.destroy()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Qe.Attribute,descriptor:{name:"a_Uv",shaderLocation:at.UV,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{shape:n}=t,{x:i,y:o}=r[n]||{x:-64,y:-64};return[i,o]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Qe.Attribute,descriptor:{name:"a_Extrude",shaderLocation:at.EXTRUDE,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:3,update:(t,r,n,i)=>{const o=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],a=i%4*3;return[o[a],o[a+1],o[a+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Qe.Attribute,descriptor:{name:"a_Size",shaderLocation:at.SIZE,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:t=>{const{size:r=5}=t;return Array.isArray(r)?[r[0]]:[r]}}})}}const D5=`layout(std140) uniform commonUniforms {
  vec2 u_textSize;
  float u_raisingHeight;
  float u_heightfixed;
};

uniform sampler2D u_texture;

in vec4 v_color;
in vec2 v_uv;
in float v_opacity;

#pragma include "picking"

out vec4 outputColor;

void main(){
  vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
  vec4 textureColor;

  // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
  
  textureColor = texture(SAMPLER_2D(u_texture), pos);

  // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
  float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
  if(fragmengTocenter >= 0.5) {
        float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
        textureColor.a *= luma;
  }
  
  if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
        outputColor= textureColor;
  }else {
        outputColor= step(0.01, textureColor.z) * v_color;
  }
  outputColor.a *= v_opacity;
  if (outputColor.a < 0.01) {
      discard;
  }
  outputColor = filterColor(outputColor);
}
`,B5=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_textSize;
  float u_raisingHeight;
  float u_heightfixed;
};

out vec4 v_color;
out vec2 v_uv;
out float v_opacity;

#pragma include "projection"
#pragma include "picking"

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_opacity = opacity;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(offsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;class hA extends Qt{constructor(...t){super(...t),E(this,"texture",void 0),E(this,"updateTexture",()=>{const{createTexture2D:r}=this.rendererService;if(this.texture){this.texture.update({data:this.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),setTimeout(()=>{this.layerService.throttleRenderLayers()});return}this.texture=r({data:this.iconService.getCanvas(),mag:g.LINEAR,min:g.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:this.iconService.canvasHeight||128,mipmap:!0})})}getUninforms(){if(this.rendererService.getDirty()){var t;(t=this.texture)===null||t===void 0||t.bind()}const r=this.getCommonUniformsInfo(),n=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),he(he({},r.uniformsOption),n.uniformsOption)}getCommonUniformsInfo(){const{raisingHeight:t=0,heightfixed:r=!1}=this.layer.getLayerConfig(),n={u_textSize:[1024,this.iconService.canvasHeight||128],u_raisingHeight:Number(t),u_heightfixed:Number(r),u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(n)}initModels(){var t=this;return pe(function*(){return t.iconService.on("imageUpdate",t.updateTexture),t.updateTexture(),t.buildModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}buildModels(){var t=this;return pe(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointImage",vertexShader:B5,fragmentShader:D5,triangulation:x6,inject:t.getInject(),depth:{enable:!1},primitive:g.POINTS})]})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Qe.Attribute,descriptor:{name:"a_Size",shaderLocation:at.SIZE,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:t=>{const{size:r=5}=t;return Array.isArray(r)?[r[0]]:[r]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Qe.Attribute,descriptor:{name:"a_Uv",shaderLocation:at.UV,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:t=>{const r=this.iconService.getIconMap(),{shape:n}=t,{x:i,y:o}=r[n]||{x:-64,y:-64};return[i,o]}}})}}const w5=`in vec4 v_color;
out vec4 outputColor;
void main() {
  outputColor = v_color;
}`,L5=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;

layout(std140) uniform u_Common {
  float u_size_scale;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2., -a_Size /2., 0., 0.);
    gl_Position = project_common_position_to_clipspace(project_pos);
  }

  gl_PointSize = a_Size * u_size_scale *  2.0  * u_DevicePixelRatio;
}
`;function Og(e){const t=e.coordinates;return{vertices:[...t],indices:[0],size:t.length}}class dA extends Qt{getDefaultStyle(){return{blend:"additive"}}getCommonUniformsInfo(){const t={u_size_scale:.5};return this.getUniformsBufferInfo(t)}initModels(){var t=this;return pe(function*(){return t.buildModels()})()}buildModels(){var t=this;return pe(function*(){return t.layer.triangulation=Og,t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:L5,fragmentShader:w5,triangulation:Og,inject:t.getInject(),depth:{enable:!1},primitive:g.POINTS,pick:!1})]})()}clearModels(){}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Qe.Attribute,descriptor:{name:"a_Size",shaderLocation:at.SIZE,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:t=>{const{size:r=1}=t;return Array.isArray(r)?[r[0]]:[r]}}})}}const U5=`
layout(std140) uniform commonUniorm{
  float u_additive;
  float u_size_unit;
  float u_speed: 1.0;
  float u_time;
};
in vec4 v_data;
in vec4 v_color;
in float v_radius;
in vec2 v_extrude;
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  outputColor = vec4(v_color.rgb, v_color.a);

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
  } else {
    outputColor.a *= opacity_t;
  }

  if(outputColor.a > 0.0) {
    outputColor = filterColor(outputColor);
  }

  vec2 extrude =  v_extrude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  outputColor.a *= radar_v;
}
`,k5=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 11) in vec3 a_Extrude;

layout(std140) uniform commonUniorm {
  float u_additive;
  float u_size_unit;
  float u_speed: 1.0;
  float u_time;
};

out vec4 v_data;
out vec4 v_color;
out float v_radius;
out vec2 v_extrude;

#pragma include "projection"
#pragma include "picking"

void main() {
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  v_extrude = rotateMatrix * a_Extrude.xy;

  v_color = a_Color;
  v_color.a *= opacity;

  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  if(u_size_unit == 1.) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  v_radius = newSize;

  vec2 offset = (a_Extrude.xy * (newSize));
  vec3 aPosition = a_Position;
  
  offset = project_pixel(offset);
  
  v_data = vec4(a_Extrude.x, a_Extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  setPickingColor(a_PickingColor);
}
`;class z5 extends Qt{getCommonUniformsInfo(){const{blend:t,speed:r=1,unit:n="pixel"}=this.layer.getLayerConfig(),i={u_additive:t==="additive"?1:0,u_size_unit:vp[n],u_speed:r,u_time:this.layer.getLayerAnimateTime()};return this.getUniformsBufferInfo(i)}getAnimateUniforms(){return{}}getAttribute(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),vo)}initModels(){var t=this;return pe(function*(){return t.buildModels()})()}buildModels(){var t=this;return pe(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:k5,fragmentShader:U5,triangulation:vo,inject:t.getInject(),depth:{enable:!1}})]})()}animateOption2Array(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Qe.Attribute,descriptor:{name:"a_Extrude",shaderLocation:at.EXTRUDE,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:3,update:(t,r,n,i)=>{const o=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],a=i%4*3;return[o[a],o[a+1],o[a+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Qe.Attribute,descriptor:{shaderLocation:at.SIZE,name:"a_Size",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:t=>{const{size:r=5}=t;return Array.isArray(r)?[r[0]]:[r]}}})}}class V5{constructor(t,r,n){E(this,"boxCells",[]),E(this,"xCellCount",void 0),E(this,"yCellCount",void 0),E(this,"boxKeys",void 0),E(this,"bboxes",void 0),E(this,"width",void 0),E(this,"height",void 0),E(this,"xScale",void 0),E(this,"yScale",void 0),E(this,"boxUid",void 0);const i=this.boxCells;this.xCellCount=Math.ceil(t/n),this.yCellCount=Math.ceil(r/n);for(let o=0;o<this.xCellCount*this.yCellCount;o++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0}insert(t,r,n,i,o){this.forEachCell(r,n,i,o,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(o)}query(t,r,n,i,o){return this.queryHitTest(t,r,n,i,!1,o)}hitTest(t,r,n,i,o){return this.queryHitTest(t,r,n,i,!0,o)}insertBoxCell(t,r,n,i,o,a){this.boxCells[o].push(a)}queryHitTest(t,r,n,i,o,a){if(n<0||t>this.width||i<0||r>this.height)return o?!1:[];const s=[];if(t<=0&&r<=0&&this.width<=n&&this.height<=i){if(o)return!0;for(let l=0;l<this.boxKeys.length;l++)s.push({key:this.boxKeys[l],x1:this.bboxes[l*4],y1:this.bboxes[l*4+1],x2:this.bboxes[l*4+2],y2:this.bboxes[l*4+3]});return a?s.filter(a):s}const u={hitTest:o,seenUids:{box:{},circle:{}}};return this.forEachCell(t,r,n,i,this.queryCell,s,u,a),o?s.length>0:s}queryCell(t,r,n,i,o,a,s,u){const l=s.seenUids,f=this.boxCells[o];if(f!==null){const c=this.bboxes;for(const h of f)if(!l.box[h]){l.box[h]=!0;const d=h*4;if(t<=c[d+2]&&r<=c[d+3]&&n>=c[d+0]&&i>=c[d+1]&&(!u||u(this.boxKeys[h]))){if(s.hitTest)return a.push(!0),!0;a.push({key:this.boxKeys[h],x1:c[d],y1:c[d+1],x2:c[d+2],y2:c[d+3]})}}}return!1}forEachCell(t,r,n,i,o,a,s,u){const l=this.convertToXCellCoord(t),f=this.convertToYCellCoord(r),c=this.convertToXCellCoord(n),h=this.convertToYCellCoord(i);for(let d=l;d<=c;d++)for(let p=f;p<=h;p++){const v=this.xCellCount*p+d;if(o.call(this,t,r,n,i,v,a,s,u))return}}convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}const H5=V5;class X5{constructor(t,r){E(this,"width",void 0),E(this,"height",void 0),E(this,"grid",void 0),E(this,"viewportPadding",100),E(this,"screenRightBoundary",void 0),E(this,"screenBottomBoundary",void 0),E(this,"gridRightBoundary",void 0),E(this,"gridBottomBoundary",void 0),this.width=t,this.height=r,this.viewportPadding=Math.max(t,r),this.grid=new H5(t+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=t+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=t+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}placeCollisionBox(t){const r=t.x1+t.anchorPointX+this.viewportPadding,n=t.y1+t.anchorPointY+this.viewportPadding,i=t.x2+t.anchorPointX+this.viewportPadding,o=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(r,n,i,o)||this.grid.hitTest(r,n,i,o)?{box:[]}:{box:[r,n,i,o]}}insertCollisionBox(t,r){const n={featureIndex:r};this.grid.insert(n,t[0],t[1],t[2],t[3])}project(t,r,n){const i=iP(r,n,0,1),o=X1(),a=ZO(...t);return Qd(o,i,a),{x:(o[0]/o[3]+1)/2*this.width+this.viewportPadding,y:(-o[1]/o[3]+1)/2*this.height+this.viewportPadding}}isInsideGrid(t,r,n,i){return n>=0&&t<this.gridRightBoundary&&i>=0&&r<this.gridBottomBoundary}}function pA(e){let t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0;break;default:t=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:t,verticalAlign:r}}function _A(e,t,r,n,i){if(!i)return;const o=e[n],a=o.glyph;if(a){const s=t[a].advance*o.scale,u=(e[n].x+s)*i;for(let l=r;l<=n;l++)e[l].x-=u}}function vA(e,t,r,n,i,o,a){const s=(t-r)*i,u=(-n*a+.5)*o;for(const l of e)l.x+=s,l.y+=u}function W5(e,t,r,n,i,o,a){let u=0,l=-8,f=0;const c=e.positionedGlyphs,h=o==="right"?1:o==="left"?0:.5,d=c.length;r.forEach(y=>{if(y.split("").forEach(A=>{const T=t[A],R=0;T&&(c.push({glyph:A,x:u,y:l+R,vertical:!1,scale:1,metrics:T}),u+=T.advance+a)}),c.length!==d){const A=u-a;f=Math.max(A,f),_A(c,t,d,c.length-1,h)}u=0,l-=n+5});const{horizontalAlign:p,verticalAlign:v}=pA(i);vA(c,h,p,v,f,n,r.length);const m=l- -8;e.top+=-v*m,e.bottom=e.top-m,e.left+=-p*f,e.right=e.left+f}function j5(e,t,r,n,i,o,a){let u=0,l=-8,f=0;const c=e.positionedGlyphs,h=o==="right"?1:o==="left"?0:.5,d=c.length;r.forEach(y=>{const A=t[y],T=0;if(A&&(c.push({glyph:y,x:A.advance/2,y:l+T,vertical:!1,scale:1,metrics:A}),u+=A.advance+a),c.length!==d){const R=u-a;f=Math.max(R,f),_A(c,t,d,c.length-1,h)}u=0,l-=n+5});const{horizontalAlign:p,verticalAlign:v}=pA(i);vA(c,h,p,v,f,n,r.length);const m=l- -8;e.top+=-v*m,e.bottom=e.top-m,e.left+=-p*f,e.right=e.left+f}function G5(e,t,r,n,i,o,a=[0,0],s){const u=e.split(`
`),l=[],f={positionedGlyphs:l,top:a[1],bottom:a[1],left:a[0],right:a[0],lineCount:u.length,text:e};return s?j5(f,t,u,r,n,i,o):W5(f,t,u,r,n,i,o),l.length?f:!1}function $5(e,t=[0,0],r){const{positionedGlyphs:n=[]}=e,i=[];for(const o of n){const a=o.metrics,s=4,u=a.advance*o.scale/2,l=r?[o.x+u,o.y]:[0,0],f=r?[0,0]:[o.x+u+t[0],o.y+t[1]],c=(0-s)*o.scale-u+f[0],h=(0-s)*o.scale+f[1],d=c+a.width*o.scale,p=h+a.height*o.scale,v={x:c,y:h},m={x:d,y:h},y={x:c,y:p},A={x:d,y:p};i.push({tl:v,tr:m,bl:y,br:A,tex:a,glyphOffset:l})}return i}const Pg=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0

uniform sampler2D u_sdf_map;
layout(std140) uniform commonUniforms {
  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
  vec2 u_sdf_map_size;
  float u_raisingHeight: 0.0;
  float u_stroke_width : 2;
  float u_gamma_scale : 0.5;
  float u_halo_blur : 0.5;
};

in vec2 v_uv;
in float v_gamma_scale;
in vec4 v_color;
in vec4 v_stroke_color;
in float v_fontScale;

out vec4 outputColor;

#pragma include "picking"
void main() {
  // get style data mapping

  // get sdf from atlas
  float dist = texture(SAMPLER_2D(u_sdf_map), v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);

  outputColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));

  outputColor.a *= alpha;
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if (outputColor.a < 0.01) {
    discard;
  }
  outputColor = filterColor(outputColor);
}
`,Ng=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 10) in vec2 a_textOffsets;
layout(location = 14) in vec2 a_tex;

layout(std140) uniform commonUniforms {
  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
  vec2 u_sdf_map_size;
  float u_raisingHeight: 0.0;
  float u_stroke_width : 2;
  float u_gamma_scale : 0.5;
  float u_halo_blur : 0.5;
};

out vec2 v_uv;
out float v_gamma_scale;
out vec4 v_color;
out vec4 v_stroke_color;
out float v_fontScale;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  
  v_uv = a_tex / u_sdf_map_size;



  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  vec2 offset = rotate_matrix(a_textOffsets,rotation);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));

  gl_Position = vec4(
    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`,{isEqual:Rs}=Ar;function Fg(e){const t=this,r=e.id,n=[],i=[];if(!t.glyphInfoMap||!t.glyphInfoMap[r])return{vertices:[],indices:[],size:7};const o=t.glyphInfoMap[r].centroid,a=o.length===2?[o[0],o[1],0]:o;return t.glyphInfoMap[r].glyphQuads.forEach((s,u)=>{n.push(...a,s.tex.x,s.tex.y+s.tex.height,s.tl.x,s.tl.y,...a,s.tex.x+s.tex.width,s.tex.y+s.tex.height,s.tr.x,s.tr.y,...a,s.tex.x+s.tex.width,s.tex.y,s.br.x,s.br.y,...a,s.tex.x,s.tex.y,s.bl.x,s.bl.y),i.push(0+u*4,1+u*4,2+u*4,2+u*4,3+u*4,0+u*4)}),{vertices:n,indices:i,size:7}}class mA extends Qt{constructor(...t){var r;super(...t),r=this,E(this,"glyphInfo",void 0),E(this,"glyphInfoMap",{}),E(this,"rawEncodeData",void 0),E(this,"texture",void 0),E(this,"currentZoom",-1),E(this,"extent",void 0),E(this,"textureHeight",0),E(this,"textCount",0),E(this,"preTextStyle",{}),E(this,"mapping",pe(function*(){r.initGlyph(),r.updateTexture(),yield r.reBuildModel()}))}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),he(he(he({},t.uniformsOption),r.uniformsOption),{u_sdf_map:this.textures[0]})}getCommonUniformsInfo(){const{stroke:t="#fff",strokeWidth:r=0,halo:n=.5,gamma:i=2,raisingHeight:o=0}=this.layer.getLayerConfig(),a=this.getFontServiceMapping(),s=this.getFontServiceCanvas();a&&Object.keys(a).length!==this.textCount&&s&&(this.updateTexture(),this.textCount=Object.keys(a).length),this.preTextStyle=this.getTextStyle();const u={u_stroke_color:Zt(t),u_sdf_map_size:[(s==null?void 0:s.width)||1,(s==null?void 0:s.height)||1],u_raisingHeight:Number(o),u_stroke_width:r,u_gamma_scale:i,u_halo_blur:n};return this.getUniformsBufferInfo(u)}initModels(){var t=this;return pe(function*(){return t.bindEvent(),t.extent=t.textExtent(),t.rawEncodeData=t.layer.getEncodedData(),t.preTextStyle=t.getTextStyle(),t.initUniformsBuffer(),t.buildModels()})()}buildModels(){var t=this;return pe(function*(){const{textAllowOverlap:r=!1}=t.layer.getLayerConfig();return t.initGlyph(),t.updateTexture(),r||t.filterGlyphs(),[yield t.layer.buildLayerModel({moduleName:"pointText",vertexShader:Ng,fragmentShader:Pg,inject:t.getInject(),triangulation:Fg.bind(t),depth:{enable:!1}})]})()}needUpdate(){var t=this;return pe(function*(){const{textAllowOverlap:r=!1,textAnchor:n="center",textOffset:i,padding:o,fontFamily:a,fontWeight:s}=t.getTextStyle();if(!Rs(o,t.preTextStyle.padding)||!Rs(i,t.preTextStyle.textOffset)||!Rs(n,t.preTextStyle.textAnchor)||!Rs(a,t.preTextStyle.fontFamily)||!Rs(s,t.preTextStyle.fontWeight))return yield t.mapping(),!0;if(r)return!1;const u=t.mapService.getZoom(),l=t.mapService.getBounds(),f=v1(t.extent,l);return Math.abs(t.currentZoom-u)>.5||!f||r!==t.preTextStyle.textAllowOverlap?(yield t.reBuildModel(),!0):!1})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.layer.off("remapping",this.mapping)}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Qe.Attribute,descriptor:{shaderLocation:10,name:"a_textOffsets",buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:2,update:(t,r,n)=>[n[5],n[6]]}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Qe.Attribute,descriptor:{name:"a_tex",shaderLocation:at.UV,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:(t,r,n)=>[n[3],n[4]]}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Qe.Attribute,descriptor:{name:"a_Size",shaderLocation:at.SIZE,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:t=>{const{size:r=12}=t;return Array.isArray(r)?[r[0]]:[r]}}})}bindEvent(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}textExtent(){const t=this.mapService.getBounds();return Wd(t,.5)}initTextFont(){const{fontWeight:t,fontFamily:r}=this.getTextStyle(),n=this.rawEncodeData,i=[];n.forEach(o=>{let{shape:a=""}=o;a=a.toString();for(const s of a)i.indexOf(s)===-1&&i.push(s)}),this.fontService.setFontOptions({characterSet:i,fontWeight:t,fontFamily:r,iconfont:!1})}initIconFontTex(){const{fontWeight:t,fontFamily:r}=this.getTextStyle(),n=this.rawEncodeData,i=[];n.forEach(o=>{let{shape:a=""}=o;a=`${a}`,i.indexOf(a)===-1&&i.push(a)}),this.fontService.setFontOptions({characterSet:i,fontWeight:t,fontFamily:r,iconfont:!0})}getTextStyle(){const{fontWeight:t="400",fontFamily:r="sans-serif",textAllowOverlap:n=!1,padding:i=[0,0],textAnchor:o="center",textOffset:a=[0,0],opacity:s=1,strokeOpacity:u=1,strokeWidth:l=0,stroke:f="#000"}=this.layer.getLayerConfig();return{fontWeight:t,fontFamily:r,textAllowOverlap:n,padding:i,textAnchor:o,textOffset:a,opacity:s,strokeOpacity:u,strokeWidth:l,stroke:f}}generateGlyphLayout(t){const r=this.getFontServiceMapping(),{spacing:n=2,textAnchor:i="center",textOffset:o}=this.layer.getLayerConfig(),a=this.rawEncodeData;this.glyphInfo=a.map(s=>{const{shape:u="",id:l,size:f=1}=s,c=s.textOffset?s.textOffset:o||[0,0],h=s.textAnchor?s.textAnchor:i||"center",d=G5(u.toString(),r,f,h,"left",n,c,t),p=$5(d,c,!1);return s.shaping=d,s.glyphQuads=p,s.centroid=zi(s.coordinates),s.originCentroid=s.version==="GAODE2.x"?zi(s.originCoordinates):s.originCentroid=s.centroid,this.glyphInfoMap[l]={shaping:d,glyphQuads:p,centroid:zi(s.coordinates)},s})}getFontServiceMapping(){const{fontWeight:t="400",fontFamily:r="sans-serif"}=this.layer.getLayerConfig();return this.fontService.getMappingByKey(`${r}_${t}`)}getFontServiceCanvas(){const{fontWeight:t="400",fontFamily:r="sans-serif"}=this.layer.getLayerConfig();return this.fontService.getCanvasByKey(`${r}_${t}`)}filterGlyphs(){const{padding:t=[0,0],textAllowOverlap:r=!1}=this.layer.getLayerConfig();if(r)return;this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();const{width:n,height:i}=this.rendererService.getViewportSize(),o=new X5(n,i);this.glyphInfo.filter(s=>{const{shaping:u,id:l=0}=s,f=s.version==="GAODE2.x"?s.originCentroid:s.centroid,h=s.size/16,d=this.mapService.lngLatToContainer(f),{box:p}=o.placeCollisionBox({x1:u.left*h-t[0],x2:u.right*h+t[0],y1:u.top*h-t[1],y2:u.bottom*h+t[1],anchorPointX:d.x,anchorPointY:d.y});return p&&p.length?(o.insertCollisionBox(p,l),!0):!1}).forEach(s=>{this.glyphInfoMap[s.id]=s})}initGlyph(){const{iconfont:t=!1}=this.layer.getLayerConfig();t?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(t)}updateTexture(){const{createTexture2D:t}=this.rendererService,r=this.getFontServiceCanvas();this.textureHeight=r.height,this.texture&&this.texture.destroy(),this.texture=t({data:r,mag:g.LINEAR,min:g.LINEAR,width:r.width,height:r.height}),this.textures=[this.texture]}reBuildModel(){var t=this;return pe(function*(){t.filterGlyphs();const r=yield t.layer.buildLayerModel({moduleName:"pointText",vertexShader:Ng,fragmentShader:Pg,triangulation:Fg.bind(t),inject:t.getInject(),depth:{enable:!1}});t.layer.models=[r]})()}}const Y5={fillImage:F5,fill:fA,radar:z5,image:hA,normal:dA,simplePoint:E5,extrude:cA,text:mA,earthFill:C5,earthExtrude:S5},Z5=Y5;class fc extends za{constructor(...t){super(...t),E(this,"type","PointLayer"),E(this,"enableShaderEncodeStyles",["stroke","offsets","opacity","rotation"]),E(this,"enableDataEncodeStyles",["textOffset","textAnchor"]),E(this,"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}})}buildModels(){var t=this;return pe(function*(){const r=t.getModelType();t.layerModel&&t.layerModel.clearModels(),t.layerModel=new Z5[r](t),yield t.initLayerModels()})()}rebuildModels(){var t=this;return pe(function*(){yield t.buildModels()})()}getModelTypeWillEmptyData(){if(this.shapeOption){const{field:t,values:r}=this.shapeOption,{shape2d:n}=this.getLayerConfig(),i=this.iconService.getIconMap();if(t&&(n==null?void 0:n.indexOf(t))!==-1)return"fill";if(r==="text")return"text";if(r&&r instanceof Array){for(const o of r)if(typeof o=="string"&&i.hasOwnProperty(o))return"image"}}return"normal"}getDefaultConfig(){const t=this.getModelType();return{fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}}[t]}getModelType(){const t=this.getEncodedData(),{shape2d:r,shape3d:n,billboard:i=!0}=this.getLayerConfig(),o=this.iconService.getIconMap(),a=t.find(s=>s.hasOwnProperty("shape"));if(a){const s=a.shape;return s==="dot"?"normal":s==="simple"?"simplePoint":s==="radar"?"radar":this.layerType==="fillImage"||i===!1?"fillImage":(r==null?void 0:r.indexOf(s))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(n==null?void 0:n.indexOf(s))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":o.hasOwnProperty(s)?"image":"text"}else return this.getModelTypeWillEmptyData()}}function q5(e){return gd.apply(this,arguments)}function gd(){return gd=pe(function*(e){if(window.createImageBitmap){const t=yield fetch(e);return yield createImageBitmap(yield t.blob())}else{const t=new window.Image;return new Promise(r=>{t.onload=()=>r(t),t.src=e,t.crossOrigin="Anonymous"})}}),gd.apply(this,arguments)}const K5=`layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

in vec4 v_Color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    outputColor = v_Color;
  
  outputColor = filterColor(outputColor);
}
`,Q5=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec3 a_uvs;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

out vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
float isSide = a_Position.z;
 float topU = a_uvs[0];
 float topV = 1.0 - a_uvs[1];
 float sidey = a_uvs[2];

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);

  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


 gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    // if(u_sidesurface < 1.0) {
    //   discard;
    // }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      v_Color = linearColor;
    } else {
      v_Color = a_Color;
    }

  } else {
    v_Color = a_Color;
  }

  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);


  setPickingColor(a_PickingColor);
}
`,J5=`uniform sampler2D u_texture;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

in vec4 v_Color;
in vec3 v_uvs;
in vec2 v_texture_data;

#pragma include "scene_uniforms"
#pragma include "picking"

out vec4 outputColor;

void main() {
  float opacity = u_opacity;
  float isSide = v_texture_data.x;
  float lightWeight = v_texture_data.y;
  float topU = v_uvs[0];
  float topV = 1.0 - v_uvs[1];
  float sidey = v_uvs[2];

  outputColor = texture(SAMPLER_2D(u_texture), vec2(topU, topV));
  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if (isSide < 0.999) {// \u662F\u5426\u662F\u8FB9\u7F18
    // side face
    if (u_sidesurface < 1.0) {
      discard;
    }

    if (u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      outputColor = linearColor;
    } else {
      outputColor = v_Color;
    }
  } else {
     // top face
    if (u_topsurface < 1.0) {
      discard;
    }
  }
  
  outputColor.a *= opacity;
  outputColor = filterColor(outputColor);
}
`,eL=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec3 a_uvs;


layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

out vec4 v_Color;
out vec3 v_uvs;
out vec2 v_texture_data;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);
  vec4 project_pos = project_position(pos);
  v_uvs = a_uvs;
  v_Color = a_Color;
  v_Color.a *= opacity;
   
  v_texture_data = vec2(a_Position.z, lightWeight);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));



  setPickingColor(a_PickingColor);
}
`,tL=`
layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

in vec4 v_Color;
in vec3 v_uvs;
in vec2 v_texture_data;
out vec4 outputColor;

#pragma include "scene_uniforms"
#pragma include "picking"

void main() {
  float isSide =  v_texture_data.x;
  float sidey = v_uvs[2];
  float lightWeight = v_texture_data.y;

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      outputColor = linearColor;
    } else {
      // side notuse linear
       outputColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    outputColor = v_Color;
  }

  outputColor = filterColorAlpha(outputColor, lightWeight);
}
`,rL=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec3 a_uvs;


layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

out vec4 v_Color;
out vec3 v_uvs;
out vec2 v_texture_data;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {


  v_uvs = a_uvs;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  float lightWeight = calc_lighting(pos);
  v_texture_data = vec2(a_Position.z,lightWeight);

  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  setPickingColor(a_PickingColor);
}
`;class nL extends Qt{constructor(...t){super(...t),E(this,"texture",void 0)}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),he(he({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{mapTexture:t,heightfixed:r=!1,raisingHeight:n=0,topsurface:i=!0,sidesurface:o=!0,sourceColor:a,targetColor:s}=this.layer.getLayerConfig();let u=0,l=[1,1,1,1],f=[1,1,1,1];a&&s&&(l=Zt(a),f=Zt(s),u=1);const c={u_sourceColor:l,u_targetColor:f,u_linearColor:u,u_topsurface:Number(i),u_sidesurface:Number(o),u_heightfixed:Number(r),u_raisingHeight:Number(n)};return t&&this.texture&&(c.u_texture=this.texture,this.textures=[this.texture]),this.getUniformsBufferInfo(c)}initModels(){var t=this;return pe(function*(){return yield t.loadTexture(),t.buildModels()})()}buildModels(){var t=this;return pe(function*(){const{frag:r,vert:n,type:i}=t.getShaders();return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:i,vertexShader:n,fragmentShader:r,depth:{enable:!0},inject:t.getInject(),triangulation:uA})]})()}getShaders(){const{pickLight:t,mapTexture:r}=this.layer.getLayerConfig();return r?{frag:J5,vert:eL,type:"polygonExtrudeTexture"}:t?{frag:tL,vert:rL,type:"polygonExtrudePickLight"}:{frag:K5,vert:Q5,type:"polygonExtrude"}}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy(),this.textures=[]}registerBuiltinAttributes(){const t=this.layer.getSource().extent;let r=t;const n=this.layer.coordCenter||this.layer.getSource().center;let i=r[2]-r[0],o=r[3]-r[1];if(this.mapService.version==="GAODE2.x"){const[a,s]=this.mapService.coordToAMap2RelativeCoordinates([t[0],t[1]],n),[u,l]=this.mapService.coordToAMap2RelativeCoordinates([t[2],t[3]],n);i=u-a,o=l-s,r=[a,s,u,l]}this.styleAttributeService.registerStyleAttribute({name:"uvs",type:Qe.Attribute,descriptor:{name:"a_uvs",shaderLocation:at.UV,buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:3,update:(a,s,u)=>{const l=u[0],f=u[1];return[(l-r[0])/i,(f-r[1])/o,u[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Qe.Attribute,descriptor:{name:"a_Normal",shaderLocation:at.NORMAL,buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:3,update:(a,s,u,l,f)=>f}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Qe.Attribute,descriptor:{name:"a_Size",shaderLocation:at.SIZE,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:a=>{const{size:s=10}=a;return Array.isArray(s)?[s[0]]:[s]}}})}loadTexture(){var t=this;return pe(function*(){const{mapTexture:r}=t.layer.getLayerConfig(),{createTexture2D:n}=t.rendererService;if(t.texture=n({height:1,width:1}),r){const i=yield q5(r);t.texture=n({data:i,width:i.width,height:i.height,wrapS:g.CLAMP_TO_EDGE,wrapT:g.CLAMP_TO_EDGE,min:g.LINEAR,mag:g.LINEAR})}})()}}const iL=`
in vec4 v_Color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {

  outputColor = v_Color;
  outputColor = filterColor(outputColor);
}
`,oL=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;

out vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size + (1.0 - a_Position.z) * extrusionBase, 1.0);

  vec4 project_pos = project_position(pos);
   float lightWeight = calc_lighting(project_pos);
  v_Color = a_Color;
  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}
`;class aL extends Qt{constructor(...t){super(...t),E(this,"texture",void 0)}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),he(he({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const t={};return this.getUniformsBufferInfo(t)}initModels(){var t=this;return pe(function*(){return t.buildModels()})()}buildModels(){var t=this;return pe(function*(){const{frag:r,vert:n,type:i}=t.getShaders();return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:i,vertexShader:n,fragmentShader:r,inject:t.getInject(),triangulation:uA,depth:{enable:!0}})]})()}getShaders(){return{frag:iL,vert:oL,type:"polygonExtrude"}}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Qe.Attribute,descriptor:{name:"a_Normal",shaderLocation:at.NORMAL,buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:3,update:(t,r,n,i,o)=>o}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Qe.Attribute,descriptor:{name:"a_Size",shaderLocation:at.SIZE,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:1,update:t=>{const{size:r=10}=t;return Array.isArray(r)?[r[0]]:[r]}}})}}const sL=`in vec4 v_color;
#pragma include "scene_uniforms"
#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,uL=`
layout(std140) uniform commonUniforms {
  float u_raisingHeight;
  float u_opacitylinear;
  float u_dir;
};

in vec4 v_color;
in vec3 v_linear;
in vec2 v_pos;
out vec4 outputColor;
#pragma include "scene_uniforms"
#pragma include "picking"

void main() {
  outputColor = v_color;
  if (u_opacitylinear > 0.0) {
    outputColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }
  outputColor = filterColor(outputColor);
}
`,lL=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 15) in vec3 a_linear;

layout(std140) uniform commonUniforms {
  float u_raisingHeight;
  float u_opacitylinear;
  float u_dir;
};

out vec4 v_color;
out vec3 v_linear;
out vec2 v_pos;

#pragma include "projection"
#pragma include "picking"

void main() {
  if (u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  project_pos.z += u_raisingHeight;

  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  setPickingColor(a_PickingColor);
}`,cL=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;

layout(std140) uniform commonUniforms {
  float u_raisingHeight;
};


out vec4 v_color;


#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

 
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}

`;class fL extends Qt{getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),he(he({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{raisingHeight:t=0,opacityLinear:r={enable:!1,dir:"in"}}=this.layer.getLayerConfig(),n={u_raisingHeight:Number(t),u_opacitylinear:Number(r.enable),u_dir:r.dir==="in"?1:0};return this.getUniformsBufferInfo(n)}initModels(){var t=this;return pe(function*(){return t.buildModels()})()}buildModels(){var t=this;return pe(function*(){const{frag:r,vert:n,triangulation:i,type:o}=t.getModelParams();return t.initUniformsBuffer(),t.layer.triangulation=i,[yield t.layer.buildLayerModel({moduleName:o,vertexShader:n,fragmentShader:r,inject:t.getInject(),triangulation:i,primitive:g.TRIANGLES,depth:{enable:!1}})]})()}registerBuiltinAttributes(){const{opacityLinear:t={enable:!1,dir:"in"}}=this.layer.getLayerConfig();t.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Qe.Attribute,descriptor:{name:"a_linear",shaderLocation:at.LINEAR,buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:3,update:(r,n,i)=>[i[3],i[4],i[5]]}})}getModelParams(){const{opacityLinear:t={enable:!1}}=this.layer.getLayerConfig();return t.enable?{frag:uL,vert:lL,type:"polygonLinear",triangulation:b6}:{frag:sL,vert:cL,type:"polygonFill",triangulation:wc}}}const hL=`
layout(std140) uniform commonUniforms {
  vec4 u_watercolor;
  vec4 u_watercolor2;
  float u_time;
};

in vec2 v_uv;
in float v_opacity;
out vec4 outputColor;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;

vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture(SAMPLER_2D(u_texture2),p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture(SAMPLER_2D(u_texture1),fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture(SAMPLER_2D(u_texture3), fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    
  outputColor = vec4(col, v_opacity);  
}
`,dL=`layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_uv;

layout(std140) uniform commonUniforms {
  vec4 u_watercolor;
  vec4 u_watercolor2;
  float u_time;
};


out vec2 v_uv;
out float v_opacity;

#pragma include "projection"

void main() {
  v_uv = a_uv;
  v_opacity = opacity;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`;class pL extends Qt{constructor(...t){super(...t),E(this,"texture1",void 0),E(this,"texture2",void 0),E(this,"texture3",void 0)}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),he(he({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{watercolor:t="#6D99A8",watercolor2:r="#0F121C"}=this.layer.getLayerConfig(),n={u_watercolor:Zt(t),u_watercolor2:Zt(r),u_time:this.layer.getLayerAnimateTime(),u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3};return this.textures=[this.texture1,this.texture2,this.texture3],this.getUniformsBufferInfo(n)}getAnimateUniforms(){return{u_time:this.layer.getLayerAnimateTime()}}initModels(){var t=this;return pe(function*(){return t.loadTexture(),t.buildModels()})()}buildModels(){var t=this;return pe(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:dL,fragmentShader:hL,inject:t.getInject(),triangulation:wc,primitive:g.TRIANGLES,depth:{enable:!1}})]})()}clearModels(){var t,r,n;(t=this.texture1)===null||t===void 0||t.destroy(),(r=this.texture2)===null||r===void 0||r.destroy(),(n=this.texture3)===null||n===void 0||n.destroy()}registerBuiltinAttributes(){const t=this.layer.getSource().extent,[r,n,i,o]=t,a=i-r,s=o-n;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:Qe.Attribute,descriptor:{name:"a_uv",shaderLocation:at.UV,buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:2,update:(u,l,f,c)=>{const h=u.version==="GAODE2.x"?u.originCoordinates[0][c]:f,[d,p]=h;return[(d-r)/a,(p-n)/s]}}})}loadTexture(){const{createTexture2D:t}=this.rendererService,r={height:0,width:0};this.texture1=t(r),this.texture2=t(r),this.texture3=t(r),n(o=>{this.texture1=i(o[0]),this.texture2=i(o[1]),this.texture3=i(o[2]),this.layerService.reRender()});function n(o){let a=0;const s=[];["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"].map(l=>{const f=new Image;f.crossOrigin="",f.src=l,s.push(f),f.onload=()=>{a++,a===3&&o(s)}})}function i(o){return t({data:o,width:o.width,height:o.height,wrapS:g.MIRRORED_REPEAT,wrapT:g.MIRRORED_REPEAT,min:g.LINEAR,mag:g.LINEAR})}}}const _L=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
  float u_speed;
  float u_time;
};

out vec4 outputColor;


in vec4 v_Color;
in vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {

  outputColor = v_Color;
  float spc = calSpc();
  outputColor += spc * 0.4;
}
`,vL=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 14) in vec2 a_uv;
layout(std140) uniform commonUniforms {
  float u_speed;
  float u_time;
};
out vec4 v_Color;
out vec2 v_uv;


#pragma include "projection"

void main() {
  v_uv = a_uv;
  v_Color = a_Color;
  v_Color.a *= opacity;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`;class mL extends Qt{constructor(...t){super(...t),E(this,"texture",void 0)}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),he(he({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{speed:t=.5}=this.layer.getLayerConfig(),r={u_speed:t,u_time:this.layer.getLayerAnimateTime(),u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(r)}getAnimateUniforms(){return{u_time:this.layer.getLayerAnimateTime()}}initModels(){var t=this;return pe(function*(){return t.loadTexture(),t.buildModels()})()}buildModels(){var t=this;return pe(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:vL,fragmentShader:_L,triangulation:wc,inject:t.getInject(),primitive:g.TRIANGLES,depth:{enable:!1},pickingEnabled:!1,diagnosticDerivativeUniformityEnabled:!1})]})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}registerBuiltinAttributes(){const t=this.layer.getSource().extent,[r,n,i,o]=t,a=i-r,s=o-n;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:Qe.Attribute,descriptor:{name:"a_uv",shaderLocation:at.UV,buffer:{usage:g.STATIC_DRAW,data:[],type:g.FLOAT},size:2,update:(u,l,f,c)=>{const h=u.version==="GAODE2.x"?u.originCoordinates[0][c]:f,[d,p]=h;return[(d-r)/a,(p-n)/s]}}})}loadTexture(){const{waterTexture:t}=this.layer.getLayerConfig(),{createTexture2D:r}=this.rendererService;this.texture=r({height:1,width:1});const n=new Image;n.crossOrigin="",t?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),n.src=t):n.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",n.onload=()=>{this.texture=r({data:n,width:n.width,height:n.height,wrapS:g.MIRRORED_REPEAT,wrapT:g.MIRRORED_REPEAT,min:g.LINEAR,mag:g.LINEAR}),this.layerService.reRender()}}}const gL={fill:fL,line:lA,extrude:nL,text:mA,point_fill:fA,point_image:hA,point_normal:dA,point_extrude:cA,water:mL,ocean:pL,extrusion:aL},EL=gL;class gA extends za{constructor(...t){super(...t),E(this,"type","PolygonLayer"),E(this,"enableShaderEncodeStyles",["opacity","extrusionBase","rotation","offsets","stroke"])}buildModels(){var t=this;return pe(function*(){const r=t.getModelType();t.layerModel=new EL[r](t),yield t.initLayerModels()})()}getModelType(){var t;const r=this.styleAttributeService.getLayerStyleAttribute("shape"),n=r==null||(t=r.scale)===null||t===void 0?void 0:t.field;return n==="fill"||!n?"fill":n==="extrude"?"extrude":n==="extrusion"?"extrusion":n==="water"?"water":n==="ocean"?"ocean":n==="line"?"line":this.getPointModelType()}getPointModelType(){const t=this.getEncodedData(),{shape2d:r,shape3d:n}=this.getLayerConfig(),i=this.iconService.getIconMap(),o=t.find(a=>a.hasOwnProperty("shape"));if(o){const a=o.shape;return a==="dot"?"point_normal":(r==null?void 0:r.indexOf(a))!==-1?"point_fill":(n==null?void 0:n.indexOf(a))!==-1?"point_extrude":i.hasOwnProperty(a)?"point_image":"text"}else return"fill"}}const yL=`layout(std140) uniform commonUniforms {
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  float u_clampLow;
  float u_clampHigh;
};

uniform sampler2D u_rasterTexture;
uniform sampler2D u_colorTexture;

in vec2 v_texCoord;

bool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }

out vec4 outputColor;

void main() {
  // Can use any component here since u_rasterTexture is under luminance format.
  float value = texture(SAMPLER_2D(u_rasterTexture), vec2(v_texCoord.x, v_texCoord.y)).r;
  if (value == u_noDataValue || isnan_emu(value)) {
    discard;
  } else if ((u_clampLow < 0.5 && value < u_domain[0]) || (u_clampHigh < 0.5 && value > u_domain[1])) {
    discard;
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(normalisedValue, 0));
    
    outputColor = color;
    outputColor.a = outputColor.a * u_opacity ;
    if (outputColor.a < 0.01)
      discard;
  }
}
`,AL=`
layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  float u_clampLow;
  float u_clampHigh;
};

out vec2 v_texCoord;

#pragma include "projection"

void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`;class Dg extends Qt{constructor(...t){super(...t),E(this,"texture",void 0),E(this,"colorTexture",void 0)}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),he(he({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{opacity:t=1,clampLow:r=!0,clampHigh:n=!0,noDataValue:i=-9999999,domain:o,rampColors:a}=this.layer.getLayerConfig(),s=o||zd(a);this.colorTexture=this.layer.textureService.getColorTexture(a,s);const u={u_domain:s,u_opacity:t||1,u_noDataValue:i,u_clampLow:r?1:0,u_clampHigh:(typeof n<"u"?n:r)?1:0,u_rasterTexture:this.texture,u_colorTexture:this.colorTexture};return this.textures=[this.texture,this.colorTexture],this.getUniformsBufferInfo(u)}getRasterData(t){return pe(function*(){if(Array.isArray(t.data))return{data:t.data,width:t.width,height:t.height};{const{rasterData:r,width:n,height:i}=yield t.data;return{data:Array.from(r),width:n,height:i}}})()}initModels(){var t=this;return pe(function*(){return t.buildModels()})()}buildModels(){var t=this;return pe(function*(){t.initUniformsBuffer();const r=t.layer.getSource(),{createTexture2D:n,queryVerdorInfo:i}=t.rendererService,o=r.data.dataArray[0],{data:a,width:s,height:u}=yield t.getRasterData(o);return t.texture=n({data:new Float32Array(a),width:s,height:u,format:i()==="WebGL1"?g.LUMINANCE:g.RED,type:g.FLOAT,alignment:1}),[yield t.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:AL,fragmentShader:yL,triangulation:Lc,primitive:g.TRIANGLES,depth:{enable:!1},pickingEnabled:!1})]})()}clearModels(){var t,r;(t=this.texture)===null||t===void 0||t.destroy(),(r=this.colorTexture)===null||r===void 0||r.destroy()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Qe.Attribute,descriptor:{shaderLocation:at.UV,name:"a_Uv",buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:(t,r,n)=>[n[3],n[4]]}})}}const TL=["data"],SL=["rasterData"],xL=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
 vec2 u_rminmax;
 vec2 u_gminmax;
 vec2 u_bminmax;
 float u_opacity;
 float u_noDataValue;
};

in vec2 v_texCoord;

out vec4 outputColor;

void main() {

  vec3 rgb = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y)).rgb;

  if(rgb == vec3(u_noDataValue)) {
    outputColor = vec4(0.0, 0, 0, 0.0);
  } else {
    outputColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);
  }

  if(outputColor.a < 0.01)
    discard;
 
}`,RL=`
layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
 vec2 u_rminmax;
 vec2 u_gminmax;
 vec2 u_bminmax;
 float u_opacity;
 float u_noDataValue;
};

out vec2 v_texCoord;

#pragma include "projection"

void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`;class CL extends Qt{constructor(...t){super(...t),E(this,"texture",void 0),E(this,"dataOption",{})}getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),he(he({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{opacity:t=1,noDataValue:r=0}=this.layer.getLayerConfig(),{rMinMax:n=[0,255],gMinMax:i=[0,255],bMinMax:o=[0,255]}=this.dataOption,a={u_rminmax:n,u_gminmax:i,u_bminmax:o,u_opacity:t||1,u_noDataValue:r,u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(a)}getRasterData(t){var r=this;return pe(function*(){if(Array.isArray(t.data)){const{data:a}=t,s=$n(t,TL);return r.dataOption=s,he({data:a},s)}const n=yield t.data,{rasterData:i}=n,o=$n(n,SL);return r.dataOption=o,Array.isArray(i)?he({data:i},o):he({data:Array.from(i)},o)})()}initModels(){var t=this;return pe(function*(){t.initUniformsBuffer();const r=t.layer.getSource(),{createTexture2D:n}=t.rendererService,i=r.data.dataArray[0],{data:o,width:a,height:s}=yield t.getRasterData(i);return t.texture=n({data:new Float32Array(o),width:a,height:s,format:g.RGB,type:g.FLOAT}),[yield t.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:RL,fragmentShader:xL,triangulation:Lc,primitive:g.TRIANGLES,depth:{enable:!1},pickingEnabled:!1})]})()}buildModels(){var t=this;return pe(function*(){return t.initModels()})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Qe.Attribute,descriptor:{name:"a_Uv",shaderLocation:at.UV,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:(t,r,n)=>[n[3],n[4]]}})}}const bL=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

layout(std140) uniform commonUniforms {
 vec4 u_unpack;
 vec2 u_domain;
 float u_opacity;
 float u_noDataValue;
 float u_clampLow;
 float u_clampHigh;
};

in vec2 v_texCoord;
out vec4 outputColor;


float getElevation(vec2 coord, float bias) {
    // Convert encoded elevation value to meters
    vec4 data =  texture(SAMPLER_2D(u_texture), coord,bias) * 255.0;
    data.a = -1.0;
    return dot(data, u_unpack);
}

vec4 getColor(float value) {
   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec2 coord = vec2(normalisedValue, 0);
    return  texture(SAMPLER_2D(u_colorTexture), coord);
}

void main() {
  float value = getElevation(v_texCoord,0.0);
  if (value == u_noDataValue) {
    outputColor = vec4(0.0, 0, 0, 0.0);
  } else if ((u_clampLow < 0.5 && value < u_domain[0]) || (u_clampHigh < 0.5 && value > u_domain[1])) {
     outputColor = vec4(0.0, 0, 0, 0.0);
  } else {
   
    outputColor = getColor(value);
    outputColor.a =  outputColor.a * u_opacity ;
      if(outputColor.a < 0.01)
      discard;
  }
}
`,ML=`layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
   vec4 u_unpack;
   vec2 u_domain;
   float u_opacity;
   float u_noDataValue;
   float u_clampLow;
   float u_clampHigh;
};
out vec2 v_texCoord;
#pragma include "projection"

void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`;class IL extends Qt{constructor(...t){super(...t),E(this,"texture",void 0)}getCommonUniformsInfo(){const{opacity:t,clampLow:r=!0,clampHigh:n=!0,noDataValue:i=-9999999,domain:o,rampColors:a,colorTexture:s,rScaler:u=6553.6,gScaler:l=25.6,bScaler:f=.1,offset:c=1e4}=this.layer.getLayerConfig(),h=o||zd(a);let d=s;s?this.layer.textureService.setColorTexture(s,a,h):d=this.layer.textureService.getColorTexture(a,h);const p={u_unpack:[u,l,f,c],u_domain:h,u_opacity:t||1,u_noDataValue:i,u_clampLow:r,u_clampHigh:typeof n<"u"?n:r,u_texture:this.texture,u_colorTexture:d};return this.textures=[this.texture,d],this.getUniformsBufferInfo(p)}initModels(){var t=this;return pe(function*(){t.initUniformsBuffer();const r=t.layer.getSource(),{createTexture2D:n}=t.rendererService,i=yield r.data.images;return t.texture=n({data:i[0],width:i[0].width,height:i[0].height,min:g.LINEAR,mag:g.LINEAR}),[yield t.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:ML,fragmentShader:bL,triangulation:Lc,primitive:g.TRIANGLES,depth:{enable:!1}})]})()}clearModels(){var t;(t=this.texture)===null||t===void 0||t.destroy()}buildModels(){var t=this;return pe(function*(){return t.initModels()})()}registerBuiltinAttributes(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Qe.Attribute,descriptor:{name:"a_Uv",shaderLocation:at.UV,buffer:{usage:g.DYNAMIC_DRAW,data:[],type:g.FLOAT},size:2,update:(t,r,n)=>[n[3],n[4]]}})}}const OL={raster:Dg,rasterRgb:CL,raster3d:Dg,rasterTerrainRgb:IL},PL=OL;class Ep extends za{constructor(...t){super(...t),E(this,"type","RasterLayer")}buildModels(){var t=this;return pe(function*(){const r=t.getModelType();t.layerModel=new PL[r](t),yield t.initLayerModels()})()}getDefaultConfig(){const t=this.getModelType();return{raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}}[t]}getModelType(){switch(this.layerSource.getParserType()){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"rgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}getLegend(t){if(t!=="color")return{type:void 0,field:void 0,items:[]};const r=this.getLayerConfig().rampColors;return O6(r,t)}}class NL{constructor({rendererService:t,layerService:r,parent:n}){E(this,"tileResource",new Map),E(this,"rendererService",void 0),E(this,"layerService",void 0),E(this,"parent",void 0),E(this,"layerTiles",[]),this.rendererService=t,this.layerService=r,this.parent=n}get tiles(){return this.layerTiles}hasTile(t){return this.layerTiles.some(r=>r.key===t)}addTile(t){this.layerTiles.push(t)}getTile(t){return this.layerTiles.find(r=>r.key===t)}getVisibleTileBylngLat(t){return this.layerTiles.find(r=>r.isLoaded&&r.visible&&r.lnglatInBounds(t))}removeTile(t){const r=this.layerTiles.findIndex(i=>i.key===t),n=this.layerTiles.splice(r,1);n[0]&&n[0].destroy()}updateTileVisible(t){const r=this.getTile(t.key);if(t.isVisible)if(t.parent){const n=this.isChildrenLoaded(t.parent);r==null||r.updateVisible(n)}else r==null||r.updateVisible(!0);else if(t.parent){const n=this.isChildrenLoaded(t.parent);r==null||r.updateVisible(!n)}else r==null||r.updateVisible(!1)}isParentLoaded(t){const r=t.parent;if(!r)return!0;const n=this.getTile(r==null?void 0:r.key);return!!(n!=null&&n.isLoaded)}isChildrenLoaded(t){const r=t==null?void 0:t.children;return r.length===0?!0:r.every(n=>{const i=this.getTile(n==null?void 0:n.key);return i?(i==null?void 0:i.isLoaded)===!0:!0})}render(){var t=this;return pe(function*(){const n=t.getRenderLayers().map(function(){var i=pe(function*(o){yield t.layerService.renderTileLayer(o)});return function(o){return i.apply(this,arguments)}}());yield Promise.all(n)})()}getRenderLayers(){const t=this.layerTiles.filter(n=>n.visible&&n.isLoaded),r=[];return t.map(n=>r.push(...n.getLayers())),r}getLayers(){const t=this.layerTiles.filter(n=>n.isLoaded),r=[];return t.map(n=>r.push(...n.getLayers())),r}getTiles(){return this.layerTiles}destroy(){this.layerTiles.forEach(t=>t.destroy()),this.tileResource.clear()}}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function FL(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(l){return function(f){return u([l,f])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){r.label=l[1];break}if(l[0]===6&&r.label<o[1]){r.label=o[1],o=l;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(l);break}o[2]&&r.ops.pop(),r.trys.pop();continue}l=t.call(e,r)}catch(f){l=[6,f],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}var Xi=function(){function e(t,r){this.next=null,this.key=t,this.data=r,this.left=null,this.right=null}return e}();function DL(e,t){return e>t?1:e<t?-1:0}function wi(e,t,r){for(var n=new Xi(null,null),i=n,o=n;;){var a=r(e,t.key);if(a<0){if(t.left===null)break;if(r(e,t.left.key)<0){var s=t.left;if(t.left=s.right,s.right=t,t=s,t.left===null)break}o.left=t,o=t,t=t.left}else if(a>0){if(t.right===null)break;if(r(e,t.right.key)>0){var s=t.right;if(t.right=s.left,s.left=t,t=s,t.right===null)break}i.right=t,i=t,t=t.right}else break}return i.right=t.left,o.left=t.right,t.left=n.right,t.right=n.left,t}function xh(e,t,r,n){var i=new Xi(e,t);if(r===null)return i.left=i.right=null,i;r=wi(e,r,n);var o=n(e,r.key);return o<0?(i.left=r.left,i.right=r,r.left=null):o>=0&&(i.right=r.right,i.left=r,r.right=null),i}function Bg(e,t,r){var n=null,i=null;if(t){t=wi(e,t,r);var o=r(t.key,e);o===0?(n=t.left,i=t.right):o<0?(i=t.right,t.right=null,n=t):(n=t.left,t.left=null,i=t)}return{left:n,right:i}}function BL(e,t,r){return t===null?e:(e===null||(t=wi(e.key,t,r),t.left=e),t)}function Ed(e,t,r,n,i){if(e){n(""+t+(r?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+i(e)+`
`);var o=t+(r?"    ":"\u2502   ");e.left&&Ed(e.left,o,!1,n,i),e.right&&Ed(e.right,o,!0,n,i)}}var yp=function(){function e(t){t===void 0&&(t=DL),this._root=null,this._size=0,this._comparator=t}return e.prototype.insert=function(t,r){return this._size++,this._root=xh(t,r,this._root,this._comparator)},e.prototype.add=function(t,r){var n=new Xi(t,r);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=wi(t,this._root,i),a=i(t,o.key);return a===0?this._root=o:(a<0?(n.left=o.left,n.right=o,o.left=null):a>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},e.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},e.prototype._remove=function(t,r,n){var i;if(r===null)return null;r=wi(t,r,n);var o=n(t,r.key);return o===0?(r.left===null?i=r.right:(i=wi(t,r.left,n),i.right=r.right),this._size--,i):r},e.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=wi(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},e.prototype.findStatic=function(t){for(var r=this._root,n=this._comparator;r;){var i=n(t,r.key);if(i===0)return r;i<0?r=r.left:r=r.right}return null},e.prototype.find=function(t){return this._root&&(this._root=wi(t,this._root,this._comparator),this._comparator(t,this._root.key)!==0)?null:this._root},e.prototype.contains=function(t){for(var r=this._root,n=this._comparator;r;){var i=n(t,r.key);if(i===0)return!0;i<0?r=r.left:r=r.right}return!1},e.prototype.forEach=function(t,r){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),t.call(r,n),n=n.right):o=!0;return this},e.prototype.range=function(t,r,n,i){for(var o=[],a=this._comparator,s=this._root,u;o.length!==0||s;)if(s)o.push(s),s=s.left;else{if(s=o.pop(),u=a(s.key,r),u>0)break;if(a(s.key,t)>=0&&n.call(i,s))return this;s=s.right}return this},e.prototype.keys=function(){var t=[];return this.forEach(function(r){var n=r.key;return t.push(n)}),t},e.prototype.values=function(){var t=[];return this.forEach(function(r){var n=r.data;return t.push(n)}),t},e.prototype.min=function(){return this._root?this.minNode(this._root).key:null},e.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},e.prototype.minNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.left;)t=t.left;return t},e.prototype.maxNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.right;)t=t.right;return t},e.prototype.at=function(t){for(var r=this._root,n=!1,i=0,o=[];!n;)if(r)o.push(r),r=r.left;else if(o.length>0){if(r=o.pop(),i===t)return r;i++,r=r.right}else n=!0;return null},e.prototype.next=function(t){var r=this._root,n=null;if(t.right){for(n=t.right;n.left;)n=n.left;return n}for(var i=this._comparator;r;){var o=i(t.key,r.key);if(o===0)break;o<0?(n=r,r=r.left):r=r.right}return n},e.prototype.prev=function(t){var r=this._root,n=null;if(t.left!==null){for(n=t.left;n.right;)n=n.right;return n}for(var i=this._comparator;r;){var o=i(t.key,r.key);if(o===0)break;o<0?r=r.left:(n=r,r=r.right)}return n},e.prototype.clear=function(){return this._root=null,this._size=0,this},e.prototype.toList=function(){return LL(this._root)},e.prototype.load=function(t,r,n){r===void 0&&(r=[]),n===void 0&&(n=!1);var i=t.length,o=this._comparator;if(n&&Td(t,r,0,i-1,o),this._root===null)this._root=yd(t,r,0,i),this._size=i;else{var a=UL(this.toList(),wL(t,r),o);i=this._size+i,this._root=Ad({head:a},0,i)}return this},e.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),e.prototype.toString=function(t){t===void 0&&(t=function(n){return String(n.key)});var r=[];return Ed(this._root,"",!0,function(n){return r.push(n)},t),r.join("")},e.prototype.update=function(t,r,n){var i=this._comparator,o=Bg(t,this._root,i),a=o.left,s=o.right;i(t,r)<0?s=xh(r,n,s,i):a=xh(r,n,a,i),this._root=BL(a,s,i)},e.prototype.split=function(t){return Bg(t,this._root,this._comparator)},e.prototype[Symbol.iterator]=function(){var t,r,n;return FL(this,function(i){switch(i.label){case 0:t=this._root,r=[],n=!1,i.label=1;case 1:return n?[3,6]:t===null?[3,2]:(r.push(t),t=t.left,[3,5]);case 2:return r.length===0?[3,4]:(t=r.pop(),[4,t]);case 3:return i.sent(),t=t.right,[3,5];case 4:n=!0,i.label=5;case 5:return[3,1];case 6:return[2]}})},e}();function yd(e,t,r,n){var i=n-r;if(i>0){var o=r+Math.floor(i/2),a=e[o],s=t[o],u=new Xi(a,s);return u.left=yd(e,t,r,o),u.right=yd(e,t,o+1,n),u}return null}function wL(e,t){for(var r=new Xi(null,null),n=r,i=0;i<e.length;i++)n=n.next=new Xi(e[i],t[i]);return n.next=null,r.next}function LL(e){for(var t=e,r=[],n=!1,i=new Xi(null,null),o=i;!n;)t?(r.push(t),t=t.left):r.length>0?(t=o=o.next=r.pop(),t=t.right):n=!0;return o.next=null,i.next}function Ad(e,t,r){var n=r-t;if(n>0){var i=t+Math.floor(n/2),o=Ad(e,t,i),a=e.head;return a.left=o,e.head=e.head.next,a.right=Ad(e,i+1,r),a}return null}function UL(e,t,r){for(var n=new Xi(null,null),i=n,o=e,a=t;o!==null&&a!==null;)r(o.key,a.key)<0?(i.next=o,o=o.next):(i.next=a,a=a.next),i=i.next;return o!==null?i.next=o:a!==null&&(i.next=a),n.next}function Td(e,t,r,n,i){if(!(r>=n)){for(var o=e[r+n>>1],a=r-1,s=n+1;;){do a++;while(i(e[a],o)<0);do s--;while(i(e[s],o)>0);if(a>=s)break;var u=e[a];e[a]=e[s],e[s]=u,u=t[a],t[a]=t[s],t[s]=u}Td(e,t,r,s,i),Td(e,t,s+1,n,i)}}const Cs=(e,t)=>e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y,Sd=(e,t)=>{if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;const r=e.ll.x<t.ll.x?t.ll.x:e.ll.x,n=e.ur.x<t.ur.x?e.ur.x:t.ur.x,i=e.ll.y<t.ll.y?t.ll.y:e.ll.y,o=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:r,y:i},ur:{x:n,y:o}}};let Ui=Number.EPSILON;Ui===void 0&&(Ui=Math.pow(2,-52));const kL=Ui*Ui,wg=(e,t)=>{if(-Ui<e&&e<Ui&&-Ui<t&&t<Ui)return 0;const r=e-t;return r*r<kL*e*t?0:e<t?-1:1};class zL{constructor(){this.reset()}reset(){this.xRounder=new Lg,this.yRounder=new Lg}round(t,r){return{x:this.xRounder.round(t),y:this.yRounder.round(r)}}}class Lg{constructor(){this.tree=new yp,this.round(0)}round(t){const r=this.tree.add(t),n=this.tree.prev(r);if(n!==null&&wg(r.key,n.key)===0)return this.tree.remove(t),n.key;const i=this.tree.next(r);return i!==null&&wg(r.key,i.key)===0?(this.tree.remove(t),i.key):t}}const pu=new zL,Ll=(e,t)=>e.x*t.y-e.y*t.x,EA=(e,t)=>e.x*t.x+e.y*t.y,Ug=(e,t,r)=>{const n=Wx(e.x,e.y,t.x,t.y,r.x,r.y);return n>0?-1:n<0?1:0},hc=e=>Math.sqrt(EA(e,e)),VL=(e,t,r)=>{const n={x:t.x-e.x,y:t.y-e.y},i={x:r.x-e.x,y:r.y-e.y};return Ll(i,n)/hc(i)/hc(n)},HL=(e,t,r)=>{const n={x:t.x-e.x,y:t.y-e.y},i={x:r.x-e.x,y:r.y-e.y};return EA(i,n)/hc(i)/hc(n)},kg=(e,t,r)=>t.y===0?null:{x:e.x+t.x/t.y*(r-e.y),y:r},zg=(e,t,r)=>t.x===0?null:{x:r,y:e.y+t.y/t.x*(r-e.x)},XL=(e,t,r,n)=>{if(t.x===0)return zg(r,n,e.x);if(n.x===0)return zg(e,t,r.x);if(t.y===0)return kg(r,n,e.y);if(n.y===0)return kg(e,t,r.y);const i=Ll(t,n);if(i==0)return null;const o={x:r.x-e.x,y:r.y-e.y},a=Ll(o,t)/i,s=Ll(o,n)/i,u=e.x+s*t.x,l=r.x+a*n.x,f=e.y+s*t.y,c=r.y+a*n.y,h=(u+l)/2,d=(f+c)/2;return{x:h,y:d}};class Fn{static compare(t,r){const n=Fn.comparePoints(t.point,r.point);return n!==0?n:(t.point!==r.point&&t.link(r),t.isLeft!==r.isLeft?t.isLeft?1:-1:Vi.compare(t.segment,r.segment))}static comparePoints(t,r){return t.x<r.x?-1:t.x>r.x?1:t.y<r.y?-1:t.y>r.y?1:0}constructor(t,r){t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=r}link(t){if(t.point===this.point)throw new Error("Tried to link already linked events");const r=t.point.events;for(let n=0,i=r.length;n<i;n++){const o=r[n];this.point.events.push(o),o.point=this.point}this.checkForConsuming()}checkForConsuming(){const t=this.point.events.length;for(let r=0;r<t;r++){const n=this.point.events[r];if(n.segment.consumedBy===void 0)for(let i=r+1;i<t;i++){const o=this.point.events[i];o.consumedBy===void 0&&n.otherSE.point.events===o.otherSE.point.events&&n.segment.consume(o.segment)}}}getAvailableLinkedEvents(){const t=[];for(let r=0,n=this.point.events.length;r<n;r++){const i=this.point.events[r];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&t.push(i)}return t}getLeftmostComparator(t){const r=new Map,n=i=>{const o=i.otherSE;r.set(i,{sine:VL(this.point,t.point,o.point),cosine:HL(this.point,t.point,o.point)})};return(i,o)=>{r.has(i)||n(i),r.has(o)||n(o);const{sine:a,cosine:s}=r.get(i),{sine:u,cosine:l}=r.get(o);return a>=0&&u>=0?s<l?1:s>l?-1:0:a<0&&u<0?s<l?-1:s>l?1:0:u<a?-1:u>a?1:0}}}let WL=0;class Vi{static compare(t,r){const n=t.leftSE.point.x,i=r.leftSE.point.x,o=t.rightSE.point.x,a=r.rightSE.point.x;if(a<n)return 1;if(o<i)return-1;const s=t.leftSE.point.y,u=r.leftSE.point.y,l=t.rightSE.point.y,f=r.rightSE.point.y;if(n<i){if(u<s&&u<l)return 1;if(u>s&&u>l)return-1;const c=t.comparePoint(r.leftSE.point);if(c<0)return 1;if(c>0)return-1;const h=r.comparePoint(t.rightSE.point);return h!==0?h:-1}if(n>i){if(s<u&&s<f)return-1;if(s>u&&s>f)return 1;const c=r.comparePoint(t.leftSE.point);if(c!==0)return c;const h=t.comparePoint(r.rightSE.point);return h<0?1:h>0?-1:1}if(s<u)return-1;if(s>u)return 1;if(o<a){const c=r.comparePoint(t.rightSE.point);if(c!==0)return c}if(o>a){const c=t.comparePoint(r.rightSE.point);if(c<0)return 1;if(c>0)return-1}if(o!==a){const c=l-s,h=o-n,d=f-u,p=a-i;if(c>h&&d<p)return 1;if(c<h&&d>p)return-1}return o>a?1:o<a||l<f?-1:l>f?1:t.id<r.id?-1:t.id>r.id?1:0}constructor(t,r,n,i){this.id=++WL,this.leftSE=t,t.segment=this,t.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=t,this.rings=n,this.windings=i}static fromRing(t,r,n){let i,o,a;const s=Fn.comparePoints(t,r);if(s<0)i=t,o=r,a=1;else if(s>0)i=r,o=t,a=-1;else throw new Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);const u=new Fn(i,!0),l=new Fn(o,!1);return new Vi(u,l,[n],[a])}replaceRightSE(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const t=this.leftSE.point.y,r=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<r?t:r},ur:{x:this.rightSE.point.x,y:t>r?t:r}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}comparePoint(t){if(this.isAnEndpoint(t))return 0;const r=this.leftSE.point,n=this.rightSE.point,i=this.vector();if(r.x===n.x)return t.x===r.x?0:t.x<r.x?1:-1;const o=(t.y-r.y)/i.y,a=r.x+o*i.x;if(t.x===a)return 0;const s=(t.x-r.x)/i.x,u=r.y+s*i.y;return t.y===u?0:t.y<u?-1:1}getIntersection(t){const r=this.bbox(),n=t.bbox(),i=Sd(r,n);if(i===null)return null;const o=this.leftSE.point,a=this.rightSE.point,s=t.leftSE.point,u=t.rightSE.point,l=Cs(r,s)&&this.comparePoint(s)===0,f=Cs(n,o)&&t.comparePoint(o)===0,c=Cs(r,u)&&this.comparePoint(u)===0,h=Cs(n,a)&&t.comparePoint(a)===0;if(f&&l)return h&&!c?a:!h&&c?u:null;if(f)return c&&o.x===u.x&&o.y===u.y?null:o;if(l)return h&&a.x===s.x&&a.y===s.y?null:s;if(h&&c)return null;if(h)return a;if(c)return u;const d=XL(o,this.vector(),s,t.vector());return d===null||!Cs(i,d)?null:pu.round(d.x,d.y)}split(t){const r=[],n=t.events!==void 0,i=new Fn(t,!0),o=new Fn(t,!1),a=this.rightSE;this.replaceRightSE(o),r.push(o),r.push(i);const s=new Vi(i,a,this.rings.slice(),this.windings.slice());return Fn.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),Fn.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(i.checkForConsuming(),o.checkForConsuming()),r}swapEvents(){const t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let r=0,n=this.windings.length;r<n;r++)this.windings[r]*=-1}consume(t){let r=this,n=t;for(;r.consumedBy;)r=r.consumedBy;for(;n.consumedBy;)n=n.consumedBy;const i=Vi.compare(r,n);if(i!==0){if(i>0){const o=r;r=n,n=o}if(r.prev===n){const o=r;r=n,n=o}for(let o=0,a=n.rings.length;o<a;o++){const s=n.rings[o],u=n.windings[o],l=r.rings.indexOf(s);l===-1?(r.rings.push(s),r.windings.push(u)):r.windings[l]+=u}n.rings=null,n.windings=null,n.consumedBy=r,n.leftSE.consumedBy=r.leftSE,n.rightSE.consumedBy=r.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};const r=this._afterState.rings,n=this._afterState.windings,i=this._afterState.multiPolys;for(let s=0,u=this.rings.length;s<u;s++){const l=this.rings[s],f=this.windings[s],c=r.indexOf(l);c===-1?(r.push(l),n.push(f)):n[c]+=f}const o=[],a=[];for(let s=0,u=r.length;s<u;s++){if(n[s]===0)continue;const l=r[s],f=l.poly;if(a.indexOf(f)===-1)if(l.isExterior)o.push(f);else{a.indexOf(f)===-1&&a.push(f);const c=o.indexOf(l.poly);c!==-1&&o.splice(c,1)}}for(let s=0,u=o.length;s<u;s++){const l=o[s].multiPoly;i.indexOf(l)===-1&&i.push(l)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const t=this.beforeState().multiPolys,r=this.afterState().multiPolys;switch(Wn.type){case"union":{const n=t.length===0,i=r.length===0;this._isInResult=n!==i;break}case"intersection":{let n,i;t.length<r.length?(n=t.length,i=r.length):(n=r.length,i=t.length),this._isInResult=i===Wn.numMultiPolys&&n<i;break}case"xor":{const n=Math.abs(t.length-r.length);this._isInResult=n%2===1;break}case"difference":{const n=i=>i.length===1&&i[0].isSubject;this._isInResult=n(t)!==n(r);break}default:throw new Error(`Unrecognized operation type found ${Wn.type}`)}return this._isInResult}}class Vg{constructor(t,r,n){if(!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=r,this.isExterior=n,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const i=pu.round(t[0][0],t[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let o=i;for(let a=1,s=t.length;a<s;a++){if(typeof t[a][0]!="number"||typeof t[a][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let u=pu.round(t[a][0],t[a][1]);u.x===o.x&&u.y===o.y||(this.segments.push(Vi.fromRing(o,u,this)),u.x<this.bbox.ll.x&&(this.bbox.ll.x=u.x),u.y<this.bbox.ll.y&&(this.bbox.ll.y=u.y),u.x>this.bbox.ur.x&&(this.bbox.ur.x=u.x),u.y>this.bbox.ur.y&&(this.bbox.ur.y=u.y),o=u)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(Vi.fromRing(o,i,this))}getSweepEvents(){const t=[];for(let r=0,n=this.segments.length;r<n;r++){const i=this.segments[r];t.push(i.leftSE),t.push(i.rightSE)}return t}}class jL{constructor(t,r){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Vg(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,i=t.length;n<i;n++){const o=new Vg(t[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=r}getSweepEvents(){const t=this.exteriorRing.getSweepEvents();for(let r=0,n=this.interiorRings.length;r<n;r++){const i=this.interiorRings[r].getSweepEvents();for(let o=0,a=i.length;o<a;o++)t.push(i[o])}return t}}class Hg{constructor(t,r){if(!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch(n){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let n=0,i=t.length;n<i;n++){const o=new jL(t[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=r}getSweepEvents(){const t=[];for(let r=0,n=this.polys.length;r<n;r++){const i=this.polys[r].getSweepEvents();for(let o=0,a=i.length;o<a;o++)t.push(i[o])}return t}}class dc{static factory(t){const r=[];for(let n=0,i=t.length;n<i;n++){const o=t[n];if(!o.isInResult()||o.ringOut)continue;let a=null,s=o.leftSE,u=o.rightSE;const l=[s],f=s.point,c=[];for(;a=s,s=u,l.push(s),s.point!==f;)for(;;){const h=s.getAvailableLinkedEvents();if(h.length===0){const v=l[0].point,m=l[l.length-1].point;throw new Error(`Unable to complete output ring starting at [${v.x}, ${v.y}]. Last matching segment found ends at [${m.x}, ${m.y}].`)}if(h.length===1){u=h[0].otherSE;break}let d=null;for(let v=0,m=c.length;v<m;v++)if(c[v].point===s.point){d=v;break}if(d!==null){const v=c.splice(d)[0],m=l.splice(v.index);m.unshift(m[0].otherSE),r.push(new dc(m.reverse()));continue}c.push({index:l.length,point:s.point});const p=s.getLeftmostComparator(a);u=h.sort(p)[0].otherSE;break}r.push(new dc(l))}return r}constructor(t){this.events=t;for(let r=0,n=t.length;r<n;r++)t[r].segment.ringOut=this;this.poly=null}getGeom(){let t=this.events[0].point;const r=[t];for(let l=1,f=this.events.length-1;l<f;l++){const c=this.events[l].point,h=this.events[l+1].point;Ug(c,t,h)!==0&&(r.push(c),t=c)}if(r.length===1)return null;const n=r[0],i=r[1];Ug(n,t,i)===0&&r.shift(),r.push(r[0]);const o=this.isExteriorRing()?1:-1,a=this.isExteriorRing()?0:r.length-1,s=this.isExteriorRing()?r.length:-1,u=[];for(let l=a;l!=s;l+=o)u.push([r[l].x,r[l].y]);return u}isExteriorRing(){if(this._isExteriorRing===void 0){const t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let t=this.events[0];for(let i=1,o=this.events.length;i<o;i++){const a=this.events[i];Fn.compare(t,a)>0&&(t=a)}let r=t.segment.prevInResult(),n=r?r.prevInResult():null;for(;;){if(!r)return null;if(!n)return r.ringOut;if(n.ringOut!==r.ringOut)return n.ringOut.enclosingRing()!==r.ringOut?r.ringOut:r.ringOut.enclosingRing();r=n.prevInResult(),n=r?r.prevInResult():null}}}class Xg{constructor(t){this.exteriorRing=t,t.poly=this,this.interiorRings=[]}addInterior(t){this.interiorRings.push(t),t.poly=this}getGeom(){const t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(let r=0,n=this.interiorRings.length;r<n;r++){const i=this.interiorRings[r].getGeom();i!==null&&t.push(i)}return t}}class GL{constructor(t){this.rings=t,this.polys=this._composePolys(t)}getGeom(){const t=[];for(let r=0,n=this.polys.length;r<n;r++){const i=this.polys[r].getGeom();i!==null&&t.push(i)}return t}_composePolys(t){const r=[];for(let n=0,i=t.length;n<i;n++){const o=t[n];if(!o.poly)if(o.isExteriorRing())r.push(new Xg(o));else{const a=o.enclosingRing();a.poly||r.push(new Xg(a)),a.poly.addInterior(o)}}return r}}class $L{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Vi.compare;this.queue=t,this.tree=new yp(r),this.segments=[]}process(t){const r=t.segment,n=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(r),n;const i=t.isLeft?this.tree.add(r):this.tree.find(r);if(!i)throw new Error(`Unable to find segment #${r.id} [${r.leftSE.point.x}, ${r.leftSE.point.y}] -> [${r.rightSE.point.x}, ${r.rightSE.point.y}] in SweepLine tree.`);let o=i,a=i,s,u;for(;s===void 0;)o=this.tree.prev(o),o===null?s=null:o.key.consumedBy===void 0&&(s=o.key);for(;u===void 0;)a=this.tree.next(a),a===null?u=null:a.key.consumedBy===void 0&&(u=a.key);if(t.isLeft){let l=null;if(s){const c=s.getIntersection(r);if(c!==null&&(r.isAnEndpoint(c)||(l=c),!s.isAnEndpoint(c))){const h=this._splitSafely(s,c);for(let d=0,p=h.length;d<p;d++)n.push(h[d])}}let f=null;if(u){const c=u.getIntersection(r);if(c!==null&&(r.isAnEndpoint(c)||(f=c),!u.isAnEndpoint(c))){const h=this._splitSafely(u,c);for(let d=0,p=h.length;d<p;d++)n.push(h[d])}}if(l!==null||f!==null){let c=null;l===null?c=f:f===null?c=l:c=Fn.comparePoints(l,f)<=0?l:f,this.queue.remove(r.rightSE),n.push(r.rightSE);const h=r.split(c);for(let d=0,p=h.length;d<p;d++)n.push(h[d])}n.length>0?(this.tree.remove(r),n.push(t)):(this.segments.push(r),r.prev=s)}else{if(s&&u){const l=s.getIntersection(u);if(l!==null){if(!s.isAnEndpoint(l)){const f=this._splitSafely(s,l);for(let c=0,h=f.length;c<h;c++)n.push(f[c])}if(!u.isAnEndpoint(l)){const f=this._splitSafely(u,l);for(let c=0,h=f.length;c<h;c++)n.push(f[c])}}}this.tree.remove(r)}return n}_splitSafely(t,r){this.tree.remove(t);const n=t.rightSE;this.queue.remove(n);const i=t.split(r);return i.push(n),t.consumedBy===void 0&&this.tree.add(t),i}}const Wg=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,YL=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class ZL{run(t,r,n){Wn.type=t,pu.reset();const i=[new Hg(r,!0)];for(let c=0,h=n.length;c<h;c++)i.push(new Hg(n[c],!1));if(Wn.numMultiPolys=i.length,Wn.type==="difference"){const c=i[0];let h=1;for(;h<i.length;)Sd(i[h].bbox,c.bbox)!==null?h++:i.splice(h,1)}if(Wn.type==="intersection")for(let c=0,h=i.length;c<h;c++){const d=i[c];for(let p=c+1,v=i.length;p<v;p++)if(Sd(d.bbox,i[p].bbox)===null)return[]}const o=new yp(Fn.compare);for(let c=0,h=i.length;c<h;c++){const d=i[c].getSweepEvents();for(let p=0,v=d.length;p<v;p++)if(o.insert(d[p]),o.size>Wg)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const a=new $L(o);let s=o.size,u=o.pop();for(;u;){const c=u.key;if(o.size===s){const d=c.segment;throw new Error(`Unable to pop() ${c.isLeft?"left":"right"} SweepEvent [${c.point.x}, ${c.point.y}] from segment #${d.id} [${d.leftSE.point.x}, ${d.leftSE.point.y}] -> [${d.rightSE.point.x}, ${d.rightSE.point.y}] from queue.`)}if(o.size>Wg)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(a.segments.length>YL)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const h=a.process(c);for(let d=0,p=h.length;d<p;d++){const v=h[d];v.consumedBy===void 0&&o.insert(v)}s=o.size,u=o.pop()}pu.reset();const l=dc.factory(a.segments);return new GL(l).getGeom()}}const Wn=new ZL,qL=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return Wn.run("union",e,r)},KL=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return Wn.run("intersection",e,r)},QL=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return Wn.run("xor",e,r)},JL=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return Wn.run("difference",e,r)};var e7={union:qL,intersection:KL,xor:QL,difference:JL};function t7(e,t,r){r===void 0&&(r={});var n=A0(e),i=A0(t),o=e7.union(n.coordinates,i.coordinates);return o.length===0?null:o.length===1?Nd(o[0],r.properties):e2(o,r.properties)}class r7{getCombineFeature(t){let r=null;const n=t[0];return t.map(i=>{const o=Nd(i.coordinates);r===null?r=o:r=t7(r,o)}),n&&(r.properties=he({},n)),r}}const bs="select",Ms="active";class n7{constructor({layerService:t,tileLayerService:r,parent:n}){E(this,"layerService",void 0),E(this,"tileLayerService",void 0),E(this,"tileSourceService",void 0),E(this,"parent",void 0),E(this,"tilePickID",new Map),this.layerService=t,this.tileLayerService=r,this.parent=n,this.tileSourceService=new r7}pickRender(t){const r=this.tileLayerService.getVisibleTileBylngLat(t.lngLat);if(r){const n=r.getMainLayer();n==null||n.layerPickService.pickRender(t)}}pick(t,r){var n=this;return pe(function*(){const o=n.parent.getContainer().pickingService;if(t.type==="RasterLayer"){const a=n.tileLayerService.getVisibleTileBylngLat(r.lngLat);if(a&&a.getMainLayer()!==void 0){const s=a.getMainLayer();return s.layerPickService.pickRasterLayer(s,r,n.parent)}return!1}return n.pickRender(r),o.pickFromPickingFBO(t,r)})()}selectFeature(t){const[r,n,i]=t,o=this.color2PickId(r,n,i);this.tilePickID.set(bs,o),this.updateHighLight(r,n,i,bs)}highlightPickedFeature(t){const[r,n,i]=t,o=this.color2PickId(r,n,i);this.tilePickID.set(Ms,o),this.updateHighLight(r,n,i,Ms)}updateHighLight(t,r,n,i){this.tileLayerService.tiles.map(o=>{const a=o.getMainLayer();switch(i){case bs:a==null||a.hooks.beforeSelect.call([t,r,n]);break;case Ms:a==null||a.hooks.beforeHighlight.call([t,r,n]);break}})}setPickState(){const t=this.tilePickID.get(bs),r=this.tilePickID.get(Ms);if(t){const[n,i,o]=this.pickId2Color(t);this.updateHighLight(n,i,o,bs);return}if(r){const[n,i,o]=this.pickId2Color(r);this.updateHighLight(n,i,o,Ms);return}}color2PickId(t,r,n){return _o(new Uint8Array([t,r,n]))}pickId2Color(t){return Ra(t)}getFeatureById(t){const r=this.tileLayerService.getTiles().filter(i=>i.visible),n=[];return r.forEach(i=>{n.push(...i.getFeatureById(t))}),n}pickRasterLayer(){return!1}}function i7(e){return e==="PolygonLayer"?gA:e==="LineLayer"?gp:fc}function o7(e){return["PolygonLayer","LineLayer"].indexOf(e)!==-1}class Ro extends vn.exports.EventEmitter{constructor(t,r){super(),E(this,"x",void 0),E(this,"y",void 0),E(this,"z",void 0),E(this,"key",void 0),E(this,"parent",void 0),E(this,"sourceTile",void 0),E(this,"visible",!0),E(this,"layers",[]),E(this,"isLoaded",!1),E(this,"tileMaskLayers",[]),E(this,"tileMask",void 0),this.parent=r,this.sourceTile=t,this.x=t.x,this.y=t.y,this.z=t.z,this.key=`${this.x}_${this.y}_${this.z}`}getLayers(){return this.layers}styleUpdate(...t){}lnglatInBounds(t){const[r,n,i,o]=this.sourceTile.bounds,{lng:a,lat:s}=t;return a>=r&&a<=i&&s>=n&&s<=o}getLayerOptions(){var t;const r=this.parent.getLayerConfig();return he(he({},r),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:o7(this.parent.type),mask:r.mask||((t=r.maskLayers)===null||t===void 0?void 0:t.length)!==0&&r.enableMask})}getMaskLayer(){const{maskLayers:t}=this.parent.getLayerConfig(),r=[];return t==null||t.forEach(n=>{if(!n.tileLayer)return r.push(n),n;const o=n.tileLayer.getTile(this.sourceTile.key),a=o==null?void 0:o.getLayers()[0];a&&r.push(a)}),r}addTileMask(){var t=this;return pe(function*(){const r=new gA({name:"mask",visible:!0,enablePicking:!1}).source({type:"FeatureCollection",features:[t.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill").color("#0f0").style({opacity:.5}),n=Zs(t.parent.container);r.setContainer(n),yield r.init(),t.tileMask=r;const i=t.getMainLayer();return i!==void 0&&(i.tileMask=r),r})()}addMask(t,r){var n=this;return pe(function*(){const i=Zs(n.parent.container);r.setContainer(i),yield r.init(),t.addMask(r),n.tileMaskLayers.push(r)})()}addLayer(t){var r=this;return pe(function*(){t.isTileLayer=!0;const n=Zs(r.parent.container);t.setContainer(n),r.layers.push(t),yield t.init()})()}updateVisible(t){this.visible=t,this.updateOptions("visible",t)}updateOptions(t,r){this.layers.forEach(n=>{n.updateLayerConfig({[t]:r})})}getMainLayer(){return this.layers[0]}getFeatures(t){return[]}getFeatureById(t){return[]}destroy(){var t;(t=this.tileMask)===null||t===void 0||t.destroy(),this.layers.forEach(r=>r.destroy())}}class a7 extends Ro{initTileLayer(){var t=this;return pe(function*(){const r=t.getSourceOption(),n=r.data.features[0].properties,i=new gp().source(r.data,r.options).size(1).shape("line").color("red"),o=new fc({minZoom:t.z-1,maxZoom:t.z+1,textAllowOverlap:!0}).source([n],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(t.key).style({stroke:"#fff",strokeWidth:2});yield t.addLayer(i),yield t.addLayer(o),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource();return{data:{type:"FeatureCollection",features:this.sourceTile.data.layers.testTile.features},options:{parser:{type:"geojson"},transforms:t.transforms}}}}class s7 extends Ro{initTileLayer(){var t=this;return pe(function*(){const r=t.parent.getLayerAttributeConfig(),n=t.getLayerOptions(),i=t.getSourceOption(),o=new w6(he({},n)).source(i.data,i.options);r&&Object.keys(r).forEach(a=>{var s,u;const l=a;o[l]((s=r[l])===null||s===void 0?void 0:s.field,(u=r[l])===null||u===void 0?void 0:u.values)}),yield t.addLayer(o),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}const u7=`layout(std140) uniform commonUniorm {
  vec4 u_color;
  float u_opacity;
};

out vec4 outputColor;

void main() {
  outputColor = u_color;
  outputColor.a *= u_opacity;
}
`,l7=`layout(location = 0) in vec3 a_Position;

layout(std140) uniform commonUniorm {
  vec4 u_color;
  float u_opacity;
};

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`;class c7 extends Qt{getUninforms(){const t=this.getCommonUniformsInfo(),r=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),he(he({},t.uniformsOption),r.uniformsOption)}getCommonUniformsInfo(){const{opacity:t=1,color:r="#000"}=this.layer.getLayerConfig(),n={u_color:Zt(r),u_opacity:t||1};return this.getUniformsBufferInfo(n)}initModels(){var t=this;return pe(function*(){return t.buildModels()})()}buildModels(){var t=this;return pe(function*(){return t.initUniformsBuffer(),[yield t.layer.buildLayerModel({moduleName:"mask",vertexShader:l7,fragmentShader:u7,triangulation:wc,depth:{enable:!1},pick:!1})]})()}clearModels(t=!0){t&&this.layerService.clear()}registerBuiltinAttributes(){return""}}const f7={fill:c7},h7=f7;class yA extends za{constructor(...t){super(...t),E(this,"type","MaskLayer")}buildModels(){var t=this;return pe(function*(){const r=t.getModelType();t.layerModel=new h7[r](t),yield t.initLayerModels()})()}getModelType(){return"fill"}}class d7 extends Ro{initTileLayer(){var t=this;return pe(function*(){const r=t.parent.getLayerAttributeConfig(),n=t.getLayerOptions(),i=t.getSourceOption(),o=new yA(he({},n)).source(i.data,i.options);r&&Object.keys(r).forEach(a=>{var s,u;const l=a;o[l]((s=r[l])===null||s===void 0?void 0:s.field,(u=r[l])===null||u===void 0?void 0:u.values)}),yield t.addLayer(o),t.isLoaded=!0})()}getFeatures(t){return t?this.sourceTile.data.getTileData(t):[]}getSourceOption(){const t=this.parent.getSource(),{sourceLayer:r,featureId:n}=this.parent.getLayerConfig();return{data:{type:"FeatureCollection",features:this.getFeatures(r)},options:{parser:{type:"geojson",featureId:n},transforms:t.transforms}}}}const p7=["rasterData"];class _7 extends Ro{initTileLayer(){var t=this;return pe(function*(){const r=t.parent.getLayerAttributeConfig(),n=t.getLayerOptions(),i=t.getSourceOption(),o=new Ep(he({},n)).source(i.data,i.options);r&&Object.keys(r).forEach(a=>{var s,u;const l=a;o[l]((s=r[l])===null||s===void 0?void 0:s.field,(u=r[l])===null||u===void 0?void 0:u.values)}),yield t.addLayer(o),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource(),r=this.sourceTile.data.data,{rasterData:n}=r,i=$n(r,p7);return{data:n,options:{parser:he({type:"rasterRgb",extent:this.sourceTile.bounds},i),transforms:t.transforms}}}}class v7 extends Ro{initTileLayer(){var t=this;return pe(function*(){const r=t.parent.getLayerAttributeConfig(),n=t.getLayerOptions(),i=t.getSourceOption(),o=new Ep(he({},n)).source(i.data,i.options);r&&Object.keys(r).forEach(a=>{var s,u;const l=a;o[l]((s=r[l])===null||s===void 0?void 0:s.field,(u=r[l])===null||u===void 0?void 0:u.values)}),yield t.addLayer(o),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}const m7=["rasterData"],g7={positions:[0,1],colors:["#000","#fff"]};class E7 extends Ro{constructor(...t){super(...t),E(this,"colorTexture",void 0)}initTileLayer(){var t=this;return pe(function*(){const r=t.parent.getLayerAttributeConfig(),n=t.getLayerOptions(),i=t.getSourceOption(),{rampColors:o,domain:a}=t.getLayerOptions();t.colorTexture=t.parent.textureService.getColorTexture(o,a);const s=new Ep(he(he({},n),{},{colorTexture:t.colorTexture})).source(i.data,i.options);r&&Object.keys(r).forEach(u=>{var l,f;const c=u;s[c]((l=r[c])===null||l===void 0?void 0:l.field,(f=r[c])===null||f===void 0?void 0:f.values)}),yield t.addLayer(s),t.isLoaded=!0})()}getSourceOption(){const t=this.parent.getSource(),r=this.sourceTile.data.data,{rasterData:n}=r,i=$n(r,m7);return{data:n,options:{parser:he({type:"raster",extent:this.sourceTile.bounds},i),transforms:t.transforms}}}styleUpdate(...t){const{rampColors:r=g7,domain:n}=t;this.colorTexture=this.parent.textureService.getColorTexture(r,n||zd(r)),this.layers.forEach(i=>i.style({colorTexture:this.colorTexture}))}destroy(){this.layers.forEach(t=>t.destroy())}}class Al extends Ro{initTileLayer(){var t=this;return pe(function*(){const r=t.parent.getLayerAttributeConfig(),n=t.getLayerOptions(),i=i7(t.parent.type),o=t.getSourceOption();if(!o){t.isLoaded=!0,t.emit("loaded");return}const a=new i(he({},n)).source(o.data,o.options);Object.keys(r).forEach(s=>{var u,l;const f=s;a[f]((u=r[f])===null||u===void 0?void 0:u.field,(l=r[f])===null||l===void 0?void 0:l.values)}),yield t.addLayer(a),n.tileMask&&(yield t.addTileMask()),t.setLayerMinMaxZoom(a),t.isLoaded=!0,t.emit("loaded")})()}getSourceOption(){const t=this.parent.getSource(),{sourceLayer:r="defaultLayer",featureId:n="id"}=this.parent.getLayerConfig();return{data:{type:"FeatureCollection",features:this.getFeatures(r)},options:{parser:{type:"geojson",featureId:n},transforms:t.transforms}}}setLayerMinMaxZoom(t){t.getModelType()==="text"&&t.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}getFeatures(t){return this.sourceTile.data.getTileData(t)}getFeatureById(t){const r=this.getMainLayer();return r?r.getSource().data.dataArray.filter(i=>i._id===t):[]}}function y7(e){switch(e.type){case"PolygonLayer":return Al;case"LineLayer":return Al;case"PointLayer":return Al;case"TileDebugLayer":return a7;case"MaskLayer":return d7;case"RasterLayer":const{dataType:r}=e.getSource().parser;switch(r){case Xr.RGB:case Xr.CUSTOMRGB:return _7;case Xr.ARRAYBUFFER:case Xr.CUSTOMARRAYBUFFER:return E7;case Xr.TERRAINRGB:case Xr.CUSTOMTERRAINRGB:return v7;default:return s7}default:return Al}}const A7=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask","addMask","removeMask"],{debounce:T7}=Ar;class S7{constructor(t){E(this,"parent",void 0),E(this,"tileLayerService",void 0),E(this,"mapService",void 0),E(this,"layerService",void 0),E(this,"rendererService",void 0),E(this,"pickingService",void 0),E(this,"tilePickService",void 0),E(this,"tilesetManager",void 0),E(this,"initedTileset",!1),E(this,"lastViewStates",void 0),E(this,"mapchange",()=>{var n;if(this.parent.isVisible()===!1)return;const{latLonBounds:i,zoom:o}=this.getCurrentView();if(this.mapService.version==="GAODE1.x"){const{visible:a}=this.parent.getLayerConfig();o<2&&a?(this.parent.updateLayerConfig({visible:!1}),this.layerService.reRender()):o>=2&&!a&&(this.parent.updateLayerConfig({visible:!0}),this.layerService.reRender())}this.lastViewStates&&this.lastViewStates.zoom===o&&this.lastViewStates.latLonBounds.toString()===i.toString()||(this.lastViewStates={zoom:o,latLonBounds:i},(n=this.tilesetManager)===null||n===void 0||n.throttleUpdate(o,i))}),E(this,"viewchange",T7(this.mapchange,24)),this.parent=t;const r=this.parent.getContainer();this.rendererService=r.rendererService,this.layerService=r.layerService,this.mapService=r.mapService,this.pickingService=r.pickingService,this.tileLayerService=new NL({rendererService:this.rendererService,layerService:this.layerService,parent:t}),this.tilePickService=new n7({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:t}),this.parent.setLayerPickService(this.tilePickService),this.proxy(t),this.initTileSetManager()}initTileSetManager(){var t;const r=this.parent.getSource();if(this.tilesetManager=r.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0),this.parent.isVisible()===!1)return;const{latLonBounds:n,zoom:i}=this.getCurrentView();(t=this.tilesetManager)===null||t===void 0||t.update(i,n)}getCurrentView(){const t=this.mapService.getBounds(),r=[t[0][0],t[0][1],t[1][0],t[1][1]],n=this.mapService.getZoom();return{latLonBounds:r,zoom:n}}bindTilesetEvent(){this.tilesetManager.on("tile-loaded",t=>{}),this.tilesetManager.on("tile-unload",t=>{this.tileUnLoad(t)}),this.tilesetManager.on("tile-error",(t,r)=>{this.tileError(t)}),this.tilesetManager.on("tile-update",()=>{this.tileUpdate()}),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}render(){this.tileLayerService.render()}getLayers(){return this.tileLayerService.getLayers()}getTiles(){return this.tileLayerService.getTiles()}getTile(t){return this.tileLayerService.getTile(t)}tileLoaded(t){}tileError(t){console.warn("error:",t)}destroy(){var t;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),(t=this.tilesetManager)===null||t===void 0||t.destroy(),this.tileLayerService.destroy()}reload(){var t;this.tilesetManager.clear();const{latLonBounds:r,zoom:n}=this.getCurrentView();(t=this.tilesetManager)===null||t===void 0||t.update(n,r)}tileUnLoad(t){this.tileLayerService.removeTile(t.key)}tileUpdate(){var t=this;return pe(function*(){if(!t.tilesetManager)return;const r=t.parent.getMinZoom(),n=t.parent.getMaxZoom(),i=t.tilesetManager.tiles.filter(o=>o.isLoaded).filter(o=>o.isVisibleChange).filter(o=>o.data).filter(o=>o.z>=r&&o.z<n);yield Promise.all(i.map(function(){var o=pe(function*(a){if(t.tileLayerService.hasTile(a.key))t.tileLayerService.updateTileVisible(a),t.tilePickService.setPickState(),t.layerService.reRender();else{const s=y7(t.parent),u=new s(a,t.parent);yield u.initTileLayer(),t.tilePickService.setPickState(),u.getLayers().length!==0&&(t.tileLayerService.addTile(u),t.tileLayerService.updateTileVisible(a),t.layerService.reRender())}});return function(a){return o.apply(this,arguments)}}())),t.tilesetManager.isLoaded&&t.parent.emit("tiles-loaded",t.tilesetManager.currentTiles)})()}setPickState(t){}pickRender(t){this.tilePickService.pickRender(t)}selectFeature(t){this.tilePickService.selectFeature(t)}highlightPickedFeature(t){this.tilePickService.highlightPickedFeature(t)}proxy(t){A7.forEach(r=>{const n=t[r].bind(t);t[r]=(...i)=>(n(...i),this.getLayers().map(o=>{o[r](...i)}),r==="style"&&this.getTiles().forEach(o=>o.styleUpdate(...i)),t)})}}function x7(e,t){var r=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(r||n)&&(t||(t=document),!!t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");return a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a),a}}x7(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font:
    12px 'Helvetica Neue',
    Arial,
    Helvetica,
    sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 999;
  box-sizing: border-box;
}
.l7-control-container {
  font:
    12px/1.5 'Helvetica Neue',
    Arial,
    Helvetica,
    sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 999;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: flex;
  justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  align-items: flex-end;
}
.l7-control-container .l7-column {
  flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 0 6px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  align-items: flex-start;
}
.l7-popper.l7-popper-end {
  align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  display: flex;
  align-items: center;
  height: 24px;
  padding: 0 16px;
  font-size: 12px;
  line-height: 24px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  width: 14px;
  height: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  display: flex;
  flex-wrap: wrap;
  align-items: flex-start;
  box-sizing: content-box;
  max-width: 460px;
  max-height: 400px;
  margin: 12px 0 0 12px;
  overflow-x: hidden;
  overflow-y: auto;
}
.l7-select-control--image .l7-select-control-item {
  position: relative;
  display: flex;
  flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);
  flex-direction: column;
  justify-content: center;
  box-sizing: content-box;
  margin-right: 12px;
  margin-bottom: 12px;
  overflow: hidden;
  font-size: 12px;
  border: 1px solid #fff;
  border-radius: 2px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 100%;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  top: 0;
  right: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: flex;
  align-items: center;
  justify-content: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  overflow: hidden;
  border-radius: 2px;
  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-control-zoom .l7-button-control {
  font-size: 16px;
  border-bottom: 1px solid #f0f0f0;
  border-radius: 0;
  box-shadow: 0 0 0;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:last-child {
  border-bottom: 0;
}
.l7-control-zoom .l7-control-zoom__number {
  color: #595959;
  padding: 0;
}
.l7-control-zoom .l7-control-zoom__number:hover {
  background-color: #fff;
}
.l7-control-scale {
  display: flex;
  flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: flex;
  align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: flex;
  will-change: transform;
  pointer-events: none;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  font-size: 14px;
  background: #fff;
  border-radius: 3px;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  margin-bottom: 8px;
  font-weight: bold;
}
.l7-popup .l7-popup-content .l7-popup-close-button,
.l7-popup .l7-popup-content .l7-popup-content__title,
.l7-popup .l7-popup-content .l7-popup-content__panel {
  white-space: normal;
  -webkit-user-select: text;
     -moz-user-select: text;
      -ms-user-select: text;
          user-select: text;
  pointer-events: initial;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  padding: 0;
  font-size: 14px;
  line-height: 18px;
  text-align: center;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
}
.l7-popup .l7-popup-tip {
  position: relative;
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {
  bottom: 1px;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  flex-direction: column;
}
.l7-popup.l7-popup-anchor-top .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {
  top: 1px;
}
.l7-popup.l7-popup-anchor-left {
  flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  position: relative;
  align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  right: 1px;
  align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
.l7-control-swipe {
  position: absolute;
  top: 50%;
  left: 50%;
  z-index: 6;
  -webkit-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
  touch-action: none;
}
.l7-control-swipe_hide {
  display: none;
}
.l7-control-swipe:before {
  position: absolute;
  top: -5000px;
  bottom: -5000px;
  left: 50%;
  z-index: -1;
  width: 4px;
  background: #fff;
  -webkit-transform: translate(-2px, 0);
          transform: translate(-2px, 0);
  content: '';
}
.l7-control-swipe.horizontal:before {
  top: 50%;
  right: -5000px;
  bottom: auto;
  left: -5000px;
  width: auto;
  height: 4px;
}
.l7-control-swipe__button {
  display: block;
  width: 28px;
  height: 28px;
  margin: 0;
  padding: 0;
  color: #595959;
  font-weight: bold;
  font-size: inherit;
  text-align: center;
  text-decoration: none;
  background-color: #fff;
  border: none;
  border-radius: 2px;
  outline: none;
}
.l7-control-swipe,
.l7-control-swipe__button {
  cursor: ew-resize;
}
.l7-control-swipe.horizontal,
.l7-control-swipe.horizontal button {
  cursor: ns-resize;
}
.l7-control-swipe:after,
.l7-control-swipe__button:before,
.l7-control-swipe__button:after {
  position: absolute;
  top: 25%;
  bottom: 25%;
  left: 50%;
  width: 2px;
  background: currentColor;
  -webkit-transform: translate(-1px, 0);
          transform: translate(-1px, 0);
  content: '';
}
.l7-control-swipe__button:after {
  -webkit-transform: translateX(4px);
          transform: translateX(4px);
}
.l7-control-swipe__button:before {
  -webkit-transform: translateX(-6px);
          transform: translateX(-6px);
}
`);class R7{constructor(t){E(this,"configService",void 0),E(this,"config",void 0),this.config=t}setContainer(t,r,n){this.configService=t.globalConfigService,t.mapConfig=he(he({},this.config),{},{id:r,canvas:n}),t.mapService=new(this.getServiceConstructor())(t)}getServiceConstructor(){throw new Error("Method not implemented.")}}var AA={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(Pd,function(){function r(c){var h=[];return c.AMapUI&&h.push(n(c.AMapUI)),c.Loca&&h.push(i(c.Loca)),Promise.all(h)}function n(c){return new Promise(function(h,d){var p=[];if(c.plugins)for(var v=0;v<c.plugins.length;v+=1)a.AMapUI.plugins.indexOf(c.plugins[v])==-1&&p.push(c.plugins[v]);if(s.AMapUI===o.failed)d("\u524D\u6B21\u8BF7\u6C42 AMapUI \u5931\u8D25");else if(s.AMapUI===o.notload){s.AMapUI=o.loading,a.AMapUI.version=c.version||a.AMapUI.version,v=a.AMapUI.version;var m=document.body||document.head,y=document.createElement("script");y.type="text/javascript",y.src="https://webapi.amap.com/ui/"+v+"/main.js",y.onerror=function(A){s.AMapUI=o.failed,d("\u8BF7\u6C42 AMapUI \u5931\u8D25")},y.onload=function(){if(s.AMapUI=o.loaded,p.length)window.AMapUI.loadUI(p,function(){for(var A=0,T=p.length;A<T;A++){var R=p[A].split("/").slice(-1)[0];window.AMapUI[R]=arguments[A]}for(h();u.AMapUI.length;)u.AMapUI.splice(0,1)[0]()});else for(h();u.AMapUI.length;)u.AMapUI.splice(0,1)[0]()},m.appendChild(y)}else s.AMapUI===o.loaded?c.version&&c.version!==a.AMapUI.version?d("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C AMapUI \u6DF7\u7528"):p.length?window.AMapUI.loadUI(p,function(){for(var A=0,T=p.length;A<T;A++){var R=p[A].split("/").slice(-1)[0];window.AMapUI[R]=arguments[A]}h()}):h():c.version&&c.version!==a.AMapUI.version?d("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C AMapUI \u6DF7\u7528"):u.AMapUI.push(function(A){A?d(A):p.length?window.AMapUI.loadUI(p,function(){for(var T=0,R=p.length;T<R;T++){var b=p[T].split("/").slice(-1)[0];window.AMapUI[b]=arguments[T]}h()}):h()})})}function i(c){return new Promise(function(h,d){if(s.Loca===o.failed)d("\u524D\u6B21\u8BF7\u6C42 Loca \u5931\u8D25");else if(s.Loca===o.notload){s.Loca=o.loading,a.Loca.version=c.version||a.Loca.version;var p=a.Loca.version,v=a.AMap.version.startsWith("2"),m=p.startsWith("2");if(v&&!m||!v&&m)d("JSAPI \u4E0E Loca \u7248\u672C\u4E0D\u5BF9\u5E94\uFF01\uFF01");else{v=a.key,m=document.body||document.head;var y=document.createElement("script");y.type="text/javascript",y.src="https://webapi.amap.com/loca?v="+p+"&key="+v,y.onerror=function(A){s.Loca=o.failed,d("\u8BF7\u6C42 AMapUI \u5931\u8D25")},y.onload=function(){for(s.Loca=o.loaded,h();u.Loca.length;)u.Loca.splice(0,1)[0]()},m.appendChild(y)}}else s.Loca===o.loaded?c.version&&c.version!==a.Loca.version?d("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C Loca \u6DF7\u7528"):h():c.version&&c.version!==a.Loca.version?d("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C Loca \u6DF7\u7528"):u.Loca.push(function(A){A?d(A):d()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var o;(function(c){c.notload="notload",c.loading="loading",c.loaded="loaded",c.failed="failed"})(o||(o={}));var a={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},s={AMap:o.notload,AMapUI:o.notload,Loca:o.notload},u={AMap:[],AMapUI:[],Loca:[]},l=[],f=function(c){typeof c=="function"&&(s.AMap===o.loaded?c(window.AMap):l.push(c))};return{load:function(c){return new Promise(function(h,d){if(s.AMap==o.failed)d("");else if(s.AMap==o.notload){var p=c.key,v=c.version,m=c.plugins;p?(window.AMap&&location.host!=="lbs.amap.com"&&d("\u7981\u6B62\u591A\u79CDAPI\u52A0\u8F7D\u65B9\u5F0F\u6DF7\u7528"),a.key=p,a.AMap.version=v||a.AMap.version,a.AMap.plugins=m||a.AMap.plugins,s.AMap=o.loading,v=document.body||document.head,window.___onAPILoaded=function(A){if(delete window.___onAPILoaded,A)s.AMap=o.failed,d(A);else for(s.AMap=o.loaded,r(c).then(function(){h(window.AMap)}).catch(d);l.length;)l.splice(0,1)[0]()},m=document.createElement("script"),m.type="text/javascript",m.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+a.AMap.version+"&key="+p+"&plugin="+a.AMap.plugins.join(","),m.onerror=function(A){s.AMap=o.failed,d(A)},v.appendChild(m)):d("\u8BF7\u586B\u5199key")}else if(s.AMap==o.loaded)if(c.key&&c.key!==a.key)d("\u591A\u4E2A\u4E0D\u4E00\u81F4\u7684 key");else if(c.version&&c.version!==a.AMap.version)d("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C JSAPI \u6DF7\u7528");else{if(p=[],c.plugins)for(v=0;v<c.plugins.length;v+=1)a.AMap.plugins.indexOf(c.plugins[v])==-1&&p.push(c.plugins[v]);p.length?window.AMap.plugin(p,function(){r(c).then(function(){h(window.AMap)}).catch(d)}):r(c).then(function(){h(window.AMap)}).catch(d)}else if(c.key&&c.key!==a.key)d("\u591A\u4E2A\u4E0D\u4E00\u81F4\u7684 key");else if(c.version&&c.version!==a.AMap.version)d("\u4E0D\u5141\u8BB8\u591A\u4E2A\u7248\u672C JSAPI \u6DF7\u7528");else{var y=[];if(c.plugins)for(v=0;v<c.plugins.length;v+=1)a.AMap.plugins.indexOf(c.plugins[v])==-1&&y.push(c.plugins[v]);f(function(){y.length?window.AMap.plugin(y,function(){r(c).then(function(){h(window.AMap)}).catch(d)}):r(c).then(function(){h(window.AMap)}).catch(d)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,a={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},s={AMap:o.notload,AMapUI:o.notload,Loca:o.notload},u={AMap:[],AMapUI:[],Loca:[]}}}})})(AA);const TA=AA.exports;function qs(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Ul(e,t){var r=Qd([],t,e);return oP(r,r,1/r[3]),r}function yo(e,t){if(!e)throw new Error(t||"viewport-mercator-project: assertion failed.")}var jn=Math.PI,SA=jn/4,Hi=jn/180,jg=180/jn,Ap=512,Gg=4003e4,C7=1.5;function xA(e){return Math.pow(2,e)}function Rh(e,t){var r=Dn(e,2),n=r[0],i=r[1];yo(Number.isFinite(n)&&Number.isFinite(t)),yo(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude"),t*=Ap;var o=n*Hi,a=i*Hi,s=t*(o+jn)/(2*jn),u=t*(jn-Math.log(Math.tan(SA+a*.5)))/(2*jn);return[s,u]}function $g(e,t){var r=Dn(e,2),n=r[0],i=r[1];t*=Ap;var o=n/t*(2*jn)-jn,a=2*(Math.atan(Math.exp(jn-i/t*(2*jn)))-SA);return[o*jg,a*jg]}function b7(e){var t=e.latitude,r=e.longitude,n=e.zoom,i=e.scale,o=e.highPrecision,a=o===void 0?!1:o;i=i!==void 0?i:xA(n),yo(Number.isFinite(t)&&Number.isFinite(r)&&Number.isFinite(i));var s={},u=Ap*i,l=Math.cos(t*Hi),f=u/360,c=f/l,h=u/Gg/l;if(s.pixelsPerMeter=[h,-h,h],s.metersPerPixel=[1/h,-1/h,1/h],s.pixelsPerDegree=[f,-c,h],s.degreesPerPixel=[1/f,-1/c,1/h],a){var d=Hi*Math.tan(t*Hi)/l,p=f*d/2,v=u/Gg*d,m=v/c*h;s.pixelsPerDegree2=[0,-p,v],s.pixelsPerMeter2=[m,0,m]}return s}function M7(e){var t=e.height,r=e.pitch,n=e.bearing,i=e.altitude,o=e.center,a=o===void 0?null:o,s=e.flipY,u=s===void 0?!1:s,l=qs();return ba(l,l,[0,0,-i]),ru(l,l,[1,1,1/t]),Ic(l,l,-r*Hi),Kd(l,l,n*Hi),u&&ru(l,l,[1,-1,1]),a&&ba(l,l,tP([],a)),l}function I7(e){var t=e.width,r=e.height,n=e.altitude,i=n===void 0?C7:n,o=e.pitch,a=o===void 0?0:o,s=e.nearZMultiplier,u=s===void 0?1:s,l=e.farZMultiplier,f=l===void 0?1:l,c=a*Hi,h=Math.atan(.5/i),d=Math.sin(h)*i/Math.sin(Math.PI/2-c-h),p=Math.cos(Math.PI/2-c)*d+i;return{fov:2*Math.atan(r/2/i),aspect:t/r,focalDistance:i,near:u,far:p*f}}function O7(e){var t=e.width,r=e.height,n=e.pitch,i=e.altitude,o=e.nearZMultiplier,a=e.farZMultiplier,s=I7({width:t,height:r,altitude:i,pitch:n,nearZMultiplier:o,farZMultiplier:a}),u=s.fov,l=s.aspect,f=s.near,c=s.far,h=H1([],u,l,f,c);return h}function P7(e,t){var r=Dn(e,3),n=r[0],i=r[1],o=r[2],a=o===void 0?0:o;return yo(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(a)),Ul(t,[n,i,a,1])}function RA(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=Dn(e,3),i=n[0],o=n[1],a=n[2];if(yo(Number.isFinite(i)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(a)){var s=Ul(t,[i,o,a,1]);return s}var u=Ul(t,[i,o,0,1]),l=Ul(t,[i,o,1,1]),f=u[2],c=l[2],h=f===c?0:((r||0)-f)/(c-f);return uP([],u,l,h)}var Yg=qs(),N7=function(){function e(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.width,n=t.height,i=t.viewMatrix,o=i===void 0?Yg:i,a=t.projectionMatrix,s=a===void 0?Yg:a;HE(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=s;var u=qs();ri(u,u,this.projectionMatrix),ri(u,u,this.viewMatrix),this.viewProjectionMatrix=u;var l=qs();ru(l,l,[this.width/2,-this.height/2,1]),ba(l,l,[1,-1,0]),ri(l,l,this.viewProjectionMatrix);var f=V1(qs(),l);if(!f)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=l,this.pixelUnprojectionMatrix=f,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return VE(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&zv(r.projectionMatrix,this.projectionMatrix)&&zv(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,o=i===void 0?!0:i,a=this.projectPosition(r),s=P7(a,this.pixelProjectionMatrix),u=Dn(s,2),l=u[0],f=u[1],c=o?f:this.height-f;return r.length===2?[l,c]:[l,c,s[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,o=i===void 0?!0:i,a=n.targetZ,s=Dn(r,3),u=s[0],l=s[1],f=s[2],c=o?l:this.height-l,h=a&&a*this.pixelsPerMeter,d=RA([u,c,f],this.pixelUnprojectionMatrix,h),p=this.unprojectPosition(d),v=Dn(p,3),m=v[0],y=v[1],A=v[2];return Number.isFinite(f)?[m,y,A]:Number.isFinite(a)?[m,y,a]:[m,y]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),i=Dn(n,2),o=i[0],a=i[1],s=(r[2]||0)*this.pixelsPerMeter;return[o,a,s]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),i=Dn(n,2),o=i[0],a=i[1],s=(r[2]||0)/this.pixelsPerMeter;return[o,a,s]}},{key:"projectFlat",value:function(r){return arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale,r}},{key:"unprojectFlat",value:function(r){return arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale,r}}]),e}();function F7(e){var t=e.width,r=e.height,n=e.bounds,i=e.minExtent,o=i===void 0?0:i,a=e.maxZoom,s=a===void 0?24:a,u=e.padding,l=u===void 0?0:u,f=e.offset,c=f===void 0?[0,0]:f,h=Dn(n,2),d=Dn(h[0],2),p=d[0],v=d[1],m=Dn(h[1],2),y=m[0],A=m[1];if(Number.isFinite(l)){var T=l;l={top:T,bottom:T,left:T,right:T}}else yo(Number.isFinite(l.top)&&Number.isFinite(l.bottom)&&Number.isFinite(l.left)&&Number.isFinite(l.right));var R=new CA({width:t,height:r,longitude:0,latitude:0,zoom:0}),b=R.project([p,A]),H=R.project([y,v]),B=[Math.max(Math.abs(H[0]-b[0]),o),Math.max(Math.abs(H[1]-b[1]),o)],q=[t-l.left-l.right-Math.abs(c[0])*2,r-l.top-l.bottom-Math.abs(c[1])*2];yo(q[0]>0&&q[1]>0);var Ee=q[0]/B[0],Z=q[1]/B[1],k=(l.right-l.left)/2/Ee,$=(l.bottom-l.top)/2/Z,K=[(H[0]+b[0])/2+k,(H[1]+b[1])/2+$],ce=R.unproject(K),Ne=R.zoom+Math.log2(Math.abs(Math.min(Ee,Z)));return{longitude:ce[0],latitude:ce[1],zoom:Math.min(Ne,s)}}var CA=function(e){Ox(t,e);function t(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.width,o=n.height,a=n.latitude,s=a===void 0?0:a,u=n.longitude,l=u===void 0?0:u,f=n.zoom,c=f===void 0?0:f,h=n.pitch,d=h===void 0?0:h,p=n.bearing,v=p===void 0?0:p,m=n.altitude,y=m===void 0?1.5:m,A=n.nearZMultiplier,T=n.farZMultiplier;HE(this,t),i=i||1,o=o||1;var R=xA(c);y=Math.max(.75,y);var b=Rh([l,s],R);b[2]=0;var H=O7({width:i,height:o,pitch:d,bearing:v,altitude:y,nearZMultiplier:A||1/o,farZMultiplier:T||1.01}),B=M7({height:o,center:b,pitch:d,bearing:v,altitude:y,flipY:!0});return r=Px(this,Nx(t).call(this,{width:i,height:o,viewMatrix:B,projectionMatrix:H})),r.latitude=s,r.longitude=l,r.zoom=c,r.pitch=d,r.bearing=v,r.altitude=y,r.scale=R,r.center=b,r.pixelsPerMeter=b7(sl(sl(r))).pixelsPerMeter[2],Object.freeze(sl(sl(r))),r}return VE(t,[{key:"projectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Rh(n,i)}},{key:"unprojectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return $g(n,i)}},{key:"getMapCenterByLngLatPosition",value:function(n){var i=n.lngLat,o=n.pos,a=RA(o,this.pixelUnprojectionMatrix),s=Rh(i,this.scale),u=Nn([],s,sP([],a)),l=Nn([],this.center,u);return $g(l,this.scale)}},{key:"getLocationAtPoint",value:function(n){var i=n.lngLat,o=n.pos;return this.getMapCenterByLngLatPosition({lngLat:i,pos:o})}},{key:"fitBounds",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=this.width,a=this.height,s=F7(Object.assign({width:o,height:a,bounds:n},i)),u=s.longitude,l=s.latitude,f=s.zoom;return new t({width:o,height:a,longitude:u,latitude:l,zoom:f})}}]),t}(N7);class D7{constructor(){E(this,"viewport",void 0)}syncWithMapCamera(t){const{center:r,zoom:n,pitch:i,bearing:o,viewportHeight:a,viewportWidth:s}=t,u=this.viewport?{width:this.viewport.width,height:this.viewport.height,longitude:this.viewport.center[0],latitude:this.viewport.center[1],zoom:this.viewport.zoom,pitch:this.viewport.pitch,bearing:this.viewport.bearing}:{};this.viewport=new CA(he(he({},u),{},{width:s,height:a,longitude:r&&r[0],latitude:r&&r[1],zoom:n,pitch:i,bearing:o}))}getZoom(){return this.viewport.zoom}getZoomScale(){return Math.pow(2,this.getZoom())}getCenter(){return[this.viewport.longitude,this.viewport.latitude]}getProjectionMatrix(){return this.viewport.projectionMatrix}getModelMatrix(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}getViewMatrix(){return this.viewport.viewMatrix}getViewMatrixUncentered(){return this.viewport.viewMatrixUncentered}getViewProjectionMatrix(){return this.viewport.viewProjectionMatrix}getViewProjectionMatrixUncentered(){return this.viewport.viewProjectionMatrix}getFocalDistance(){return 1}projectFlat(t,r){return this.viewport.projectFlat(t,r)}}class B7{constructor(t){E(this,"size",1e4),this.size=t||1e4}setSize(t){this.size=t}getSize(){return[this.size,this.size]}mercatorXfromLng(t){return(180+t)/360*this.size}mercatorYfromLat(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}lngFromMercatorX(t){return t/this.size*360-180}latFromMercatorY(t){const r=180-(1-t/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90}project(t){const r=this.mercatorXfromLng(t[0]),n=this.mercatorYfromLat(t[1]);return[r,n]}unproject(t){const r=this.lngFromMercatorX(t[0]),n=this.latFromMercatorY(t[1]);return[r,n]}}function Zg(e={}){const t={top:0,right:0,bottom:0,left:0};if(typeof e=="number")return{top:e,right:e,bottom:e,left:e};if(Array.isArray(e)){if(e.length===4)return{top:e[0],right:e[1],bottom:e[2],left:e[3]};if(e.length===2)return{top:e[0],right:e[1],bottom:e[0],left:e[1]}}return he(he({},t),e)}const w7={normal:"amap://styles/normal",light:"amap://styles/c422f5c0cfced5be9fe3a83f05f28a68?isPublic=true",dark:"amap://styles/c9f1d10cae34f8ab05e425462c5a58d7?isPublic=true",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true",fresh:"amap://styles/fresh",grey:"amap://styles/grey",graffiti:"amap://styles/graffiti",macaron:"amap://styles/macaron",darkblue:"amap://styles/darkblue",wine:"amap://styles/wine"},L7=["id","style","minZoom","maxZoom","token","mapInstance","plugin"];function U7(e,t){var r=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(r||n)&&(t||(t=document),!!t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");return a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a),a}}U7(`.amap-logo {
  display: none !important;
}
.amap-copyright {
  display: none !important;
}
`);const k7={contextmenu:"rightclick"},z7={contextmenu:"rightclick",camerachange:"viewchange"},qg={"GAODE1.x":k7,"GAODE2.x":z7};let V7=0;window.forceWebGL=!0;const Kg="15cd8a57710d40c9b7c0e3cc120f1200",H7="1.4.15",X7="amap-script";let Ch=!1,Tl=[];const W7=12;class j7{constructor(t){E(this,"version",m1["GAODE1.x"]),E(this,"simpleMapCoord",new B7),E(this,"map",void 0),E(this,"bgColor","rgba(0, 0, 0, 0)"),E(this,"configService",void 0),E(this,"config",void 0),E(this,"coordinateSystemService",void 0),E(this,"eventEmitter",void 0),E(this,"markerContainer",void 0),E(this,"$mapContainer",void 0),E(this,"cameraChangedCallback",void 0),E(this,"handleCameraChanged",r=>{const{fov:n,near:i,far:o,height:a,pitch:s,rotation:u,aspect:l,position:f}=r.camera,{lng:c,lat:h}=this.getCenter();if(this.emit("mapchange"),this.cameraChangedCallback){this.viewport.syncWithMapCamera({aspect:l,bearing:360-u,far:o,fov:n,cameraHeight:a,near:i,pitch:s,zoom:this.map.getZoom()-1,center:[c,h],offsetOrigin:[f.x,f.y]});const{offsetZoom:d=W7}=this.config;this.viewport.getZoom()>d?this.coordinateSystemService.setCoordinateSystem(Li.P20_OFFSET):this.coordinateSystemService.setCoordinateSystem(Li.P20),this.cameraChangedCallback(this.viewport)}}),this.config=t.mapConfig,this.configService=t.globalConfigService,this.coordinateSystemService=t.coordinateSystemService,this.eventEmitter=new vn.exports.EventEmitter}setBgColor(t){this.bgColor=t}addMarkerContainer(){const t=this.map.getContainer();if(t!==null){const r=t.getElementsByClassName("amap-maps")[0];this.markerContainer=pn("div","l7-marker-container",r)}}getMarkerContainer(){return this.markerContainer}on(t,r){Pv.indexOf(t)!==-1?this.eventEmitter.on(t,r):this.map.on(qg[this.version][t]||t,r)}off(t,r){Pv.indexOf(t)!==-1?this.eventEmitter.off(t,r):this.map.off(qg[this.version][t]||t,r)}getContainer(){return this.map.getContainer()}getMapCanvasContainer(){var t;return(t=this.map.getContainer())===null||t===void 0?void 0:t.getElementsByClassName("amap-maps")[0]}getCanvasOverlays(){var t;return(t=this.$mapContainer)===null||t===void 0?void 0:t.querySelector(".amap-overlays")}getSize(){const t=this.map.getSize();return[t.getWidth(),t.getHeight()]}getType(){return"amap"}getZoom(){return this.map.getZoom()-1}setZoom(t){return this.map.setZoom(t+1)}getCenter(t){if(t!=null&&t.padding){const n=this.getCenter(),i=Zg(t.padding),o=this.lngLatToPixel([n.lng,n.lat]),a=[(i.right-i.left)/2,(i.bottom-i.top)/2];return this.pixelToLngLat([o.x-a[0],o.y-a[1]])}const r=this.map.getCenter();return{lng:r.getLng(),lat:r.getLat()}}setCenter(t,r){if(r!=null&&r.padding){const n=Zg(r.padding),i=this.lngLatToPixel(t),o=[(n.right-n.left)/2,(n.bottom-n.top)/2],a=this.pixelToLngLat([i.x+o[0],i.y+o[1]]);this.map.setCenter([a.lng,a.lat])}else this.map.setCenter(t)}getPitch(){return this.map.getPitch()}getRotation(){return 360-this.map.getRotation()}getBounds(){const t=this.map.getBounds().toBounds(),r=t.getNorthEast(),n=t.getSouthWest(),i=this.getCenter(),o=i.lng>r.getLng()||i.lng<n.getLng()?180-r.getLng():r.getLng();return[[i.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[o,r.getLat()]]}getMinZoom(){return this.map.get("zooms")[0]-1}getMaxZoom(){return this.map.get("zooms")[1]-1}setRotation(t){return this.map.setRotation(t)}setPitch(t){return this.map.setPitch(t)}zoomIn(){this.map.zoomIn()}zoomOut(){this.map.zoomOut()}panTo(t){this.map.panTo(t)}panBy(t=0,r=0){this.map.panBy(t,r)}fitBounds(t){this.map.setBounds(new AMap.Bounds([t[0][0],t[0][1],t[1][0],t[1][1]]))}setZoomAndCenter(t,r){this.map.setZoomAndCenter(t+1,r)}setMapStyle(t){this.map.setMapStyle(this.getMapStyleValue(t))}setMapStatus(t){this.map.setStatus(t)}getMapStyleConfig(){return w7}getMapStyleValue(t){return this.getMapStyleConfig()[t]||t}getMapStyle(){return this.map.getMapStyle()}pixelToLngLat(t){const r=this.map.pixelToLngLat(new AMap.Pixel(t[0],t[1]));return{lng:r.getLng(),lat:r.getLat()}}lngLatToPixel(t){const r=this.map.lnglatToPixel(new AMap.LngLat(t[0],t[1]));return{x:r.getX(),y:r.getY()}}containerToLngLat(t){const r=new AMap.Pixel(t[0],t[1]),n=this.map.containerToLngLat(r);return{lng:n==null?void 0:n.getLng(),lat:n==null?void 0:n.getLat()}}lngLatToContainer(t){const r=new AMap.LngLat(t[0],t[1]),n=this.map.lngLatToContainer(r);return{x:n.getX(),y:n.getY()}}lngLatToCoord(t){const{x:r,y:n}=this.map.lngLatToGeodeticCoord(t);return[r,-n]}lngLatToMercator(t,r){return{x:0,y:0,z:0}}getModelMatrix(t,r,n,i=[1,1,1]){const o=this.viewport.projectFlat(t),a=Bn();return ba(a,a,Wr(o[0],o[1],r)),ru(a,a,Wr(i[0],i[1],i[2])),Ic(a,a,n[0]),qd(a,a,n[1]),Kd(a,a,n[2]),a}init(){var t=this;return pe(function*(){const r=t.config,{id:n,style:i="light",minZoom:o=0,maxZoom:a=18,token:s=Kg,mapInstance:u,plugin:l=[]}=r,f=$n(r,L7);yield new Promise(c=>{const h=()=>{if(u)t.map=u,t.$mapContainer=t.map.getContainer(),setTimeout(()=>{t.map.on("camerachange",t.handleCameraChanged),c()},30);else{t.$mapContainer=t.creatMapContainer(n);const d=he({mapStyle:t.getMapStyleValue(i),zooms:[o,a],viewMode:"3D"},f);d.zoom&&(d.zoom+=1);const p=new AMap.Map(t.$mapContainer,d);p.on("camerachange",t.handleCameraChanged),p.on("camerachange",()=>{setTimeout(()=>t.handleAfterMapChange())}),t.map=p,setTimeout(()=>{c()},10)}};!Ch&&!u?(s===Kg&&console.warn(`%c${t.configService.getSceneWarninfo("MapToken")}!`,"color: #873bf4;font-weigh:900;font-size: 16px;"),Ch=!0,l.push("Map3D"),TA.load({key:s,version:H7,plugins:l}).then(()=>{h(),Tl.length&&(Tl.forEach(d=>d()),Tl=[])}).catch(d=>{throw new Error(d)})):Ch&&window.AMap||u?h():Tl.push(h)}),t.viewport=new D7})()}meterToCoord(t,r){const n=AMap.GeometryUtil.distance(new AMap.LngLat(...t),new AMap.LngLat(...r)),[i,o]=this.lngLatToCoord(t),[a,s]=this.lngLatToCoord(r);return Math.sqrt(Math.pow(i-a,2)+Math.pow(o-s,2))/n}updateView(t){}getOverlayContainer(){}exportMap(t){var r;const n=(r=this.getContainer())===null||r===void 0?void 0:r.getElementsByClassName("amap-layer")[0];return t==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png")}emit(t,...r){this.eventEmitter.emit(t,...r)}once(t,...r){this.eventEmitter.once(t,...r)}destroy(){var t;(t=this.$mapContainer)===null||t===void 0||(t=t.parentNode)===null||t===void 0||t.removeChild(this.$mapContainer),delete window.initAMap;const r=document.getElementById(X7);r&&document.head.removeChild(r),this.map.destroy()}getMapContainer(){return this.$mapContainer}onCameraChanged(t){this.cameraChangedCallback=t}handleAfterMapChange(){this.emit("mapAfterFrameChange")}creatMapContainer(t){let r=t;typeof t=="string"&&(r=document.getElementById(t));const n=document.createElement("div");return n.style.cssText+=`
       position: absolute;
       top: 0;
       height: 100%;
       width: 100%;
     `,n.id="l7_amap_div"+V7++,r.appendChild(n),n}}class G7{constructor(){E(this,"projectionMatrix",Bn()),E(this,"viewMatrix",Bn()),E(this,"viewProjectionMatrix",Bn()),E(this,"ViewProjectionMatrixUncentered",Bn()),E(this,"viewUncenteredMatrix",Bn()),E(this,"zoom",void 0),E(this,"center",void 0)}syncWithMapCamera(t){const{zoom:r=1,center:n=[0,0],offsetOrigin:i=[0,0],cameraPosition:o=[0,0,0],up:a=[0,1,0],lookAt:s=[0,0,0],aspect:u=1,near:l=.1,far:f=1e3,fov:c=45}=t;this.zoom=r,this.center=n,H1(this.projectionMatrix,c/180*Math.PI,u,l,f);const h=Wr(...o),d=Wr(...s),p=Wr(...a);JO(this.viewMatrix,h,d,p),this.viewUncenteredMatrix=YO(this.viewMatrix),ba(this.viewMatrix,this.viewMatrix,Wr(-i[0],i[1],0)),ri(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),ri(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}getZoom(){return this.zoom}getZoomScale(){return 1048576}getCenter(){const[t,r]=this.center;return[t,r]}getProjectionMatrix(){return this.projectionMatrix}getModelMatrix(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}getViewMatrix(){return this.viewMatrix}getViewMatrixUncentered(){return this.viewUncenteredMatrix}getViewProjectionMatrix(){return this.viewProjectionMatrix}getViewProjectionMatrixUncentered(){return this.ViewProjectionMatrixUncentered}getFocalDistance(){return 1.2}projectFlat(t){const r=85.0511287798,n=Math.max(Math.min(r,t[1]),-r),i=256<<20;let o=Math.PI/180,a=t[0]*o,s=n*o;s=Math.log(Math.tan(Math.PI/4+s/2));const u=.5/Math.PI,l=.5,f=-.5/Math.PI;return o=.5,a=i*(u*a+l)-215440491,s=-(i*(f*s+o)-106744817),[a,s]}}const $7=["id","style","minZoom","maxZoom","token","mapInstance","plugin","version"];function Y7(e,t){var r=typeof my<"u"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx<"u"&&wx!==null&&(typeof wx.request<"u"||typeof wx.miniProgram<"u");if(!(r||n)&&(t||(t=document),!!t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");return a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a),a}}Y7(`.amap-logo {
  display: none !important;
}
.amap-copyright {
  display: none !important;
}
.amap-overlays {
  z-index: 3 !important;
}
`);const Qg=[108.92361,34.54083];window.forceWebGL=!0;const Jg="f59bcf249433f8b05caaee19f349b3d7",eE="2.0";class Z7 extends j7{constructor(...t){super(...t),E(this,"version","GAODE2.x"),E(this,"sceneCenter",void 0),E(this,"sceneCenterMercator",void 0),E(this,"viewport",void 0),E(this,"handleViewChanged",r=>{const{fov:n,near:i,far:o,aspect:a,position:s,lookAt:u,up:l}=this.map.customCoords.getCameraParams();this.emit("mapchange");const f=this.map.customCoords.getCenter();this.cameraChangedCallback&&(this.viewport.syncWithMapCamera({aspect:a,far:o,fov:n,cameraPosition:s,lookAt:u,up:l,near:i,zoom:this.map.getZoom()-1,center:f,offsetOrigin:[s[0],s[1]]}),this.coordinateSystemService.setCoordinateSystem(Li.P20_2),this.cameraChangedCallback(this.viewport))})}setCustomCoordCenter(t){this.sceneCenter=t,this.sceneCenterMercator=cl(...t)}getCustomCoordCenter(){return this.sceneCenterMercator}lngLatToCoordByLayer(t,r){const n=r||this.sceneCenterMercator,i=this._sub(cl(t[0],t[1]),n);return t[2]&&i.push(t[2]),i}coordToAMap2RelativeCoordinates(t,r){const n=cl(r[0],r[1]);return typeof t[0]=="number"?this.lngLatToCoordByLayer(t,n):t.map(i=>Array.isArray(i)&&typeof i[0]=="number"?this.lngLatToCoordByLayer(i,n):i.map(o=>this.lngLatToCoordByLayer(o,n)))}setCoordCenter(t){this.map.customCoords.setCenter(t||Qg),this.setCustomCoordCenter(t||Qg)}lngLatToCoord(t){return this.sceneCenter||(this.map.customCoords.setCenter(t),this.setCustomCoordCenter(t)),this._sub(cl(t[0],t[1]),this.sceneCenterMercator)}lngLatToCoords(t){return t.map(r=>typeof r[0]=="number"?this.lngLatToCoord(r):r.map(n=>this.lngLatToCoord(n)))}addMarkerContainer(){if(!this.map)return;const t=this.map.getContainer();if(t!==null){const r=t.getElementsByClassName("amap-maps")[0];r.style.zIndex="auto",this.markerContainer=pn("div","l7-marker-container2",r)}}updateView(t){}getOverlayContainer(){}getType(){return"amap2"}getBounds(){const t=this.map.getBounds(),r=t.getNorthEast(),n=t.getSouthWest(),i=this.getCenter(),o=i.lng>r.getLng()||i.lng<n.getLng()?180-r.getLng():r.getLng();return[[i.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[o,r.getLat()]]}getMinZoom(){return this.map.getZooms()[0]-1}getMaxZoom(){return this.map.getZooms()[1]-1}lngLatToContainer(t){const r=this.map.lngLatToContainer(t);return{x:r.getX(),y:r.getY()}}lngLatToPixel(t){const r=this.map.lngLatToPixel(new AMap.LngLat(t[0],t[1]));return{x:r.getX(),y:r.getY()}}getModelMatrix(t,r,n,i=[1,1,1]){const o=this.map.customCoords.lngLatToCoord(t),a=Bn();return ba(a,a,Wr(o[0],o[1],r)),ru(a,a,Wr(i[0],i[1],i[2])),Ic(a,a,n[0]),qd(a,a,n[1]),Kd(a,a,n[2]),a}init(){var t=this;return pe(function*(){const r=t.config,{id:n,style:i="light",minZoom:o=0,maxZoom:a=24,token:s=Jg,mapInstance:u,plugin:l=[],version:f=eE}=r,c=$n(r,$7);if(t.viewport=new G7,window.AMap||u||(l.push("Map3D"),yield TA.load({key:s,version:eE,plugins:l})),u){var h;t.map=u,t.$mapContainer=t.map.getContainer();const p=t.map.getCenter();(h=t.map.customCoords)===null||h===void 0||h.setCenter([p.lng,p.lat]),t.setCustomCoordCenter([p.lng,p.lat]),t.map.on("viewchange",t.handleViewChanged)}else{var d;t.$mapContainer=t.creatMapContainer(n);const p=he({mapStyle:t.getMapStyleValue(i),zooms:[o,a],viewMode:"3D"},c);p.zoom&&(p.zoom+=1),s===Jg&&(window._AMapSecurityConfig={securityJsCode:"2653011adeb04230b3a26cc9a780a800"},console.warn(`%c${t.configService.getSceneWarninfo("MapToken")}!`,"color: #873bf4;font-weigh:900;font-size: 16px;"));const v=new AMap.Map(t.$mapContainer,p);t.map=v;const m=v.getCenter();(d=t.map.customCoords)===null||d===void 0||d.setCenter([m.lng,m.lat]),t.setCustomCoordCenter([m.lng,m.lat]),v.on("viewchange",t.handleViewChanged)}t.initViewPort()})()}getMapContainer(){return this.$mapContainer}onCameraChanged(t){this.cameraChangedCallback=t}initViewPort(){var t;const{fov:r,near:n,far:i,aspect:o,position:a,lookAt:s,up:u}=((t=this.map.customCoords)===null||t===void 0?void 0:t.getCameraParams())||{};this.emit("mapchange");const l=this.map.customCoords.getCenter(),f=this.map.getZoom();this.cameraChangedCallback&&(this.viewport.syncWithMapCamera({aspect:o,far:i,fov:r,cameraPosition:a,lookAt:s,near:n,up:u,zoom:f-1,center:l,offsetOrigin:[a[0],a[1]]}),this.coordinateSystemService.setCoordinateSystem(Li.P20_2),this.cameraChangedCallback(this.viewport))}_sub(t,r){const n=[0,0];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n}}class q7 extends R7{getServiceConstructor(){return Z7}}var K7=function(e){return e==null};const wn=K7;var Q7={}.toString,J7=function(e,t){return Q7.call(e)==="[object "+t+"]"};const e8=J7;var t8=function(e,t,r){return e<t?t:e>r?r:e};const r8=t8;var n8=function(e){return e8(e,"Number")};const da=n8;var xd=function(e,t){return xd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])},xd(e,t)};function or(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");xd(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var tr=function(){return tr=Object.assign||function(t){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},tr.apply(this,arguments)};function i8(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}function Aa(e,t,r,n){function i(o){return o instanceof r?o:new r(function(a){a(o)})}return new(r||(r=Promise))(function(o,a){function s(f){try{l(n.next(f))}catch(c){a(c)}}function u(f){try{l(n.throw(f))}catch(c){a(c)}}function l(f){f.done?o(f.value):i(f.value).then(s,u)}l((n=n.apply(e,t||[])).next())})}function Ta(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(l){return function(f){return u([l,f])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,l[0]&&(r=0)),r;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){r.label=l[1];break}if(l[0]===6&&r.label<o[1]){r.label=o[1],o=l;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(l);break}o[2]&&r.ops.pop(),r.trys.pop();continue}l=t.call(e,r)}catch(f){l=[6,f],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Ao(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Xn(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,o=[],a;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(s){a={error:s}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return o}function Is(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,o;n<i;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))}var bA={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function i(u,l,f){this.fn=u,this.context=l,this.once=f||!1}function o(u,l,f,c,h){if(typeof f!="function")throw new TypeError("The listener must be a function");var d=new i(f,c||u,h),p=r?r+l:l;return u._events[p]?u._events[p].fn?u._events[p]=[u._events[p],d]:u._events[p].push(d):(u._events[p]=d,u._eventsCount++),u}function a(u,l){--u._eventsCount===0?u._events=new n:delete u._events[l]}function s(){this._events=new n,this._eventsCount=0}s.prototype.eventNames=function(){var l=[],f,c;if(this._eventsCount===0)return l;for(c in f=this._events)t.call(f,c)&&l.push(r?c.slice(1):c);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(f)):l},s.prototype.listeners=function(l){var f=r?r+l:l,c=this._events[f];if(!c)return[];if(c.fn)return[c.fn];for(var h=0,d=c.length,p=new Array(d);h<d;h++)p[h]=c[h].fn;return p},s.prototype.listenerCount=function(l){var f=r?r+l:l,c=this._events[f];return c?c.fn?1:c.length:0},s.prototype.emit=function(l,f,c,h,d,p){var v=r?r+l:l;if(!this._events[v])return!1;var m=this._events[v],y=arguments.length,A,T;if(m.fn){switch(m.once&&this.removeListener(l,m.fn,void 0,!0),y){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,f),!0;case 3:return m.fn.call(m.context,f,c),!0;case 4:return m.fn.call(m.context,f,c,h),!0;case 5:return m.fn.call(m.context,f,c,h,d),!0;case 6:return m.fn.call(m.context,f,c,h,d,p),!0}for(T=1,A=new Array(y-1);T<y;T++)A[T-1]=arguments[T];m.fn.apply(m.context,A)}else{var R=m.length,b;for(T=0;T<R;T++)switch(m[T].once&&this.removeListener(l,m[T].fn,void 0,!0),y){case 1:m[T].fn.call(m[T].context);break;case 2:m[T].fn.call(m[T].context,f);break;case 3:m[T].fn.call(m[T].context,f,c);break;case 4:m[T].fn.call(m[T].context,f,c,h);break;default:if(!A)for(b=1,A=new Array(y-1);b<y;b++)A[b-1]=arguments[b];m[T].fn.apply(m[T].context,A)}}return!0},s.prototype.on=function(l,f,c){return o(this,l,f,c,!1)},s.prototype.once=function(l,f,c){return o(this,l,f,c,!0)},s.prototype.removeListener=function(l,f,c,h){var d=r?r+l:l;if(!this._events[d])return this;if(!f)return a(this,d),this;var p=this._events[d];if(p.fn)p.fn===f&&(!h||p.once)&&(!c||p.context===c)&&a(this,d);else{for(var v=0,m=[],y=p.length;v<y;v++)(p[v].fn!==f||h&&!p[v].once||c&&p[v].context!==c)&&m.push(p[v]);m.length?this._events[d]=m.length===1?m[0]:m:a(this,d)}return this},s.prototype.removeAllListeners=function(l){var f;return l?(f=r?r+l:l,this._events[f]&&a(this,f)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s})(bA);const MA=bA.exports;var D;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.ALWAYS=519]="ALWAYS",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.GEQUAL=518]="GEQUAL",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",e[e.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",e[e.RGBA32F_EXT=34836]="RGBA32F_EXT",e[e.RGB32F_EXT=34837]="RGB32F_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",e[e.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.SRGB_EXT=35904]="SRGB_EXT",e[e.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",e[e.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",e[e.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",e[e.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",e[e.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",e[e.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",e[e.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",e[e.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",e[e.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",e[e.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",e[e.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",e[e.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",e[e.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",e[e.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",e[e.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",e[e.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",e[e.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",e[e.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",e[e.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",e[e.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",e[e.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",e[e.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",e[e.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",e[e.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",e[e.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",e[e.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",e[e.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",e[e.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",e[e.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",e[e.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",e[e.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",e[e.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",e[e.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",e[e.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",e[e.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",e[e.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",e[e.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"})(D||(D={}));var Dt;(function(e){e[e.Buffer=0]="Buffer",e[e.Texture=1]="Texture",e[e.RenderTarget=2]="RenderTarget",e[e.Sampler=3]="Sampler",e[e.Program=4]="Program",e[e.Bindings=5]="Bindings",e[e.InputLayout=6]="InputLayout",e[e.RenderPipeline=7]="RenderPipeline",e[e.ComputePipeline=8]="ComputePipeline",e[e.Readback=9]="Readback",e[e.QueryPool=10]="QueryPool",e[e.RenderBundle=11]="RenderBundle"})(Dt||(Dt={}));var zt;(function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"})(zt||(zt={}));var _u;(function(e){e[e.CCW=2305]="CCW",e[e.CW=2304]="CW"})(_u||(_u={}));var dn;(function(e){e[e.NONE=0]="NONE",e[e.FRONT=1]="FRONT",e[e.BACK=2]="BACK",e[e.FRONT_AND_BACK=3]="FRONT_AND_BACK"})(dn||(dn={}));var Rt;(function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC=768]="SRC",e[e.ONE_MINUS_SRC=769]="ONE_MINUS_SRC",e[e.DST=774]="DST",e[e.ONE_MINUS_DST=775]="ONE_MINUS_DST",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.CONST=32769]="CONST",e[e.ONE_MINUS_CONSTANT=32770]="ONE_MINUS_CONSTANT",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"})(Rt||(Rt={}));var Dr;(function(e){e[e.ADD=32774]="ADD",e[e.SUBSTRACT=32778]="SUBSTRACT",e[e.REVERSE_SUBSTRACT=32779]="REVERSE_SUBSTRACT",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX"})(Dr||(Dr={}));var tn;(function(e){e[e.CLAMP_TO_EDGE=0]="CLAMP_TO_EDGE",e[e.REPEAT=1]="REPEAT",e[e.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"})(tn||(tn={}));var sr;(function(e){e[e.POINT=0]="POINT",e[e.BILINEAR=1]="BILINEAR"})(sr||(sr={}));var Mr;(function(e){e[e.NO_MIP=0]="NO_MIP",e[e.NEAREST=1]="NEAREST",e[e.LINEAR=2]="LINEAR"})(Mr||(Mr={}));var vr;(function(e){e[e.POINTS=0]="POINTS",e[e.TRIANGLES=1]="TRIANGLES",e[e.TRIANGLE_STRIP=2]="TRIANGLE_STRIP",e[e.LINES=3]="LINES",e[e.LINE_STRIP=4]="LINE_STRIP"})(vr||(vr={}));var Gt;(function(e){e[e.MAP_READ=1]="MAP_READ",e[e.MAP_WRITE=2]="MAP_WRITE",e[e.COPY_SRC=4]="COPY_SRC",e[e.COPY_DST=8]="COPY_DST",e[e.INDEX=16]="INDEX",e[e.VERTEX=32]="VERTEX",e[e.UNIFORM=64]="UNIFORM",e[e.STORAGE=128]="STORAGE",e[e.INDIRECT=256]="INDIRECT",e[e.QUERY_RESOLVE=512]="QUERY_RESOLVE"})(Gt||(Gt={}));var Gn;(function(e){e[e.STATIC=1]="STATIC",e[e.DYNAMIC=2]="DYNAMIC"})(Gn||(Gn={}));var To;(function(e){e[e.VERTEX=1]="VERTEX",e[e.INSTANCE=2]="INSTANCE"})(To||(To={}));var tE;(function(e){e.LOADED="loaded"})(tE||(tE={}));var Ct;(function(e){e[e.TEXTURE_2D=0]="TEXTURE_2D",e[e.TEXTURE_2D_ARRAY=1]="TEXTURE_2D_ARRAY",e[e.TEXTURE_3D=2]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP=3]="TEXTURE_CUBE_MAP"})(Ct||(Ct={}));var qr;(function(e){e[e.SAMPLED=1]="SAMPLED",e[e.RENDER_TARGET=2]="RENDER_TARGET",e[e.STORAGE=4]="STORAGE"})(qr||(qr={}));var Fr;(function(e){e[e.NONE=0]="NONE",e[e.RED=1]="RED",e[e.GREEN=2]="GREEN",e[e.BLUE=4]="BLUE",e[e.ALPHA=8]="ALPHA",e[e.RGB=7]="RGB",e[e.ALL=15]="ALL"})(Fr||(Fr={}));var ir;(function(e){e[e.KEEP=7680]="KEEP",e[e.ZERO=0]="ZERO",e[e.REPLACE=7681]="REPLACE",e[e.INVERT=5386]="INVERT",e[e.INCREMENT_CLAMP=7682]="INCREMENT_CLAMP",e[e.DECREMENT_CLAMP=7683]="DECREMENT_CLAMP",e[e.INCREMENT_WRAP=34055]="INCREMENT_WRAP",e[e.DECREMENT_WRAP=34056]="DECREMENT_WRAP"})(ir||(ir={}));var nr;(function(e){e[e.Float=0]="Float",e[e.UnfilterableFloat=1]="UnfilterableFloat",e[e.Uint=2]="Uint",e[e.Sint=3]="Sint",e[e.Depth=4]="Depth"})(nr||(nr={}));var ni;(function(e){e[e.LOWER_LEFT=0]="LOWER_LEFT",e[e.UPPER_LEFT=1]="UPPER_LEFT"})(ni||(ni={}));var Na;(function(e){e[e.NEGATIVE_ONE=0]="NEGATIVE_ONE",e[e.ZERO=1]="ZERO"})(Na||(Na={}));var pc;(function(e){e[e.OcclusionConservative=0]="OcclusionConservative"})(pc||(pc={}));var de;(function(e){e[e.U8=1]="U8",e[e.U16=2]="U16",e[e.U32=3]="U32",e[e.S8=4]="S8",e[e.S16=5]="S16",e[e.S32=6]="S32",e[e.F16=7]="F16",e[e.F32=8]="F32",e[e.BC1=65]="BC1",e[e.BC2=66]="BC2",e[e.BC3=67]="BC3",e[e.BC4_UNORM=68]="BC4_UNORM",e[e.BC4_SNORM=69]="BC4_SNORM",e[e.BC5_UNORM=70]="BC5_UNORM",e[e.BC5_SNORM=71]="BC5_SNORM",e[e.U16_PACKED_5551=97]="U16_PACKED_5551",e[e.U16_PACKED_565=98]="U16_PACKED_565",e[e.D24=129]="D24",e[e.D32F=130]="D32F",e[e.D24S8=131]="D24S8",e[e.D32FS8=132]="D32FS8"})(de||(de={}));var Ge;(function(e){e[e.R=1]="R",e[e.RG=2]="RG",e[e.RGB=3]="RGB",e[e.RGBA=4]="RGBA",e[e.A=5]="A"})(Ge||(Ge={}));var ze;(function(e){e[e.None=0]="None",e[e.Normalized=1]="Normalized",e[e.sRGB=2]="sRGB",e[e.Depth=4]="Depth",e[e.Stencil=8]="Stencil",e[e.RenderTarget=16]="RenderTarget",e[e.Luminance=32]="Luminance"})(ze||(ze={}));function rt(e,t,r){return e<<16|t<<8|r}var G;(function(e){e[e.ALPHA=rt(de.U8,Ge.A,ze.None)]="ALPHA",e[e.U8_LUMINANCE=rt(de.U8,Ge.A,ze.Luminance)]="U8_LUMINANCE",e[e.F16_LUMINANCE=rt(de.F16,Ge.A,ze.Luminance)]="F16_LUMINANCE",e[e.F32_LUMINANCE=rt(de.F32,Ge.A,ze.Luminance)]="F32_LUMINANCE",e[e.F16_R=rt(de.F16,Ge.R,ze.None)]="F16_R",e[e.F16_RG=rt(de.F16,Ge.RG,ze.None)]="F16_RG",e[e.F16_RGB=rt(de.F16,Ge.RGB,ze.None)]="F16_RGB",e[e.F16_RGBA=rt(de.F16,Ge.RGBA,ze.None)]="F16_RGBA",e[e.F32_R=rt(de.F32,Ge.R,ze.None)]="F32_R",e[e.F32_RG=rt(de.F32,Ge.RG,ze.None)]="F32_RG",e[e.F32_RGB=rt(de.F32,Ge.RGB,ze.None)]="F32_RGB",e[e.F32_RGBA=rt(de.F32,Ge.RGBA,ze.None)]="F32_RGBA",e[e.U8_R=rt(de.U8,Ge.R,ze.None)]="U8_R",e[e.U8_R_NORM=rt(de.U8,Ge.R,ze.Normalized)]="U8_R_NORM",e[e.U8_RG=rt(de.U8,Ge.RG,ze.None)]="U8_RG",e[e.U8_RG_NORM=rt(de.U8,Ge.RG,ze.Normalized)]="U8_RG_NORM",e[e.U8_RGB=rt(de.U8,Ge.RGB,ze.None)]="U8_RGB",e[e.U8_RGB_NORM=rt(de.U8,Ge.RGB,ze.Normalized)]="U8_RGB_NORM",e[e.U8_RGB_SRGB=rt(de.U8,Ge.RGB,ze.sRGB|ze.Normalized)]="U8_RGB_SRGB",e[e.U8_RGBA=rt(de.U8,Ge.RGBA,ze.None)]="U8_RGBA",e[e.U8_RGBA_NORM=rt(de.U8,Ge.RGBA,ze.Normalized)]="U8_RGBA_NORM",e[e.U8_RGBA_SRGB=rt(de.U8,Ge.RGBA,ze.sRGB|ze.Normalized)]="U8_RGBA_SRGB",e[e.U16_R=rt(de.U16,Ge.R,ze.None)]="U16_R",e[e.U16_R_NORM=rt(de.U16,Ge.R,ze.Normalized)]="U16_R_NORM",e[e.U16_RG_NORM=rt(de.U16,Ge.RG,ze.Normalized)]="U16_RG_NORM",e[e.U16_RGBA_NORM=rt(de.U16,Ge.RGBA,ze.Normalized)]="U16_RGBA_NORM",e[e.U16_RGBA=rt(de.U16,Ge.RGBA,ze.None)]="U16_RGBA",e[e.U16_RGB=rt(de.U16,Ge.RGB,ze.None)]="U16_RGB",e[e.U16_RG=rt(de.U16,Ge.RG,ze.None)]="U16_RG",e[e.U32_R=rt(de.U32,Ge.R,ze.None)]="U32_R",e[e.U32_RG=rt(de.U32,Ge.RG,ze.None)]="U32_RG",e[e.U32_RGB=rt(de.U32,Ge.RGB,ze.None)]="U32_RGB",e[e.U32_RGBA=rt(de.U32,Ge.RGBA,ze.None)]="U32_RGBA",e[e.S8_R=rt(de.S8,Ge.R,ze.None)]="S8_R",e[e.S8_R_NORM=rt(de.S8,Ge.R,ze.Normalized)]="S8_R_NORM",e[e.S8_RG_NORM=rt(de.S8,Ge.RG,ze.Normalized)]="S8_RG_NORM",e[e.S8_RGB_NORM=rt(de.S8,Ge.RGB,ze.Normalized)]="S8_RGB_NORM",e[e.S8_RGBA_NORM=rt(de.S8,Ge.RGBA,ze.Normalized)]="S8_RGBA_NORM",e[e.S16_R=rt(de.S16,Ge.R,ze.None)]="S16_R",e[e.S16_RG=rt(de.S16,Ge.RG,ze.None)]="S16_RG",e[e.S16_RG_NORM=rt(de.S16,Ge.RG,ze.Normalized)]="S16_RG_NORM",e[e.S16_RGB_NORM=rt(de.S16,Ge.RGB,ze.Normalized)]="S16_RGB_NORM",e[e.S16_RGBA=rt(de.S16,Ge.RGBA,ze.None)]="S16_RGBA",e[e.S16_RGBA_NORM=rt(de.S16,Ge.RGBA,ze.Normalized)]="S16_RGBA_NORM",e[e.S32_R=rt(de.S32,Ge.R,ze.None)]="S32_R",e[e.S32_RG=rt(de.S32,Ge.RG,ze.None)]="S32_RG",e[e.S32_RGB=rt(de.S32,Ge.RGB,ze.None)]="S32_RGB",e[e.S32_RGBA=rt(de.S32,Ge.RGBA,ze.None)]="S32_RGBA",e[e.U16_RGBA_5551=rt(de.U16_PACKED_5551,Ge.RGBA,ze.Normalized)]="U16_RGBA_5551",e[e.U16_RGB_565=rt(de.U16_PACKED_565,Ge.RGB,ze.Normalized)]="U16_RGB_565",e[e.BC1=rt(de.BC1,Ge.RGBA,ze.Normalized)]="BC1",e[e.BC1_SRGB=rt(de.BC1,Ge.RGBA,ze.Normalized|ze.sRGB)]="BC1_SRGB",e[e.BC2=rt(de.BC2,Ge.RGBA,ze.Normalized)]="BC2",e[e.BC2_SRGB=rt(de.BC2,Ge.RGBA,ze.Normalized|ze.sRGB)]="BC2_SRGB",e[e.BC3=rt(de.BC3,Ge.RGBA,ze.Normalized)]="BC3",e[e.BC3_SRGB=rt(de.BC3,Ge.RGBA,ze.Normalized|ze.sRGB)]="BC3_SRGB",e[e.BC4_UNORM=rt(de.BC4_UNORM,Ge.R,ze.Normalized)]="BC4_UNORM",e[e.BC4_SNORM=rt(de.BC4_SNORM,Ge.R,ze.Normalized)]="BC4_SNORM",e[e.BC5_UNORM=rt(de.BC5_UNORM,Ge.RG,ze.Normalized)]="BC5_UNORM",e[e.BC5_SNORM=rt(de.BC5_SNORM,Ge.RG,ze.Normalized)]="BC5_SNORM",e[e.D24=rt(de.D24,Ge.R,ze.Depth)]="D24",e[e.D24_S8=rt(de.D24S8,Ge.RG,ze.Depth|ze.Stencil)]="D24_S8",e[e.D32F=rt(de.D32F,Ge.R,ze.Depth)]="D32F",e[e.D32F_S8=rt(de.D32FS8,Ge.RG,ze.Depth|ze.Stencil)]="D32F_S8",e[e.U8_RGB_RT=rt(de.U8,Ge.RGB,ze.RenderTarget|ze.Normalized)]="U8_RGB_RT",e[e.U8_RGBA_RT=rt(de.U8,Ge.RGBA,ze.RenderTarget|ze.Normalized)]="U8_RGBA_RT",e[e.U8_RGBA_RT_SRGB=rt(de.U8,Ge.RGBA,ze.RenderTarget|ze.Normalized|ze.sRGB)]="U8_RGBA_RT_SRGB"})(G||(G={}));function Tp(e){return e>>>8&255}function oi(e){return e>>>16&255}function Fa(e){return e&255}function IA(e){switch(e){case de.F32:case de.U32:case de.S32:return 4;case de.U16:case de.S16:case de.F16:return 2;case de.U8:case de.S8:return 1;default:throw new Error("whoops")}}function OA(e){return IA(oi(e))}function o8(e){var t=IA(oi(e)),r=Tp(e);return t*r}function PA(e){var t=Fa(e);if(t&ze.Depth)return nr.Depth;if(t&ze.Normalized)return nr.Float;var r=oi(e);if(r===de.F16||r===de.F32)return nr.Float;if(r===de.U8||r===de.U16||r===de.U32)return nr.Uint;if(r===de.S8||r===de.S16||r===de.S32)return nr.Sint;throw new Error("whoops")}function dt(e,t){if(t===void 0&&(t=""),!e)throw new Error("Assert fail: ".concat(t))}function po(e){if(e!=null)return e;throw new Error("Missing object")}function NA(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}function FA(e,t){e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a}function DA(e){var t=e.r,r=e.g,n=e.b,i=e.a;return{r:t,g:r,b:n,a:i}}function Su(e,t,r,n){return n===void 0&&(n=1),{r:e,g:t,b:r,a:n}}var Uc=Su(0,0,0,0);Su(0,0,0,1);var a8=Su(1,1,1,0);Su(1,1,1,1);function _c(e){return!!(e&&(e&e-1)===0)}function aa(e,t){return e!=null?e:t}function s8(e){return e===void 0?null:e}function vc(e,t){var r=t-1;return e+r&~r}function u8(e,t){for(var r=new Array(e),n=0;n<e;n++)r[n]=t();return r}function l8(e,t){t===void 0&&(t=1);var r=e.split(`
`);return r.map(function(n,i){return"".concat(c8(""+(t+i),4," "),"  ").concat(n)}).join(`
`)}function c8(e,t,r){for(r===void 0&&(r="0");e.length<t;)e="".concat(r).concat(e);return e}function rE(e,t){e.blendDstFactor=t.blendDstFactor,e.blendSrcFactor=t.blendSrcFactor,e.blendMode=t.blendMode}function mc(e,t){return e===void 0&&(e={}),e.compare=t.compare,e.depthFailOp=t.depthFailOp,e.passOp=t.passOp,e.failOp=t.failOp,e.mask=t.mask,e}function BA(e,t){return e===void 0&&(e={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),rE(e.rgbBlendState,t.rgbBlendState),rE(e.alphaBlendState,t.alphaBlendState),e.channelWriteMask=t.channelWriteMask,e}function wA(e,t){e.length!==t.length&&(e.length=t.length);for(var r=0;r<t.length;r++)e[r]=BA(e[r],t[r])}function f8(e,t){t.attachmentsState!==void 0&&wA(e.attachmentsState,t.attachmentsState),e.blendConstant&&t.blendConstant&&FA(e.blendConstant,t.blendConstant),e.depthCompare=aa(t.depthCompare,e.depthCompare),e.depthWrite=aa(t.depthWrite,e.depthWrite),e.stencilWrite=aa(t.stencilWrite,e.stencilWrite),e.stencilFront&&t.stencilFront&&mc(e.stencilFront,t.stencilFront),e.stencilBack&&t.stencilBack&&mc(e.stencilBack,t.stencilBack),e.cullMode=aa(t.cullMode,e.cullMode),e.frontFace=aa(t.frontFace,e.frontFace),e.polygonOffset=aa(t.polygonOffset,e.polygonOffset)}function Da(e){var t=Object.assign({},e);return t.attachmentsState=[],wA(t.attachmentsState,e.attachmentsState),t.blendConstant=t.blendConstant&&DA(t.blendConstant),t.stencilFront=mc(void 0,e.stencilFront),t.stencilBack=mc(void 0,e.stencilBack),t}var nE={blendMode:Dr.ADD,blendSrcFactor:Rt.ONE,blendDstFactor:Rt.ZERO},Ba={attachmentsState:[{channelWriteMask:Fr.ALL,rgbBlendState:nE,alphaBlendState:nE}],blendConstant:DA(Uc),depthWrite:!0,depthCompare:zt.LEQUAL,stencilWrite:!1,stencilFront:{compare:zt.ALWAYS,passOp:ir.KEEP,depthFailOp:ir.KEEP,failOp:ir.KEEP},stencilBack:{compare:zt.ALWAYS,passOp:ir.KEEP,depthFailOp:ir.KEEP,failOp:ir.KEEP},cullMode:dn.NONE,frontFace:_u.CCW,polygonOffset:!1};function h8(e,t){e===void 0&&(e=null),t===void 0&&(t=Ba);var r=Da(t);return e!==null&&f8(r,e),r}h8({depthCompare:zt.ALWAYS,depthWrite:!1},Ba);var LA={texture:null,sampler:null,formatKind:nr.Float,dimension:Ct.TEXTURE_2D};function ki(e,t,r){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!r(e[n],t[n]))return!1;return!0}function pa(e,t){for(var r=Array(e.length),n=0;n<e.length;n++)r[n]=t(e[n]);return r}function d8(e,t){return e.texture===t.texture&&e.binding===t.binding}function iE(e,t){return e.buffer===t.buffer&&e.size===t.size&&e.binding===t.binding&&e.offset===t.offset}function p8(e,t){return e===null?t===null:t===null?!1:e.sampler===t.sampler&&e.texture===t.texture&&e.dimension===t.dimension&&e.formatKind===t.formatKind&&e.comparison===t.comparison}function _8(e,t){return e.samplerBindings=e.samplerBindings||[],e.uniformBufferBindings=e.uniformBufferBindings||[],e.storageBufferBindings=e.storageBufferBindings||[],e.storageTextureBindings=e.storageTextureBindings||[],t.samplerBindings=t.samplerBindings||[],t.uniformBufferBindings=t.uniformBufferBindings||[],t.storageBufferBindings=t.storageBufferBindings||[],t.storageTextureBindings=t.storageTextureBindings||[],!(e.samplerBindings.length!==t.samplerBindings.length||!ki(e.samplerBindings,t.samplerBindings,p8)||!ki(e.uniformBufferBindings,t.uniformBufferBindings,iE)||!ki(e.storageBufferBindings,t.storageBufferBindings,iE)||!ki(e.storageTextureBindings,t.storageTextureBindings,d8))}function oE(e,t){return e.blendMode==t.blendMode&&e.blendSrcFactor===t.blendSrcFactor&&e.blendDstFactor===t.blendDstFactor}function v8(e,t){return!(!oE(e.rgbBlendState,t.rgbBlendState)||!oE(e.alphaBlendState,t.alphaBlendState)||e.channelWriteMask!==t.channelWriteMask)}function gc(e,t){return e.compare==t.compare&&e.depthFailOp===t.depthFailOp&&e.failOp===t.failOp&&e.passOp===t.passOp&&e.mask===t.mask}function m8(e,t){return!ki(e.attachmentsState,t.attachmentsState,v8)||e.blendConstant&&t.blendConstant&&!NA(e.blendConstant,t.blendConstant)||e.stencilFront&&t.stencilFront&&!gc(e.stencilFront,t.stencilFront)||e.stencilBack&&t.stencilBack&&!gc(e.stencilBack,t.stencilBack)?!1:e.depthCompare===t.depthCompare&&e.depthWrite===t.depthWrite&&e.stencilWrite===t.stencilWrite&&e.cullMode===t.cullMode&&e.frontFace===t.frontFace&&e.polygonOffset===t.polygonOffset}function UA(e,t){return e.id===t.id}function g8(e,t){return e===t}function E8(e,t){return!(e.topology!==t.topology||e.inputLayout!==t.inputLayout||e.sampleCount!==t.sampleCount||e.megaStateDescriptor&&t.megaStateDescriptor&&!m8(e.megaStateDescriptor,t.megaStateDescriptor)||!UA(e.program,t.program)||!ki(e.colorAttachmentFormats,t.colorAttachmentFormats,g8)||e.depthStencilAttachmentFormat!==t.depthStencilAttachmentFormat)}function y8(e,t){return e.offset===t.offset&&e.shaderLocation===t.shaderLocation&&e.format===t.format&&e.divisor===t.divisor}function A8(e,t){return wn(e)?wn(t):wn(t)?!1:e.arrayStride===t.arrayStride&&e.stepMode===t.stepMode&&ki(e.attributes,t.attributes,y8)}function T8(e,t){return!(e.indexBufferFormat!==t.indexBufferFormat||!ki(e.vertexBufferDescriptors,t.vertexBufferDescriptors,A8)||!UA(e.program,t.program))}function S8(e){var t=e.sampler,r=e.texture,n=e.dimension,i=e.formatKind,o=e.comparison;return{sampler:t,texture:r,dimension:n,formatKind:i,comparison:o}}function aE(e){var t=e.buffer,r=e.size,n=e.binding,i=e.offset;return{binding:n,buffer:t,offset:i,size:r}}function x8(e){var t=e.binding,r=e.texture;return{binding:t,texture:r}}function R8(e){var t=e.samplerBindings&&pa(e.samplerBindings,S8),r=e.uniformBufferBindings&&pa(e.uniformBufferBindings,aE),n=e.storageBufferBindings&&pa(e.storageBufferBindings,aE),i=e.storageTextureBindings&&pa(e.storageTextureBindings,x8);return{samplerBindings:t,uniformBufferBindings:r,storageBufferBindings:n,storageTextureBindings:i,pipeline:e.pipeline}}function C8(e){var t=e.inputLayout,r=e.program,n=e.topology,i=e.megaStateDescriptor&&Da(e.megaStateDescriptor),o=e.colorAttachmentFormats.slice(),a=e.depthStencilAttachmentFormat,s=e.sampleCount;return{inputLayout:t,megaStateDescriptor:i,program:r,topology:n,colorAttachmentFormats:o,depthStencilAttachmentFormat:a,sampleCount:s}}function b8(e){var t=e.shaderLocation,r=e.format,n=e.offset,i=e.divisor;return{shaderLocation:t,format:r,offset:n,divisor:i}}function M8(e){if(wn(e))return e;var t=e.arrayStride,r=e.stepMode,n=pa(e.attributes,b8);return{arrayStride:t,stepMode:r,attributes:n}}function I8(e){var t=pa(e.vertexBufferDescriptors,M8),r=e.indexBufferFormat,n=e.program;return{vertexBufferDescriptors:t,indexBufferFormat:r,program:n}}var It,O8=/([^[]*)(\[[0-9]+\])?/;function P8(e){if(e[e.length-1]!=="]")return{name:e,length:1,isArray:!1};var t=e.match(O8);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(e));return{name:t[1],length:Number(t[2])||1,isArray:Boolean(t[2])}}function en(){var e=null;return function(t,r,n){var i=e!==n;return i&&(t.uniform1i(r,n),e=n),i}}function er(e,t,r,n){var i=null,o=null;return function(a,s,u){var l=t(u,r),f=l.length,c=!1;if(i===null)i=new Float32Array(f),o=f,c=!0;else{dt(o===f,"Uniform length cannot change.");for(var h=0;h<f;++h)if(l[h]!==i[h]){c=!0;break}}return c&&(n(a,e,s,l),i.set(l)),c}}function Yr(e,t,r,n){e[t](r,n)}function di(e,t,r,n){e[t](r,!1,n)}var N8={},F8={},D8={},sE=[0];function Sp(e,t,r,n){t===1&&typeof e=="boolean"&&(e=e?1:0),Number.isFinite(e)&&(sE[0]=e,e=sE);var i=e.length;if(e instanceof r)return e;var o=n[i];o||(o=new r(i),n[i]=o);for(var a=0;a<i;a++)o[a]=e[a];return o}function yn(e,t){return Sp(e,t,Float32Array,N8)}function Fi(e,t){return Sp(e,t,Int32Array,F8)}function Sl(e,t){return Sp(e,t,Uint32Array,D8)}var B8=(It={},It[D.FLOAT]=er.bind(null,"uniform1fv",yn,1,Yr),It[D.FLOAT_VEC2]=er.bind(null,"uniform2fv",yn,2,Yr),It[D.FLOAT_VEC3]=er.bind(null,"uniform3fv",yn,3,Yr),It[D.FLOAT_VEC4]=er.bind(null,"uniform4fv",yn,4,Yr),It[D.INT]=er.bind(null,"uniform1iv",Fi,1,Yr),It[D.INT_VEC2]=er.bind(null,"uniform2iv",Fi,2,Yr),It[D.INT_VEC3]=er.bind(null,"uniform3iv",Fi,3,Yr),It[D.INT_VEC4]=er.bind(null,"uniform4iv",Fi,4,Yr),It[D.BOOL]=er.bind(null,"uniform1iv",Fi,1,Yr),It[D.BOOL_VEC2]=er.bind(null,"uniform2iv",Fi,2,Yr),It[D.BOOL_VEC3]=er.bind(null,"uniform3iv",Fi,3,Yr),It[D.BOOL_VEC4]=er.bind(null,"uniform4iv",Fi,4,Yr),It[D.FLOAT_MAT2]=er.bind(null,"uniformMatrix2fv",yn,4,di),It[D.FLOAT_MAT3]=er.bind(null,"uniformMatrix3fv",yn,9,di),It[D.FLOAT_MAT4]=er.bind(null,"uniformMatrix4fv",yn,16,di),It[D.UNSIGNED_INT]=er.bind(null,"uniform1uiv",Sl,1,Yr),It[D.UNSIGNED_INT_VEC2]=er.bind(null,"uniform2uiv",Sl,2,Yr),It[D.UNSIGNED_INT_VEC3]=er.bind(null,"uniform3uiv",Sl,3,Yr),It[D.UNSIGNED_INT_VEC4]=er.bind(null,"uniform4uiv",Sl,4,Yr),It[D.FLOAT_MAT2x3]=er.bind(null,"uniformMatrix2x3fv",yn,6,di),It[D.FLOAT_MAT2x4]=er.bind(null,"uniformMatrix2x4fv",yn,8,di),It[D.FLOAT_MAT3x2]=er.bind(null,"uniformMatrix3x2fv",yn,6,di),It[D.FLOAT_MAT3x4]=er.bind(null,"uniformMatrix3x4fv",yn,12,di),It[D.FLOAT_MAT4x2]=er.bind(null,"uniformMatrix4x2fv",yn,8,di),It[D.FLOAT_MAT4x3]=er.bind(null,"uniformMatrix4x3fv",yn,12,di),It[D.SAMPLER_2D]=en,It[D.SAMPLER_CUBE]=en,It[D.SAMPLER_3D]=en,It[D.SAMPLER_2D_SHADOW]=en,It[D.SAMPLER_2D_ARRAY]=en,It[D.SAMPLER_2D_ARRAY_SHADOW]=en,It[D.SAMPLER_CUBE_SHADOW]=en,It[D.INT_SAMPLER_2D]=en,It[D.INT_SAMPLER_3D]=en,It[D.INT_SAMPLER_CUBE]=en,It[D.INT_SAMPLER_2D_ARRAY]=en,It[D.UNSIGNED_INT_SAMPLER_2D]=en,It[D.UNSIGNED_INT_SAMPLER_3D]=en,It[D.UNSIGNED_INT_SAMPLER_CUBE]=en,It[D.UNSIGNED_INT_SAMPLER_2D_ARRAY]=en,It);function uE(e,t,r){var n=B8[r.type];if(!n)throw new Error("Unknown GLSL uniform type ".concat(r.type));return n().bind(null,e,t)}var w8={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function L8(e){return Object.prototype.toString.call(e)in w8}function Os(e,t){return"#define ".concat(e," ").concat(t)}function U8(e){var t={};return e.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,function(r,n,i){var o=Number(i);return t[n]=isNaN(o)?i:o,""}),t}function k8(e,t){var r=[];return e.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,function(n,i,o){var a=Number(i);return r.push({location:isNaN(a)?t[i]:a,name:o}),""}),r}function lE(e){if(e===void 0)return null;var t=/binding\s*=\s*(\d+)/.exec(e);if(t!==null){var r=parseInt(t[1],10);if(!Number.isNaN(r))return r}return null}function cE(e){var t="",r=e;return[r,t]}function wa(e,t,r,n,i){var o;n===void 0&&(n=null),i===void 0&&(i=!0);var a=e.glslVersion==="#version 100",s=t==="frag"&&((o=r.match(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm))===null||o===void 0?void 0:o.length)>1,u=r.replace(`\r
`,`
`).split(`
`).map(function(H){return H.replace(/[/][/].*$/,"")}).filter(function(H){var B=!H||/^\s+$/.test(H);return!B}),l="";n!==null&&(l=Object.keys(n).map(function(H){return Os(H,n[H])}).join(`
`));var f=u.find(function(H){return H.startsWith("precision")})||"precision mediump float;",c=i?u.filter(function(H){return!H.startsWith("precision")}).join(`
`):u.join(`
`),h="";if(e.viewportOrigin===ni.UPPER_LEFT&&(h+="".concat(Os("VIEWPORT_ORIGIN_TL","1"),`
`)),e.clipSpaceNearZ===Na.ZERO&&(h+="".concat(Os("CLIPSPACE_NEAR_ZERO","1"),`
`)),e.explicitBindingLocations){var d=0,p=0,v=0;c=c.replace(/^\s*(layout\((.*)\))?\s*uniform(.+{)$/gm,function(H,B,q,Ee){var Z=q?"".concat(q,", "):"";return"layout(".concat(Z,"set = ").concat(d,", binding = ").concat(p++,") uniform ").concat(Ee)}),d++,p=0,dt(e.separateSamplerTextures),c=c.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(H,B,q,Ee,Z){var k=lE(q);k===null&&(k=p++);var $=Xn(cE(Ee),2),K=$[0],ce=$[1];return t==="frag"?`
layout(set = `.concat(d,", binding = ").concat(k*2+0,") uniform texture").concat(K," T_").concat(Z,`;
layout(set = `).concat(d,", binding = ").concat(k*2+1,") uniform sampler").concat(ce," S_").concat(Z,";").trim():""}),c=c.replace(t==="frag"?/^\s*\b(varying|in)\b/gm:/^\s*\b(varying|out)\b/gm,function(H,B){return"layout(location = ".concat(v++,") ").concat(B)}),h+="".concat(Os("gl_VertexID","gl_VertexIndex"),`
`),h+="".concat(Os("gl_InstanceID","gl_InstanceIndex"),`
`),f=f.replace(/^precision (.*) sampler(.*);$/gm,"")}else{var m=0;c=c.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(H,B,q,Ee,Z){var k=lE(q);return k===null&&(k=m++),"uniform sampler".concat(Ee," ").concat(Z,"; // BINDING=").concat(k)})}if(c=c.replace(/\bPU_SAMPLER_(\w+)\((.*?)\)/g,function(H,B,q){return"SAMPLER_".concat(B,"(P_").concat(q,")")}),c=c.replace(/\bPF_SAMPLER_(\w+)\((.*?)\)/g,function(H,B,q){return"PP_SAMPLER_".concat(B,"(P_").concat(q,")")}),c=c.replace(/\bPU_TEXTURE\((.*?)\)/g,function(H,B){return"TEXTURE(P_".concat(B,")")}),e.separateSamplerTextures)c=c.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,function(H,B,q){var Ee=Xn(cE(B),2),Z=Ee[0],k=Ee[1];return"texture".concat(Z," T_P_").concat(q,", sampler").concat(k," S_P_").concat(q)}),c=c.replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,function(H,B,q){return"T_".concat(q,", S_").concat(q)}),c=c.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(H,B,q){return"sampler".concat(B,"(T_").concat(q,", S_").concat(q,")")}),c=c.replace(/\bTEXTURE\((.*?)\)/g,function(H,B){return"T_".concat(B)});else{var y=[];c=c.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,function(H,B,q){return"sampler".concat(B," P_").concat(q)}),c=c.replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,function(H,B,q){return q}),c=c.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(H,B,q){return y.push([q,B]),q}),a&&y.forEach(function(H){var B=Xn(H,2),q=B[0],Ee=B[1];c=c.replace(new RegExp("texture\\(".concat(q),"g"),function(){return"texture".concat(Ee,"(").concat(q)})}),c=c.replace(/\bTEXTURE\((.*?)\)/g,function(H,B){return B})}var A="".concat(a?"":e.glslVersion,`
`).concat(a&&s?`#extension GL_EXT_draw_buffers : require
`:"",`
`).concat(a&&t==="frag"?`#extension GL_OES_standard_derivatives : enable
`:"").concat(i?f:"",`
`).concat(h||"").concat(l?l+`
`:"",`
`).concat(c,`
`).trim();if(e.explicitBindingLocations&&t==="frag"&&(A=A.replace(/^\b(out)\b/g,function(H,B){return"layout(location = 0) ".concat(B)})),a){if(t==="frag"&&(A=A.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,function(H,B,q){return"varying ".concat(B," ").concat(q,`;
`)})),t==="vert"&&(A=A.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(H,B,q){return"varying ".concat(B," ").concat(q,`;
`)}),A=A.replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,function(H,B,q){return"attribute ".concat(B," ").concat(q,`;
`)})),A=A.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,function(H,B){return B.trim().replace(/^.*$/gm,function(q){var Ee=q.trim();return Ee.startsWith("#")?Ee:q?"uniform ".concat(Ee):""})}),t==="frag")if(s){var T=[];A=A.replace(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm,function(H,B){return T.push(B),"vec4 ".concat(B,`;
`)});var R=A.lastIndexOf("}");A=A.substring(0,R)+`
    `.concat(T.map(function(H,B){return"gl_FragData[".concat(B,"] = ").concat(H,`;
    `)}).join(`
`))+A.substring(R)}else{var b;if(A=A.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(H,B,q){return b=q,"".concat(B," ").concat(q,`;
`)}),b){var R=A.lastIndexOf("}");A=A.substring(0,R)+`
  gl_FragColor = vec4(`.concat(b,`);
`)+A.substring(R)}}A=A.replace(/^\s*layout\((.*)\)/gm,"")}return A}var Ln=function(e){or(t,e);function t(r){var n=r.id,i=r.device,o=e.call(this)||this;return o.id=n,o.device=i,o.device.resourceCreationTracker!==null&&o.device.resourceCreationTracker.trackResourceCreated(o),o}return t.prototype.destroy=function(){this.device.resourceCreationTracker!==null&&this.device.resourceCreationTracker.trackResourceDestroyed(this)},t}(MA),z8=function(e){or(t,e);function t(r){var n=r.id,i=r.device,o=r.descriptor,a=e.call(this,{id:n,device:i})||this;a.type=Dt.Bindings;var s=o.uniformBufferBindings,u=o.samplerBindings;return a.uniformBufferBindings=s||[],a.samplerBindings=u||[],a.bindingLayouts=a.createBindingLayouts(),a}return t.prototype.createBindingLayouts=function(){var r=0,n=0,i=[],o=this.uniformBufferBindings.length,a=this.samplerBindings.length;return i.push({firstUniformBuffer:r,numUniformBuffers:o,firstSampler:n,numSamplers:a}),r+=o,n+=a,{numUniformBuffers:r,numSamplers:n,bindingLayoutTables:i}},t}(Ln);function Ye(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:Boolean(e&&e._version===2)}function kA(e){var t=oi(e);switch(t){case de.BC1:case de.BC2:case de.BC3:case de.BC4_UNORM:case de.BC4_SNORM:case de.BC5_UNORM:case de.BC5_SNORM:return!0;default:return!1}}function zA(e){var t=Fa(e);if(t&ze.Normalized)return!1;var r=oi(e);return r===de.S8||r===de.S16||r===de.S32||r===de.U8||r===de.U16||r===de.U32}function V8(e){switch(e){case Gn.STATIC:return D.STATIC_DRAW;case Gn.DYNAMIC:return D.DYNAMIC_DRAW}}function fE(e){if(e&Gt.INDEX)return D.ELEMENT_ARRAY_BUFFER;if(e&Gt.VERTEX)return D.ARRAY_BUFFER;if(e&Gt.UNIFORM)return D.UNIFORM_BUFFER}function H8(e){switch(e){case vr.TRIANGLES:return D.TRIANGLES;case vr.POINTS:return D.POINTS;case vr.TRIANGLE_STRIP:return D.TRIANGLE_STRIP;case vr.LINES:return D.LINES;case vr.LINE_STRIP:return D.LINE_STRIP;default:throw new Error("Unknown primitive topology mode")}}function X8(e){switch(e){case de.U8:return D.UNSIGNED_BYTE;case de.U16:return D.UNSIGNED_SHORT;case de.U32:return D.UNSIGNED_INT;case de.S8:return D.BYTE;case de.S16:return D.SHORT;case de.S32:return D.INT;case de.F16:return D.HALF_FLOAT;case de.F32:return D.FLOAT;default:throw new Error("whoops")}}function W8(e){switch(e){case Ge.R:return 1;case Ge.RG:return 2;case Ge.RGB:return 3;case Ge.RGBA:return 4;default:return 1}}function j8(e){var t=oi(e),r=Tp(e),n=Fa(e),i=X8(t),o=W8(r),a=!!(n&ze.Normalized);return{size:o,type:i,normalized:a}}function G8(e){switch(e){case G.U8_R:return D.UNSIGNED_BYTE;case G.U16_R:return D.UNSIGNED_SHORT;case G.U32_R:return D.UNSIGNED_INT;default:throw new Error("whoops")}}function Ps(e){switch(e){case tn.CLAMP_TO_EDGE:return D.CLAMP_TO_EDGE;case tn.REPEAT:return D.REPEAT;case tn.MIRRORED_REPEAT:return D.MIRRORED_REPEAT;default:throw new Error("whoops")}}function xl(e,t){if(t===Mr.LINEAR&&e===sr.BILINEAR)return D.LINEAR_MIPMAP_LINEAR;if(t===Mr.LINEAR&&e===sr.POINT)return D.NEAREST_MIPMAP_LINEAR;if(t===Mr.NEAREST&&e===sr.BILINEAR)return D.LINEAR_MIPMAP_NEAREST;if(t===Mr.NEAREST&&e===sr.POINT)return D.NEAREST_MIPMAP_NEAREST;if(t===Mr.NO_MIP&&e===sr.BILINEAR)return D.LINEAR;if(t===Mr.NO_MIP&&e===sr.POINT)return D.NEAREST;throw new Error("Unknown texture filter mode")}function Sa(e,t){t===void 0&&(t=0);var r=e;return r.gl_buffer_pages[t/r.pageByteSize|0]}function fa(e){var t=e;return t.gl_texture}function Rd(e){var t=e;return t.gl_sampler}function Ns(e,t){e.name=t,e.__SPECTOR_Metadata={name:t}}function hE(e,t){for(var r=[];;){var n=t.exec(e);if(!n)break;r.push(n)}return r}function Di(e){return e.blendMode==Dr.ADD&&e.blendSrcFactor==Rt.ONE&&e.blendDstFactor===Rt.ZERO}function $8(e){switch(e){case pc.OcclusionConservative:return D.ANY_SAMPLES_PASSED_CONSERVATIVE;default:throw new Error("whoops")}}function Y8(e){if(e===Ct.TEXTURE_2D)return D.TEXTURE_2D;if(e===Ct.TEXTURE_2D_ARRAY)return D.TEXTURE_2D_ARRAY;if(e===Ct.TEXTURE_CUBE_MAP)return D.TEXTURE_CUBE_MAP;if(e===Ct.TEXTURE_3D)return D.TEXTURE_3D;throw new Error("whoops")}function bh(e,t,r,n){return!(e%r!==0||t%n!==0)}var Z8=function(e){or(t,e);function t(r){var n=r.id,i=r.device,o=r.descriptor,a=e.call(this,{id:n,device:i})||this;a.type=Dt.Buffer;var s=o.viewOrSize,u=o.usage,l=o.hint,f=l===void 0?Gn.STATIC:l,c=i.uniformBufferMaxPageByteSize,h=i.gl,d=u&Gt.UNIFORM;d||(Ye(h)?h.bindVertexArray(null):i.OES_vertex_array_object.bindVertexArrayOES(null));var p=da(s)?vc(s,4):vc(s.byteLength,4);a.gl_buffer_pages=[];var v;if(d){for(var m=p;m>0;)a.gl_buffer_pages.push(a.createBufferPage(Math.min(m,c),u,f)),m-=c;v=c}else a.gl_buffer_pages.push(a.createBufferPage(p,u,f)),v=p;return a.pageByteSize=v,a.byteSize=p,a.usage=u,a.gl_target=fE(u),da(s)||a.setSubData(0,new Uint8Array(s.buffer)),d||(Ye(h)?h.bindVertexArray(a.device.currentBoundVAO):i.OES_vertex_array_object.bindVertexArrayOES(a.device.currentBoundVAO)),a}return t.prototype.setSubData=function(r,n,i,o){i===void 0&&(i=0),o===void 0&&(o=n.byteLength-i);for(var a=this.device.gl,s=this.pageByteSize,u=r+o,l=r,f=r%s;l<u;){var c=Ye(a)?a.COPY_WRITE_BUFFER:this.gl_target,h=Sa(this,l);if(h.ubo)return;a.bindBuffer(c,h),Ye(a)?a.bufferSubData(c,f,n,i,Math.min(u-l,s)):a.bufferSubData(c,f,n),l+=s,f=0,i+=s,this.device.debugGroupStatisticsBufferUpload()}},t.prototype.destroy=function(){e.prototype.destroy.call(this);for(var r=0;r<this.gl_buffer_pages.length;r++)this.gl_buffer_pages[r].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[r]);this.gl_buffer_pages=[]},t.prototype.createBufferPage=function(r,n,i){var o=this.device.gl,a=n&Gt.UNIFORM;if(!Ye(o)&&a)return{ubo:!0};var s=this.device.ensureResourceExists(o.createBuffer()),u=fE(n),l=V8(i);return o.bindBuffer(u,s),o.bufferData(u,r,l),s},t}(Ln),q8=function(e){or(t,e);function t(r){var n,i,o,a,s=r.id,u=r.device,l=r.descriptor,f,c=e.call(this,{id:s,device:u})||this;c.type=Dt.InputLayout;var h=l.vertexBufferDescriptors,d=l.indexBufferFormat,p=l.program;dt(d===G.U16_R||d===G.U32_R||d===null);var v=d!==null?G8(d):null,m=d!==null?OA(d):null,y=c.device.gl,A=c.device.ensureResourceExists(Ye(y)?y.createVertexArray():u.OES_vertex_array_object.createVertexArrayOES());Ye(y)?y.bindVertexArray(A):u.OES_vertex_array_object.bindVertexArrayOES(A),y.bindBuffer(y.ARRAY_BUFFER,Sa(c.device.fallbackVertexBuffer));try{for(var T=Ao(l.vertexBufferDescriptors),R=T.next();!R.done;R=T.next()){var b=R.value,H=b.stepMode,B=b.attributes;try{for(var q=(o=void 0,Ao(B)),Ee=q.next();!Ee.done;Ee=q.next()){var Z=Ee.value,k=Z.shaderLocation,$=Z.format,K=Z.divisor,ce=K===void 0?1:K,Ne=Ye(y)?k:(f=p.attributes[k])===null||f===void 0?void 0:f.location,je=j8($);if(Z.vertexFormat=je,!wn(Ne)){zA($);var Je=je.size,ht=je.type,$e=je.normalized;y.vertexAttribPointer(Ne,Je,ht,$e,0,0),H===To.INSTANCE&&(Ye(y)?y.vertexAttribDivisor(Ne,ce):u.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(Ne,ce)),y.enableVertexAttribArray(Ne)}}}catch(et){o={error:et}}finally{try{Ee&&!Ee.done&&(a=q.return)&&a.call(q)}finally{if(o)throw o.error}}}}catch(et){n={error:et}}finally{try{R&&!R.done&&(i=T.return)&&i.call(T)}finally{if(n)throw n.error}}return Ye(y)?y.bindVertexArray(null):u.OES_vertex_array_object.bindVertexArrayOES(null),c.vertexBufferDescriptors=h,c.vao=A,c.indexBufferFormat=d,c.indexBufferType=v,c.indexBufferCompByteSize=m,c.program=p,c}return t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.currentBoundVAO===this.vao&&(Ye(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)},t}(Ln),Cd=function(e){or(t,e);function t(r){var n=r.id,i=r.device,o=r.descriptor,a=r.fake,s=e.call(this,{id:n,device:i})||this;s.type=Dt.Texture,o=tr({dimension:Ct.TEXTURE_2D,depthOrArrayLayers:1,mipLevelCount:1},o);var u=s.device.gl,l,f,c=s.clampmipLevelCount(o);if(s.immutable=o.usage===qr.RENDER_TARGET,s.pixelStore=o.pixelStore,s.format=o.format,s.dimension=o.dimension,s.formatKind=PA(o.format),s.width=o.width,s.height=o.height,s.depthOrArrayLayers=o.depthOrArrayLayers,s.mipmaps=c>=1,!a){f=s.device.ensureResourceExists(u.createTexture());var h=s.device.translateTextureType(o.format),d=s.device.translateTextureInternalFormat(o.format);if(s.device.setActiveTexture(u.TEXTURE0),s.device.currentTextures[0]=null,s.preprocessImage(),o.dimension===Ct.TEXTURE_2D){if(l=D.TEXTURE_2D,u.bindTexture(l,f),s.immutable)if(Ye(u))u.texStorage2D(l,c,d,o.width,o.height);else{var p=(d===D.DEPTH_COMPONENT||s.isNPOT(),0);(s.format===G.D32F||s.format===G.D24_S8)&&!Ye(u)&&!i.WEBGL_depth_texture||(u.texImage2D(l,p,d,o.width,o.height,0,d,h,null),s.mipmaps&&(s.mipmaps=!1,u.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,D.LINEAR),u.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_S,D.CLAMP_TO_EDGE),u.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_T,D.CLAMP_TO_EDGE)))}dt(o.depthOrArrayLayers===1)}else if(o.dimension===Ct.TEXTURE_2D_ARRAY)l=D.TEXTURE_2D_ARRAY,u.bindTexture(l,f),s.immutable&&Ye(u)&&u.texStorage3D(l,c,d,o.width,o.height,o.depthOrArrayLayers);else if(o.dimension===Ct.TEXTURE_3D)l=D.TEXTURE_3D,u.bindTexture(l,f),s.immutable&&Ye(u)&&u.texStorage3D(l,c,d,o.width,o.height,o.depthOrArrayLayers);else if(o.dimension===Ct.TEXTURE_CUBE_MAP)l=D.TEXTURE_CUBE_MAP,u.bindTexture(l,f),s.immutable&&Ye(u)&&u.texStorage2D(l,c,d,o.width,o.height),dt(o.depthOrArrayLayers===6);else throw new Error("whoops")}return s.gl_texture=f,s.gl_target=l,s.mipLevelCount=c,s}return t.prototype.setImageData=function(r,n){n===void 0&&(n=0);var i=this.device.gl;kA(this.format);var o=this.gl_target===D.TEXTURE_3D||this.gl_target===D.TEXTURE_2D_ARRAY,a=this.gl_target===D.TEXTURE_CUBE_MAP,s=L8(r[0]);this.device.setActiveTexture(i.TEXTURE0),this.device.currentTextures[0]=null;var u=r[0],l,f;s?(l=this.width,f=this.height):(l=u.width,f=u.height,this.width=l,this.height=f),i.bindTexture(this.gl_target,this.gl_texture);var c=this.device.translateTextureFormat(this.format),h=Ye(i)?this.device.translateInternalTextureFormat(this.format):c,d=this.device.translateTextureType(this.format);this.preprocessImage();for(var p=0;p<this.depthOrArrayLayers;p++){var v=r[p],m=this.gl_target;a&&(m=D.TEXTURE_CUBE_MAP_POSITIVE_X+p%6),this.immutable?i.texSubImage2D(m,n,0,0,l,f,c,d,v):Ye(i)?o?i.texImage3D(m,n,h,l,f,this.depthOrArrayLayers,0,c,d,v):i.texImage2D(m,n,h,l,f,0,c,d,v):s?i.texImage2D(m,n,c,l,f,0,c,d,v):i.texImage2D(m,n,c,c,d,v)}this.mipmaps&&this.generateMipmap(o)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteTexture(fa(this))},t.prototype.clampmipLevelCount=function(r){if(r.dimension===Ct.TEXTURE_2D_ARRAY&&r.depthOrArrayLayers>1){var n=oi(r.format);if(n===de.BC1)for(var i=r.width,o=r.height,a=0;a<r.mipLevelCount;a++){if(i<=2||o<=2)return a-1;i=Math.max(i/2|0,1),o=Math.max(o/2|0,1)}}return r.mipLevelCount},t.prototype.preprocessImage=function(){var r=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&r.pixelStorei(D.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&r.pixelStorei(D.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&r.pixelStorei(D.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))},t.prototype.generateMipmap=function(r){r===void 0&&(r=!1);var n=this.device.gl;return!Ye(n)&&this.isNPOT()?this:(this.gl_texture&&this.gl_target&&(n.bindTexture(this.gl_target,this.gl_texture),r?(n.texParameteri(this.gl_target,D.TEXTURE_BASE_LEVEL,0),n.texParameteri(this.gl_target,D.TEXTURE_MAX_LEVEL,Math.log2(this.width)),n.texParameteri(this.gl_target,D.TEXTURE_MIN_FILTER,D.LINEAR_MIPMAP_LINEAR),n.texParameteri(this.gl_target,D.TEXTURE_MAG_FILTER,D.LINEAR)):n.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,D.NEAREST_MIPMAP_LINEAR),n.generateMipmap(this.gl_target),n.bindTexture(this.gl_target,null)),this)},t.prototype.isNPOT=function(){var r=this.device.gl;return Ye(r)?!1:!_c(this.width)||!_c(this.height)},t}(Ln),K8=function(e){or(t,e);function t(r){var n=r.id,i=r.device,o=r.descriptor,a=e.call(this,{id:n,device:i})||this;a.type=Dt.RenderTarget,a.gl_renderbuffer=null,a.texture=null;var s=a.device.gl,u=o.format,l=o.width,f=o.height,c=o.sampleCount,h=c===void 0?1:c,d=o.texture,p=!1;if((u===G.D32F||u===G.D24_S8)&&d&&!Ye(s)&&!i.WEBGL_depth_texture&&(d.destroy(),a.texture=null,p=!0),!p&&d)a.texture=d;else{a.gl_renderbuffer=a.device.ensureResourceExists(s.createRenderbuffer()),s.bindRenderbuffer(s.RENDERBUFFER,a.gl_renderbuffer);var v=a.device.translateTextureInternalFormat(u,!0);Ye(s)&&h>1?s.renderbufferStorageMultisample(D.RENDERBUFFER,h,v,l,f):s.renderbufferStorage(D.RENDERBUFFER,v,l,f)}return a.format=u,a.width=l,a.height=f,a.sampleCount=h,a}return t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gl_renderbuffer!==null&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer),this.texture&&this.texture.destroy()},t}(Ln),cn;(function(e){e[e.NeedsCompile=0]="NeedsCompile",e[e.Compiling=1]="Compiling",e[e.NeedsBind=2]="NeedsBind",e[e.ReadyToUse=3]="ReadyToUse"})(cn||(cn={}));var Q8=function(e){or(t,e);function t(r,n){var i=r.id,o=r.device,a=r.descriptor,s=e.call(this,{id:i,device:o})||this;s.rawVertexGLSL=n,s.type=Dt.Program,s.uniformSetters={},s.attributes=[];var u=s.device.gl;return s.descriptor=a,s.gl_program=s.device.ensureResourceExists(u.createProgram()),s.gl_shader_vert=null,s.gl_shader_frag=null,s.compileState=cn.NeedsCompile,s.tryCompileProgram(),s}return t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)},t.prototype.tryCompileProgram=function(){dt(this.compileState===cn.NeedsCompile);var r=this.descriptor,n=r.vertex,i=r.fragment,o=this.device.gl;(n==null?void 0:n.glsl)&&(i==null?void 0:i.glsl)&&(this.gl_shader_vert=this.compileShader(n.postprocess?n.postprocess(n.glsl):n.glsl,o.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(i.postprocess?i.postprocess(i.glsl):i.glsl,o.FRAGMENT_SHADER),o.attachShader(this.gl_program,this.gl_shader_vert),o.attachShader(this.gl_program,this.gl_shader_frag),o.linkProgram(this.gl_program),this.compileState=cn.Compiling,Ye(o)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram()))},t.prototype.readAttributesFromLinkedProgram=function(){for(var r,n=this.device.gl,i=n.getProgramParameter(this.gl_program,n.ACTIVE_ATTRIBUTES),o=U8(this.descriptor.vertex.glsl),a=k8(this.rawVertexGLSL,o),s=function(f){var c=n.getActiveAttrib(u.gl_program,f),h=c.name,d=c.type,p=c.size,v=n.getAttribLocation(u.gl_program,h),m=(r=a.find(function(y){return y.name===h}))===null||r===void 0?void 0:r.location;v>=0&&!wn(m)&&(u.attributes[m]={name:h,location:v,type:d,size:p})},u=this,l=0;l<i;l++)s(l)},t.prototype.readUniformLocationsFromLinkedProgram=function(){for(var r=this.device.gl,n=r.getProgramParameter(this.gl_program,r.ACTIVE_UNIFORMS),i=0;i<n;i++){var o=r.getActiveUniform(this.gl_program,i),a=P8(o.name).name,s=r.getUniformLocation(this.gl_program,a);if(this.uniformSetters[a]=uE(r,s,o),o&&o.size>1)for(var u=0;u<o.size;u++)s=r.getUniformLocation(this.gl_program,"".concat(a,"[").concat(u,"]")),this.uniformSetters["".concat(a,"[").concat(u,"]")]=uE(r,s,o)}},t.prototype.compileShader=function(r,n){var i=this.device.gl,o=this.device.ensureResourceExists(i.createShader(n));return i.shaderSource(o,r),i.compileShader(o),o},t.prototype.setUniformsLegacy=function(r){r===void 0&&(r={});var n=this.device.gl;if(!Ye(n)){var i=!1;for(var o in r){i||(n.useProgram(this.gl_program),i=!0);var a=r[o],s=this.uniformSetters[o];if(s){var u=a;u instanceof Cd&&(u=u.textureIndex),s(u)}}}return this},t}(Ln),J8=function(e){or(t,e);function t(r){var n=r.id,i=r.device,o=r.descriptor,a=e.call(this,{id:n,device:i})||this;a.type=Dt.QueryPool;var s=a.device.gl;if(Ye(s)){var u=o.elemCount,l=o.type;a.gl_query=u8(u,function(){return a.device.ensureResourceExists(s.createQuery())}),a.gl_query_type=$8(l)}return a}return t.prototype.queryResultOcclusion=function(r){var n=this.device.gl;if(Ye(n)){var i=this.gl_query[r];return n.getQueryParameter(i,n.QUERY_RESULT_AVAILABLE)?!!n.getQueryParameter(i,n.QUERY_RESULT):null}return null},t.prototype.destroy=function(){e.prototype.destroy.call(this);var r=this.device.gl;if(Ye(r))for(var n=0;n<this.gl_query.length;n++)r.deleteQuery(this.gl_query[n])},t}(Ln),eU=function(e){or(t,e);function t(r){var n=r.id,i=r.device,o=e.call(this,{id:n,device:i})||this;return o.type=Dt.Readback,o.gl_pbo=null,o.gl_sync=null,o}return t.prototype.clientWaitAsync=function(r,n,i){n===void 0&&(n=0),i===void 0&&(i=10);var o=this.device.gl;return new Promise(function(a,s){function u(){var l=o.clientWaitSync(r,n,0);if(l==o.WAIT_FAILED){s();return}if(l==o.TIMEOUT_EXPIRED){setTimeout(u,r8(i,0,o.MAX_CLIENT_WAIT_TIMEOUT_WEBGL));return}a()}u()})},t.prototype.getBufferSubDataAsync=function(r,n,i,o,a,s){return Aa(this,void 0,void 0,function(){var u;return Ta(this,function(l){switch(l.label){case 0:return u=this.device.gl,Ye(u)?(this.gl_sync=u.fenceSync(u.SYNC_GPU_COMMANDS_COMPLETE,0),u.flush(),[4,this.clientWaitAsync(this.gl_sync,0,10)]):[3,2];case 1:return l.sent(),u.bindBuffer(r,n),u.getBufferSubData(r,i,o,a,s),u.bindBuffer(r,null),[2,o];case 2:return[2]}})})},t.prototype.readTexture=function(r,n,i,o,a,s,u,l){return u===void 0&&(u=0),l===void 0&&(l=s.byteLength||0),Aa(this,void 0,void 0,function(){var f,c,h,d,p;return Ta(this,function(v){return f=this.device.gl,c=r,h=this.device.translateTextureFormat(c.format),d=this.device.translateTextureType(c.format),p=o8(c.format),Ye(f)?(this.gl_pbo=this.device.ensureResourceExists(f.createBuffer()),f.bindBuffer(f.PIXEL_PACK_BUFFER,this.gl_pbo),f.bufferData(f.PIXEL_PACK_BUFFER,l,f.STREAM_READ),f.bindBuffer(f.PIXEL_PACK_BUFFER,null),f.bindFramebuffer(D.READ_FRAMEBUFFER,this.device.readbackFramebuffer),f.framebufferTexture2D(D.READ_FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_2D,c.gl_texture,0),f.bindBuffer(f.PIXEL_PACK_BUFFER,this.gl_pbo),f.readPixels(n,i,o,a,h,d,u*p),f.bindBuffer(f.PIXEL_PACK_BUFFER,null),[2,this.getBufferSubDataAsync(f.PIXEL_PACK_BUFFER,this.gl_pbo,0,s,u,0)]):[2,this.readTextureSync(r,n,i,o,a,s,u,l)]})})},t.prototype.readTextureSync=function(r,n,i,o,a,s,u,l){l===void 0&&(l=s.byteLength||0);var f=this.device.gl,c=r,h=this.device.translateTextureType(c.format);return f.bindFramebuffer(D.FRAMEBUFFER,this.device.readbackFramebuffer),f.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_2D,c.gl_texture,0),f.pixelStorei(f.PACK_ALIGNMENT,4),f.readPixels(n,i,o,a,f.RGBA,h,s),s},t.prototype.readBuffer=function(r,n,i,o,a){return Aa(this,void 0,void 0,function(){var s;return Ta(this,function(u){return s=this.device.gl,Ye(s)?[2,this.getBufferSubDataAsync(s.ARRAY_BUFFER,Sa(r,n),n,i,o,a)]:[2,Promise.reject()]})})},t.prototype.destroy=function(){e.prototype.destroy.call(this),Ye(this.device.gl)&&(this.gl_sync!==null&&this.device.gl.deleteSync(this.gl_sync),this.gl_pbo!==null&&this.device.gl.deleteBuffer(this.gl_pbo))},t}(Ln),tU=function(e){or(t,e);function t(r){var n=r.id,i=r.device,o=r.descriptor,a,s,u=e.call(this,{id:n,device:i})||this;return u.type=Dt.RenderPipeline,u.drawMode=H8((a=o.topology)!==null&&a!==void 0?a:vr.TRIANGLES),u.program=o.program,u.inputLayout=o.inputLayout,u.megaState=tr(tr({},Da(Ba)),o.megaStateDescriptor),u.colorAttachmentFormats=o.colorAttachmentFormats.slice(),u.depthStencilAttachmentFormat=o.depthStencilAttachmentFormat,u.sampleCount=(s=o.sampleCount)!==null&&s!==void 0?s:1,u}return t}(Ln),rU=function(e){or(t,e);function t(r){var n=r.id,i=r.device,o=r.descriptor,a=e.call(this,{id:n,device:i})||this;return a.type=Dt.ComputePipeline,a.descriptor=o,a}return t}(Ln),nU=function(){function e(){this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return e.prototype.trackResourceCreated=function(t){this.creationStacks.set(t,new Error().stack),this.liveObjects.add(t)},e.prototype.trackResourceDestroyed=function(t){this.deletionStacks.has(t)&&console.warn("Object double freed:",t,`

Creation stack: `,this.creationStacks.get(t),`

Deletion stack: `,this.deletionStacks.get(t),`

This stack: `,new Error().stack),this.deletionStacks.set(t,new Error().stack),this.liveObjects.delete(t)},e.prototype.checkForLeaks=function(){var t,r;try{for(var n=Ao(this.liveObjects.values()),i=n.next();!i.done;i=n.next()){var o=i.value;console.warn("Object leaked:",o,"Creation stack:",this.creationStacks.get(o))}}catch(a){t={error:a}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}},e.prototype.setResourceLeakCheck=function(t,r){r?this.liveObjects.add(t):this.liveObjects.delete(t)},e}(),iU=function(e){or(t,e);function t(r){var n=r.id,i=r.device,o=r.descriptor,a,s,u=e.call(this,{id:n,device:i})||this;u.type=Dt.Sampler;var l=u.device.gl;if(Ye(l)){var f=u.device.ensureResourceExists(l.createSampler());l.samplerParameteri(f,D.TEXTURE_WRAP_S,Ps(o.addressModeU)),l.samplerParameteri(f,D.TEXTURE_WRAP_T,Ps(o.addressModeV)),l.samplerParameteri(f,D.TEXTURE_WRAP_R,Ps((a=o.addressModeW)!==null&&a!==void 0?a:o.addressModeU)),l.samplerParameteri(f,D.TEXTURE_MIN_FILTER,xl(o.minFilter,o.mipmapFilter)),l.samplerParameteri(f,D.TEXTURE_MAG_FILTER,xl(o.magFilter,Mr.NO_MIP)),o.lodMinClamp!==void 0&&l.samplerParameterf(f,D.TEXTURE_MIN_LOD,o.lodMinClamp),o.lodMaxClamp!==void 0&&l.samplerParameterf(f,D.TEXTURE_MAX_LOD,o.lodMaxClamp),o.compareFunction!==void 0&&(l.samplerParameteri(f,l.TEXTURE_COMPARE_MODE,l.COMPARE_REF_TO_TEXTURE),l.samplerParameteri(f,l.TEXTURE_COMPARE_FUNC,o.compareFunction));var c=(s=o.maxAnisotropy)!==null&&s!==void 0?s:1;c>1&&u.device.EXT_texture_filter_anisotropic!==null&&(dt(o.minFilter===sr.BILINEAR&&o.magFilter===sr.BILINEAR&&o.mipmapFilter===Mr.LINEAR),l.samplerParameterf(f,u.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c)),u.gl_sampler=f}else u.descriptor=o;return u}return t.prototype.setTextureParameters=function(r,n,i){var o,a=this.device.gl,s=this.descriptor;this.isNPOT(n,i)?a.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,D.LINEAR):a.texParameteri(r,D.TEXTURE_MIN_FILTER,xl(s.minFilter,s.mipmapFilter)),a.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_S,Ps(s.addressModeU)),a.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_T,Ps(s.addressModeV)),a.texParameteri(r,D.TEXTURE_MAG_FILTER,xl(s.magFilter,Mr.NO_MIP));var u=(o=s.maxAnisotropy)!==null&&o!==void 0?o:1;u>1&&this.device.EXT_texture_filter_anisotropic!==null&&(dt(s.minFilter===sr.BILINEAR&&s.magFilter===sr.BILINEAR&&s.mipmapFilter===Mr.LINEAR),a.texParameteri(r,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u))},t.prototype.destroy=function(){e.prototype.destroy.call(this),Ye(this.device.gl)&&this.device.gl.deleteSampler(Rd(this))},t.prototype.isNPOT=function(r,n){return!_c(r)||!_c(n)},t}(Ln),oU=function(){function e(){}return e.prototype.dispatchWorkgroups=function(t,r,n){},e.prototype.dispatchWorkgroupsIndirect=function(t,r){},e.prototype.setPipeline=function(t){},e.prototype.setBindings=function(t){},e.prototype.pushDebugGroup=function(t){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(t){},e}(),aU=function(e){or(t,e);function t(){var r=e!==null&&e.apply(this,arguments)||this;return r.type=Dt.RenderBundle,r.commands=[],r}return t.prototype.push=function(r){this.commands.push(r)},t.prototype.replay=function(){this.commands.forEach(function(r){return r()})},t}(Ln),dE=65536,sU=/uniform(?:\s+)(\w+)(?:\s?){([^]*?)}/g,uU=function(){function e(t,r){r===void 0&&(r={}),this.shaderDebug=!1,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_color_buffer_float=null,this.EXT_color_buffer_half_float=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.EXT_color_buffer_float=null,this.OES_texture_float_linear=null,this.OES_texture_half_float_linear=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorAttachmentLevels=[],this.currentColorResolveTos=[],this.currentColorResolveToLevels=[],this.currentSampleCount=-1,this.currentIndexBufferByteOffset=null,this.currentMegaState=Da(Ba),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.currentRenderPassDescriptorStack=[],this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveDepthStencilAttachmentsChanged=!1,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=ni.LOWER_LEFT,this.clipSpaceNearZ=Na.NEGATIVE_ONE,this.supportMRT=!1,this.inBlitRenderPass=!1,this.supportedSampleCounts=[],this.occlusionQueriesRecommended=!1,this.computeShadersSupported=!1,this.gl=t,this.contextAttributes=po(t.getContextAttributes()),Ye(t)?(this.EXT_texture_norm16=t.getExtension("EXT_texture_norm16"),this.EXT_color_buffer_float=t.getExtension("EXT_color_buffer_float")):(this.OES_vertex_array_object=t.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=t.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=t.getExtension("OES_texture_float"),this.WEBGL_draw_buffers=t.getExtension("WEBGL_draw_buffers"),this.WEBGL_depth_texture=t.getExtension("WEBGL_depth_texture"),this.WEBGL_color_buffer_float=t.getExtension("WEBGL_color_buffer_float"),this.EXT_color_buffer_half_float=t.getExtension("EXT_color_buffer_half_float"),t.getExtension("EXT_frag_depth"),t.getExtension("OES_element_index_uint"),t.getExtension("OES_standard_derivatives")),this.WEBGL_compressed_texture_s3tc=t.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=t.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=t.getExtension("EXT_texture_filter_anisotropic"),this.EXT_texture_norm16=t.getExtension("EXT_texture_norm16"),this.OES_texture_float_linear=t.getExtension("OES_texture_float_linear"),this.OES_texture_half_float_linear=t.getExtension("OES_texture_half_float_linear"),this.KHR_parallel_shader_compile=t.getExtension("KHR_parallel_shader_compile"),Ye(t)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new Cd({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depthOrArrayLayers:1,dimension:Ct.TEXTURE_2D,mipLevelCount:1,usage:qr.RENDER_TARGET,format:this.contextAttributes.alpha===!1?G.U8_RGB_RT:G.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=nr.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(t.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(Ct.TEXTURE_2D,nr.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(Ct.TEXTURE_2D,nr.Depth),this.fallbackVertexBuffer=this.createBuffer({viewOrSize:1,usage:Gt.VERTEX,hint:Gn.STATIC}),Ye(t)&&(this.fallbackTexture2DArray=this.createFallbackTexture(Ct.TEXTURE_2D_ARRAY,nr.Float),this.fallbackTexture3D=this.createFallbackTexture(Ct.TEXTURE_3D,nr.Float),this.fallbackTextureCube=this.createFallbackTexture(Ct.TEXTURE_CUBE_MAP,nr.Float)),this.currentMegaState.depthCompare=zt.LESS,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=Fr.ALL,t.enable(t.DEPTH_TEST),t.enable(t.STENCIL_TEST),this.checkLimits(),r.shaderDebug&&(this.shaderDebug=!0),r.trackResources&&(this.resourceCreationTracker=new nU)}return e.prototype.destroy=function(){this.blitBindings&&this.blitBindings.destroy(),this.blitInputLayout&&this.blitInputLayout.destroy(),this.blitRenderPipeline&&this.blitRenderPipeline.destroy(),this.blitVertexBuffer&&this.blitVertexBuffer.destroy(),this.blitProgram&&this.blitProgram.destroy()},e.prototype.createFallbackTexture=function(t,r){var n=t===Ct.TEXTURE_CUBE_MAP?6:1,i=r===nr.Depth?G.D32F:G.U8_RGBA_NORM,o=this.createTexture({dimension:t,format:i,usage:qr.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1});return r===nr.Float&&o.setImageData([new Uint8Array(4*n)]),fa(o)},e.prototype.getNextUniqueId=function(){return++this.resourceUniqueId},e.prototype.checkLimits=function(){var t=this.gl;if(this.maxVertexAttribs=t.getParameter(D.MAX_VERTEX_ATTRIBS),Ye(t)){this.uniformBufferMaxPageByteSize=Math.min(t.getParameter(D.MAX_UNIFORM_BLOCK_SIZE),dE),this.uniformBufferWordAlignment=t.getParameter(t.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var r=t.getInternalformatParameter(t.RENDERBUFFER,t.DEPTH32F_STENCIL8,t.SAMPLES);this.supportedSampleCounts=r?Is([],Xn(r),!1):[],this.occlusionQueriesRecommended=!0}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=dE;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort(function(n,i){return n-i})},e.prototype.configureSwapChain=function(t,r,n){var i=this.scTexture;i.width=t,i.height=r,this.scPlatformFramebuffer=s8(n)},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.gl.canvas},e.prototype.getOnscreenTexture=function(){return this.scTexture},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.translateTextureInternalFormat=function(t,r){switch(r===void 0&&(r=!1),t){case G.ALPHA:return D.ALPHA;case G.U8_LUMINANCE:case G.F16_LUMINANCE:case G.F32_LUMINANCE:return D.LUMINANCE;case G.F16_R:return D.R16F;case G.F16_RG:return D.RG16F;case G.F16_RGB:return D.RGB16F;case G.F16_RGBA:return D.RGBA16F;case G.F32_R:return D.R32F;case G.F32_RG:return D.RG32F;case G.F32_RGB:return D.RGB32F;case G.F32_RGBA:return Ye(this.gl)?D.RGBA32F:r?this.WEBGL_color_buffer_float.RGBA32F_EXT:D.RGBA;case G.U8_R_NORM:return D.R8;case G.U8_RG_NORM:return D.RG8;case G.U8_RGB_NORM:case G.U8_RGB_RT:return D.RGB8;case G.U8_RGB_SRGB:return D.SRGB8;case G.U8_RGBA_NORM:case G.U8_RGBA_RT:return Ye(this.gl)?D.RGBA8:r?D.RGBA4:D.RGBA;case G.U8_RGBA:return D.RGBA;case G.U8_RGBA_SRGB:case G.U8_RGBA_RT_SRGB:return D.SRGB8_ALPHA8;case G.U16_R:return D.R16UI;case G.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case G.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case G.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case G.U16_RGBA_5551:return D.RGB5_A1;case G.U16_RGB_565:return D.RGB565;case G.U32_R:return D.R32UI;case G.S8_RGBA_NORM:return D.RGBA8_SNORM;case G.S8_RG_NORM:return D.RG8_SNORM;case G.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case G.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case G.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case G.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case G.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case G.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case G.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case G.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case G.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case G.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case G.D32F_S8:return Ye(this.gl)?D.DEPTH32F_STENCIL8:this.WEBGL_depth_texture?D.DEPTH_STENCIL:D.DEPTH_COMPONENT16;case G.D24_S8:return Ye(this.gl)?D.DEPTH24_STENCIL8:this.WEBGL_depth_texture?D.DEPTH_STENCIL:D.DEPTH_COMPONENT16;case G.D32F:return Ye(this.gl)?D.DEPTH_COMPONENT32F:this.WEBGL_depth_texture?D.DEPTH_COMPONENT:D.DEPTH_COMPONENT16;case G.D24:return Ye(this.gl)?D.DEPTH_COMPONENT24:this.WEBGL_depth_texture?D.DEPTH_COMPONENT:D.DEPTH_COMPONENT16;default:throw new Error("whoops")}},e.prototype.translateTextureType=function(t){var r=oi(t);switch(r){case de.U8:return D.UNSIGNED_BYTE;case de.U16:return D.UNSIGNED_SHORT;case de.U32:return D.UNSIGNED_INT;case de.S8:return D.BYTE;case de.F16:return D.HALF_FLOAT;case de.F32:return D.FLOAT;case de.U16_PACKED_5551:return D.UNSIGNED_SHORT_5_5_5_1;case de.D32F:return Ye(this.gl)?D.FLOAT:this.WEBGL_depth_texture?D.UNSIGNED_INT:D.UNSIGNED_BYTE;case de.D24:return Ye(this.gl)?D.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?D.UNSIGNED_SHORT:D.UNSIGNED_BYTE;case de.D24S8:return Ye(this.gl)?D.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?D.UNSIGNED_INT_24_8_WEBGL:D.UNSIGNED_BYTE;case de.D32FS8:return D.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw new Error("whoops")}},e.prototype.translateInternalTextureFormat=function(t){switch(t){case G.F32_R:return D.R32F;case G.F32_RG:return D.RG32F;case G.F32_RGB:return D.RGB32F;case G.F32_RGBA:return D.RGBA32F;case G.F16_R:return D.R16F;case G.F16_RG:return D.RG16F;case G.F16_RGB:return D.RGB16F;case G.F16_RGBA:return D.RGBA16F}return this.translateTextureFormat(t)},e.prototype.translateTextureFormat=function(t){if(kA(t)||t===G.F32_LUMINANCE||t===G.U8_LUMINANCE)return this.translateTextureInternalFormat(t);var r=Ye(this.gl)||!Ye(this.gl)&&!!this.WEBGL_depth_texture;switch(t){case G.D24_S8:case G.D32F_S8:return r?D.DEPTH_STENCIL:D.RGBA;case G.D24:case G.D32F:return r?D.DEPTH_COMPONENT:D.RGBA}var n=zA(t),i=Tp(t);switch(i){case Ge.A:return D.ALPHA;case Ge.R:return n?D.RED_INTEGER:D.RED;case Ge.RG:return n?D.RG_INTEGER:D.RG;case Ge.RGB:return n?D.RGB_INTEGER:D.RGB;case Ge.RGBA:return D.RGBA}},e.prototype.setActiveTexture=function(t){this.currentActiveTexture!==t&&(this.gl.activeTexture(t),this.currentActiveTexture=t)},e.prototype.bindVAO=function(t){this.currentBoundVAO!==t&&(Ye(this.gl)?this.gl.bindVertexArray(t):this.OES_vertex_array_object.bindVertexArrayOES(t),this.currentBoundVAO=t)},e.prototype.programCompiled=function(t){dt(t.compileState!==cn.NeedsCompile),t.compileState===cn.Compiling&&(t.compileState=cn.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(t))},e.prototype.useProgram=function(t){this.currentProgram!==t&&(this.programCompiled(t),this.gl.useProgram(t.gl_program),this.currentProgram=t)},e.prototype.ensureResourceExists=function(t){if(t===null){var r=this.gl.getError();throw new Error("Created resource is null; GL error encountered: ".concat(r))}else return t},e.prototype.createBuffer=function(t){return new Z8({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createTexture=function(t){return new Cd({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createSampler=function(t){return new iU({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderTarget=function(t){return new K8({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderTargetFromTexture=function(t){var r=t,n=r.format,i=r.width,o=r.height,a=r.mipLevelCount;return dt(a===1),this.createRenderTarget({format:n,width:i,height:o,sampleCount:1,texture:t})},e.prototype.createProgram=function(t){var r,n,i,o=(r=t.vertex)===null||r===void 0?void 0:r.glsl;return!((n=t.vertex)===null||n===void 0)&&n.glsl&&(t.vertex.glsl=wa(this.queryVendorInfo(),"vert",t.vertex.glsl)),!((i=t.fragment)===null||i===void 0)&&i.glsl&&(t.fragment.glsl=wa(this.queryVendorInfo(),"frag",t.fragment.glsl)),this.createProgramSimple(t,o)},e.prototype.createProgramSimple=function(t,r){var n=new Q8({id:this.getNextUniqueId(),device:this,descriptor:t},r);return n},e.prototype.createBindings=function(t){return new z8({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createInputLayout=function(t){return new q8({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderPipeline=function(t){return new tU({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createComputePass=function(){return new oU},e.prototype.createComputePipeline=function(t){return new rU({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createReadback=function(){return new eU({id:this.getNextUniqueId(),device:this})},e.prototype.createQueryPool=function(t,r){return new J8({id:this.getNextUniqueId(),device:this,descriptor:{type:t,elemCount:r}})},e.prototype.formatRenderPassDescriptor=function(t){var r,n,i,o,a,s,u=t.colorAttachment;t.depthClearValue=(r=t.depthClearValue)!==null&&r!==void 0?r:"load",t.stencilClearValue=(n=t.stencilClearValue)!==null&&n!==void 0?n:"load";for(var l=0;l<u.length;l++)t.colorAttachmentLevel||(t.colorAttachmentLevel=[]),t.colorAttachmentLevel[l]=(i=t.colorAttachmentLevel[l])!==null&&i!==void 0?i:0,t.colorResolveToLevel||(t.colorResolveToLevel=[]),t.colorResolveToLevel[l]=(o=t.colorResolveToLevel[l])!==null&&o!==void 0?o:0,t.colorClearColor||(t.colorClearColor=[]),t.colorClearColor[l]=(a=t.colorClearColor[l])!==null&&a!==void 0?a:"load",t.colorStore||(t.colorStore=[]),t.colorStore[l]=(s=t.colorStore[l])!==null&&s!==void 0?s:!1},e.prototype.createRenderBundle=function(){return new aU({id:this.getNextUniqueId(),device:this})},e.prototype.beginBundle=function(t){this.renderBundle=t},e.prototype.endBundle=function(){this.renderBundle=void 0},e.prototype.executeBundles=function(t){t.forEach(function(r){r.replay()})},e.prototype.createRenderPass=function(t){this.currentRenderPassDescriptor!==null&&this.currentRenderPassDescriptorStack.push(this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=t,this.formatRenderPassDescriptor(t);var r=t.colorAttachment,n=t.colorAttachmentLevel,i=t.colorClearColor,o=t.colorResolveTo,a=t.colorResolveToLevel,s=t.depthStencilAttachment,u=t.depthClearValue,l=t.stencilClearValue,f=t.depthStencilResolveTo;this.setRenderPassParametersBegin(r.length);for(var c=0;c<r.length;c++)this.setRenderPassParametersColor(c,r[c],n[c],o[c],a[c]);this.setRenderPassParametersDepthStencil(s,f),this.validateCurrentAttachments();for(var c=0;c<r.length;c++){var h=i[c];h!=="load"&&this.setRenderPassParametersClearColor(c,h.r,h.g,h.b,h.a)}return this.setRenderPassParametersClearDepthStencil(u,l),this},e.prototype.submitPass=function(t){dt(this.currentRenderPassDescriptor!==null),this.endPass(),this.currentRenderPassDescriptorStack.length?this.currentRenderPassDescriptor=this.currentRenderPassDescriptorStack.pop():this.currentRenderPassDescriptor=null},e.prototype.copySubTexture2D=function(t,r,n,i,o,a){var s=this.gl,u=t,l=i;if(dt(l.mipLevelCount===1),dt(u.mipLevelCount===1),Ye(s))u===this.scTexture?s.bindFramebuffer(s.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(s.bindFramebuffer(s.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0,u,0)),s.bindFramebuffer(s.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(s.READ_FRAMEBUFFER,s.COLOR_ATTACHMENT0,l,0),s.blitFramebuffer(o,a,o+l.width,a+l.height,r,n,r+l.width,n+l.height,s.COLOR_BUFFER_BIT,s.LINEAR),s.bindFramebuffer(s.READ_FRAMEBUFFER,null),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,null);else if(u===this.scTexture){var f=this.createRenderTargetFromTexture(i);this.submitBlitRenderPass(f,u)}},e.prototype.queryLimits=function(){return this},e.prototype.queryTextureFormatSupported=function(t,r,n){switch(t){case G.BC1_SRGB:case G.BC2_SRGB:case G.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb!==null?bh(r,n,4,4):!1;case G.BC1:case G.BC2:case G.BC3:return this.WEBGL_compressed_texture_s3tc!==null?bh(r,n,4,4):!1;case G.BC4_UNORM:case G.BC4_SNORM:case G.BC5_UNORM:case G.BC5_SNORM:return this.EXT_texture_compression_rgtc!==null?bh(r,n,4,4):!1;case G.U16_R_NORM:case G.U16_RG_NORM:case G.U16_RGBA_NORM:return this.EXT_texture_norm16!==null;case G.F32_R:case G.F32_RG:case G.F32_RGB:case G.F32_RGBA:return this.OES_texture_float_linear!==null;case G.F16_R:case G.F16_RG:case G.F16_RGB:case G.F16_RGBA:return this.OES_texture_half_float_linear!==null;default:return!0}},e.prototype.queryProgramReady=function(t){var r=this.gl;if(t.compileState===cn.NeedsCompile)throw new Error("whoops");if(t.compileState===cn.Compiling){var n=void 0;return this.KHR_parallel_shader_compile!==null?n=r.getProgramParameter(t.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR):n=!0,n&&this.programCompiled(t),n}return t.compileState===cn.NeedsBind||t.compileState===cn.ReadyToUse},e.prototype.queryPlatformAvailable=function(){return this.gl.isContextLost()},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(t){return this.currentRenderPassDescriptor},e.prototype.queryRenderTarget=function(t){var r=t;return r},e.prototype.setResourceName=function(t,r){if(t.name=r,t.type===Dt.Buffer)for(var n=t.gl_buffer_pages,i=0;i<n.length;i++)Ns(n[i],"".concat(r," Page ").concat(i));else if(t.type===Dt.Texture)Ns(fa(t),r);else if(t.type===Dt.Sampler)Ns(Rd(t),r);else if(t.type===Dt.RenderTarget){var o=t.gl_renderbuffer;o!==null&&Ns(o,r)}else t.type===Dt.InputLayout&&Ns(t.vao,r)},e.prototype.setResourceLeakCheck=function(t,r){this.resourceCreationTracker!==null&&this.resourceCreationTracker.setResourceLeakCheck(t,r)},e.prototype.checkForLeaks=function(){this.resourceCreationTracker!==null&&this.resourceCreationTracker.checkForLeaks()},e.prototype.pushDebugGroup=function(t){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(t){},e.prototype.programPatched=function(t,r){dt(this.shaderDebug)},e.prototype.getBufferData=function(t,r,n){n===void 0&&(n=0);var i=this.gl;Ye(i)&&(i.bindBuffer(i.COPY_READ_BUFFER,Sa(t,n*4)),i.getBufferSubData(i.COPY_READ_BUFFER,n*4,r))},e.prototype.debugGroupStatisticsDrawCall=function(t){t===void 0&&(t=1);for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].drawCallCount+=t},e.prototype.debugGroupStatisticsBufferUpload=function(t){t===void 0&&(t=1);for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].bufferUploadCount+=t},e.prototype.debugGroupStatisticsTextureBind=function(t){t===void 0&&(t=1);for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].textureBindCount+=t},e.prototype.debugGroupStatisticsTriangles=function(t){for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].triangleCount+=t},e.prototype.reportShaderError=function(t,r){var n=this.gl,i=n.getShaderParameter(t,n.COMPILE_STATUS);if(!i){console.error(l8(r));var o=n.getExtension("WEBGL_debug_shaders");o&&console.error(o.getTranslatedShaderSource(t)),console.error(n.getShaderInfoLog(t))}return i},e.prototype.checkProgramCompilationForErrors=function(t){var r=this.gl,n=t.gl_program;if(!r.getProgramParameter(n,r.LINK_STATUS)){var i=t.descriptor;if(!this.reportShaderError(t.gl_shader_vert,i.vertex.glsl)||!this.reportShaderError(t.gl_shader_frag,i.fragment.glsl))return;console.error(r.getProgramInfoLog(t.gl_program))}},e.prototype.bindFramebufferAttachment=function(t,r,n,i){var o=this.gl;if(wn(n))o.framebufferRenderbuffer(t,r,o.RENDERBUFFER,null);else if(n.type===Dt.RenderTarget)n.gl_renderbuffer!==null?o.framebufferRenderbuffer(t,r,o.RENDERBUFFER,n.gl_renderbuffer):n.texture!==null&&o.framebufferTexture2D(t,r,D.TEXTURE_2D,fa(n.texture),i);else if(n.type===Dt.Texture){var a=fa(n);n.dimension===Ct.TEXTURE_2D?o.framebufferTexture2D(t,r,D.TEXTURE_2D,a,i):Ye(o)&&(n.dimension,Ct.TEXTURE_2D_ARRAY)}},e.prototype.bindFramebufferDepthStencilAttachment=function(t,r){var n=this.gl,i=wn(r)?ze.Depth|ze.Stencil:Fa(r.format),o=!!(i&ze.Depth),a=!!(i&ze.Stencil);if(o&&a){var s=Ye(this.gl)||!Ye(this.gl)&&!!this.WEBGL_depth_texture;s?this.bindFramebufferAttachment(t,n.DEPTH_STENCIL_ATTACHMENT,r,0):this.bindFramebufferAttachment(t,n.DEPTH_ATTACHMENT,r,0)}else o?(this.bindFramebufferAttachment(t,n.DEPTH_ATTACHMENT,r,0),this.bindFramebufferAttachment(t,n.STENCIL_ATTACHMENT,null,0)):a&&(this.bindFramebufferAttachment(t,n.STENCIL_ATTACHMENT,r,0),this.bindFramebufferAttachment(t,n.DEPTH_ATTACHMENT,null,0))},e.prototype.validateCurrentAttachments=function(){for(var t=-1,r=-1,n=-1,i=0;i<this.currentColorAttachments.length;i++){var o=this.currentColorAttachments[i];o!==null&&(t===-1?(t=o.sampleCount,r=o.width,n=o.height):(dt(t===o.sampleCount),dt(r===o.width),dt(n===o.height)))}this.currentDepthStencilAttachment&&(t===-1?t=this.currentDepthStencilAttachment.sampleCount:(dt(t===this.currentDepthStencilAttachment.sampleCount),dt(r===this.currentDepthStencilAttachment.width),dt(n===this.currentDepthStencilAttachment.height))),this.currentSampleCount=t},e.prototype.setRenderPassParametersBegin=function(t){var r=this.gl;if(Ye(r)?r.bindFramebuffer(D.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||r.bindFramebuffer(D.FRAMEBUFFER,this.renderPassDrawFramebuffer),Ye(r)?r.drawBuffers([D.COLOR_ATTACHMENT0,D.COLOR_ATTACHMENT1,D.COLOR_ATTACHMENT2,D.COLOR_ATTACHMENT3]):!this.inBlitRenderPass&&this.WEBGL_draw_buffers&&this.WEBGL_draw_buffers.drawBuffersWEBGL([D.COLOR_ATTACHMENT0_WEBGL,D.COLOR_ATTACHMENT1_WEBGL,D.COLOR_ATTACHMENT2_WEBGL,D.COLOR_ATTACHMENT3_WEBGL]),!this.inBlitRenderPass)for(var n=t;n<this.currentColorAttachments.length;n++){var i=Ye(r)?D.DRAW_FRAMEBUFFER:D.FRAMEBUFFER,o=Ye(r)?D.COLOR_ATTACHMENT0:D.COLOR_ATTACHMENT0_WEBGL;r.framebufferRenderbuffer(i,o+n,D.RENDERBUFFER,null),r.framebufferTexture2D(i,o+n,D.TEXTURE_2D,null,0)}this.currentColorAttachments.length=t},e.prototype.setRenderPassParametersColor=function(t,r,n,i,o){var a=this.gl,s=Ye(a);(this.currentColorAttachments[t]!==r||this.currentColorAttachmentLevels[t]!==n)&&(this.currentColorAttachments[t]=r,this.currentColorAttachmentLevels[t]=n,(s||!s&&this.WEBGL_draw_buffers)&&this.bindFramebufferAttachment(s?D.DRAW_FRAMEBUFFER:D.FRAMEBUFFER,(s?D.COLOR_ATTACHMENT0:D.COLOR_ATTACHMENT0_WEBGL)+t,r,n),this.resolveColorAttachmentsChanged=!0),(this.currentColorResolveTos[t]!==i||this.currentColorResolveToLevels[t]!==o)&&(this.currentColorResolveTos[t]=i,this.currentColorResolveToLevels[t]=o,i!==null&&(this.resolveColorAttachmentsChanged=!0))},e.prototype.setRenderPassParametersDepthStencil=function(t,r){var n=this.gl;this.currentDepthStencilAttachment!==t&&(this.currentDepthStencilAttachment=t,this.inBlitRenderPass||this.bindFramebufferDepthStencilAttachment(Ye(n)?D.DRAW_FRAMEBUFFER:D.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==r&&(this.currentDepthStencilResolveTo=r,r&&(this.resolveDepthStencilAttachmentsChanged=!0))},e.prototype.setRenderPassParametersClearColor=function(t,r,n,i,o){var a=this.gl;if(this.OES_draw_buffers_indexed!==null){var s=this.currentMegaState.attachmentsState[t];s&&s.channelWriteMask!==Fr.ALL&&(this.OES_draw_buffers_indexed.colorMaskiOES(t,!0,!0,!0,!0),s.channelWriteMask=Fr.ALL)}else{var s=this.currentMegaState.attachmentsState[0];s&&s.channelWriteMask!==Fr.ALL&&(a.colorMask(!0,!0,!0,!0),s.channelWriteMask=Fr.ALL)}this.setScissorRectEnabled(!1),Ye(a)?a.clearBufferfv(a.COLOR,t,[r,n,i,o]):(a.clearColor(r,n,i,o),a.clear(a.COLOR_BUFFER_BIT))},e.prototype.setRenderPassParametersClearDepthStencil=function(t,r){t===void 0&&(t="load"),r===void 0&&(r="load");var n=this.gl;t!=="load"&&(dt(!!this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(n.depthMask(!0),this.currentMegaState.depthWrite=!0),Ye(n)?n.clearBufferfv(n.DEPTH,0,[t]):(n.clearDepth(t),n.clear(n.DEPTH_BUFFER_BIT))),r!=="load"&&(dt(!!this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(n.enable(n.STENCIL_TEST),n.stencilMask(255),this.currentMegaState.stencilWrite=!0),Ye(n)?n.clearBufferiv(n.STENCIL,0,[r]):(n.clearStencil(r),n.clear(n.STENCIL_BUFFER_BIT)))},e.prototype.setBindings=function(t){var r=this,n;if(this.renderBundle){this.renderBundle.push(function(){return r.setBindings(t)});return}var i=this.gl,o=t,a=o.uniformBufferBindings,s=o.samplerBindings,u=o.bindingLayouts;dt(0<u.bindingLayoutTables.length);var l=u.bindingLayoutTables[0];dt(a.length>=l.numUniformBuffers),dt(s.length>=l.numSamplers);for(var f=0;f<a.length;f++){var c=a[f];if(c.size!==0){var h=l.firstUniformBuffer+f,d=c.buffer,p=c.offset||0,v=c.size||d.byteSize;if(d!==this.currentUniformBuffers[h]||p!==this.currentUniformBufferByteOffsets[h]||v!==this.currentUniformBufferByteSizes[h]){var m=p%d.pageByteSize,y=d.gl_buffer_pages[p/d.pageByteSize|0];dt(m+v<=d.pageByteSize),Ye(i)&&i.bindBufferRange(i.UNIFORM_BUFFER,h,y,m,v),this.currentUniformBuffers[h]=d,this.currentUniformBufferByteOffsets[h]=p,this.currentUniformBufferByteSizes[h]=v}}}for(var f=0;f<l.numSamplers;f++){var c=s[f],A=l.firstSampler+f,T=c!==null&&c.sampler!==null?Rd(c.sampler):null,R=c!==null&&c.texture!==null?fa(c.texture):null;if(this.currentSamplers[A]!==T&&(Ye(i)&&i.bindSampler(A,T),this.currentSamplers[A]=T),this.currentTextures[A]!==R){if(this.setActiveTexture(i.TEXTURE0+A),R!==null){var b=po(c).texture,H=b.gl_target,B=b.width,q=b.height;c.texture.textureIndex=A,i.bindTexture(H,R),Ye(i)||(n=c.sampler)===null||n===void 0||n.setTextureParameters(H,B,q),this.debugGroupStatisticsTextureBind()}else{var Ee=tr(tr({},c),LA),Z=Ee.dimension,k=Ee.formatKind,H=Y8(Z);i.bindTexture(H,this.getFallbackTexture(tr({gl_target:H,formatKind:k},Ee)))}this.currentTextures[A]=R}}},e.prototype.setViewport=function(t,r,n,i){var o=this.gl;o.viewport(t,r,n,i)},e.prototype.setScissorRect=function(t,r,n,i){var o=this.gl;this.setScissorRectEnabled(!0),o.scissor(t,r,n,i)},e.prototype.applyAttachmentStateIndexed=function(t,r,n){var i=this.gl,o=this.OES_draw_buffers_indexed;r.channelWriteMask!==n.channelWriteMask&&(o.colorMaskiOES(t,!!(n.channelWriteMask&Fr.RED),!!(n.channelWriteMask&Fr.GREEN),!!(n.channelWriteMask&Fr.BLUE),!!(n.channelWriteMask&Fr.ALPHA)),r.channelWriteMask=n.channelWriteMask);var a=r.rgbBlendState.blendMode!==n.rgbBlendState.blendMode||r.alphaBlendState.blendMode!==n.alphaBlendState.blendMode,s=r.rgbBlendState.blendSrcFactor!==n.rgbBlendState.blendSrcFactor||r.alphaBlendState.blendSrcFactor!==n.alphaBlendState.blendSrcFactor||r.rgbBlendState.blendDstFactor!==n.rgbBlendState.blendDstFactor||r.alphaBlendState.blendDstFactor!==n.alphaBlendState.blendDstFactor;(s||a)&&(Di(r.rgbBlendState)&&Di(r.alphaBlendState)?o.enableiOES(t,i.BLEND):Di(n.rgbBlendState)&&Di(n.alphaBlendState)&&o.disableiOES(t,i.BLEND)),a&&(o.blendEquationSeparateiOES(t,n.rgbBlendState.blendMode,n.alphaBlendState.blendMode),r.rgbBlendState.blendMode=n.rgbBlendState.blendMode,r.alphaBlendState.blendMode=n.alphaBlendState.blendMode),s&&(o.blendFuncSeparateiOES(t,n.rgbBlendState.blendSrcFactor,n.rgbBlendState.blendDstFactor,n.alphaBlendState.blendSrcFactor,n.alphaBlendState.blendDstFactor),r.rgbBlendState.blendSrcFactor=n.rgbBlendState.blendSrcFactor,r.alphaBlendState.blendSrcFactor=n.alphaBlendState.blendSrcFactor,r.rgbBlendState.blendDstFactor=n.rgbBlendState.blendDstFactor,r.alphaBlendState.blendDstFactor=n.alphaBlendState.blendDstFactor)},e.prototype.applyAttachmentState=function(t,r){var n=this.gl;t.channelWriteMask!==r.channelWriteMask&&(n.colorMask(!!(r.channelWriteMask&Fr.RED),!!(r.channelWriteMask&Fr.GREEN),!!(r.channelWriteMask&Fr.BLUE),!!(r.channelWriteMask&Fr.ALPHA)),t.channelWriteMask=r.channelWriteMask);var i=t.rgbBlendState.blendMode!==r.rgbBlendState.blendMode||t.alphaBlendState.blendMode!==r.alphaBlendState.blendMode,o=t.rgbBlendState.blendSrcFactor!==r.rgbBlendState.blendSrcFactor||t.alphaBlendState.blendSrcFactor!==r.alphaBlendState.blendSrcFactor||t.rgbBlendState.blendDstFactor!==r.rgbBlendState.blendDstFactor||t.alphaBlendState.blendDstFactor!==r.alphaBlendState.blendDstFactor;(o||i)&&(Di(t.rgbBlendState)&&Di(t.alphaBlendState)?n.enable(n.BLEND):Di(r.rgbBlendState)&&Di(r.alphaBlendState)&&n.disable(n.BLEND)),i&&(n.blendEquationSeparate(r.rgbBlendState.blendMode,r.alphaBlendState.blendMode),t.rgbBlendState.blendMode=r.rgbBlendState.blendMode,t.alphaBlendState.blendMode=r.alphaBlendState.blendMode),o&&(n.blendFuncSeparate(r.rgbBlendState.blendSrcFactor,r.rgbBlendState.blendDstFactor,r.alphaBlendState.blendSrcFactor,r.alphaBlendState.blendDstFactor),t.rgbBlendState.blendSrcFactor=r.rgbBlendState.blendSrcFactor,t.alphaBlendState.blendSrcFactor=r.alphaBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor=r.rgbBlendState.blendDstFactor,t.alphaBlendState.blendDstFactor=r.alphaBlendState.blendDstFactor)},e.prototype.setMegaState=function(t){var r=this.gl,n=this.currentMegaState;if(this.OES_draw_buffers_indexed!==null)for(var i=0;i<t.attachmentsState.length;i++)this.applyAttachmentStateIndexed(i,n.attachmentsState[0],t.attachmentsState[0]);else dt(t.attachmentsState.length===1),this.applyAttachmentState(n.attachmentsState[0],t.attachmentsState[0]);if(NA(n.blendConstant,t.blendConstant)||(r.blendColor(t.blendConstant.r,t.blendConstant.g,t.blendConstant.b,t.blendConstant.a),FA(n.blendConstant,t.blendConstant)),n.depthCompare!==t.depthCompare&&(r.depthFunc(t.depthCompare),n.depthCompare=t.depthCompare),!!n.depthWrite!=!!t.depthWrite&&(r.depthMask(t.depthWrite),n.depthWrite=t.depthWrite),!!n.stencilWrite!=!!t.stencilWrite&&(r.stencilMask(t.stencilWrite?255:0),n.stencilWrite=t.stencilWrite),!gc(n.stencilFront,t.stencilFront)){var o=t.stencilFront,a=o.passOp,s=o.failOp,u=o.depthFailOp,l=o.compare;(n.stencilFront.passOp!==a||n.stencilFront.failOp!==s||n.stencilFront.depthFailOp!==u)&&(r.stencilOpSeparate(r.FRONT,s,u,a),n.stencilFront.passOp=a,n.stencilFront.failOp=s,n.stencilFront.depthFailOp=u),n.stencilFront.compare!==l&&(this.setStencilReference(0),n.stencilFront.compare=l)}if(!gc(n.stencilBack,t.stencilBack)){var f=t.stencilBack,a=f.passOp,s=f.failOp,u=f.depthFailOp,l=f.compare;(n.stencilBack.passOp!==a||n.stencilBack.failOp!==s||n.stencilBack.depthFailOp!==u)&&(r.stencilOpSeparate(r.BACK,s,u,a),n.stencilBack.passOp=a,n.stencilBack.failOp=s,n.stencilBack.depthFailOp=u),n.stencilBack.compare!==l&&(this.setStencilReference(0),n.stencilBack.compare=l)}(n.stencilFront.mask!==t.stencilFront.mask||n.stencilBack.mask!==t.stencilBack.mask)&&(n.stencilFront.mask=t.stencilFront.mask,n.stencilBack.mask=t.stencilBack.mask,this.applyStencil()),n.cullMode!==t.cullMode&&(n.cullMode===dn.NONE?r.enable(r.CULL_FACE):t.cullMode===dn.NONE&&r.disable(r.CULL_FACE),t.cullMode===dn.BACK?r.cullFace(r.BACK):t.cullMode===dn.FRONT?r.cullFace(r.FRONT):t.cullMode===dn.FRONT_AND_BACK&&r.cullFace(r.FRONT_AND_BACK),n.cullMode=t.cullMode),n.frontFace!==t.frontFace&&(r.frontFace(t.frontFace),n.frontFace=t.frontFace),n.polygonOffset!==t.polygonOffset&&(t.polygonOffset?(r.polygonOffset(1,1),r.enable(r.POLYGON_OFFSET_FILL)):r.disable(r.POLYGON_OFFSET_FILL),n.polygonOffset=t.polygonOffset)},e.prototype.validatePipelineFormats=function(t){for(var r=0;r<this.currentColorAttachments.length;r++)var n=this.currentColorAttachments[r];this.currentDepthStencilAttachment&&dt(this.currentDepthStencilAttachment.format===t.depthStencilAttachmentFormat),this.currentSampleCount!==-1&&dt(this.currentSampleCount===t.sampleCount)},e.prototype.setPipeline=function(t){var r=this;if(this.renderBundle){this.renderBundle.push(function(){return r.setPipeline(t)});return}this.currentPipeline=t,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var n=this.currentPipeline.program;if(this.useProgram(n),n.compileState===cn.NeedsBind){var i=this.gl,o=n.gl_program,a=n.descriptor,s=hE(a.vertex.glsl,sU);if(Ye(i))for(var u=0;u<s.length;u++){var l=Xn(s[u],2),f=l[1],c=i.getUniformBlockIndex(o,f);c!==-1&&c!==4294967295&&i.uniformBlockBinding(o,c,u)}for(var h=hE(a.fragment.glsl,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm),u=0;u<h.length;u++){var d=Xn(h[u],3),p=d[1],v=d[2],m=i.getUniformLocation(o,p);i.uniform1i(m,parseInt(v))}n.compileState=cn.ReadyToUse}},e.prototype.setVertexInput=function(t,r,n){var i,o,a=this,s;if(this.renderBundle){this.renderBundle.push(function(){return a.setVertexInput(t,r,n)});return}if(t!==null){dt(this.currentPipeline.inputLayout===t);var u=t;this.bindVAO(u.vao);for(var l=this.gl,f=0;f<u.vertexBufferDescriptors.length;f++){var c=u.vertexBufferDescriptors[f],h=c.arrayStride,d=c.attributes;try{for(var p=(i=void 0,Ao(d)),v=p.next();!v.done;v=p.next()){var m=v.value,y=m.shaderLocation,A=m.offset,T=Ye(l)?y:(s=u.program.attributes[y])===null||s===void 0?void 0:s.location;if(!wn(T)){var R=r[f];if(R===null)continue;var b=m.vertexFormat;l.bindBuffer(l.ARRAY_BUFFER,Sa(R.buffer));var H=(R.offset||0)+A;l.vertexAttribPointer(T,b.size,b.type,b.normalized,h,H)}}}catch(q){i={error:q}}finally{try{v&&!v.done&&(o=p.return)&&o.call(p)}finally{if(i)throw i.error}}}if(dt(n!==null==(u.indexBufferFormat!==null)),n!==null){var B=n.buffer;dt(B.usage===Gt.INDEX),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,Sa(B)),this.currentIndexBufferByteOffset=n.offset||0}else this.currentIndexBufferByteOffset=null}else dt(this.currentPipeline.inputLayout===null),dt(n===null),this.bindVAO(null),this.currentIndexBufferByteOffset=0},e.prototype.setStencilReference=function(t){this.currentStencilRef!==t&&(this.currentStencilRef=t,this.applyStencil())},e.prototype.draw=function(t,r,n,i){var o,a=this;if(this.renderBundle){this.renderBundle.push(function(){return a.draw(t,r,n,i)});return}var s=this.gl,u=this.currentPipeline;if(r){var l=[u.drawMode,n||0,t,r];Ye(s)?s.drawArraysInstanced.apply(s,Is([],Xn(l),!1)):(o=this.ANGLE_instanced_arrays).drawArraysInstancedANGLE.apply(o,Is([],Xn(l),!1))}else s.drawArrays(u.drawMode,n,t);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(t/3*Math.max(r,1))},e.prototype.drawIndexed=function(t,r,n,i,o){var a,s=this;if(this.renderBundle){this.renderBundle.push(function(){return s.drawIndexed(t,r,n,i,o)});return}var u=this.gl,l=this.currentPipeline,f=po(l.inputLayout),c=po(this.currentIndexBufferByteOffset)+n*f.indexBufferCompByteSize;if(r){var h=[l.drawMode,t,f.indexBufferType,c,r];Ye(u)?u.drawElementsInstanced.apply(u,Is([],Xn(h),!1)):(a=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(a,Is([],Xn(h),!1))}else u.drawElements(l.drawMode,t,f.indexBufferType,c);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(t/3*Math.max(r,1))},e.prototype.drawIndirect=function(t,r){},e.prototype.drawIndexedIndirect=function(t,r){},e.prototype.beginOcclusionQuery=function(t){var r=this.gl;if(Ye(r)){var n=this.currentRenderPassDescriptor.occlusionQueryPool;r.beginQuery(n.gl_query_type,n.gl_query[t])}},e.prototype.endOcclusionQuery=function(){var t=this.gl;if(Ye(t)){var r=this.currentRenderPassDescriptor.occlusionQueryPool;t.endQuery(r.gl_query_type)}},e.prototype.pipelineQueryReady=function(t){var r=t;return this.queryProgramReady(r.program)},e.prototype.pipelineForceReady=function(t){},e.prototype.endPass=function(){for(var t=this.gl,r=Ye(t),n=!1,i=0;i<this.currentColorAttachments.length;i++){var o=this.currentColorAttachments[i];if(o!==null){var a=this.currentColorResolveTos[i],s=!1;a!==null&&(dt(o.width===a.width&&o.height===a.height),this.setScissorRectEnabled(!1),r&&t.bindFramebuffer(t.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&r&&this.bindFramebufferAttachment(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,o,this.currentColorAttachmentLevels[i]),s=!0,a===this.scTexture?t.bindFramebuffer(r?D.DRAW_FRAMEBUFFER:D.FRAMEBUFFER,this.scPlatformFramebuffer):(t.bindFramebuffer(r?D.DRAW_FRAMEBUFFER:D.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&t.framebufferTexture2D(r?D.DRAW_FRAMEBUFFER:D.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,a.gl_texture,this.currentColorResolveToLevels[i])),r?(t.blitFramebuffer(0,0,o.width,o.height,0,0,a.width,a.height,t.COLOR_BUFFER_BIT,t.LINEAR),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null)):this.submitBlitRenderPass(o,a),n=!0),this.currentRenderPassDescriptor.colorStore[i]||s||(t.bindFramebuffer(r?D.READ_FRAMEBUFFER:D.FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&this.bindFramebufferAttachment(r?D.READ_FRAMEBUFFER:D.FRAMEBUFFER,t.COLOR_ATTACHMENT0,o,this.currentColorAttachmentLevels[i])),t.bindFramebuffer(r?D.READ_FRAMEBUFFER:D.FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var u=this.currentDepthStencilAttachment;if(u){var l=this.currentDepthStencilResolveTo,s=!1;l&&(dt(u.width===l.width&&u.height===l.height),this.setScissorRectEnabled(!1),t.bindFramebuffer(r?D.READ_FRAMEBUFFER:D.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),t.bindFramebuffer(r?D.DRAW_FRAMEBUFFER:D.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(r?D.READ_FRAMEBUFFER:D.FRAMEBUFFER,u),this.bindFramebufferDepthStencilAttachment(r?D.DRAW_FRAMEBUFFER:D.FRAMEBUFFER,l)),s=!0,r&&t.blitFramebuffer(0,0,u.width,u.height,0,0,l.width,l.height,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(r?D.DRAW_FRAMEBUFFER:D.FRAMEBUFFER,null),n=!0),this.currentRenderPassDescriptor.depthStencilStore||(s||(t.bindFramebuffer(r?D.READ_FRAMEBUFFER:D.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),this.resolveDepthStencilAttachmentsChanged&&this.bindFramebufferDepthStencilAttachment(r?D.READ_FRAMEBUFFER:D.FRAMEBUFFER,u),s=!0),r&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[t.DEPTH_STENCIL_ATTACHMENT])),s&&t.bindFramebuffer(r?D.READ_FRAMEBUFFER:D.FRAMEBUFFER,null),this.resolveDepthStencilAttachmentsChanged=!1}n||t.bindFramebuffer(r?D.DRAW_FRAMEBUFFER:D.FRAMEBUFFER,null)},e.prototype.setScissorRectEnabled=function(t){if(this.currentScissorEnabled!==t){var r=this.gl;t?r.enable(r.SCISSOR_TEST):r.disable(r.SCISSOR_TEST),this.currentScissorEnabled=t}},e.prototype.applyStencil=function(){wn(this.currentStencilRef)||(this.gl.stencilFuncSeparate(D.FRONT,this.currentMegaState.stencilFront.compare,this.currentStencilRef,this.currentMegaState.stencilFront.mask||255),this.gl.stencilFuncSeparate(D.BACK,this.currentMegaState.stencilBack.compare,this.currentStencilRef,this.currentMegaState.stencilBack.mask||255))},e.prototype.getFallbackTexture=function(t){var r=t.gl_target,n=t.formatKind;if(r===D.TEXTURE_2D)return n===nr.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(r===D.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(r===D.TEXTURE_3D)return this.fallbackTexture3D;if(r===D.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.submitBlitRenderPass=function(t,r){this.blitRenderPipeline||(this.blitProgram=this.createProgram({vertex:{glsl:`layout(location = 0) in vec2 a_Position;
out vec2 v_TexCoord;
void main() {
  v_TexCoord = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);

  #ifdef VIEWPORT_ORIGIN_TL
    v_TexCoord.y = 1.0 - v_TexCoord.y;
  #endif
}`},fragment:{glsl:`uniform sampler2D u_Texture;
in vec2 v_TexCoord;
out vec4 outputColor;
void main() {
  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);
}`}}),this.blitVertexBuffer=this.createBuffer({usage:Gt.VERTEX|Gt.COPY_DST,viewOrSize:new Float32Array([-4,-4,4,-4,0,4])}),this.blitInputLayout=this.createInputLayout({vertexBufferDescriptors:[{arrayStride:4*2,stepMode:To.VERTEX,attributes:[{format:G.F32_RG,offset:4*0,shaderLocation:0}]}],indexBufferFormat:null,program:this.blitProgram}),this.blitRenderPipeline=this.createRenderPipeline({topology:vr.TRIANGLES,sampleCount:1,program:this.blitProgram,colorAttachmentFormats:[G.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:this.blitInputLayout,megaStateDescriptor:Da(Ba)}),this.blitBindings=this.createBindings({samplerBindings:[{sampler:null,texture:t.texture}],uniformBufferBindings:[]}),this.blitProgram.setUniformsLegacy({u_Texture:t}));var n=this.currentRenderPassDescriptor;this.currentRenderPassDescriptor=null,this.inBlitRenderPass=!0;var i=this.createRenderPass({colorAttachment:[t],colorResolveTo:[r],colorClearColor:[a8]}),o=this.getCanvas(),a=o.width,s=o.height;i.setPipeline(this.blitRenderPipeline),i.setBindings(this.blitBindings),i.setVertexInput(this.blitInputLayout,[{buffer:this.blitVertexBuffer}],null),i.setViewport(0,0,a,s),this.gl.disable(this.gl.BLEND),i.draw(3,0),this.gl.enable(this.gl.BLEND),this.currentRenderPassDescriptor=n,this.inBlitRenderPass=!1},e}(),lU=function(){function e(t){this.pluginOptions=t}return e.prototype.createSwapChain=function(t){return Aa(this,void 0,void 0,function(){var r,n,i,o,a,s,u,l,f,c,h,d,p;return Ta(this,function(v){return r=this.pluginOptions,n=r.targets,i=r.xrCompatible,o=r.antialias,a=o===void 0?!1:o,s=r.preserveDrawingBuffer,u=s===void 0?!1:s,l=r.premultipliedAlpha,f=l===void 0?!0:l,c=r.shaderDebug,h=r.trackResources,d={antialias:a,preserveDrawingBuffer:u,stencil:!0,premultipliedAlpha:f,xrCompatible:i},this.handleContextEvents(t),n.includes("webgl2")&&(p=t.getContext("webgl2",d)||t.getContext("experimental-webgl2",d)),!p&&n.includes("webgl1")&&(p=t.getContext("webgl",d)||t.getContext("experimental-webgl",d)),[2,new uU(p,{shaderDebug:c,trackResources:h})]})})},e.prototype.handleContextEvents=function(t){var r=this.pluginOptions,n=r.onContextLost,i=r.onContextRestored,o=r.onContextCreationError;o&&t.addEventListener("webglcontextcreationerror",o,!1),n&&t.addEventListener("webglcontextlost",n,!1),i&&t.addEventListener("webglcontextrestored",i,!1)},e}();let rr;const VA=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&VA.decode();let Xs=null;function kl(){return(Xs===null||Xs.byteLength===0)&&(Xs=new Uint8Array(rr.memory.buffer)),Xs}function Ec(e,t){return e=e>>>0,VA.decode(kl().subarray(e,e+t))}const _i=new Array(128).fill(void 0);_i.push(void 0,null,!0,!1);let Ks=_i.length;function cU(e){Ks===_i.length&&_i.push(_i.length+1);const t=Ks;return Ks=_i[t],_i[t]=e,t}function zl(e){return _i[e]}function fU(e){e<132||(_i[e]=Ks,Ks=e)}function hU(e){const t=zl(e);return fU(e),t}let La=0;const Vl=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},dU=typeof Vl.encodeInto=="function"?function(e,t){return Vl.encodeInto(e,t)}:function(e,t){const r=Vl.encode(e);return t.set(r),{read:e.length,written:r.length}};function yc(e,t,r){if(r===void 0){const s=Vl.encode(e),u=t(s.length,1)>>>0;return kl().subarray(u,u+s.length).set(s),La=s.length,u}let n=e.length,i=t(n,1)>>>0;const o=kl();let a=0;for(;a<n;a++){const s=e.charCodeAt(a);if(s>127)break;o[i+a]=s}if(a!==n){a!==0&&(e=e.slice(a)),i=r(i,n,n=a+e.length*3,1)>>>0;const s=kl().subarray(i+a,i+n),u=dU(e,s);a+=u.written}return La=a,i}let Ws=null;function Ac(){return(Ws===null||Ws.byteLength===0)&&(Ws=new Int32Array(rr.memory.buffer)),Ws}function pU(e,t,r){let n,i;try{const s=rr.__wbindgen_add_to_stack_pointer(-16),u=yc(e,rr.__wbindgen_malloc,rr.__wbindgen_realloc),l=La,f=yc(t,rr.__wbindgen_malloc,rr.__wbindgen_realloc),c=La;rr.glsl_compile(s,u,l,f,c,r);var o=Ac()[s/4+0],a=Ac()[s/4+1];return n=o,i=a,Ec(o,a)}finally{rr.__wbindgen_add_to_stack_pointer(16),rr.__wbindgen_free(n,i,1)}}class vu{static __wrap(t){t=t>>>0;const r=Object.create(vu.prototype);return r.__wbg_ptr=t,r}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();rr.__wbg_wgslcomposer_free(t)}constructor(){const t=rr.wgslcomposer_new();return vu.__wrap(t)}load_composable(t){const r=yc(t,rr.__wbindgen_malloc,rr.__wbindgen_realloc),n=La;rr.wgslcomposer_load_composable(this.__wbg_ptr,r,n)}wgsl_compile(t){let r,n;try{const a=rr.__wbindgen_add_to_stack_pointer(-16),s=yc(t,rr.__wbindgen_malloc,rr.__wbindgen_realloc),u=La;rr.wgslcomposer_wgsl_compile(a,this.__wbg_ptr,s,u);var i=Ac()[a/4+0],o=Ac()[a/4+1];return r=i,n=o,Ec(i,o)}finally{rr.__wbindgen_add_to_stack_pointer(16),rr.__wbindgen_free(r,n,1)}}}async function _U(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(n){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const r=await e.arrayBuffer();return await WebAssembly.instantiate(r,t)}else{const r=await WebAssembly.instantiate(e,t);return r instanceof WebAssembly.Instance?{instance:r,module:e}:r}}function vU(){const e={};return e.wbg={},e.wbg.__wbindgen_string_new=function(t,r){const n=Ec(t,r);return cU(n)},e.wbg.__wbindgen_object_drop_ref=function(t){hU(t)},e.wbg.__wbg_log_1d3ae0273d8f4f8a=function(t){console.log(zl(t))},e.wbg.__wbg_log_576ca876af0d4a77=function(t,r){console.log(zl(t),zl(r))},e.wbg.__wbindgen_throw=function(t,r){throw new Error(Ec(t,r))},e}function mU(e,t){return rr=e.exports,HA.__wbindgen_wasm_module=t,Ws=null,Xs=null,rr}async function HA(e){if(rr!==void 0)return rr;const t=vU();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:r,module:n}=await _U(await e,t);return mU(r,n)}var br;(function(e){e[e.COPY_SRC=1]="COPY_SRC",e[e.COPY_DST=2]="COPY_DST",e[e.TEXTURE_BINDING=4]="TEXTURE_BINDING",e[e.STORAGE_BINDING=8]="STORAGE_BINDING",e[e.STORAGE=8]="STORAGE",e[e.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"})(br||(br={}));var bd;(function(e){e[e.READ=1]="READ",e[e.WRITE=2]="WRITE"})(bd||(bd={}));function gU(e){var t=0;return e&qr.SAMPLED&&(t|=br.TEXTURE_BINDING|br.COPY_DST|br.COPY_SRC),e&qr.STORAGE&&(t|=br.TEXTURE_BINDING|br.STORAGE_BINDING|br.COPY_SRC|br.COPY_DST),e&qr.RENDER_TARGET&&(t|=br.RENDER_ATTACHMENT|br.TEXTURE_BINDING|br.COPY_SRC|br.COPY_DST),t}function xp(e){if(e===G.U8_R_NORM)return"r8unorm";if(e===G.S8_R_NORM)return"r8snorm";if(e===G.U8_RG_NORM)return"rg8unorm";if(e===G.S8_RG_NORM)return"rg8snorm";if(e===G.U32_R)return"r32uint";if(e===G.S32_R)return"r32sint";if(e===G.F32_R)return"r32float";if(e===G.U16_RG)return"rg16uint";if(e===G.S16_RG)return"rg16sint";if(e===G.F16_RG)return"rg16float";if(e===G.U8_RGBA_RT)return"bgra8unorm";if(e===G.U8_RGBA_RT_SRGB)return"bgra8unorm-srgb";if(e===G.U8_RGBA_NORM)return"rgba8unorm";if(e===G.U8_RGBA_SRGB)return"rgba8unorm-srgb";if(e===G.S8_RGBA_NORM)return"rgba8snorm";if(e===G.U32_RG)return"rg32uint";if(e===G.S32_RG)return"rg32sint";if(e===G.F32_RG)return"rg32float";if(e===G.U16_RGBA)return"rgba16uint";if(e===G.S16_RGBA)return"rgba16sint";if(e===G.F16_RGBA)return"rgba16float";if(e===G.F32_RGBA)return"rgba32float";if(e===G.U32_RGBA)return"rgba32uint";if(e===G.S32_RGBA)return"rgba32sint";if(e===G.D24)return"depth24plus";if(e===G.D24_S8)return"depth24plus-stencil8";if(e===G.D32F)return"depth32float";if(e===G.D32F_S8)return"depth32float-stencil8";if(e===G.BC1)return"bc1-rgba-unorm";if(e===G.BC1_SRGB)return"bc1-rgba-unorm-srgb";if(e===G.BC2)return"bc2-rgba-unorm";if(e===G.BC2_SRGB)return"bc2-rgba-unorm-srgb";if(e===G.BC3)return"bc3-rgba-unorm";if(e===G.BC3_SRGB)return"bc3-rgba-unorm-srgb";if(e===G.BC4_SNORM)return"bc4-r-snorm";if(e===G.BC4_UNORM)return"bc4-r-unorm";if(e===G.BC5_SNORM)return"bc5-rg-snorm";if(e===G.BC5_UNORM)return"bc5-rg-unorm";throw"whoops"}function EU(e){if(e===Ct.TEXTURE_2D)return"2d";if(e===Ct.TEXTURE_CUBE_MAP)return"2d";if(e===Ct.TEXTURE_2D_ARRAY)return"2d";if(e===Ct.TEXTURE_3D)return"3d";throw new Error("whoops")}function yU(e){if(e===Ct.TEXTURE_2D)return"2d";if(e===Ct.TEXTURE_CUBE_MAP)return"cube";if(e===Ct.TEXTURE_2D_ARRAY)return"2d-array";if(e===Ct.TEXTURE_3D)return"3d";throw new Error("whoops")}function AU(e){var t=0;return e&Gt.INDEX&&(t|=GPUBufferUsage.INDEX),e&Gt.VERTEX&&(t|=GPUBufferUsage.VERTEX),e&Gt.UNIFORM&&(t|=GPUBufferUsage.UNIFORM),e&Gt.STORAGE&&(t|=GPUBufferUsage.STORAGE),e&Gt.COPY_SRC&&(t|=GPUBufferUsage.COPY_SRC),e&Gt.INDIRECT&&(t|=GPUBufferUsage.INDIRECT),t|=GPUBufferUsage.COPY_DST,t}function Mh(e){if(e===tn.CLAMP_TO_EDGE)return"clamp-to-edge";if(e===tn.REPEAT)return"repeat";if(e===tn.MIRRORED_REPEAT)return"mirror-repeat";throw new Error("whoops")}function pE(e){if(e===sr.BILINEAR)return"linear";if(e===sr.POINT)return"nearest";throw new Error("whoops")}function TU(e){if(e===Mr.LINEAR)return"linear";if(e===Mr.NEAREST)return"nearest";if(e===Mr.NO_MIP)return"nearest";throw new Error("whoops")}function _a(e){var t=e;return t.gpuBuffer}function SU(e){var t=e;return t.gpuSampler}function xU(e){var t=e;return t.querySet}function RU(e){if(e===pc.OcclusionConservative)return"occlusion";throw new Error("whoops")}function CU(e){switch(e){case vr.TRIANGLES:return"triangle-list";case vr.POINTS:return"point-list";case vr.TRIANGLE_STRIP:return"triangle-strip";case vr.LINES:return"line-list";case vr.LINE_STRIP:return"line-strip";default:throw new Error("Unknown primitive topology mode")}}function bU(e){if(e===dn.NONE)return"none";if(e===dn.FRONT)return"front";if(e===dn.BACK)return"back";throw new Error("whoops")}function MU(e){if(e===_u.CCW)return"ccw";if(e===_u.CW)return"cw";throw new Error("whoops")}function IU(e,t){return{topology:CU(e),cullMode:bU(t.cullMode),frontFace:MU(t.frontFace)}}function _E(e){if(e===Rt.ZERO)return"zero";if(e===Rt.ONE)return"one";if(e===Rt.SRC)return"src";if(e===Rt.ONE_MINUS_SRC)return"one-minus-src";if(e===Rt.DST)return"dst";if(e===Rt.ONE_MINUS_DST)return"one-minus-dst";if(e===Rt.SRC_ALPHA)return"src-alpha";if(e===Rt.ONE_MINUS_SRC_ALPHA)return"one-minus-src-alpha";if(e===Rt.DST_ALPHA)return"dst-alpha";if(e===Rt.ONE_MINUS_DST_ALPHA)return"one-minus-dst-alpha";if(e===Rt.CONST)return"constant";if(e===Rt.ONE_MINUS_CONSTANT)return"one-minus-constant";if(e===Rt.SRC_ALPHA_SATURATE)return"src-alpha-saturated";throw new Error("whoops")}function OU(e){if(e===Dr.ADD)return"add";if(e===Dr.SUBSTRACT)return"subtract";if(e===Dr.REVERSE_SUBSTRACT)return"reverse-subtract";if(e===Dr.MIN)return"min";if(e===Dr.MAX)return"max";throw new Error("whoops")}function vE(e){return{operation:OU(e.blendMode),srcFactor:_E(e.blendSrcFactor),dstFactor:_E(e.blendDstFactor)}}function mE(e){return e.blendMode===Dr.ADD&&e.blendSrcFactor===Rt.ONE&&e.blendDstFactor===Rt.ZERO}function PU(e){if(!(mE(e.rgbBlendState)&&mE(e.alphaBlendState)))return{color:vE(e.rgbBlendState),alpha:vE(e.alphaBlendState)}}function NU(e,t){return{format:xp(t),blend:PU(e),writeMask:e.channelWriteMask}}function FU(e,t){return t.attachmentsState.map(function(r,n){return NU(r,e[n])})}function Hl(e){if(e===zt.NEVER)return"never";if(e===zt.LESS)return"less";if(e===zt.EQUAL)return"equal";if(e===zt.LEQUAL)return"less-equal";if(e===zt.GREATER)return"greater";if(e===zt.NOTEQUAL)return"not-equal";if(e===zt.GEQUAL)return"greater-equal";if(e===zt.ALWAYS)return"always";throw new Error("whoops")}function sa(e){if(e===ir.KEEP)return"keep";if(e===ir.REPLACE)return"replace";if(e===ir.ZERO)return"zero";if(e===ir.DECREMENT_CLAMP)return"decrement-clamp";if(e===ir.DECREMENT_WRAP)return"decrement-wrap";if(e===ir.INCREMENT_CLAMP)return"increment-clamp";if(e===ir.INCREMENT_WRAP)return"increment-wrap";if(e===ir.INVERT)return"invert";throw new Error("whoops")}function DU(e,t){if(!wn(e))return{format:xp(e),depthWriteEnabled:!!t.depthWrite,depthCompare:Hl(t.depthCompare),depthBias:t.polygonOffset?1:0,depthBiasSlopeScale:t.polygonOffset?1:0,stencilFront:{compare:Hl(t.stencilFront.compare),passOp:sa(t.stencilFront.passOp),failOp:sa(t.stencilFront.failOp),depthFailOp:sa(t.stencilFront.depthFailOp)},stencilBack:{compare:Hl(t.stencilBack.compare),passOp:sa(t.stencilBack.passOp),failOp:sa(t.stencilBack.failOp),depthFailOp:sa(t.stencilBack.depthFailOp)},stencilReadMask:4294967295,stencilWriteMask:4294967295}}function BU(e){if(e!==null){if(e===G.U16_R)return"uint16";if(e===G.U32_R)return"uint32";throw new Error("whoops")}}function wU(e){if(e===To.VERTEX)return"vertex";if(e===To.INSTANCE)return"instance";throw new Error("whoops")}function LU(e){if(e===G.U8_R)return"uint8x2";if(e===G.U8_RG)return"uint8x2";if(e===G.U8_RGB)return"uint8x4";if(e===G.U8_RGBA)return"uint8x4";if(e===G.U8_RG_NORM)return"unorm8x2";if(e===G.U8_RGBA_NORM)return"unorm8x4";if(e===G.S8_RGB_NORM)return"snorm8x4";if(e===G.S8_RGBA_NORM)return"snorm8x4";if(e===G.U16_RG_NORM)return"unorm16x2";if(e===G.U16_RGBA_NORM)return"unorm16x4";if(e===G.S16_RG_NORM)return"snorm16x2";if(e===G.S16_RGBA_NORM)return"snorm16x4";if(e===G.S16_RG)return"uint16x2";if(e===G.F16_RG)return"float16x2";if(e===G.F16_RGBA)return"float16x4";if(e===G.F32_R)return"float32";if(e===G.F32_RG)return"float32x2";if(e===G.F32_RGB)return"float32x3";if(e===G.F32_RGBA)return"float32x4";throw"whoops"}function UU(e){var t=oi(e);switch(t){case de.BC1:case de.BC2:case de.BC3:case de.BC4_SNORM:case de.BC4_UNORM:case de.BC5_SNORM:case de.BC5_UNORM:return!0;default:return!1}}function kU(e){var t=oi(e);switch(t){case de.BC1:case de.BC2:case de.BC3:case de.BC4_SNORM:case de.BC4_UNORM:case de.BC5_SNORM:case de.BC5_UNORM:return 4;default:return 1}}function gE(e,t,r,n){switch(r===void 0&&(r=!1),e){case G.S8_R:case G.S8_R_NORM:case G.S8_RG_NORM:case G.S8_RGB_NORM:case G.S8_RGBA_NORM:{var i=t instanceof ArrayBuffer?new Int8Array(t):new Int8Array(t);return n&&i.set(new Int8Array(n)),i}case G.U8_R:case G.U8_R_NORM:case G.U8_RG:case G.U8_RG_NORM:case G.U8_RGB:case G.U8_RGB_NORM:case G.U8_RGB_SRGB:case G.U8_RGBA:case G.U8_RGBA_NORM:case G.U8_RGBA_SRGB:{var o=t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t);return n&&o.set(new Uint8Array(n)),o}case G.S16_R:case G.S16_RG:case G.S16_RG_NORM:case G.S16_RGB_NORM:case G.S16_RGBA:case G.S16_RGBA_NORM:{var a=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(r?t/2:t);return n&&a.set(new Int16Array(n)),a}case G.U16_R:case G.U16_RGB:case G.U16_RGBA_5551:case G.U16_RGBA_NORM:case G.U16_RG_NORM:case G.U16_R_NORM:{var s=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(r?t/2:t);return n&&s.set(new Uint16Array(n)),s}case G.S32_R:{var u=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(r?t/4:t);return n&&u.set(new Int32Array(n)),u}case G.U32_R:case G.U32_RG:{var l=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(r?t/4:t);return n&&l.set(new Uint32Array(n)),l}case G.F32_R:case G.F32_RG:case G.F32_RGB:case G.F32_RGBA:{var f=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(r?t/4:t);return n&&f.set(new Float32Array(n)),f}}var c=t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t);return n&&c.set(new Uint8Array(n)),c}function zU(e){var t=(e&32768)>>15,r=(e&31744)>>10,n=e&1023;return r===0?(t?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):r==31?n?NaN:(t?-1:1)*(1/0):(t?-1:1)*Math.pow(2,r-15)*(1+n/Math.pow(2,10))}function XA(e){switch(e){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2unorm":case"rg11b10ufloat":return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw new Error("No fixed size for Stencil8 format!");case"depth16unorm":return{width:1,height:1,length:2};case"depth24plus":throw new Error("No fixed size for Depth24Plus format!");case"depth24plus-stencil8":throw new Error("No fixed size for Depth24PlusStencil8 format!");case"depth32float":return{width:1,height:1,length:4};case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8};default:return{width:1,height:1,length:4}}}var Yn=function(e){or(t,e);function t(r){var n=r.id,i=r.device,o=e.call(this)||this;return o.id=n,o.device=i,o}return t.prototype.destroy=function(){},t}(MA),VU=function(e){or(t,e);function t(r){var n=r.id,i=r.device,o=r.descriptor,a,s,u=e.call(this,{id:n,device:i})||this;u.type=Dt.Bindings;var l=o.pipeline;dt(!!l);var f=o.uniformBufferBindings,c=o.storageBufferBindings,h=o.samplerBindings,d=o.storageTextureBindings;u.numUniformBuffers=(f==null?void 0:f.length)||0;var p=[[],[],[],[]],v=0;if(f&&f.length)for(var m=0;m<f.length;m++){var y=o.uniformBufferBindings[m],A=y.binding,T=y.size,R=y.offset,b=y.buffer,H={buffer:_a(b),offset:R!=null?R:0,size:T};p[0].push({binding:A!=null?A:v++,resource:H})}if(h&&h.length){v=0;for(var m=0;m<h.length;m++){var B=tr(tr({},h[m]),LA),A=o.samplerBindings[m],q=A.texture!==null?A.texture:u.device.getFallbackTexture(B);B.dimension=q.dimension,B.formatKind=PA(q.format);var Ee=q.gpuTextureView;if(p[1].push({binding:(a=A.textureBinding)!==null&&a!==void 0?a:v++,resource:Ee}),A.samplerBinding!==-1){var Z=A.sampler!==null?A.sampler:u.device.getFallbackSampler(B),k=SU(Z);p[1].push({binding:(s=A.samplerBinding)!==null&&s!==void 0?s:v++,resource:k})}}}if(c&&c.length){v=0;for(var m=0;m<c.length;m++){var $=o.storageBufferBindings[m],A=$.binding,T=$.size,R=$.offset,b=$.buffer,H={buffer:_a(b),offset:R!=null?R:0,size:T};p[2].push({binding:A!=null?A:v++,resource:H})}}if(d&&d.length){v=0;for(var m=0;m<d.length;m++){var K=o.storageTextureBindings[m],A=K.binding,q=K.texture,Ee=q.gpuTextureView;p[3].push({binding:A!=null?A:v++,resource:Ee})}}var ce=p.findLastIndex(function(Ne){return!!Ne.length});return u.gpuBindGroup=p.map(function(Ne,je){return je<=ce&&u.device.device.createBindGroup({layout:l.getBindGroupLayout(je),entries:Ne})}),u}return t}(Yn),HU=function(e){or(t,e);function t(r){var n=r.id,i=r.device,o=r.descriptor,a=e.call(this,{id:n,device:i})||this;a.type=Dt.Buffer;var s=o.usage,u=o.viewOrSize,l=!!(s&Gt.MAP_READ);a.usage=AU(s),l&&(a.usage=Gt.MAP_READ|Gt.COPY_DST);var f=!da(u);if(a.view=da(u)?null:u,a.size=da(u)?vc(u,4):vc(u.byteLength,4),da(u))a.gpuBuffer=a.device.device.createBuffer({usage:a.usage,size:a.size,mappedAtCreation:l?f:!1});else{a.gpuBuffer=a.device.device.createBuffer({usage:a.usage,size:a.size,mappedAtCreation:!0});var c=u&&u.constructor||Float32Array;new c(a.gpuBuffer.getMappedRange()).set(u),a.gpuBuffer.unmap()}return a}return t.prototype.setSubData=function(r,n,i,o){i===void 0&&(i=0),o===void 0&&(o=0);var a=this.gpuBuffer;o=o||n.byteLength,o=Math.min(o,this.size-r);var s=n.byteOffset+i,u=s+o,l=o+3&-4;if(l!==o){var f=new Uint8Array(n.buffer.slice(s,u));n=new Uint8Array(l),n.set(f),i=0,s=0,u=l,o=l}for(var c=1024*1024*15,h=0;u-(s+h)>c;)this.device.device.queue.writeBuffer(a,r+h,n.buffer,s+h,c),h+=c;this.device.device.queue.writeBuffer(a,r+h,n.buffer,s+h,o-h)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuBuffer.destroy()},t}(Yn),EE=function(){function e(){this.gpuComputePassEncoder=null}return e.prototype.dispatchWorkgroups=function(t,r,n){this.gpuComputePassEncoder.dispatchWorkgroups(t,r,n)},e.prototype.dispatchWorkgroupsIndirect=function(t,r){this.gpuComputePassEncoder.dispatchWorkgroupsIndirect(t.gpuBuffer,r)},e.prototype.finish=function(){this.gpuComputePassEncoder.end(),this.gpuComputePassEncoder=null,this.frameCommandEncoder=null},e.prototype.beginComputePass=function(t){dt(this.gpuComputePassEncoder===null),this.frameCommandEncoder=t,this.gpuComputePassEncoder=this.frameCommandEncoder.beginComputePass(this.gpuComputePassDescriptor)},e.prototype.setPipeline=function(t){var r=t,n=po(r.gpuComputePipeline);this.gpuComputePassEncoder.setPipeline(n)},e.prototype.setBindings=function(t){var r=this,n=t;n.gpuBindGroup.forEach(function(i,o){i&&r.gpuComputePassEncoder.setBindGroup(o,n.gpuBindGroup[o])})},e.prototype.pushDebugGroup=function(t){this.gpuComputePassEncoder.pushDebugGroup(t)},e.prototype.popDebugGroup=function(){this.gpuComputePassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(t){this.gpuComputePassEncoder.insertDebugMarker(t)},e}(),XU=function(e){or(t,e);function t(r){var n=r.id,i=r.device,o=r.descriptor,a=e.call(this,{id:n,device:i})||this;a.type=Dt.ComputePipeline,a.gpuComputePipeline=null,a.descriptor=o;var s=o.program,u=s.computeStage;if(u===null)return a;var l={layout:"auto",compute:tr({},u)};return a.gpuComputePipeline=a.device.device.createComputePipeline(l),a.name!==void 0&&(a.gpuComputePipeline.label=a.name),a}return t.prototype.getBindGroupLayout=function(r){return this.gpuComputePipeline.getBindGroupLayout(r)},t}(Yn),WU=function(e){or(t,e);function t(r){var n,i,o,a,s=r.id,u=r.device,l=r.descriptor,f=e.call(this,{id:s,device:u})||this;f.type=Dt.InputLayout;var c=[];try{for(var h=Ao(l.vertexBufferDescriptors),d=h.next();!d.done;d=h.next()){var p=d.value,v=p.arrayStride,m=p.stepMode,y=p.attributes;c.push({arrayStride:v,stepMode:wU(m),attributes:[]});try{for(var A=(o=void 0,Ao(y)),T=A.next();!T.done;T=A.next()){var R=T.value,b=R.shaderLocation,H=R.format,B=R.offset;c[c.length-1].attributes.push({shaderLocation:b,format:LU(H),offset:B})}}catch(q){o={error:q}}finally{try{T&&!T.done&&(a=A.return)&&a.call(A)}finally{if(o)throw o.error}}}}catch(q){n={error:q}}finally{try{d&&!d.done&&(i=h.return)&&i.call(h)}finally{if(n)throw n.error}}return f.indexFormat=BU(l.indexBufferFormat),f.buffers=c,f}return t}(Yn),yE=function(e){or(t,e);function t(r){var n=r.id,i=r.device,o=r.descriptor,a=e.call(this,{id:n,device:i})||this;return a.type=Dt.Program,a.vertexStage=null,a.fragmentStage=null,a.computeStage=null,a.descriptor=o,o.vertex&&(a.vertexStage=a.createShaderStage(o.vertex,"vertex")),o.fragment&&(a.fragmentStage=a.createShaderStage(o.fragment,"fragment")),o.compute&&(a.computeStage=a.createShaderStage(o.compute,"compute")),a}return t.prototype.setUniformsLegacy=function(r){},t.prototype.createShaderStage=function(r,n){var i,o,a=r.glsl,s=r.wgsl,u=r.entryPoint,l=r.postprocess,f=!1,c=s;if(!c)try{c=this.device.glsl_compile(a,n,f)}catch(y){throw console.error(y,a),new Error("whoops")}var h=function(y){if(!c.includes(y))return"continue";c=c.replace("var T_".concat(y,": texture_2d<f32>;"),"var T_".concat(y,": texture_depth_2d;")),c=c.replace(new RegExp("textureSample\\(T_".concat(y,"(.*)\\);$"),"gm"),function(A,T){return"vec4<f32>(textureSample(T_".concat(y).concat(T,"), 0.0, 0.0, 0.0);")})};try{for(var d=Ao(["u_TextureFramebufferDepth"]),p=d.next();!p.done;p=d.next()){var v=p.value;h(v)}}catch(y){i={error:y}}finally{try{p&&!p.done&&(o=d.return)&&o.call(d)}finally{if(i)throw i.error}}l&&(c=l(c));var m=this.device.device.createShaderModule({code:c});return{module:m,entryPoint:u||"main"}},t}(Yn),jU=function(e){or(t,e);function t(r){var n=r.id,i=r.device,o=r.descriptor,a=e.call(this,{id:n,device:i})||this;a.type=Dt.QueryPool;var s=o.elemCount,u=o.type;return a.querySet=a.device.device.createQuerySet({type:RU(u),count:s}),a.resolveBuffer=a.device.device.createBuffer({size:s*8,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),a.cpuBuffer=a.device.device.createBuffer({size:s*8,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),a.results=null,a}return t.prototype.queryResultOcclusion=function(r){return this.results===null?null:this.results[r]!==BigInt(0)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.querySet.destroy(),this.resolveBuffer.destroy(),this.cpuBuffer.destroy()},t}(Yn),GU=function(e){or(t,e);function t(r){var n=r.id,i=r.device,o=e.call(this,{id:n,device:i})||this;return o.type=Dt.Readback,o}return t.prototype.readTexture=function(r,n,i,o,a,s,u,l){return u===void 0&&(u=0),Aa(this,void 0,void 0,function(){var f,c,h,d,p,v,m,y;return Ta(this,function(A){return f=r,c=0,h=XA(f.gpuTextureformat),d=Math.ceil(o/h.width)*h.length,p=Math.ceil(d/256)*256,v=p*a,m=this.device.createBuffer({usage:Gt.STORAGE|Gt.MAP_READ|Gt.COPY_DST,hint:Gn.STATIC,viewOrSize:v}),y=this.device.device.createCommandEncoder(),y.copyTextureToBuffer({texture:f.gpuTexture,mipLevel:0,origin:{x:n,y:i,z:Math.max(c,0)}},{buffer:m.gpuBuffer,offset:0,bytesPerRow:p},{width:o,height:a,depthOrArrayLayers:1}),this.device.device.queue.submit([y.finish()]),[2,this.readBuffer(m,0,s.byteLength===v?s:null,u,v,f.format,!0,!1,d,p,a)]})})},t.prototype.readTextureSync=function(r,n,i,o,a,s,u,l){throw new Error("ERROR_MSG_METHOD_NOT_IMPLEMENTED")},t.prototype.readBuffer=function(r,n,i,o,a,s,u,l,f,c,h){var d=this;n===void 0&&(n=0),i===void 0&&(i=null),a===void 0&&(a=0),s===void 0&&(s=G.U8_RGB),u===void 0&&(u=!1),f===void 0&&(f=0),c===void 0&&(c=0),h===void 0&&(h=0);var p=r,v=a||p.size,m=i||p.view,y=m&&m.constructor&&m.constructor.BYTES_PER_ELEMENT||OA(s),A=p;if(!(p.usage&Gt.MAP_READ&&p.usage&Gt.COPY_DST)){var T=this.device.device.createCommandEncoder();A=this.device.createBuffer({usage:Gt.STORAGE|Gt.MAP_READ|Gt.COPY_DST,hint:Gn.STATIC,viewOrSize:v}),T.copyBufferToBuffer(p.gpuBuffer,n,A.gpuBuffer,0,v),this.device.device.queue.submit([T.finish()])}return new Promise(function(R,b){A.gpuBuffer.mapAsync(bd.READ,n,v).then(function(){var H=A.gpuBuffer.getMappedRange(n,v),B=m;if(u)B===null?B=gE(s,v,!0,H):B=gE(s,B.buffer,void 0,H);else if(B===null)switch(y){case 1:B=new Uint8Array(v),B.set(new Uint8Array(H));break;case 2:B=d.getHalfFloatAsFloatRGBAArrayBuffer(v/2,H);break;case 4:B=new Float32Array(v/4),B.set(new Float32Array(H));break}else switch(y){case 1:B=new Uint8Array(B.buffer),B.set(new Uint8Array(H));break;case 2:B=d.getHalfFloatAsFloatRGBAArrayBuffer(v/2,H,m);break;case 4:var q=m&&m.constructor||Float32Array;B=new q(B.buffer),B.set(new q(H));break}if(f!==c){y===1&&!u&&(f*=2,c*=2);for(var Ee=new Uint8Array(B.buffer),Z=f,k=0,$=1;$<h;++$){k=$*c;for(var K=0;K<f;++K)Ee[Z++]=Ee[k++]}y!==0&&!u?B=new Float32Array(Ee.buffer,0,Z/4):B=new Uint8Array(Ee.buffer,0,Z)}A.gpuBuffer.unmap(),R(B)},function(H){return b(H)})})},t.prototype.getHalfFloatAsFloatRGBAArrayBuffer=function(r,n,i){i||(i=new Float32Array(r));for(var o=new Uint16Array(n);r--;)i[r]=zU(o[r]);return i},t}(Yn),AE=function(){function e(t){this.device=t,this.gpuRenderPassEncoder=null,this.gfxColorAttachment=[],this.gfxColorAttachmentLevel=[],this.gfxColorResolveTo=[],this.gfxColorResolveToLevel=[],this.gfxDepthStencilAttachment=null,this.gfxDepthStencilResolveTo=null,this.gpuColorAttachments=[],this.gpuDepthStencilAttachment={view:null,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"},this.gpuRenderPassDescriptor={colorAttachments:this.gpuColorAttachments,depthStencilAttachment:this.gpuDepthStencilAttachment}}return e.prototype.getEncoder=function(){var t;return((t=this.renderBundle)===null||t===void 0?void 0:t.renderBundleEncoder)||this.gpuRenderPassEncoder},e.prototype.getTextureView=function(t,r){return dt(r<t.mipLevelCount),t.mipLevelCount===1?t.gpuTextureView:t.gpuTexture.createView({baseMipLevel:r,mipLevelCount:1})},e.prototype.setRenderPassDescriptor=function(t){var r,n,i,o,a,s;this.descriptor=t,this.gpuRenderPassDescriptor.colorAttachments=this.gpuColorAttachments;var u=t.colorAttachment.length;this.gfxColorAttachment.length=u,this.gfxColorResolveTo.length=u;for(var l=0;l<t.colorAttachment.length;l++){var f=t.colorAttachment[l],c=t.colorResolveTo[l];if(f===null&&c!==null&&(f=c,c=null),this.gfxColorAttachment[l]=f,this.gfxColorResolveTo[l]=c,this.gfxColorAttachmentLevel[l]=((r=t.colorAttachmentLevel)===null||r===void 0?void 0:r[l])||0,this.gfxColorResolveToLevel[l]=((n=t.colorResolveToLevel)===null||n===void 0?void 0:n[l])||0,f!==null){this.gpuColorAttachments[l]===void 0&&(this.gpuColorAttachments[l]={});var h=this.gpuColorAttachments[l];h.view=this.getTextureView(f,((i=this.gfxColorAttachmentLevel)===null||i===void 0?void 0:i[l])||0);var d=(a=(o=t.colorClearColor)===null||o===void 0?void 0:o[l])!==null&&a!==void 0?a:"load";d==="load"?h.loadOp="load":(h.loadOp="clear",h.clearValue=d),h.storeOp=!((s=t.colorStore)===null||s===void 0)&&s[l]?"store":"discard",h.resolveTarget=void 0,c!==null&&(f.sampleCount>1?h.resolveTarget=this.getTextureView(c,this.gfxColorResolveToLevel[l]):h.storeOp="store")}else{this.gpuColorAttachments.length=l,this.gfxColorAttachment.length=l,this.gfxColorResolveTo.length=l;break}}if(this.gfxDepthStencilAttachment=t.depthStencilAttachment,this.gfxDepthStencilResolveTo=t.depthStencilResolveTo,t.depthStencilAttachment){var p=t.depthStencilAttachment,h=this.gpuDepthStencilAttachment;h.view=p.gpuTextureView;var v=!!(Fa(p.format)&ze.Depth);v?(t.depthClearValue==="load"?h.depthLoadOp="load":(h.depthLoadOp="clear",h.depthClearValue=t.depthClearValue),t.depthStencilStore||this.gfxDepthStencilResolveTo!==null?h.depthStoreOp="store":h.depthStoreOp="discard"):(h.depthLoadOp=void 0,h.depthStoreOp=void 0);var m=!!(Fa(p.format)&ze.Stencil);m?(t.stencilClearValue==="load"?h.stencilLoadOp="load":(h.stencilLoadOp="clear",h.stencilClearValue=t.stencilClearValue),t.depthStencilStore||this.gfxDepthStencilResolveTo!==null?h.stencilStoreOp="store":h.stencilStoreOp="discard"):(h.stencilLoadOp=void 0,h.stencilStoreOp=void 0),this.gpuRenderPassDescriptor.depthStencilAttachment=this.gpuDepthStencilAttachment}else this.gpuRenderPassDescriptor.depthStencilAttachment=void 0;this.gpuRenderPassDescriptor.occlusionQuerySet=wn(t.occlusionQueryPool)?void 0:xU(t.occlusionQueryPool)},e.prototype.beginRenderPass=function(t,r){dt(this.gpuRenderPassEncoder===null),this.setRenderPassDescriptor(r),this.frameCommandEncoder=t,this.gpuRenderPassEncoder=this.frameCommandEncoder.beginRenderPass(this.gpuRenderPassDescriptor)},e.prototype.flipY=function(t,r){var n=this.device.swapChainHeight;return n-t-r},e.prototype.setViewport=function(t,r,n,i,o,a){o===void 0&&(o=0),a===void 0&&(a=1),this.gpuRenderPassEncoder.setViewport(t,this.flipY(r,i),n,i,o,a)},e.prototype.setScissorRect=function(t,r,n,i){this.gpuRenderPassEncoder.setScissorRect(t,this.flipY(r,i),n,i)},e.prototype.setPipeline=function(t){var r=t,n=po(r.gpuRenderPipeline);this.getEncoder().setPipeline(n)},e.prototype.setVertexInput=function(t,r,n){if(t!==null){var i=this.getEncoder(),o=t;n!==null&&i.setIndexBuffer(_a(n.buffer),po(o.indexFormat),n.offset);for(var a=0;a<r.length;a++){var s=r[a];s!==null&&i.setVertexBuffer(a,_a(s.buffer),s.offset)}}},e.prototype.setBindings=function(t){var r=t,n=this.getEncoder();r.gpuBindGroup.forEach(function(i,o){i&&n.setBindGroup(o,r.gpuBindGroup[o])})},e.prototype.setStencilReference=function(t){this.gpuRenderPassEncoder.setStencilReference(t)},e.prototype.draw=function(t,r,n,i){this.getEncoder().draw(t,r,n,i)},e.prototype.drawIndexed=function(t,r,n,i,o){this.getEncoder().drawIndexed(t,r,n,i,o)},e.prototype.drawIndirect=function(t,r){this.getEncoder().drawIndirect(_a(t),r)},e.prototype.drawIndexedIndirect=function(t,r){this.getEncoder().drawIndexedIndirect(_a(t),r)},e.prototype.beginOcclusionQuery=function(t){this.gpuRenderPassEncoder.beginOcclusionQuery(t)},e.prototype.endOcclusionQuery=function(){this.gpuRenderPassEncoder.endOcclusionQuery()},e.prototype.pushDebugGroup=function(t){this.gpuRenderPassEncoder.pushDebugGroup(t)},e.prototype.popDebugGroup=function(){this.gpuRenderPassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(t){this.gpuRenderPassEncoder.insertDebugMarker(t)},e.prototype.beginBundle=function(t){this.renderBundle=t},e.prototype.endBundle=function(){this.renderBundle.finish()},e.prototype.executeBundles=function(t){this.gpuRenderPassEncoder.executeBundles(t.map(function(r){return r.renderBundle}))},e.prototype.finish=function(){var t;(t=this.gpuRenderPassEncoder)===null||t===void 0||t.end(),this.gpuRenderPassEncoder=null;for(var r=0;r<this.gfxColorAttachment.length;r++){var n=this.gfxColorAttachment[r],i=this.gfxColorResolveTo[r];n!==null&&i!==null&&n.sampleCount===1&&this.copyAttachment(i,this.gfxColorAttachmentLevel[r],n,this.gfxColorResolveToLevel[r])}this.gfxDepthStencilAttachment&&this.gfxDepthStencilResolveTo&&(this.gfxDepthStencilAttachment.sampleCount>1||this.copyAttachment(this.gfxDepthStencilResolveTo,0,this.gfxDepthStencilAttachment,0)),this.frameCommandEncoder=null},e.prototype.copyAttachment=function(t,r,n,i){dt(n.sampleCount===1);var o={texture:n.gpuTexture,mipLevel:i},a={texture:t.gpuTexture,mipLevel:r};dt(n.width>>>i===t.width>>>r),dt(n.height>>>i===t.height>>>r),dt(!!(n.usage&br.COPY_SRC)),dt(!!(t.usage&br.COPY_DST)),this.frameCommandEncoder.copyTextureToTexture(o,a,[t.width,t.height,1])},e}(),$U=function(e){or(t,e);function t(r){var n=r.id,i=r.device,o=r.descriptor,a=e.call(this,{id:n,device:i})||this;return a.type=Dt.RenderPipeline,a.isCreatingAsync=!1,a.gpuRenderPipeline=null,a.descriptor=o,a.device.createRenderPipelineInternal(a,!1),a}return t.prototype.getBindGroupLayout=function(r){return this.gpuRenderPipeline.getBindGroupLayout(r)},t}(Yn),YU=function(e){or(t,e);function t(r){var n=r.id,i=r.device,o=r.descriptor,a,s,u=e.call(this,{id:n,device:i})||this;u.type=Dt.Sampler;var l=o.lodMinClamp,f=o.mipmapFilter===Mr.NO_MIP?o.lodMinClamp:o.lodMaxClamp,c=(a=o.maxAnisotropy)!==null&&a!==void 0?a:1;return c>1&&dt(o.minFilter===sr.BILINEAR&&o.magFilter===sr.BILINEAR&&o.mipmapFilter===Mr.LINEAR),u.gpuSampler=u.device.device.createSampler({addressModeU:Mh(o.addressModeU),addressModeV:Mh(o.addressModeV),addressModeW:Mh((s=o.addressModeW)!==null&&s!==void 0?s:o.addressModeU),lodMinClamp:l,lodMaxClamp:f,minFilter:pE(o.minFilter),magFilter:pE(o.magFilter),mipmapFilter:TU(o.mipmapFilter),compare:o.compareFunction!==void 0?Hl(o.compareFunction):void 0,maxAnisotropy:c}),u}return t}(Yn),Rl=function(e){or(t,e);function t(r){var n=r.id,i=r.device,o=r.descriptor,a=r.skipCreate,s=r.sampleCount,u=e.call(this,{id:n,device:i})||this;u.type=Dt.Texture,u.flipY=!1;var l=o.format,f=o.dimension,c=o.width,h=o.height,d=o.depthOrArrayLayers,p=o.mipLevelCount,v=o.usage,m=o.pixelStore;return u.flipY=!!(m!=null&&m.unpackFlipY),u.device.createTextureShared({format:l,dimension:f!=null?f:Ct.TEXTURE_2D,width:c,height:h,depthOrArrayLayers:d!=null?d:1,mipLevelCount:p!=null?p:1,usage:v,sampleCount:s!=null?s:1},u,a),u}return t.prototype.textureFromImageBitmapOrCanvas=function(r,n,i){for(var o=n[0].width,a=n[0].height,s={size:{width:o,height:a,depthOrArrayLayers:i},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT},u=r.createTexture(s),l=0;l<n.length;l++)r.queue.copyExternalImageToTexture({source:n[l],flipY:this.flipY},{texture:u,origin:[0,0,l]},[o,a]);return[u,o,a]},t.prototype.isImageBitmapOrCanvases=function(r){var n=r[0];return n instanceof ImageBitmap||n instanceof HTMLCanvasElement||n instanceof OffscreenCanvas},t.prototype.isVideo=function(r){var n=r[0];return n instanceof HTMLVideoElement},t.prototype.setImageData=function(r,n){var i,o=this,a=this.device.device,s,u,l;if(this.isImageBitmapOrCanvases(r))i=Xn(this.textureFromImageBitmapOrCanvas(a,r,this.depthOrArrayLayers),3),s=i[0],u=i[1],l=i[2];else if(this.isVideo(r))s=a.importExternalTexture({source:r[0]});else{var f=XA(this.gpuTextureformat),c=Math.ceil(this.width/f.width)*f.length;r.forEach(function(h){a.queue.writeTexture({texture:o.gpuTexture},h,{bytesPerRow:c},{width:o.width,height:o.height})})}this.width=u,this.height=l,s&&(this.gpuTexture=s),this.gpuTextureView=this.gpuTexture.createView({dimension:yU(this.dimension)})},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuTexture.destroy()},t}(Yn),ZU=function(e){or(t,e);function t(r){var n=r.id,i=r.device,o=e.call(this,{id:n,device:i})||this;return o.type=Dt.RenderBundle,o.renderBundleEncoder=o.device.device.createRenderBundleEncoder({colorFormats:[o.device.swapChainFormat]}),o}return t.prototype.finish=function(){this.renderBundle=this.renderBundleEncoder.finish()},t}(Yn),qU=function(){function e(t,r,n,i,o,a){this.swapChainWidth=0,this.swapChainHeight=0,this.swapChainTextureUsage=br.RENDER_ATTACHMENT|br.COPY_DST,this._resourceUniqueId=0,this.renderPassPool=[],this.computePassPool=[],this.frameCommandEncoderPool=[],this.featureTextureCompressionBC=!1,this.platformString="WebGPU",this.glslVersion="#version 440",this.explicitBindingLocations=!0,this.separateSamplerTextures=!0,this.viewportOrigin=ni.UPPER_LEFT,this.clipSpaceNearZ=Na.ZERO,this.supportsSyncPipelineCompilation=!1,this.supportMRT=!0,this.device=r,this.canvas=n,this.canvasContext=i,this.glsl_compile=o,this.WGSLComposer=a,this.fallbackTexture2D=this.createFallbackTexture(Ct.TEXTURE_2D,nr.Float),this.setResourceName(this.fallbackTexture2D,"Fallback Texture2D"),this.fallbackTexture2DDepth=this.createFallbackTexture(Ct.TEXTURE_2D,nr.Depth),this.setResourceName(this.fallbackTexture2DDepth,"Fallback Depth Texture2D"),this.fallbackTexture2DArray=this.createFallbackTexture(Ct.TEXTURE_2D_ARRAY,nr.Float),this.setResourceName(this.fallbackTexture2DArray,"Fallback Texture2DArray"),this.fallbackTexture3D=this.createFallbackTexture(Ct.TEXTURE_3D,nr.Float),this.setResourceName(this.fallbackTexture3D,"Fallback Texture3D"),this.fallbackTextureCube=this.createFallbackTexture(Ct.TEXTURE_CUBE_MAP,nr.Float),this.setResourceName(this.fallbackTextureCube,"Fallback TextureCube"),this.fallbackSamplerFiltering=this.createSampler({addressModeU:tn.REPEAT,addressModeV:tn.REPEAT,minFilter:sr.POINT,magFilter:sr.POINT,mipmapFilter:Mr.NEAREST}),this.setResourceName(this.fallbackSamplerFiltering,"Fallback Sampler Filtering"),this.fallbackSamplerComparison=this.createSampler({addressModeU:tn.REPEAT,addressModeV:tn.REPEAT,minFilter:sr.POINT,magFilter:sr.POINT,mipmapFilter:Mr.NEAREST,compareFunction:zt.ALWAYS}),this.setResourceName(this.fallbackSamplerComparison,"Fallback Sampler Comparison Filtering"),this.device.features&&(this.featureTextureCompressionBC=this.device.features.has("texture-compression-bc")),this.device.onuncapturederror=function(s){console.error(s.error)},this.swapChainFormat=navigator.gpu.getPreferredCanvasFormat(),this.canvasContext.configure({device:this.device,format:this.swapChainFormat,usage:this.swapChainTextureUsage,alphaMode:"premultiplied"})}return e.prototype.destroy=function(){},e.prototype.configureSwapChain=function(t,r){this.swapChainWidth===t&&this.swapChainHeight===r||(this.swapChainWidth=t,this.swapChainHeight=r)},e.prototype.getOnscreenTexture=function(){var t=this.canvasContext.getCurrentTexture(),r=t.createView(),n=new Rl({id:0,device:this,descriptor:{format:G.U8_RGBA_RT,width:this.swapChainWidth,height:this.swapChainHeight,depthOrArrayLayers:0,dimension:Ct.TEXTURE_2D,mipLevelCount:1,usage:this.swapChainTextureUsage},skipCreate:!0});return n.depthOrArrayLayers=1,n.sampleCount=1,n.gpuTexture=t,n.gpuTextureView=r,n.name="Onscreen",this.setResourceName(n,"Onscreen Texture"),n},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.canvas},e.prototype.beginFrame=function(){dt(this.frameCommandEncoderPool.length===0)},e.prototype.endFrame=function(){dt(this.frameCommandEncoderPool.every(function(t){return t!==null})),this.device.queue.submit(this.frameCommandEncoderPool.map(function(t){return t.finish()})),this.frameCommandEncoderPool=[]},e.prototype.getNextUniqueId=function(){return++this._resourceUniqueId},e.prototype.createBuffer=function(t){return new HU({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createTexture=function(t){return new Rl({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createSampler=function(t){return new YU({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderTarget=function(t){var r=new Rl({id:this.getNextUniqueId(),device:this,descriptor:tr(tr({},t),{dimension:Ct.TEXTURE_2D,mipLevelCount:1,depthOrArrayLayers:1,usage:qr.RENDER_TARGET}),sampleCount:t.sampleCount});return r.depthOrArrayLayers=1,r.type=Dt.RenderTarget,r},e.prototype.createRenderTargetFromTexture=function(t){var r=t,n=r.format,i=r.width,o=r.height,a=r.depthOrArrayLayers,s=r.sampleCount,u=r.mipLevelCount,l=r.gpuTexture,f=r.gpuTextureView,c=r.usage;dt(!!(c&br.RENDER_ATTACHMENT));var h=new Rl({id:this.getNextUniqueId(),device:this,descriptor:{format:n,width:i,height:o,depthOrArrayLayers:a,dimension:Ct.TEXTURE_2D,mipLevelCount:u,usage:c},skipCreate:!0});return h.depthOrArrayLayers=a,h.sampleCount=s,h.gpuTexture=l,h.gpuTextureView=f,h},e.prototype.createProgram=function(t){var r,n;return!((r=t.vertex)===null||r===void 0)&&r.glsl&&(t.vertex.glsl=wa(this.queryVendorInfo(),"vert",t.vertex.glsl)),!((n=t.fragment)===null||n===void 0)&&n.glsl&&(t.fragment.glsl=wa(this.queryVendorInfo(),"frag",t.fragment.glsl)),new yE({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createProgramSimple=function(t){return new yE({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createTextureShared=function(t,r,n){var i={width:t.width,height:t.height,depthOrArrayLayers:t.depthOrArrayLayers},o=t.mipLevelCount,a=xp(t.format),s=EU(t.dimension),u=gU(t.usage);if(r.gpuTextureformat=a,r.dimension=t.dimension,r.format=t.format,r.width=t.width,r.height=t.height,r.depthOrArrayLayers=t.depthOrArrayLayers,r.mipLevelCount=o,r.usage=u,r.sampleCount=t.sampleCount,!n){var l=this.device.createTexture({size:i,mipLevelCount:o,format:a,dimension:s,sampleCount:t.sampleCount,usage:u}),f=l.createView();r.gpuTexture=l,r.gpuTextureView=f}},e.prototype.getFallbackSampler=function(t){var r=t.formatKind;return r===nr.Depth&&t.comparison?this.fallbackSamplerComparison:this.fallbackSamplerFiltering},e.prototype.getFallbackTexture=function(t){var r=t.dimension,n=t.formatKind;if(r===Ct.TEXTURE_2D)return n===nr.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(r===Ct.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(r===Ct.TEXTURE_3D)return this.fallbackTexture3D;if(r===Ct.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.createFallbackTexture=function(t,r){var n=t===Ct.TEXTURE_CUBE_MAP?6:1,i=r===nr.Float?G.U8_RGBA_NORM:G.D24;return this.createTexture({dimension:t,format:i,usage:qr.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1})},e.prototype.createBindings=function(t){return new VU({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createInputLayout=function(t){return new WU({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createComputePipeline=function(t){return new XU({id:this.getNextUniqueId(),device:this,descriptor:t})},e.prototype.createRenderPipeline=function(t){return new $U({id:this.getNextUniqueId(),device:this,descriptor:tr({},t)})},e.prototype.createQueryPool=function(t,r){return new jU({id:this.getNextUniqueId(),device:this,descriptor:{type:t,elemCount:r}})},e.prototype.createRenderPipelineInternal=function(t,r){var n;if(t.gpuRenderPipeline===null){var i=t.descriptor,o=i.program,a=o.vertexStage,s=o.fragmentStage;if(!(a===null||s===null)){var u=i.megaStateDescriptor||{},l=u.stencilBack,f=u.stencilFront,c=i8(u,["stencilBack","stencilFront"]),h=Da(Ba);i.megaStateDescriptor=tr(tr(tr({},h),{stencilBack:tr(tr({},h.stencilBack),l),stencilFront:tr(tr({},h.stencilFront),f)}),c);var d=i.megaStateDescriptor.attachmentsState[0];i.colorAttachmentFormats.forEach(function(R,b){i.megaStateDescriptor.attachmentsState[b]||(i.megaStateDescriptor.attachmentsState[b]=BA(void 0,d))});var p=IU((n=i.topology)!==null&&n!==void 0?n:vr.TRIANGLES,i.megaStateDescriptor),v=FU(i.colorAttachmentFormats,i.megaStateDescriptor),m=DU(i.depthStencilAttachmentFormat,i.megaStateDescriptor),y=void 0;i.inputLayout!==null&&(y=i.inputLayout.buffers);var A=i.sampleCount,T={layout:"auto",vertex:tr(tr({},a),{buffers:y}),primitive:p,depthStencil:m,multisample:{count:A},fragment:tr(tr({},s),{targets:v})};t.gpuRenderPipeline=this.device.createRenderPipeline(T)}}},e.prototype.createReadback=function(){return new GU({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderBundle=function(){return new ZU({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderPass=function(t){var r=this.renderPassPool.pop();r===void 0&&(r=new AE(this));var n=this.frameCommandEncoderPool.pop();return n===void 0&&(n=this.device.createCommandEncoder()),r.beginRenderPass(n,t),r},e.prototype.createComputePass=function(){var t=this.computePassPool.pop();t===void 0&&(t=new EE);var r=this.frameCommandEncoderPool.pop();return r===void 0&&(r=this.device.createCommandEncoder()),t.beginComputePass(r),t},e.prototype.submitPass=function(t){var r=t;r instanceof AE?(this.frameCommandEncoderPool.push(r.frameCommandEncoder),r.finish(),this.renderPassPool.push(r)):r instanceof EE&&(this.frameCommandEncoderPool.push(r.frameCommandEncoder),r.finish(),this.computePassPool.push(r))},e.prototype.copySubTexture2D=function(t,r,n,i,o,a,s){var u=this.device.createCommandEncoder(),l=t,f=i,c={texture:f.gpuTexture,origin:[o,a,0],mipLevel:0,aspect:"all"},h={texture:l.gpuTexture,origin:[r,n,0],mipLevel:0,aspect:"all"};dt(!!(f.usage&br.COPY_SRC)),dt(!!(l.usage&br.COPY_DST)),u.copyTextureToTexture(c,h,[f.width,f.height,s||1]),this.device.queue.submit([u.finish()])},e.prototype.queryLimits=function(){return{uniformBufferMaxPageWordSize:this.device.limits.maxUniformBufferBindingSize>>>2,uniformBufferWordAlignment:this.device.limits.minUniformBufferOffsetAlignment>>>2,supportedSampleCounts:[1],occlusionQueriesRecommended:!0,computeShadersSupported:!0}},e.prototype.queryTextureFormatSupported=function(t,r,n){if(UU(t)){if(!this.featureTextureCompressionBC)return!1;var i=kU(t);return r%i!==0||n%i!==0?!1:this.featureTextureCompressionBC}switch(t){case G.U16_RGBA_NORM:return!1;case G.F32_RGBA:return!1}return!0},e.prototype.queryPlatformAvailable=function(){return!0},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(t){var r=t;return r.descriptor},e.prototype.queryRenderTarget=function(t){var r=t;return r},e.prototype.setResourceName=function(t,r){if(t.name=r,t.type===Dt.Buffer){var n=t;n.gpuBuffer.label=r}else if(t.type===Dt.Texture){var n=t;n.gpuTexture.label=r,n.gpuTextureView.label=r}else if(t.type===Dt.RenderTarget){var n=t;n.gpuTexture.label=r,n.gpuTextureView.label=r}else if(t.type===Dt.Sampler){var n=t;n.gpuSampler.label=r}else if(t.type===Dt.RenderPipeline){var n=t;n.gpuRenderPipeline!==null&&(n.gpuRenderPipeline.label=r)}},e.prototype.setResourceLeakCheck=function(t,r){},e.prototype.checkForLeaks=function(){},e.prototype.programPatched=function(t){},e.prototype.pipelineQueryReady=function(t){var r=t;return r.gpuRenderPipeline!==null},e.prototype.pipelineForceReady=function(t){var r=t;this.createRenderPipelineInternal(r,!1)},e}(),KU=function(){function e(t){this.pluginOptions=t}return e.prototype.createSwapChain=function(t){return Aa(this,void 0,void 0,function(){var r,n,i,o,a,s,u,l;return Ta(this,function(f){switch(f.label){case 0:if(globalThis.navigator.gpu===void 0)return[2,null];r=null,f.label=1;case 1:return f.trys.push([1,3,,4]),n=this.pluginOptions.xrCompatible,[4,globalThis.navigator.gpu.requestAdapter({xrCompatible:n})];case 2:return r=f.sent(),[3,4];case 3:return i=f.sent(),console.log(i),[3,4];case 4:return r===null?[2,null]:(o=["depth32float-stencil8","texture-compression-bc","float32-filterable"],a=o.filter(function(c){return r.features.has(c)}),[4,r.requestDevice({requiredFeatures:a})]);case 5:if(s=f.sent(),s&&(u=this.pluginOptions.onContextLost,s.lost.then(function(){u&&u()})),s===null)return[2,null];if(l=t.getContext("webgpu"),!l)return[2,null];f.label=6;case 6:return f.trys.push([6,8,,9]),[4,HA(this.pluginOptions.shaderCompilerPath)];case 7:return f.sent(),[3,9];case 8:return f.sent(),[3,9];case 9:return[2,new qU(r,s,t,l,pU,vu&&new vu)]}})})},e}(),QU=class{constructor(e,t){const{buffer:r,offset:n,stride:i,normalized:o,size:a,divisor:s,shaderLocation:u}=t;this.buffer=r,this.attribute={shaderLocation:u,buffer:r.get(),offset:n||0,stride:i||0,normalized:o||!1,divisor:s||0},a&&(this.attribute.size=a)}get(){return this.buffer}updateBuffer(e){this.buffer.subData(e)}destroy(){this.buffer.destroy()}},Tc={[g.FLOAT]:Float32Array,[g.UNSIGNED_BYTE]:Uint8Array,[g.SHORT]:Int16Array,[g.UNSIGNED_SHORT]:Uint16Array,[g.INT]:Int32Array,[g.UNSIGNED_INT]:Uint32Array},JU={[g.POINTS]:vr.POINTS,[g.LINES]:vr.LINES,[g.LINE_LOOP]:vr.LINES,[g.LINE_STRIP]:vr.LINE_STRIP,[g.TRIANGLES]:vr.TRIANGLES,[g.TRIANGLE_FAN]:vr.TRIANGLES,[g.TRIANGLE_STRIP]:vr.TRIANGLE_STRIP},ek={[1]:G.F32_R,[2]:G.F32_RG,[3]:G.F32_RGB,[4]:G.F32_RGBA},tk={[g.STATIC_DRAW]:Gn.STATIC,[g.DYNAMIC_DRAW]:Gn.DYNAMIC,[g.STREAM_DRAW]:Gn.DYNAMIC},TE={[g.REPEAT]:tn.REPEAT,[g.CLAMP_TO_EDGE]:tn.CLAMP_TO_EDGE,[g.MIRRORED_REPEAT]:tn.MIRRORED_REPEAT},rk={[g.NEVER]:zt.NEVER,[g.ALWAYS]:zt.ALWAYS,[g.LESS]:zt.LESS,[g.LEQUAL]:zt.LEQUAL,[g.GREATER]:zt.GREATER,[g.GEQUAL]:zt.GEQUAL,[g.EQUAL]:zt.EQUAL,[g.NOTEQUAL]:zt.NOTEQUAL},nk={[g.FRONT]:dn.FRONT,[g.BACK]:dn.BACK},SE={[g.FUNC_ADD]:Dr.ADD,[g.MIN_EXT]:Dr.MIN,[g.MAX_EXT]:Dr.MAX,[g.FUNC_SUBTRACT]:Dr.SUBSTRACT,[g.FUNC_REVERSE_SUBTRACT]:Dr.REVERSE_SUBSTRACT},Cl={[g.ZERO]:Rt.ZERO,[g.ONE]:Rt.ONE,[g.SRC_COLOR]:Rt.SRC,[g.ONE_MINUS_SRC_COLOR]:Rt.ONE_MINUS_SRC,[g.SRC_ALPHA]:Rt.SRC_ALPHA,[g.ONE_MINUS_SRC_ALPHA]:Rt.ONE_MINUS_SRC_ALPHA,[g.DST_COLOR]:Rt.DST,[g.ONE_MINUS_DST_COLOR]:Rt.ONE_MINUS_DST,[g.DST_ALPHA]:Rt.DST_ALPHA,[g.ONE_MINUS_DST_ALPHA]:Rt.ONE_MINUS_DST_ALPHA,[g.CONSTANT_COLOR]:Rt.CONST,[g.ONE_MINUS_CONSTANT_COLOR]:Rt.ONE_MINUS_CONSTANT,[g.CONSTANT_ALPHA]:Rt.CONST,[g.ONE_MINUS_CONSTANT_ALPHA]:Rt.ONE_MINUS_CONSTANT,[g.SRC_ALPHA_SATURATE]:Rt.SRC_ALPHA_SATURATE},ua={[g.REPLACE]:ir.REPLACE,[g.KEEP]:ir.KEEP,[g.ZERO]:ir.ZERO,[g.INVERT]:ir.INVERT,[g.INCR]:ir.INCREMENT_CLAMP,[g.DECR]:ir.DECREMENT_CLAMP,[g.INCR_WRAP]:ir.INCREMENT_WRAP,[g.DECR_WRAP]:ir.DECREMENT_WRAP},ik={[g.ALWAYS]:zt.ALWAYS,[g.EQUAL]:zt.EQUAL,[g.GEQUAL]:zt.GEQUAL,[g.GREATER]:zt.GREATER,[g.LEQUAL]:zt.LEQUAL,[g.LESS]:zt.LESS,[g.NEVER]:zt.NEVER,[g.NOTEQUAL]:zt.NOTEQUAL},ok={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function Sc(e){return Object.prototype.toString.call(e)in ok}function ak(e,t){const r=e.length,n=Math.ceil(r/3),i=r+n,o=new Float32Array(i);for(let a=0;a<i;a+=4)o[a]=e[a/4*3],o[a+1]=e[a/4*3+1],o[a+2]=e[a/4*3+2],o[a+3]=t;return o}var sk=class{constructor(e,t){this.isDestroyed=!1;const{data:r,usage:n,type:i,isUBO:o,label:a}=t;let s;Sc(r)?s=r:s=new Tc[this.type||g.FLOAT](r),this.type=i,this.size=s.byteLength,this.buffer=e.createBuffer({viewOrSize:s,usage:o?Gt.UNIFORM:Gt.VERTEX,hint:tk[n||g.STATIC_DRAW]}),a&&e.setResourceName(this.buffer,a)}get(){return this.buffer}destroy(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}subData({data:e,offset:t}){let r;Sc(e)?r=e:r=new Tc[this.type||g.FLOAT](e),this.buffer.setSubData(t,new Uint8Array(r.buffer))}};function Vt(e,t=0){return e+=t,e+=e<<10,e+=e>>>6,e>>>0}function WA(e){return e+=e<<3,e^=e>>>11,e+=e<<15,e>>>0}function xE(){return 0}var uk=class{constructor(){this.keys=[],this.values=[]}},bl=class{constructor(e,t){this.keyEqualFunc=e,this.keyHashFunc=t,this.buckets=new Map}findBucketIndex(e,t){for(let r=0;r<e.keys.length;r++)if(this.keyEqualFunc(t,e.keys[r]))return r;return-1}findBucket(e){const t=this.keyHashFunc(e);return this.buckets.get(t)}get(e){const t=this.findBucket(e);if(t===void 0)return null;const r=this.findBucketIndex(t,e);return r<0?null:t.values[r]}add(e,t){const r=this.keyHashFunc(e);this.buckets.get(r)===void 0&&this.buckets.set(r,new uk);const n=this.buckets.get(r);n.keys.push(e),n.values.push(t)}delete(e){const t=this.findBucket(e);if(t===void 0)return;const r=this.findBucketIndex(t,e);r!==-1&&(t.keys.splice(r,1),t.values.splice(r,1))}clear(){this.buckets.clear()}size(){let e=0;for(const t of this.buckets.values())e+=t.values.length;return e}*values(){for(const e of this.buckets.values())for(let t=e.values.length-1;t>=0;t--)yield e.values[t]}};function RE(e,t){return e=Vt(e,t.blendMode),e=Vt(e,t.blendSrcFactor),e=Vt(e,t.blendDstFactor),e}function lk(e,t){return e=RE(e,t.rgbBlendState),e=RE(e,t.alphaBlendState),e=Vt(e,t.channelWriteMask),e}function ck(e,t){return e=Vt(e,t.r<<24|t.g<<16|t.b<<8|t.a),e}function fk(e,t){var r,n,i,o,a,s,u,l;for(let f=0;f<t.attachmentsState.length;f++)e=lk(e,t.attachmentsState[f]);return e=ck(e,t.blendConstant||Uc),e=Vt(e,t.depthCompare),e=Vt(e,t.depthWrite?1:0),e=Vt(e,(r=t.stencilFront)==null?void 0:r.compare),e=Vt(e,(n=t.stencilFront)==null?void 0:n.passOp),e=Vt(e,(i=t.stencilFront)==null?void 0:i.failOp),e=Vt(e,(o=t.stencilFront)==null?void 0:o.depthFailOp),e=Vt(e,(a=t.stencilBack)==null?void 0:a.compare),e=Vt(e,(s=t.stencilBack)==null?void 0:s.passOp),e=Vt(e,(u=t.stencilBack)==null?void 0:u.failOp),e=Vt(e,(l=t.stencilBack)==null?void 0:l.depthFailOp),e=Vt(e,t.stencilWrite?1:0),e=Vt(e,t.cullMode),e=Vt(e,t.frontFace?1:0),e=Vt(e,t.polygonOffset?1:0),e}function hk(e){let t=0;t=Vt(t,e.program.id),e.inputLayout!==null&&(t=Vt(t,e.inputLayout.id)),t=fk(t,e.megaStateDescriptor);for(let r=0;r<e.colorAttachmentFormats.length;r++)t=Vt(t,e.colorAttachmentFormats[r]||0);return t=Vt(t,e.depthStencilAttachmentFormat||0),WA(t)}function dk(e){let t=0;if(e.samplerBindings)for(let r=0;r<e.samplerBindings.length;r++){const n=e.samplerBindings[r];n!==null&&n.texture!==null&&(t=Vt(t,n.texture.id))}if(e.uniformBufferBindings)for(let r=0;r<e.uniformBufferBindings.length;r++){const n=e.uniformBufferBindings[r];n!==null&&n.buffer!==null&&(t=Vt(t,n.buffer.id),t=Vt(t,n.binding),t=Vt(t,n.offset),t=Vt(t,n.size))}if(e.storageBufferBindings)for(let r=0;r<e.storageBufferBindings.length;r++){const n=e.storageBufferBindings[r];n!==null&&n.buffer!==null&&(t=Vt(t,n.buffer.id),t=Vt(t,n.binding),t=Vt(t,n.offset),t=Vt(t,n.size))}if(e.storageTextureBindings)for(let r=0;r<e.storageTextureBindings.length;r++){const n=e.storageTextureBindings[r];n!==null&&n.texture!==null&&(t=Vt(t,n.texture.id),t=Vt(t,n.binding))}return WA(t)}function pk(e,t){var r,n,i,o;return((r=e.vertex)==null?void 0:r.glsl)===((n=t.vertex)==null?void 0:n.glsl)&&((i=e.fragment)==null?void 0:i.glsl)===((o=t.fragment)==null?void 0:o.glsl)}function _k(e){var t,r;return{vertex:{glsl:(t=e.vertex)==null?void 0:t.glsl},fragment:{glsl:(r=e.fragment)==null?void 0:r.glsl}}}var vk=class{constructor(e){this.device=e,this.bindingsCache=new bl(_8,dk),this.renderPipelinesCache=new bl(E8,hk),this.inputLayoutsCache=new bl(T8,xE),this.programCache=new bl(pk,xE)}createBindings(e){var t;let r=this.bindingsCache.get(e);if(r===null){const n=R8(e);n.uniformBufferBindings=(t=n.uniformBufferBindings)==null?void 0:t.filter(({size:i})=>i&&i>0),r=this.device.createBindings(n),this.bindingsCache.add(n,r)}return r}createRenderPipeline(e){let t=this.renderPipelinesCache.get(e);if(t===null){const r=C8(e);r.colorAttachmentFormats=r.colorAttachmentFormats.filter(n=>n),t=this.device.createRenderPipeline(r),this.renderPipelinesCache.add(r,t)}return t}createInputLayout(e){e.vertexBufferDescriptors=e.vertexBufferDescriptors.filter(r=>!!r);let t=this.inputLayoutsCache.get(e);if(t===null){const r=I8(e);t=this.device.createInputLayout(r),this.inputLayoutsCache.add(r,t)}return t}createProgram(e){let t=this.programCache.get(e);if(t===null){const r=_k(e);t=this.device.createProgram(e),this.programCache.add(r,t)}return t}destroy(){for(const e of this.bindingsCache.values())e.destroy();for(const e of this.renderPipelinesCache.values())e.destroy();for(const e of this.inputLayoutsCache.values())e.destroy();for(const e of this.programCache.values())e.destroy();this.bindingsCache.clear(),this.renderPipelinesCache.clear(),this.inputLayoutsCache.clear(),this.programCache.clear()}},mk=class{constructor(e,t){const{data:r,type:n,count:i=0}=t;let o;Sc(r)?o=r:o=new Tc[this.type||g.UNSIGNED_INT](r),this.type=n,this.count=i,this.indexBuffer=e.createBuffer({viewOrSize:o,usage:Gt.INDEX})}get(){return this.indexBuffer}subData({data:e}){let t;Sc(e)?t=e:t=new Tc[this.type||g.UNSIGNED_INT](e),this.indexBuffer.setSubData(0,new Uint8Array(t.buffer))}destroy(){this.indexBuffer.destroy()}};function CE(e){return!!(e&&e.texture)}var jA=class{constructor(e,t){this.device=e,this.options=t,this.isDestroy=!1;const{wrapS:r=g.CLAMP_TO_EDGE,wrapT:n=g.CLAMP_TO_EDGE,aniso:i,mag:o=g.NEAREST,min:a=g.NEAREST}=t;this.createTexture(t),this.sampler=e.createSampler({addressModeU:TE[r],addressModeV:TE[n],minFilter:a===g.NEAREST?sr.POINT:sr.BILINEAR,magFilter:o===g.NEAREST?sr.POINT:sr.BILINEAR,mipmapFilter:Mr.NO_MIP,maxAnisotropy:i})}createTexture(e){const{type:t=g.UNSIGNED_BYTE,width:r,height:n,flipY:i=!1,format:o=g.RGBA,alignment:a=1,usage:s=Zh.SAMPLED,unorm:u=!1,label:l}=e;let{data:f}=e;this.width=r,this.height=n;let c=G.U8_RGBA_RT;if(t===g.UNSIGNED_BYTE&&o===g.RGBA)c=u?G.U8_RGBA_NORM:G.U8_RGBA_RT;else if(t===g.UNSIGNED_BYTE&&o===g.LUMINANCE)c=G.U8_LUMINANCE;else if(t===g.FLOAT&&o===g.RGB)this.device.queryVendorInfo().platformString==="WebGPU"?(f&&(f=ak(f,0)),c=G.F32_RGBA):c=G.F32_RGB;else if(t===g.FLOAT&&o===g.RGBA)c=G.F32_RGBA;else if(t===g.FLOAT&&o===g.RED)c=G.F32_R;else throw new Error(`create texture error, type: ${t}, format: ${o}`);this.texture=this.device.createTexture({format:c,width:r,height:n,usage:s===Zh.SAMPLED?qr.SAMPLED:qr.RENDER_TARGET,pixelStore:{unpackFlipY:i,packAlignment:a},mipLevelCount:1}),l&&this.device.setResourceName(this.texture,l),f&&this.texture.setImageData([f])}get(){return this.texture}update(e){const{data:t}=e;this.texture.setImageData([t])}bind(){}resize({width:e,height:t}){(this.width!==e||this.height!==t)&&this.destroy(),this.options.width=e,this.options.height=t,this.createTexture(this.options),this.isDestroy=!1}getSize(){return[this.width,this.height]}destroy(){var e;!this.isDestroy&&!this.texture.destroyed&&((e=this.texture)==null||e.destroy()),this.isDestroy=!0}},GA=class{constructor(e,t){this.device=e,this.options=t,this.createColorRenderTarget(),this.createDepthRenderTarget()}createColorRenderTarget(e=!1){const{width:t,height:r,color:n}=this.options;n&&(CE(n)?(e&&n.resize({width:t,height:r}),this.colorTexture=n.get(),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=n.width,this.height=n.height):t&&r&&(this.colorTexture=this.device.createTexture({format:G.U8_RGBA_RT,usage:qr.RENDER_TARGET,width:t,height:r}),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=t,this.height=r))}createDepthRenderTarget(e=!1){const{width:t,height:r,depth:n}=this.options;n&&(CE(n)?(e&&n.resize({width:t,height:r}),this.depthTexture=n.get(),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=n.width,this.height=n.height):t&&r&&(this.depthTexture=this.device.createTexture({format:G.D24_S8,usage:qr.RENDER_TARGET,width:t,height:r}),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=t,this.height=r))}get(){return this.colorRenderTarget}destroy(){var e,t;(e=this.colorRenderTarget)==null||e.destroy(),(t=this.depthRenderTarget)==null||t.destroy()}resize({width:e,height:t}){(this.width!==e||this.height!==t)&&(this.destroy(),this.colorTexture.destroyed=!0,this.depthTexture.destroyed=!0,this.options.width=e,this.options.height=t,this.createColorRenderTarget(!0),this.createDepthRenderTarget(!0))}},gk=Object.defineProperty,Ek=Object.defineProperties,yk=Object.getOwnPropertyDescriptors,bE=Object.getOwnPropertySymbols,Ak=Object.prototype.hasOwnProperty,Tk=Object.prototype.propertyIsEnumerable,ME=(e,t,r)=>t in e?gk(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,fo=(e,t)=>{for(var r in t||(t={}))Ak.call(t,r)&&ME(e,r,t[r]);if(bE)for(var r of bE(t))Tk.call(t,r)&&ME(e,r,t[r]);return e},Sk=(e,t)=>Ek(e,yk(t)),{isPlainObject:xk,isTypedArray:Rk}=Ar,Ck=class{constructor(e,t,r){this.device=e,this.options=t,this.service=r,this.destroyed=!1,this.uniforms={},this.vertexBuffers=[];const{vs:n,fs:i,attributes:o,uniforms:a,count:s,elements:u,diagnosticDerivativeUniformityEnabled:l}=t;this.options=t;const f=l?"":this.service.viewportOrigin===ni.UPPER_LEFT?"diagnostic(off,derivative_uniformity);":"";this.program=r.renderCache.createProgram({vertex:{glsl:n},fragment:{glsl:i,postprocess:p=>f+p}}),a&&(this.uniforms=this.extractUniforms(a));const c=[];let h=0;Object.keys(o).forEach(p=>{const v=o[p],m=v.get();this.vertexBuffers.push(m.get());const{offset:y=0,stride:A=0,size:T=1,divisor:R=0,shaderLocation:b=0}=v.attribute;c.push({arrayStride:A||T*4,stepMode:To.VERTEX,attributes:[{format:ek[T],shaderLocation:b,offset:y,divisor:R}]}),h=m.size/T}),s||(this.options.count=h),u&&(this.indexBuffer=u.get());const d=r.renderCache.createInputLayout({vertexBufferDescriptors:c,indexBufferFormat:u?G.U32_R:null,program:this.program});this.inputLayout=d,this.pipeline=this.createPipeline(t)}createPipeline(e,t){const{primitive:r=g.TRIANGLES,depth:n,cull:i,blend:o,stencil:a}=e,s=this.initDepthDrawParams({depth:n}),u=!!(s&&s.enable),l=this.initCullDrawParams({cull:i}),f=!!(l&&l.enable),c=this.getBlendDrawParams({blend:o}),h=!!(c&&c.enable),d=this.getStencilDrawParams({stencil:a}),p=!!(d&&d.enable);return this.device.createRenderPipeline({inputLayout:this.inputLayout,program:this.program,topology:JU[r],colorAttachmentFormats:[G.U8_RGBA_RT],depthStencilAttachmentFormat:G.D24_S8,megaStateDescriptor:{attachmentsState:[t?{channelWriteMask:Fr.ALL,rgbBlendState:{blendMode:Dr.ADD,blendSrcFactor:Rt.ONE,blendDstFactor:Rt.ZERO},alphaBlendState:{blendMode:Dr.ADD,blendSrcFactor:Rt.ONE,blendDstFactor:Rt.ZERO}}:{channelWriteMask:p&&d.opFront.zpass===ir.REPLACE?Fr.NONE:Fr.ALL,rgbBlendState:{blendMode:h&&c.equation.rgb||Dr.ADD,blendSrcFactor:h&&c.func.srcRGB||Rt.SRC_ALPHA,blendDstFactor:h&&c.func.dstRGB||Rt.ONE_MINUS_SRC_ALPHA},alphaBlendState:{blendMode:h&&c.equation.alpha||Dr.ADD,blendSrcFactor:h&&c.func.srcAlpha||Rt.ONE,blendDstFactor:h&&c.func.dstAlpha||Rt.ONE}}],blendConstant:h?Uc:void 0,depthWrite:u,depthCompare:u&&s.func||zt.LESS,cullMode:f&&l.face||dn.NONE,stencilWrite:p,stencilFront:{compare:p?d.func.cmp:zt.ALWAYS,passOp:d.opFront.zpass,failOp:d.opFront.fail,depthFailOp:d.opFront.zfail,mask:d.opFront.mask},stencilBack:{compare:p?d.func.cmp:zt.ALWAYS,passOp:d.opBack.zpass,failOp:d.opBack.fail,depthFailOp:d.opBack.zfail,mask:d.opBack.mask}}})}updateAttributesAndElements(){}updateAttributes(){}addUniforms(e){this.uniforms=fo(fo({},this.uniforms),this.extractUniforms(e))}draw(e,t){const r=fo(fo({},this.options),e),{count:n=0,instances:i,elements:o,uniforms:a={},uniformBuffers:s,textures:u}=r;this.uniforms=fo(fo({},this.uniforms),this.extractUniforms(a));const{renderPass:l,currentFramebuffer:f,width:c,height:h,renderCache:d}=this.service;this.pipeline=this.createPipeline(r,t);const p=this.service.device,v=p.swapChainHeight;if(p.swapChainHeight=(f==null?void 0:f.height)||h,l.setViewport(0,0,(f==null?void 0:f.width)||c,(f==null?void 0:f.height)||h),p.swapChainHeight=v,l.setPipeline(this.pipeline),l.setStencilReference(1),l.setVertexInput(this.inputLayout,this.vertexBuffers.map(m=>({buffer:m})),o?{buffer:this.indexBuffer,offset:0}:null),s&&(this.bindings=d.createBindings({pipeline:this.pipeline,uniformBufferBindings:s.map((m,y)=>{const A=m;return{binding:y,buffer:A.get(),size:A.size}}),samplerBindings:u==null?void 0:u.map(m=>({texture:m.texture,sampler:m.sampler}))})),this.bindings&&(l.setBindings(this.bindings),Object.keys(this.uniforms).forEach(m=>{const y=this.uniforms[m];y instanceof jA?this.uniforms[m]=y.get():y instanceof GA&&(this.uniforms[m]=y.get().texture)}),this.program.setUniformsLegacy(this.uniforms)),o){const m=o.count;m===0?l.draw(n,i):l.drawIndexed(m,i)}else l.draw(n,i)}destroy(){var e,t,r;this.program.destroy(),(e=this.vertexBuffers)==null||e.forEach(n=>n.destroy()),(t=this.indexBuffer)==null||t.destroy(),(r=this.bindings)==null||r.destroy(),this.inputLayout.destroy(),this.pipeline.destroy(),this.destroyed=!0}initDepthDrawParams({depth:e}){if(e)return{enable:e.enable===void 0?!0:!!e.enable,mask:e.mask===void 0?!0:!!e.mask,func:rk[e.func||g.LESS],range:e.range||[0,1]}}getBlendDrawParams({blend:e}){const{enable:t,func:r,equation:n,color:i=[0,0,0,0]}=e||{};return{enable:!!t,func:{srcRGB:Cl[r&&r.srcRGB||g.SRC_ALPHA],srcAlpha:Cl[r&&r.srcAlpha||g.SRC_ALPHA],dstRGB:Cl[r&&r.dstRGB||g.ONE_MINUS_SRC_ALPHA],dstAlpha:Cl[r&&r.dstAlpha||g.ONE_MINUS_SRC_ALPHA]},equation:{rgb:SE[n&&n.rgb||g.FUNC_ADD],alpha:SE[n&&n.alpha||g.FUNC_ADD]},color:i}}getStencilDrawParams({stencil:e}){const{enable:t,mask:r=4294967295,func:n={cmp:g.ALWAYS,ref:0,mask:4294967295},opFront:i={fail:g.KEEP,zfail:g.KEEP,zpass:g.KEEP},opBack:o={fail:g.KEEP,zfail:g.KEEP,zpass:g.KEEP}}=e||{};return{enable:!!t,mask:r,func:Sk(fo({},n),{cmp:ik[n.cmp]}),opFront:{fail:ua[i.fail],zfail:ua[i.zfail],zpass:ua[i.zpass],mask:n.mask},opBack:{fail:ua[o.fail],zfail:ua[o.zfail],zpass:ua[o.zpass],mask:n.mask}}}initCullDrawParams({cull:e}){if(e){const{enable:t,face:r=g.BACK}=e;return{enable:!!t,face:nk[r]}}}extractUniforms(e){const t={};return Object.keys(e).forEach(r=>{this.extractUniformsRecursively(r,e[r],t,"")}),t}extractUniformsRecursively(e,t,r,n){if(t===null||typeof t=="number"||typeof t=="boolean"||Array.isArray(t)&&typeof t[0]=="number"||Rk(t)||t===""||"resize"in t){r[`${n&&n+"."}${e}`]=t;return}xk(t)&&Object.keys(t).forEach(i=>{this.extractUniformsRecursively(i,t[i],r,`${n&&n+"."}${e}`)}),Array.isArray(t)&&t.forEach((i,o)=>{Object.keys(i).forEach(a=>{this.extractUniformsRecursively(a,i[a],r,`${n&&n+"."}${e}[${o}]`)})})}};function bk(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:Boolean(e&&e._version===2)}var Ih=(e,t,r)=>new Promise((n,i)=>{var o=u=>{try{s(r.next(u))}catch(l){i(l)}},a=u=>{try{s(r.throw(u))}catch(l){i(l)}},s=u=>u.done?n(u.value):Promise.resolve(u.value).then(o,a);s((r=r.apply(e,t)).next())}),{isUndefined:Ml}=Ar,Mk=class{constructor(){this.uniformBuffers=[],this.queryVerdorInfo=()=>this.device.queryVendorInfo().platformString,this.createModel=e=>new Ck(this.device,e,this),this.createAttribute=e=>new QU(this.device,e),this.createBuffer=e=>new sk(this.device,e),this.createElements=e=>new mk(this.device,e),this.createTexture2D=e=>new jA(this.device,e),this.createFramebuffer=e=>new GA(this.device,e),this.useFramebuffer=(e,t)=>{this.currentFramebuffer=e,this.beginFrame(),t(),this.endFrame(),this.currentFramebuffer=null},this.useFramebufferAsync=(e,t)=>Ih(this,null,function*(){this.currentFramebuffer=e,this.preRenderPass=this.renderPass,this.beginFrame(),yield t(),this.endFrame(),this.currentFramebuffer=null,this.renderPass=this.preRenderPass}),this.clear=e=>{const{color:t,depth:r,stencil:n,framebuffer:i=null}=e;if(i)i.clearOptions={color:t,depth:r,stencil:n};else{const o=this.queryVerdorInfo();if(o==="WebGL1"){const a=this.getGLContext();Ml(n)?Ml(r)||(a.clearDepth(r),a.clear(a.DEPTH_BUFFER_BIT)):(a.clearStencil(n),a.clear(a.STENCIL_BUFFER_BIT))}else if(o==="WebGL2"){const a=this.getGLContext();Ml(n)?Ml(r)||a.clearBufferfv(a.DEPTH,0,[r]):a.clearBufferiv(a.STENCIL,0,[n])}}},this.viewport=({width:e,height:t})=>{this.swapChain.configureSwapChain(e,t),this.createMainColorDepthRT(e,t),this.width=e,this.height=t},this.readPixels=e=>{const{framebuffer:t,x:r,y:n,width:i,height:o}=e,a=this.device.createReadback(),s=t.colorTexture,u=a.readTextureSync(s,r,this.viewportOrigin===ni.LOWER_LEFT?n:this.height-n,i,o,new Uint8Array(i*o*4));return a.destroy(),u},this.readPixelsAsync=e=>Ih(this,null,function*(){const{framebuffer:t,x:r,y:n,width:i,height:o}=e,a=this.device.createReadback(),s=t.colorTexture,u=yield a.readTexture(s,r,this.viewportOrigin===ni.LOWER_LEFT?n:this.height-n,i,o,new Uint8Array(i*o*4));if(this.viewportOrigin!==ni.LOWER_LEFT)for(let l=0;l<u.length;l+=4){const f=u[l];u[l]=u[l+2],u[l+2]=f}return a.destroy(),u}),this.getViewportSize=()=>({width:this.width,height:this.height}),this.getContainer=()=>{var e;return(e=this.canvas)==null?void 0:e.parentElement},this.getCanvas=()=>this.canvas,this.getGLContext=()=>this.device.gl,this.destroy=()=>{var e;this.canvas=null,(e=this.uniformBuffers)==null||e.forEach(t=>{t.destroy()}),this.device.destroy(),this.renderCache.destroy()}}init(e,t){return Ih(this,null,function*(){const{enableWebGPU:r,shaderCompilerPath:n}=t;this.canvas=e;const o=yield(r?new KU({shaderCompilerPath:n}):new lU({targets:["webgl2","webgl1"],onContextLost(s){console.warn("context lost",s)},onContextCreationError(s){console.warn("context creation error",s)},onContextRestored(s){console.warn("context restored",s)}})).createSwapChain(e);o.configureSwapChain(e.width,e.height),this.device=o.getDevice(),this.swapChain=o,this.renderCache=new vk(this.device),this.currentFramebuffer=null,this.viewportOrigin=this.device.queryVendorInfo().viewportOrigin;const a=this.device.gl;this.extensionObject={OES_texture_float:!bk(a)&&this.device.OES_texture_float},this.createMainColorDepthRT(e.width,e.height)})}createMainColorDepthRT(e,t){this.mainColorRT&&this.mainColorRT.destroy(),this.mainDepthRT&&this.mainDepthRT.destroy(),this.mainColorRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:G.U8_RGBA_RT,width:e,height:t,usage:qr.RENDER_TARGET})),this.mainDepthRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:G.D24_S8,width:e,height:t,usage:qr.RENDER_TARGET}))}beginFrame(){this.device.beginFrame();const{currentFramebuffer:e,swapChain:t,mainColorRT:r,mainDepthRT:n}=this,i=e?e.colorRenderTarget:r,o=e?null:t.getOnscreenTexture(),a=e?e.depthRenderTarget:n,{color:s=[0,0,0,0],depth:u=1,stencil:l=0}=(e==null?void 0:e.clearOptions)||{},f=i?Su(s[0]*255,s[1]*255,s[2]*255,s[3]):Uc,c=a?u:void 0,h=a?l:void 0,d=this.device.createRenderPass({colorAttachment:[i],colorResolveTo:[o],colorClearColor:[f],colorStore:[!0],depthStencilAttachment:a,depthClearValue:c,stencilClearValue:h});this.renderPass=d}endFrame(){this.device.submitPass(this.renderPass),this.device.endFrame()}getPointSizeRange(){const e=this.device.gl;return e.getParameter(e.ALIASED_POINT_SIZE_RANGE)}testExtension(e){return!!this.getGLContext().getExtension(e)}setState(){}setBaseState(){}setCustomLayerDefaults(){}setDirty(e){this.isDirty=e}getDirty(){return this.isDirty}},$A={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(Pd,function(){var r=function(_){return _ instanceof Uint8Array||_ instanceof Uint16Array||_ instanceof Uint32Array||_ instanceof Int8Array||_ instanceof Int16Array||_ instanceof Int32Array||_ instanceof Float32Array||_ instanceof Float64Array||_ instanceof Uint8ClampedArray},n=function(_,C){for(var L=Object.keys(C),te=0;te<L.length;++te)_[L[te]]=C[L[te]];return _},i=`
`;function o(_){return typeof atob<"u"?atob(_):"base64:"+_}function a(_){var C=new Error("(regl) "+_);throw console.error(C),C}function s(_,C){_||a(C)}function u(_){return _?": "+_:""}function l(_,C,L){_ in C||a("unknown parameter ("+_+")"+u(L)+". possible values: "+Object.keys(C).join())}function f(_,C){r(_)||a("invalid parameter type"+u(C)+". must be a typed array")}function c(_,C){switch(C){case"number":return typeof _=="number";case"object":return typeof _=="object";case"string":return typeof _=="string";case"boolean":return typeof _=="boolean";case"function":return typeof _=="function";case"undefined":return typeof _>"u";case"symbol":return typeof _=="symbol"}}function h(_,C,L){c(_,C)||a("invalid parameter type"+u(L)+". expected "+C+", got "+typeof _)}function d(_,C){_>=0&&(_|0)===_||a("invalid parameter type, ("+_+")"+u(C)+". must be a nonnegative integer")}function p(_,C,L){C.indexOf(_)<0&&a("invalid value"+u(L)+". must be one of: "+C)}var v=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function m(_){Object.keys(_).forEach(function(C){v.indexOf(C)<0&&a('invalid regl constructor argument "'+C+'". must be one of '+v)})}function y(_,C){for(_=_+"";_.length<C;)_=" "+_;return _}function A(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function T(_,C){this.number=_,this.line=C,this.errors=[]}function R(_,C,L){this.file=_,this.line=C,this.message=L}function b(){var _=new Error,C=(_.stack||_).toString(),L=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(C);if(L)return L[1];var te=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(C);return te?te[1]:"unknown"}function H(){var _=new Error,C=(_.stack||_).toString(),L=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(C);if(L)return L[1];var te=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(C);return te?te[1]:"unknown"}function B(_,C){var L=_.split(`
`),te=1,fe=0,re={unknown:new A,0:new A};re.unknown.name=re[0].name=C||b(),re.unknown.lines.push(new T(0,""));for(var ae=0;ae<L.length;++ae){var xe=L[ae],Ce=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(xe);if(Ce)switch(Ce[1]){case"line":var De=/(\d+)(\s+\d+)?/.exec(Ce[2]);De&&(te=De[1]|0,De[2]&&(fe=De[2]|0,fe in re||(re[fe]=new A)));break;case"define":var Ie=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Ce[2]);Ie&&(re[fe].name=Ie[1]?o(Ie[2]):Ie[2]);break}re[fe].lines.push(new T(te++,xe))}return Object.keys(re).forEach(function(Oe){var Be=re[Oe];Be.lines.forEach(function(Ae){Be.index[Ae.number]=Ae})}),re}function q(_){var C=[];return _.split(`
`).forEach(function(L){if(!(L.length<5)){var te=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(L);te?C.push(new R(te[1]|0,te[2]|0,te[3].trim())):L.length>0&&C.push(new R("unknown",0,L))}}),C}function Ee(_,C){C.forEach(function(L){var te=_[L.file];if(te){var fe=te.index[L.line];if(fe){fe.errors.push(L),te.hasErrors=!0;return}}_.unknown.hasErrors=!0,_.unknown.lines[0].errors.push(L)})}function Z(_,C,L,te,fe){if(!_.getShaderParameter(C,_.COMPILE_STATUS)){var re=_.getShaderInfoLog(C),ae=te===_.FRAGMENT_SHADER?"fragment":"vertex";Je(L,"string",ae+" shader source must be a string",fe);var xe=B(L,fe),Ce=q(re);Ee(xe,Ce),Object.keys(xe).forEach(function(De){var Ie=xe[De];if(!Ie.hasErrors)return;var Oe=[""],Be=[""];function Ae(Pe,Y){Oe.push(Pe),Be.push(Y||"")}Ae("file number "+De+": "+Ie.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Ie.lines.forEach(function(Pe){if(Pe.errors.length>0){Ae(y(Pe.number,4)+"|  ","background-color:yellow; font-weight:bold"),Ae(Pe.line+i,"color:red; background-color:yellow; font-weight:bold");var Y=0;Pe.errors.forEach(function(oe){var Re=oe.message,Le=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Re);if(Le){var me=Le[1];switch(Re=Le[2],me){case"assign":me="=";break}Y=Math.max(Pe.line.indexOf(me,Y),0)}else Y=0;Ae(y("| ",6)),Ae(y("^^^",Y+3)+i,"font-weight:bold"),Ae(y("| ",6)),Ae(Re+i,"font-weight:bold")}),Ae(y("| ",6)+i)}else Ae(y(Pe.number,4)+"|  "),Ae(Pe.line+i,"color:red")}),typeof document<"u"&&!window.chrome?(Be[0]=Oe.join("%c"),console.log.apply(console,Be)):console.log(Oe.join(""))}),s.raise("Error compiling "+ae+" shader, "+xe[0].name)}}function k(_,C,L,te,fe){if(!_.getProgramParameter(C,_.LINK_STATUS)){var re=_.getProgramInfoLog(C),ae=B(L,fe),xe=B(te,fe),Ce='Error linking program with vertex shader, "'+xe[0].name+'", and fragment shader "'+ae[0].name+'"';typeof document<"u"?console.log("%c"+Ce+i+"%c"+re,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Ce+i+re),s.raise(Ce)}}function $(_){_._commandRef=b()}function K(_,C,L,te){$(_);function fe(Ce){return Ce?te.id(Ce):0}_._fragId=fe(_.static.frag),_._vertId=fe(_.static.vert);function re(Ce,De){Object.keys(De).forEach(function(Ie){Ce[te.id(Ie)]=!0})}var ae=_._uniformSet={};re(ae,C.static),re(ae,C.dynamic);var xe=_._attributeSet={};re(xe,L.static),re(xe,L.dynamic),_._hasCount="count"in _.static||"count"in _.dynamic||"elements"in _.static||"elements"in _.dynamic}function ce(_,C){var L=H();a(_+" in command "+(C||b())+(L==="unknown"?"":" called from "+L))}function Ne(_,C,L){_||ce(C,L||b())}function je(_,C,L,te){_ in C||ce("unknown parameter ("+_+")"+u(L)+". possible values: "+Object.keys(C).join(),te||b())}function Je(_,C,L,te){c(_,C)||ce("invalid parameter type"+u(L)+". expected "+C+", got "+typeof _,te||b())}function ht(_){_()}function $e(_,C,L){_.texture?p(_.texture._texture.internalformat,C,"unsupported texture format for attachment"):p(_.renderbuffer._renderbuffer.format,L,"unsupported renderbuffer format for attachment")}var et=33071,mt=9728,gt=9984,Ot=9985,Bt=9986,Et=9987,Tr=5120,$t=5121,Gr=5122,le=5123,Ve=5124,nt=5125,Te=5126,Ut=32819,yt=32820,Ht=33635,bt=34042,lt=36193,kt={};kt[Tr]=kt[$t]=1,kt[Gr]=kt[le]=kt[lt]=kt[Ht]=kt[Ut]=kt[yt]=2,kt[Ve]=kt[nt]=kt[Te]=kt[bt]=4;function zr(_,C){return _===yt||_===Ut||_===Ht?2:_===bt?4:kt[_]*C}function fr(_){return!(_&_-1)&&!!_}function Jt(_,C,L){var te,fe=C.width,re=C.height,ae=C.channels;s(fe>0&&fe<=L.maxTextureSize&&re>0&&re<=L.maxTextureSize,"invalid texture shape"),(_.wrapS!==et||_.wrapT!==et)&&s(fr(fe)&&fr(re),"incompatible wrap mode for texture, both width and height must be power of 2"),C.mipmask===1?fe!==1&&re!==1&&s(_.minFilter!==gt&&_.minFilter!==Bt&&_.minFilter!==Ot&&_.minFilter!==Et,"min filter requires mipmap"):(s(fr(fe)&&fr(re),"texture must be a square power of 2 to support mipmapping"),s(C.mipmask===(fe<<1)-1,"missing or incomplete mipmap data")),C.type===Te&&(L.extensions.indexOf("oes_texture_float_linear")<0&&s(_.minFilter===mt&&_.magFilter===mt,"filter not supported, must enable oes_texture_float_linear"),s(!_.genMipmaps,"mipmap generation not supported with float textures"));var xe=C.images;for(te=0;te<16;++te)if(xe[te]){var Ce=fe>>te,De=re>>te;s(C.mipmask&1<<te,"missing mipmap data");var Ie=xe[te];if(s(Ie.width===Ce&&Ie.height===De,"invalid shape for mip images"),s(Ie.format===C.format&&Ie.internalformat===C.internalformat&&Ie.type===C.type,"incompatible type for mip image"),!Ie.compressed)if(Ie.data){var Oe=Math.ceil(zr(Ie.type,ae)*Ce/Ie.unpackAlignment)*Ie.unpackAlignment;s(Ie.data.byteLength===Oe*De,"invalid data for image, buffer size is inconsistent with image format")}else Ie.element||Ie.copy}else _.genMipmaps||s((C.mipmask&1<<te)===0,"extra mipmap data");C.compressed&&s(!_.genMipmaps,"mipmap generation for compressed images not supported")}function nn(_,C,L,te){var fe=_.width,re=_.height,ae=_.channels;s(fe>0&&fe<=te.maxTextureSize&&re>0&&re<=te.maxTextureSize,"invalid texture shape"),s(fe===re,"cube map must be square"),s(C.wrapS===et&&C.wrapT===et,"wrap mode not supported by cube map");for(var xe=0;xe<L.length;++xe){var Ce=L[xe];s(Ce.width===fe&&Ce.height===re,"inconsistent cube map face shape"),C.genMipmaps&&(s(!Ce.compressed,"can not generate mipmap for compressed textures"),s(Ce.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var De=Ce.images,Ie=0;Ie<16;++Ie){var Oe=De[Ie];if(Oe){var Be=fe>>Ie,Ae=re>>Ie;s(Ce.mipmask&1<<Ie,"missing mipmap data"),s(Oe.width===Be&&Oe.height===Ae,"invalid shape for mip images"),s(Oe.format===_.format&&Oe.internalformat===_.internalformat&&Oe.type===_.type,"incompatible type for mip image"),Oe.compressed||(Oe.data?s(Oe.data.byteLength===Be*Ae*Math.max(zr(Oe.type,ae),Oe.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Oe.element||Oe.copy)}}}}var P=n(s,{optional:ht,raise:a,commandRaise:ce,command:Ne,parameter:l,commandParameter:je,constructor:m,type:h,commandType:Je,isTypedArray:f,nni:d,oneOf:p,shaderError:Z,linkError:k,callSite:H,saveCommandRef:$,saveDrawInfo:K,framebufferFormat:$e,guessCommand:b,texture2D:Jt,textureCube:nn}),Ei=0,Co=0;function ai(_,C){this.id=Ei++,this.type=_,this.data=C}function yi(_){return _.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Kt(_){if(_.length===0)return[];var C=_.charAt(0),L=_.charAt(_.length-1);if(_.length>1&&C===L&&(C==='"'||C==="'"))return['"'+yi(_.substr(1,_.length-2))+'"'];var te=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(_);if(te)return Kt(_.substr(0,te.index)).concat(Kt(te[1])).concat(Kt(_.substr(te.index+te[0].length)));var fe=_.split(".");if(fe.length===1)return['"'+yi(_)+'"'];for(var re=[],ae=0;ae<fe.length;++ae)re=re.concat(Kt(fe[ae]));return re}function Kr(_){return"["+Kt(_).join("][")+"]"}function Un(_,C){return new ai(_,Kr(C+""))}function on(_){return typeof _=="function"&&!_._reglType||_ instanceof ai}function Gi(_,C){return typeof _=="function"?new ai(Co,_):_}var wr={DynamicVariable:ai,define:Un,isDynamic:on,unbox:Gi,accessor:Kr},$i={next:typeof requestAnimationFrame=="function"?function(_){return requestAnimationFrame(_)}:function(_){return setTimeout(_,16)},cancel:typeof cancelAnimationFrame=="function"?function(_){return cancelAnimationFrame(_)}:clearTimeout},Ai=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function Va(){var _={"":0},C=[""];return{id:function(L){var te=_[L];return te||(te=_[L]=C.length,C.push(L),te)},str:function(L){return C[L]}}}function kc(_,C,L){var te=document.createElement("canvas");n(te.style,{border:0,margin:0,padding:0,top:0,left:0}),_.appendChild(te),_===document.body&&(te.style.position="absolute",n(_.style,{margin:0,padding:0}));function fe(){var xe=window.innerWidth,Ce=window.innerHeight;if(_!==document.body){var De=_.getBoundingClientRect();xe=De.right-De.left,Ce=De.bottom-De.top}te.width=L*xe,te.height=L*Ce,n(te.style,{width:xe+"px",height:Ce+"px"})}var re;_!==document.body&&typeof ResizeObserver=="function"?(re=new ResizeObserver(function(){setTimeout(fe)}),re.observe(_)):window.addEventListener("resize",fe,!1);function ae(){re?re.disconnect():window.removeEventListener("resize",fe),_.removeChild(te)}return fe(),{canvas:te,onDestroy:ae}}function bo(_,C){function L(te){try{return _.getContext(te,C)}catch(fe){return null}}return L("webgl")||L("experimental-webgl")||L("webgl-experimental")}function zc(_){return typeof _.nodeName=="string"&&typeof _.appendChild=="function"&&typeof _.getBoundingClientRect=="function"}function Vc(_){return typeof _.drawArrays=="function"||typeof _.drawElements=="function"}function Ha(_){return typeof _=="string"?_.split():(P(Array.isArray(_),"invalid extension array"),_)}function Xa(_){return typeof _=="string"?(P(typeof document<"u","not supported outside of DOM"),document.querySelector(_)):_}function Wa(_){var C=_||{},L,te,fe,re,ae={},xe=[],Ce=[],De=typeof window>"u"?1:window.devicePixelRatio,Ie=!1,Oe=function(Pe){Pe&&P.raise(Pe)},Be=function(){};if(typeof C=="string"?(P(typeof document<"u","selector queries only supported in DOM enviroments"),L=document.querySelector(C),P(L,"invalid query string for element")):typeof C=="object"?zc(C)?L=C:Vc(C)?(re=C,fe=re.canvas):(P.constructor(C),"gl"in C?re=C.gl:"canvas"in C?fe=Xa(C.canvas):"container"in C&&(te=Xa(C.container)),"attributes"in C&&(ae=C.attributes,P.type(ae,"object","invalid context attributes")),"extensions"in C&&(xe=Ha(C.extensions)),"optionalExtensions"in C&&(Ce=Ha(C.optionalExtensions)),"onDone"in C&&(P.type(C.onDone,"function","invalid or missing onDone callback"),Oe=C.onDone),"profile"in C&&(Ie=!!C.profile),"pixelRatio"in C&&(De=+C.pixelRatio,P(De>0,"invalid pixel ratio"))):P.raise("invalid arguments to regl"),L&&(L.nodeName.toLowerCase()==="canvas"?fe=L:te=L),!re){if(!fe){P(typeof document<"u","must manually specify webgl context outside of DOM environments");var Ae=kc(te||document.body,Oe,De);if(!Ae)return null;fe=Ae.canvas,Be=Ae.onDestroy}ae.premultipliedAlpha===void 0&&(ae.premultipliedAlpha=!0),re=bo(fe,ae)}return re?{gl:re,canvas:fe,container:te,extensions:xe,optionalExtensions:Ce,pixelRatio:De,profile:Ie,onDone:Oe,onDestroy:Be}:(Be(),Oe("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Hc(_,C){var L={};function te(ae){P.type(ae,"string","extension name must be string");var xe=ae.toLowerCase(),Ce;try{Ce=L[xe]=_.getExtension(xe)}catch(De){}return!!Ce}for(var fe=0;fe<C.extensions.length;++fe){var re=C.extensions[fe];if(!te(re))return C.onDestroy(),C.onDone('"'+re+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return C.optionalExtensions.forEach(te),{extensions:L,restore:function(){Object.keys(L).forEach(function(ae){if(L[ae]&&!te(ae))throw new Error("(regl): error restoring extension "+ae)})}}}function Qr(_,C){for(var L=Array(_),te=0;te<_;++te)L[te]=C(te);return L}var Xc=5120,xu=5121,Wc=5122,jc=5123,Gc=5124,Mo=5125,$c=5126;function Yc(_){for(var C=16;C<=1<<28;C*=16)if(_<=C)return C;return 0}function ja(_){var C,L;return C=(_>65535)<<4,_>>>=C,L=(_>255)<<3,_>>>=L,C|=L,L=(_>15)<<2,_>>>=L,C|=L,L=(_>3)<<1,_>>>=L,C|=L,C|_>>1}function Io(){var _=Qr(8,function(){return[]});function C(re){var ae=Yc(re),xe=_[ja(ae)>>2];return xe.length>0?xe.pop():new ArrayBuffer(ae)}function L(re){_[ja(re.byteLength)>>2].push(re)}function te(re,ae){var xe=null;switch(re){case Xc:xe=new Int8Array(C(ae),0,ae);break;case xu:xe=new Uint8Array(C(ae),0,ae);break;case Wc:xe=new Int16Array(C(2*ae),0,ae);break;case jc:xe=new Uint16Array(C(2*ae),0,ae);break;case Gc:xe=new Int32Array(C(4*ae),0,ae);break;case Mo:xe=new Uint32Array(C(4*ae),0,ae);break;case $c:xe=new Float32Array(C(4*ae),0,ae);break;default:return null}return xe.length!==ae?xe.subarray(0,ae):xe}function fe(re){L(re.buffer)}return{alloc:C,free:L,allocType:te,freeType:fe}}var ar=Io();ar.zero=Io();var Ru=3408,Zc=3410,Cu=3411,bu=3412,Mu=3413,Iu=3414,Ga=3415,si=33901,Yi=33902,Zi=3379,Oo=3386,$a=34921,qc=36347,Kc=36348,Po=35661,an=35660,Ti=34930,Zn=36349,kn=34076,qi=34024,Rn=7936,zn=7937,Ou=7938,Pu=35724,No=34047,mn=36063,Fo=34852,Si=3553,Do=34067,Ya=34069,Za=33984,qn=6408,gn=5126,Nu=5121,Bo=36160,qa=36053,Fu=36064,Qc=16384,Jc=function(_,C){var L=1;C.ext_texture_filter_anisotropic&&(L=_.getParameter(No));var te=1,fe=1;C.webgl_draw_buffers&&(te=_.getParameter(Fo),fe=_.getParameter(mn));var re=!!C.oes_texture_float;if(re){var ae=_.createTexture();_.bindTexture(Si,ae),_.texImage2D(Si,0,qn,1,1,0,qn,gn,null);var xe=_.createFramebuffer();if(_.bindFramebuffer(Bo,xe),_.framebufferTexture2D(Bo,Fu,Si,ae,0),_.bindTexture(Si,null),_.checkFramebufferStatus(Bo)!==qa)re=!1;else{_.viewport(0,0,1,1),_.clearColor(1,0,0,1),_.clear(Qc);var Ce=ar.allocType(gn,4);_.readPixels(0,0,1,1,qn,gn,Ce),_.getError()?re=!1:(_.deleteFramebuffer(xe),_.deleteTexture(ae),re=Ce[0]===1),ar.freeType(Ce)}}var De=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Ie=!0;if(!De){var Oe=_.createTexture(),Be=ar.allocType(Nu,36);_.activeTexture(Za),_.bindTexture(Do,Oe),_.texImage2D(Ya,0,qn,3,3,0,qn,Nu,Be),ar.freeType(Be),_.bindTexture(Do,null),_.deleteTexture(Oe),Ie=!_.getError()}return{colorBits:[_.getParameter(Zc),_.getParameter(Cu),_.getParameter(bu),_.getParameter(Mu)],depthBits:_.getParameter(Iu),stencilBits:_.getParameter(Ga),subpixelBits:_.getParameter(Ru),extensions:Object.keys(C).filter(function(Ae){return!!C[Ae]}),maxAnisotropic:L,maxDrawbuffers:te,maxColorAttachments:fe,pointSizeDims:_.getParameter(si),lineWidthDims:_.getParameter(Yi),maxViewportDims:_.getParameter(Oo),maxCombinedTextureUnits:_.getParameter(Po),maxCubeMapSize:_.getParameter(kn),maxRenderbufferSize:_.getParameter(qi),maxTextureUnits:_.getParameter(Ti),maxTextureSize:_.getParameter(Zi),maxAttributes:_.getParameter($a),maxVertexUniforms:_.getParameter(qc),maxVertexTextureUnits:_.getParameter(an),maxVaryingVectors:_.getParameter(Kc),maxFragmentUniforms:_.getParameter(Zn),glsl:_.getParameter(Pu),renderer:_.getParameter(zn),vendor:_.getParameter(Rn),version:_.getParameter(Ou),readFloat:re,npotTextureCube:Ie}};function x(_){return!!_&&typeof _=="object"&&Array.isArray(_.shape)&&Array.isArray(_.stride)&&typeof _.offset=="number"&&_.shape.length===_.stride.length&&(Array.isArray(_.data)||r(_.data))}var I=function(_){return Object.keys(_).map(function(C){return _[C]})},X={shape:Ir,flatten:Sr};function se(_,C,L){for(var te=0;te<C;++te)L[te]=_[te]}function Fe(_,C,L,te){for(var fe=0,re=0;re<C;++re)for(var ae=_[re],xe=0;xe<L;++xe)te[fe++]=ae[xe]}function qe(_,C,L,te,fe,re){for(var ae=re,xe=0;xe<C;++xe)for(var Ce=_[xe],De=0;De<L;++De)for(var Ie=Ce[De],Oe=0;Oe<te;++Oe)fe[ae++]=Ie[Oe]}function Pt(_,C,L,te,fe){for(var re=1,ae=L+1;ae<C.length;++ae)re*=C[ae];var xe=C[L];if(C.length-L===4){var Ce=C[L+1],De=C[L+2],Ie=C[L+3];for(ae=0;ae<xe;++ae)qe(_[ae],Ce,De,Ie,te,fe),fe+=re}else for(ae=0;ae<xe;++ae)Pt(_[ae],C,L+1,te,fe),fe+=re}function Sr(_,C,L,te){var fe=1;if(C.length)for(var re=0;re<C.length;++re)fe*=C[re];else fe=0;var ae=te||ar.allocType(L,fe);switch(C.length){case 0:break;case 1:se(_,C[0],ae);break;case 2:Fe(_,C[0],C[1],ae);break;case 3:qe(_,C[0],C[1],C[2],ae,0);break;default:Pt(_,C,0,ae,0)}return ae}function Ir(_){for(var C=[],L=_;L.length;L=L[0])C.push(L.length);return C}var Or={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Cn=5120,ZA=5122,qA=5124,KA=5121,QA=5123,JA=5125,eT=5126,tT=5126,Ki={int8:Cn,int16:ZA,int32:qA,uint8:KA,uint16:QA,uint32:JA,float:eT,float32:tT},rT=35048,nT=35040,Du={dynamic:rT,stream:nT,static:35044},ef=X.flatten,Cp=X.shape,bp=35044,iT=35040,tf=5121,rf=5126,xi=[];xi[5120]=1,xi[5122]=2,xi[5124]=4,xi[5121]=1,xi[5123]=2,xi[5125]=4,xi[5126]=4;function Bu(_){return Or[Object.prototype.toString.call(_)]|0}function Mp(_,C){for(var L=0;L<C.length;++L)_[L]=C[L]}function Ip(_,C,L,te,fe,re,ae){for(var xe=0,Ce=0;Ce<L;++Ce)for(var De=0;De<te;++De)_[xe++]=C[fe*Ce+re*De+ae]}function oT(_,C,L,te){var fe=0,re={};function ae(Y){this.id=fe++,this.buffer=_.createBuffer(),this.type=Y,this.usage=bp,this.byteLength=0,this.dimension=1,this.dtype=tf,this.persistentData=null,L.profile&&(this.stats={size:0})}ae.prototype.bind=function(){_.bindBuffer(this.type,this.buffer)},ae.prototype.destroy=function(){Be(this)};var xe=[];function Ce(Y,oe){var Re=xe.pop();return Re||(Re=new ae(Y)),Re.bind(),Oe(Re,oe,iT,0,1,!1),Re}function De(Y){xe.push(Y)}function Ie(Y,oe,Re){Y.byteLength=oe.byteLength,_.bufferData(Y.type,oe,Re)}function Oe(Y,oe,Re,Le,me,He){var be;if(Y.usage=Re,Array.isArray(oe)){if(Y.dtype=Le||rf,oe.length>0){var ke;if(Array.isArray(oe[0])){be=Cp(oe);for(var ge=1,we=1;we<be.length;++we)ge*=be[we];Y.dimension=ge,ke=ef(oe,be,Y.dtype),Ie(Y,ke,Re),He?Y.persistentData=ke:ar.freeType(ke)}else if(typeof oe[0]=="number"){Y.dimension=me;var tt=ar.allocType(Y.dtype,oe.length);Mp(tt,oe),Ie(Y,tt,Re),He?Y.persistentData=tt:ar.freeType(tt)}else r(oe[0])?(Y.dimension=oe[0].length,Y.dtype=Le||Bu(oe[0])||rf,ke=ef(oe,[oe.length,oe[0].length],Y.dtype),Ie(Y,ke,Re),He?Y.persistentData=ke:ar.freeType(ke)):P.raise("invalid buffer data")}}else if(r(oe))Y.dtype=Le||Bu(oe),Y.dimension=me,Ie(Y,oe,Re),He&&(Y.persistentData=new Uint8Array(new Uint8Array(oe.buffer)));else if(x(oe)){be=oe.shape;var st=oe.stride,Ue=oe.offset,Me=0,_e=0,ut=0,Mt=0;be.length===1?(Me=be[0],_e=1,ut=st[0],Mt=0):be.length===2?(Me=be[0],_e=be[1],ut=st[0],Mt=st[1]):P.raise("invalid shape"),Y.dtype=Le||Bu(oe.data)||rf,Y.dimension=_e;var Ze=ar.allocType(Y.dtype,Me*_e);Ip(Ze,oe.data,Me,_e,ut,Mt,Ue),Ie(Y,Ze,Re),He?Y.persistentData=Ze:ar.freeType(Ze)}else oe instanceof ArrayBuffer?(Y.dtype=tf,Y.dimension=me,Ie(Y,oe,Re),He&&(Y.persistentData=new Uint8Array(new Uint8Array(oe)))):P.raise("invalid buffer data")}function Be(Y){C.bufferCount--,te(Y);var oe=Y.buffer;P(oe,"buffer must not be deleted already"),_.deleteBuffer(oe),Y.buffer=null,delete re[Y.id]}function Ae(Y,oe,Re,Le){C.bufferCount++;var me=new ae(oe);re[me.id]=me;function He(ge){var we=bp,tt=null,st=0,Ue=0,Me=1;return Array.isArray(ge)||r(ge)||x(ge)||ge instanceof ArrayBuffer?tt=ge:typeof ge=="number"?st=ge|0:ge&&(P.type(ge,"object","buffer arguments must be an object, a number or an array"),"data"in ge&&(P(tt===null||Array.isArray(tt)||r(tt)||x(tt),"invalid data for buffer"),tt=ge.data),"usage"in ge&&(P.parameter(ge.usage,Du,"invalid buffer usage"),we=Du[ge.usage]),"type"in ge&&(P.parameter(ge.type,Ki,"invalid buffer type"),Ue=Ki[ge.type]),"dimension"in ge&&(P.type(ge.dimension,"number","invalid dimension"),Me=ge.dimension|0),"length"in ge&&(P.nni(st,"buffer length must be a nonnegative integer"),st=ge.length|0)),me.bind(),tt?Oe(me,tt,we,Ue,Me,Le):(st&&_.bufferData(me.type,st,we),me.dtype=Ue||tf,me.usage=we,me.dimension=Me,me.byteLength=st),L.profile&&(me.stats.size=me.byteLength*xi[me.dtype]),He}function be(ge,we){P(we+ge.byteLength<=me.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+ge.byteLength+" starting from offset "+we+" to a buffer of size "+me.byteLength),_.bufferSubData(me.type,we,ge)}function ke(ge,we){var tt=(we||0)|0,st;if(me.bind(),r(ge)||ge instanceof ArrayBuffer)be(ge,tt);else if(Array.isArray(ge)){if(ge.length>0)if(typeof ge[0]=="number"){var Ue=ar.allocType(me.dtype,ge.length);Mp(Ue,ge),be(Ue,tt),ar.freeType(Ue)}else if(Array.isArray(ge[0])||r(ge[0])){st=Cp(ge);var Me=ef(ge,st,me.dtype);be(Me,tt),ar.freeType(Me)}else P.raise("invalid buffer data")}else if(x(ge)){st=ge.shape;var _e=ge.stride,ut=0,Mt=0,Ze=0,At=0;st.length===1?(ut=st[0],Mt=1,Ze=_e[0],At=0):st.length===2?(ut=st[0],Mt=st[1],Ze=_e[0],At=_e[1]):P.raise("invalid shape");var ct=Array.isArray(ge.data)?me.dtype:Bu(ge.data),vt=ar.allocType(ct,ut*Mt);Ip(vt,ge.data,ut,Mt,Ze,At,ge.offset),be(vt,tt),ar.freeType(vt)}else P.raise("invalid data for buffer subdata");return He}return Re||He(Y),He._reglType="buffer",He._buffer=me,He.subdata=ke,L.profile&&(He.stats=me.stats),He.destroy=function(){Be(me)},He}function Pe(){I(re).forEach(function(Y){Y.buffer=_.createBuffer(),_.bindBuffer(Y.type,Y.buffer),_.bufferData(Y.type,Y.persistentData||Y.byteLength,Y.usage)})}return L.profile&&(C.getTotalBufferSize=function(){var Y=0;return Object.keys(re).forEach(function(oe){Y+=re[oe].stats.size}),Y}),{create:Ae,createStream:Ce,destroyStream:De,clear:function(){I(re).forEach(Be),xe.forEach(Be)},getBuffer:function(Y){return Y&&Y._buffer instanceof ae?Y._buffer:null},restore:Pe,_initBuffer:Oe}}var aT=0,sT=0,uT=1,lT=1,cT=4,fT=4,wo={points:aT,point:sT,lines:uT,line:lT,triangles:cT,triangle:fT,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},hT=0,dT=1,Ka=4,pT=5120,Lo=5121,Op=5122,Uo=5123,Pp=5124,Qi=5125,nf=34963,_T=35040,vT=35044;function mT(_,C,L,te){var fe={},re=0,ae={uint8:Lo,uint16:Uo};C.oes_element_index_uint&&(ae.uint32=Qi);function xe(Pe){this.id=re++,fe[this.id]=this,this.buffer=Pe,this.primType=Ka,this.vertCount=0,this.type=0}xe.prototype.bind=function(){this.buffer.bind()};var Ce=[];function De(Pe){var Y=Ce.pop();return Y||(Y=new xe(L.create(null,nf,!0,!1)._buffer)),Oe(Y,Pe,_T,-1,-1,0,0),Y}function Ie(Pe){Ce.push(Pe)}function Oe(Pe,Y,oe,Re,Le,me,He){Pe.buffer.bind();var be;if(Y){var ke=He;!He&&(!r(Y)||x(Y)&&!r(Y.data))&&(ke=C.oes_element_index_uint?Qi:Uo),L._initBuffer(Pe.buffer,Y,oe,ke,3)}else _.bufferData(nf,me,oe),Pe.buffer.dtype=be||Lo,Pe.buffer.usage=oe,Pe.buffer.dimension=3,Pe.buffer.byteLength=me;if(be=He,!He){switch(Pe.buffer.dtype){case Lo:case pT:be=Lo;break;case Uo:case Op:be=Uo;break;case Qi:case Pp:be=Qi;break;default:P.raise("unsupported type for element array")}Pe.buffer.dtype=be}Pe.type=be,P(be!==Qi||!!C.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var ge=Le;ge<0&&(ge=Pe.buffer.byteLength,be===Uo?ge>>=1:be===Qi&&(ge>>=2)),Pe.vertCount=ge;var we=Re;if(Re<0){we=Ka;var tt=Pe.buffer.dimension;tt===1&&(we=hT),tt===2&&(we=dT),tt===3&&(we=Ka)}Pe.primType=we}function Be(Pe){te.elementsCount--,P(Pe.buffer!==null,"must not double destroy elements"),delete fe[Pe.id],Pe.buffer.destroy(),Pe.buffer=null}function Ae(Pe,Y){var oe=L.create(null,nf,!0),Re=new xe(oe._buffer);te.elementsCount++;function Le(me){if(!me)oe(),Re.primType=Ka,Re.vertCount=0,Re.type=Lo;else if(typeof me=="number")oe(me),Re.primType=Ka,Re.vertCount=me|0,Re.type=Lo;else{var He=null,be=vT,ke=-1,ge=-1,we=0,tt=0;Array.isArray(me)||r(me)||x(me)?He=me:(P.type(me,"object","invalid arguments for elements"),"data"in me&&(He=me.data,P(Array.isArray(He)||r(He)||x(He),"invalid data for element buffer")),"usage"in me&&(P.parameter(me.usage,Du,"invalid element buffer usage"),be=Du[me.usage]),"primitive"in me&&(P.parameter(me.primitive,wo,"invalid element buffer primitive"),ke=wo[me.primitive]),"count"in me&&(P(typeof me.count=="number"&&me.count>=0,"invalid vertex count for elements"),ge=me.count|0),"type"in me&&(P.parameter(me.type,ae,"invalid buffer type"),tt=ae[me.type]),"length"in me?we=me.length|0:(we=ge,tt===Uo||tt===Op?we*=2:(tt===Qi||tt===Pp)&&(we*=4))),Oe(Re,He,be,ke,ge,we,tt)}return Le}return Le(Pe),Le._reglType="elements",Le._elements=Re,Le.subdata=function(me,He){return oe.subdata(me,He),Le},Le.destroy=function(){Be(Re)},Le}return{create:Ae,createStream:De,destroyStream:Ie,getElements:function(Pe){return typeof Pe=="function"&&Pe._elements instanceof xe?Pe._elements:null},clear:function(){I(fe).forEach(Be)}}}var Np=new Float32Array(1),gT=new Uint32Array(Np.buffer),ET=5123;function Fp(_){for(var C=ar.allocType(ET,_.length),L=0;L<_.length;++L)if(isNaN(_[L]))C[L]=65535;else if(_[L]===1/0)C[L]=31744;else if(_[L]===-1/0)C[L]=64512;else{Np[0]=_[L];var te=gT[0],fe=te>>>31<<15,re=(te<<1>>>24)-127,ae=te>>13&(1<<10)-1;if(re<-24)C[L]=fe;else if(re<-14){var xe=-14-re;C[L]=fe+(ae+(1<<10)>>xe)}else re>15?C[L]=fe+31744:C[L]=fe+(re+15<<10)+ae}return C}function ur(_){return Array.isArray(_)||r(_)}var Dp=function(_){return!(_&_-1)&&!!_},yT=34467,ui=3553,Bp=34067,wu=34069,Ji=6408,of=6406,Lu=6407,Qa=6409,Uu=6410,wp=32854,af=32855,Lp=36194,AT=32819,TT=32820,ST=33635,xT=34042,sf=6402,ku=34041,uf=35904,lf=35906,ko=36193,cf=33776,ff=33777,hf=33778,df=33779,Up=35986,kp=35987,zp=34798,Vp=35840,Hp=35841,Xp=35842,Wp=35843,jp=36196,zo=5121,pf=5123,_f=5125,Ja=5126,RT=10242,CT=10243,bT=10497,vf=33071,MT=33648,IT=10240,OT=10241,mf=9728,PT=9729,gf=9984,Gp=9985,$p=9986,Ef=9987,NT=33170,zu=4352,FT=4353,DT=4354,BT=34046,wT=3317,LT=37440,UT=37441,kT=37443,Yp=37444,Vu=33984,zT=[gf,$p,Gp,Ef],Hu=[0,Qa,Uu,Lu,Ji],bn={};bn[Qa]=bn[of]=bn[sf]=1,bn[ku]=bn[Uu]=2,bn[Lu]=bn[uf]=3,bn[Ji]=bn[lf]=4;function Vo(_){return"[object "+_+"]"}var Zp=Vo("HTMLCanvasElement"),qp=Vo("OffscreenCanvas"),Kp=Vo("CanvasRenderingContext2D"),Qp=Vo("ImageBitmap"),Jp=Vo("HTMLImageElement"),e_=Vo("HTMLVideoElement"),VT=Object.keys(Or).concat([Zp,qp,Kp,Qp,Jp,e_]),Ho=[];Ho[zo]=1,Ho[Ja]=4,Ho[ko]=2,Ho[pf]=2,Ho[_f]=4;var Lr=[];Lr[wp]=2,Lr[af]=2,Lr[Lp]=2,Lr[ku]=4,Lr[cf]=.5,Lr[ff]=.5,Lr[hf]=1,Lr[df]=1,Lr[Up]=.5,Lr[kp]=1,Lr[zp]=1,Lr[Vp]=.5,Lr[Hp]=.25,Lr[Xp]=.5,Lr[Wp]=.25,Lr[jp]=.5;function t_(_){return Array.isArray(_)&&(_.length===0||typeof _[0]=="number")}function r_(_){if(!Array.isArray(_))return!1;var C=_.length;return!(C===0||!ur(_[0]))}function eo(_){return Object.prototype.toString.call(_)}function n_(_){return eo(_)===Zp}function i_(_){return eo(_)===qp}function HT(_){return eo(_)===Kp}function XT(_){return eo(_)===Qp}function WT(_){return eo(_)===Jp}function jT(_){return eo(_)===e_}function yf(_){if(!_)return!1;var C=eo(_);return VT.indexOf(C)>=0?!0:t_(_)||r_(_)||x(_)}function o_(_){return Or[Object.prototype.toString.call(_)]|0}function GT(_,C){var L=C.length;switch(_.type){case zo:case pf:case _f:case Ja:var te=ar.allocType(_.type,L);te.set(C),_.data=te;break;case ko:_.data=Fp(C);break;default:P.raise("unsupported texture type, must specify a typed array")}}function a_(_,C){return ar.allocType(_.type===ko?Ja:_.type,C)}function s_(_,C){_.type===ko?(_.data=Fp(C),ar.freeType(C)):_.data=C}function $T(_,C,L,te,fe,re){for(var ae=_.width,xe=_.height,Ce=_.channels,De=ae*xe*Ce,Ie=a_(_,De),Oe=0,Be=0;Be<xe;++Be)for(var Ae=0;Ae<ae;++Ae)for(var Pe=0;Pe<Ce;++Pe)Ie[Oe++]=C[L*Ae+te*Be+fe*Pe+re];s_(_,Ie)}function Xu(_,C,L,te,fe,re){var ae;if(typeof Lr[_]<"u"?ae=Lr[_]:ae=bn[_]*Ho[C],re&&(ae*=6),fe){for(var xe=0,Ce=L;Ce>=1;)xe+=ae*Ce*Ce,Ce/=2;return xe}else return ae*L*te}function YT(_,C,L,te,fe,re,ae){var xe={"don't care":zu,"dont care":zu,nice:DT,fast:FT},Ce={repeat:bT,clamp:vf,mirror:MT},De={nearest:mf,linear:PT},Ie=n({mipmap:Ef,"nearest mipmap nearest":gf,"linear mipmap nearest":Gp,"nearest mipmap linear":$p,"linear mipmap linear":Ef},De),Oe={none:0,browser:Yp},Be={uint8:zo,rgba4:AT,rgb565:ST,"rgb5 a1":TT},Ae={alpha:of,luminance:Qa,"luminance alpha":Uu,rgb:Lu,rgba:Ji,rgba4:wp,"rgb5 a1":af,rgb565:Lp},Pe={};C.ext_srgb&&(Ae.srgb=uf,Ae.srgba=lf),C.oes_texture_float&&(Be.float32=Be.float=Ja),C.oes_texture_half_float&&(Be.float16=Be["half float"]=ko),C.webgl_depth_texture&&(n(Ae,{depth:sf,"depth stencil":ku}),n(Be,{uint16:pf,uint32:_f,"depth stencil":xT})),C.webgl_compressed_texture_s3tc&&n(Pe,{"rgb s3tc dxt1":cf,"rgba s3tc dxt1":ff,"rgba s3tc dxt3":hf,"rgba s3tc dxt5":df}),C.webgl_compressed_texture_atc&&n(Pe,{"rgb atc":Up,"rgba atc explicit alpha":kp,"rgba atc interpolated alpha":zp}),C.webgl_compressed_texture_pvrtc&&n(Pe,{"rgb pvrtc 4bppv1":Vp,"rgb pvrtc 2bppv1":Hp,"rgba pvrtc 4bppv1":Xp,"rgba pvrtc 2bppv1":Wp}),C.webgl_compressed_texture_etc1&&(Pe["rgb etc1"]=jp);var Y=Array.prototype.slice.call(_.getParameter(yT));Object.keys(Pe).forEach(function(N){var ie=Pe[N];Y.indexOf(ie)>=0&&(Ae[N]=ie)});var oe=Object.keys(Ae);L.textureFormats=oe;var Re=[];Object.keys(Ae).forEach(function(N){var ie=Ae[N];Re[ie]=N});var Le=[];Object.keys(Be).forEach(function(N){var ie=Be[N];Le[ie]=N});var me=[];Object.keys(De).forEach(function(N){var ie=De[N];me[ie]=N});var He=[];Object.keys(Ie).forEach(function(N){var ie=Ie[N];He[ie]=N});var be=[];Object.keys(Ce).forEach(function(N){var ie=Ce[N];be[ie]=N});var ke=oe.reduce(function(N,ie){var Q=Ae[ie];return Q===Qa||Q===of||Q===Qa||Q===Uu||Q===sf||Q===ku||C.ext_srgb&&(Q===uf||Q===lf)?N[Q]=Q:Q===af||ie.indexOf("rgba")>=0?N[Q]=Ji:N[Q]=Lu,N},{});function ge(){this.internalformat=Ji,this.format=Ji,this.type=zo,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Yp,this.width=0,this.height=0,this.channels=0}function we(N,ie){N.internalformat=ie.internalformat,N.format=ie.format,N.type=ie.type,N.compressed=ie.compressed,N.premultiplyAlpha=ie.premultiplyAlpha,N.flipY=ie.flipY,N.unpackAlignment=ie.unpackAlignment,N.colorSpace=ie.colorSpace,N.width=ie.width,N.height=ie.height,N.channels=ie.channels}function tt(N,ie){if(!(typeof ie!="object"||!ie)){if("premultiplyAlpha"in ie&&(P.type(ie.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),N.premultiplyAlpha=ie.premultiplyAlpha),"flipY"in ie&&(P.type(ie.flipY,"boolean","invalid texture flip"),N.flipY=ie.flipY),"alignment"in ie&&(P.oneOf(ie.alignment,[1,2,4,8],"invalid texture unpack alignment"),N.unpackAlignment=ie.alignment),"colorSpace"in ie&&(P.parameter(ie.colorSpace,Oe,"invalid colorSpace"),N.colorSpace=Oe[ie.colorSpace]),"type"in ie){var Q=ie.type;P(C.oes_texture_float||!(Q==="float"||Q==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),P(C.oes_texture_half_float||!(Q==="half float"||Q==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),P(C.webgl_depth_texture||!(Q==="uint16"||Q==="uint32"||Q==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),P.parameter(Q,Be,"invalid texture type"),N.type=Be[Q]}var Xe=N.width,Tt=N.height,Yt=N.channels,S=!1;"shape"in ie?(P(Array.isArray(ie.shape)&&ie.shape.length>=2,"shape must be an array"),Xe=ie.shape[0],Tt=ie.shape[1],ie.shape.length===3&&(Yt=ie.shape[2],P(Yt>0&&Yt<=4,"invalid number of channels"),S=!0),P(Xe>=0&&Xe<=L.maxTextureSize,"invalid width"),P(Tt>=0&&Tt<=L.maxTextureSize,"invalid height")):("radius"in ie&&(Xe=Tt=ie.radius,P(Xe>=0&&Xe<=L.maxTextureSize,"invalid radius")),"width"in ie&&(Xe=ie.width,P(Xe>=0&&Xe<=L.maxTextureSize,"invalid width")),"height"in ie&&(Tt=ie.height,P(Tt>=0&&Tt<=L.maxTextureSize,"invalid height")),"channels"in ie&&(Yt=ie.channels,P(Yt>0&&Yt<=4,"invalid number of channels"),S=!0)),N.width=Xe|0,N.height=Tt|0,N.channels=Yt|0;var O=!1;if("format"in ie){var w=ie.format;P(C.webgl_depth_texture||!(w==="depth"||w==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),P.parameter(w,Ae,"invalid texture format");var J=N.internalformat=Ae[w];N.format=ke[J],w in Be&&("type"in ie||(N.type=Be[w])),w in Pe&&(N.compressed=!0),O=!0}!S&&O?N.channels=bn[N.format]:S&&!O?N.channels!==Hu[N.format]&&(N.format=N.internalformat=Hu[N.channels]):O&&S&&P(N.channels===bn[N.format],"number of channels inconsistent with specified format")}}function st(N){_.pixelStorei(LT,N.flipY),_.pixelStorei(UT,N.premultiplyAlpha),_.pixelStorei(kT,N.colorSpace),_.pixelStorei(wT,N.unpackAlignment)}function Ue(){ge.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Me(N,ie){var Q=null;if(yf(ie)?Q=ie:ie&&(P.type(ie,"object","invalid pixel data type"),tt(N,ie),"x"in ie&&(N.xOffset=ie.x|0),"y"in ie&&(N.yOffset=ie.y|0),yf(ie.data)&&(Q=ie.data)),P(!N.compressed||Q instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),ie.copy){P(!Q,"can not specify copy and data field for the same texture");var Xe=fe.viewportWidth,Tt=fe.viewportHeight;N.width=N.width||Xe-N.xOffset,N.height=N.height||Tt-N.yOffset,N.needsCopy=!0,P(N.xOffset>=0&&N.xOffset<Xe&&N.yOffset>=0&&N.yOffset<Tt&&N.width>0&&N.width<=Xe&&N.height>0&&N.height<=Tt,"copy texture read out of bounds")}else if(!Q)N.width=N.width||1,N.height=N.height||1,N.channels=N.channels||4;else if(r(Q))N.channels=N.channels||4,N.data=Q,!("type"in ie)&&N.type===zo&&(N.type=o_(Q));else if(t_(Q))N.channels=N.channels||4,GT(N,Q),N.alignment=1,N.needsFree=!0;else if(x(Q)){var Yt=Q.data;!Array.isArray(Yt)&&N.type===zo&&(N.type=o_(Yt));var S=Q.shape,O=Q.stride,w,J,ee,U,W,j;S.length===3?(ee=S[2],j=O[2]):(P(S.length===2,"invalid ndarray pixel data, must be 2 or 3D"),ee=1,j=1),w=S[0],J=S[1],U=O[0],W=O[1],N.alignment=1,N.width=w,N.height=J,N.channels=ee,N.format=N.internalformat=Hu[ee],N.needsFree=!0,$T(N,Yt,U,W,j,Q.offset)}else if(n_(Q)||i_(Q)||HT(Q))n_(Q)||i_(Q)?N.element=Q:N.element=Q.canvas,N.width=N.element.width,N.height=N.element.height,N.channels=4;else if(XT(Q))N.element=Q,N.width=Q.width,N.height=Q.height,N.channels=4;else if(WT(Q))N.element=Q,N.width=Q.naturalWidth,N.height=Q.naturalHeight,N.channels=4;else if(jT(Q))N.element=Q,N.width=Q.videoWidth,N.height=Q.videoHeight,N.channels=4;else if(r_(Q)){var F=N.width||Q[0].length,z=N.height||Q.length,M=N.channels;ur(Q[0][0])?M=M||Q[0][0].length:M=M||1;for(var V=X.shape(Q),ne=1,ue=0;ue<V.length;++ue)ne*=V[ue];var ye=a_(N,ne);X.flatten(Q,V,"",ye),s_(N,ye),N.alignment=1,N.width=F,N.height=z,N.channels=M,N.format=N.internalformat=Hu[M],N.needsFree=!0}N.type===Ja?P(L.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):N.type===ko&&P(L.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function _e(N,ie,Q){var Xe=N.element,Tt=N.data,Yt=N.internalformat,S=N.format,O=N.type,w=N.width,J=N.height;st(N),Xe?_.texImage2D(ie,Q,S,S,O,Xe):N.compressed?_.compressedTexImage2D(ie,Q,Yt,w,J,0,Tt):N.needsCopy?(te(),_.copyTexImage2D(ie,Q,S,N.xOffset,N.yOffset,w,J,0)):_.texImage2D(ie,Q,S,w,J,0,S,O,Tt||null)}function ut(N,ie,Q,Xe,Tt){var Yt=N.element,S=N.data,O=N.internalformat,w=N.format,J=N.type,ee=N.width,U=N.height;st(N),Yt?_.texSubImage2D(ie,Tt,Q,Xe,w,J,Yt):N.compressed?_.compressedTexSubImage2D(ie,Tt,Q,Xe,O,ee,U,S):N.needsCopy?(te(),_.copyTexSubImage2D(ie,Tt,Q,Xe,N.xOffset,N.yOffset,ee,U)):_.texSubImage2D(ie,Tt,Q,Xe,ee,U,w,J,S)}var Mt=[];function Ze(){return Mt.pop()||new Ue}function At(N){N.needsFree&&ar.freeType(N.data),Ue.call(N),Mt.push(N)}function ct(){ge.call(this),this.genMipmaps=!1,this.mipmapHint=zu,this.mipmask=0,this.images=Array(16)}function vt(N,ie,Q){var Xe=N.images[0]=Ze();N.mipmask=1,Xe.width=N.width=ie,Xe.height=N.height=Q,Xe.channels=N.channels=4}function Ft(N,ie){var Q=null;if(yf(ie))Q=N.images[0]=Ze(),we(Q,N),Me(Q,ie),N.mipmask=1;else if(tt(N,ie),Array.isArray(ie.mipmap))for(var Xe=ie.mipmap,Tt=0;Tt<Xe.length;++Tt)Q=N.images[Tt]=Ze(),we(Q,N),Q.width>>=Tt,Q.height>>=Tt,Me(Q,Xe[Tt]),N.mipmask|=1<<Tt;else Q=N.images[0]=Ze(),we(Q,N),Me(Q,ie),N.mipmask=1;we(N,N.images[0]),N.compressed&&(N.internalformat===cf||N.internalformat===ff||N.internalformat===hf||N.internalformat===df)&&P(N.width%4===0&&N.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function dr(N,ie){for(var Q=N.images,Xe=0;Xe<Q.length;++Xe){if(!Q[Xe])return;_e(Q[Xe],ie,Xe)}}var xr=[];function xt(){var N=xr.pop()||new ct;ge.call(N),N.mipmask=0;for(var ie=0;ie<16;++ie)N.images[ie]=null;return N}function mr(N){for(var ie=N.images,Q=0;Q<ie.length;++Q)ie[Q]&&At(ie[Q]),ie[Q]=null;xr.push(N)}function qt(){this.minFilter=mf,this.magFilter=mf,this.wrapS=vf,this.wrapT=vf,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=zu}function pr(N,ie){if("min"in ie){var Q=ie.min;P.parameter(Q,Ie),N.minFilter=Ie[Q],zT.indexOf(N.minFilter)>=0&&!("faces"in ie)&&(N.genMipmaps=!0)}if("mag"in ie){var Xe=ie.mag;P.parameter(Xe,De),N.magFilter=De[Xe]}var Tt=N.wrapS,Yt=N.wrapT;if("wrap"in ie){var S=ie.wrap;typeof S=="string"?(P.parameter(S,Ce),Tt=Yt=Ce[S]):Array.isArray(S)&&(P.parameter(S[0],Ce),P.parameter(S[1],Ce),Tt=Ce[S[0]],Yt=Ce[S[1]])}else{if("wrapS"in ie){var O=ie.wrapS;P.parameter(O,Ce),Tt=Ce[O]}if("wrapT"in ie){var w=ie.wrapT;P.parameter(w,Ce),Yt=Ce[w]}}if(N.wrapS=Tt,N.wrapT=Yt,"anisotropic"in ie){var J=ie.anisotropic;P(typeof J=="number"&&J>=1&&J<=L.maxAnisotropic,"aniso samples must be between 1 and "),N.anisotropic=ie.anisotropic}if("mipmap"in ie){var ee=!1;switch(typeof ie.mipmap){case"string":P.parameter(ie.mipmap,xe,"invalid mipmap hint"),N.mipmapHint=xe[ie.mipmap],N.genMipmaps=!0,ee=!0;break;case"boolean":ee=N.genMipmaps=ie.mipmap;break;case"object":P(Array.isArray(ie.mipmap),"invalid mipmap type"),N.genMipmaps=!1,ee=!0;break;default:P.raise("invalid mipmap type")}ee&&!("min"in ie)&&(N.minFilter=gf)}}function gr(N,ie){_.texParameteri(ie,OT,N.minFilter),_.texParameteri(ie,IT,N.magFilter),_.texParameteri(ie,RT,N.wrapS),_.texParameteri(ie,CT,N.wrapT),C.ext_texture_filter_anisotropic&&_.texParameteri(ie,BT,N.anisotropic),N.genMipmaps&&(_.hint(NT,N.mipmapHint),_.generateMipmap(ie))}var Er=0,Pr={},Vr=L.maxTextureUnits,yr=Array(Vr).map(function(){return null});function pt(N){ge.call(this),this.mipmask=0,this.internalformat=Ji,this.id=Er++,this.refCount=1,this.target=N,this.texture=_.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new qt,ae.profile&&(this.stats={size:0})}function Ur(N){_.activeTexture(Vu),_.bindTexture(N.target,N.texture)}function Lt(){var N=yr[0];N?_.bindTexture(N.target,N.texture):_.bindTexture(ui,null)}function it(N){var ie=N.texture;P(ie,"must not double destroy texture");var Q=N.unit,Xe=N.target;Q>=0&&(_.activeTexture(Vu+Q),_.bindTexture(Xe,null),yr[Q]=null),_.deleteTexture(ie),N.texture=null,N.params=null,N.pixels=null,N.refCount=0,delete Pr[N.id],re.textureCount--}n(pt.prototype,{bind:function(){var N=this;N.bindCount+=1;var ie=N.unit;if(ie<0){for(var Q=0;Q<Vr;++Q){var Xe=yr[Q];if(Xe){if(Xe.bindCount>0)continue;Xe.unit=-1}yr[Q]=N,ie=Q;break}ie>=Vr&&P.raise("insufficient number of texture units"),ae.profile&&re.maxTextureUnits<ie+1&&(re.maxTextureUnits=ie+1),N.unit=ie,_.activeTexture(Vu+ie),_.bindTexture(N.target,N.texture)}return ie},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&it(this)}});function St(N,ie){var Q=new pt(ui);Pr[Q.id]=Q,re.textureCount++;function Xe(S,O){var w=Q.texInfo;qt.call(w);var J=xt();return typeof S=="number"?typeof O=="number"?vt(J,S|0,O|0):vt(J,S|0,S|0):S?(P.type(S,"object","invalid arguments to regl.texture"),pr(w,S),Ft(J,S)):vt(J,1,1),w.genMipmaps&&(J.mipmask=(J.width<<1)-1),Q.mipmask=J.mipmask,we(Q,J),P.texture2D(w,J,L),Q.internalformat=J.internalformat,Xe.width=J.width,Xe.height=J.height,Ur(Q),dr(J,ui),gr(w,ui),Lt(),mr(J),ae.profile&&(Q.stats.size=Xu(Q.internalformat,Q.type,J.width,J.height,w.genMipmaps,!1)),Xe.format=Re[Q.internalformat],Xe.type=Le[Q.type],Xe.mag=me[w.magFilter],Xe.min=He[w.minFilter],Xe.wrapS=be[w.wrapS],Xe.wrapT=be[w.wrapT],Xe}function Tt(S,O,w,J){P(!!S,"must specify image data");var ee=O|0,U=w|0,W=J|0,j=Ze();return we(j,Q),j.width=0,j.height=0,Me(j,S),j.width=j.width||(Q.width>>W)-ee,j.height=j.height||(Q.height>>W)-U,P(Q.type===j.type&&Q.format===j.format&&Q.internalformat===j.internalformat,"incompatible format for texture.subimage"),P(ee>=0&&U>=0&&ee+j.width<=Q.width&&U+j.height<=Q.height,"texture.subimage write out of bounds"),P(Q.mipmask&1<<W,"missing mipmap data"),P(j.data||j.element||j.needsCopy,"missing image data"),Ur(Q),ut(j,ui,ee,U,W),Lt(),At(j),Xe}function Yt(S,O){var w=S|0,J=O|0||w;if(w===Q.width&&J===Q.height)return Xe;Xe.width=Q.width=w,Xe.height=Q.height=J,Ur(Q);for(var ee=0;Q.mipmask>>ee;++ee){var U=w>>ee,W=J>>ee;if(!U||!W)break;_.texImage2D(ui,ee,Q.format,U,W,0,Q.format,Q.type,null)}return Lt(),ae.profile&&(Q.stats.size=Xu(Q.internalformat,Q.type,w,J,!1,!1)),Xe}return Xe(N,ie),Xe.subimage=Tt,Xe.resize=Yt,Xe._reglType="texture2d",Xe._texture=Q,ae.profile&&(Xe.stats=Q.stats),Xe.destroy=function(){Q.decRef()},Xe}function Nt(N,ie,Q,Xe,Tt,Yt){var S=new pt(Bp);Pr[S.id]=S,re.cubeCount++;var O=new Array(6);function w(U,W,j,F,z,M){var V,ne=S.texInfo;for(qt.call(ne),V=0;V<6;++V)O[V]=xt();if(typeof U=="number"||!U){var ue=U|0||1;for(V=0;V<6;++V)vt(O[V],ue,ue)}else if(typeof U=="object")if(W)Ft(O[0],U),Ft(O[1],W),Ft(O[2],j),Ft(O[3],F),Ft(O[4],z),Ft(O[5],M);else if(pr(ne,U),tt(S,U),"faces"in U){var ye=U.faces;for(P(Array.isArray(ye)&&ye.length===6,"cube faces must be a length 6 array"),V=0;V<6;++V)P(typeof ye[V]=="object"&&!!ye[V],"invalid input for cube map face"),we(O[V],S),Ft(O[V],ye[V])}else for(V=0;V<6;++V)Ft(O[V],U);else P.raise("invalid arguments to cube map");for(we(S,O[0]),L.npotTextureCube||P(Dp(S.width)&&Dp(S.height),"your browser does not support non power or two texture dimensions"),ne.genMipmaps?S.mipmask=(O[0].width<<1)-1:S.mipmask=O[0].mipmask,P.textureCube(S,ne,O,L),S.internalformat=O[0].internalformat,w.width=O[0].width,w.height=O[0].height,Ur(S),V=0;V<6;++V)dr(O[V],wu+V);for(gr(ne,Bp),Lt(),ae.profile&&(S.stats.size=Xu(S.internalformat,S.type,w.width,w.height,ne.genMipmaps,!0)),w.format=Re[S.internalformat],w.type=Le[S.type],w.mag=me[ne.magFilter],w.min=He[ne.minFilter],w.wrapS=be[ne.wrapS],w.wrapT=be[ne.wrapT],V=0;V<6;++V)mr(O[V]);return w}function J(U,W,j,F,z){P(!!W,"must specify image data"),P(typeof U=="number"&&U===(U|0)&&U>=0&&U<6,"invalid face");var M=j|0,V=F|0,ne=z|0,ue=Ze();return we(ue,S),ue.width=0,ue.height=0,Me(ue,W),ue.width=ue.width||(S.width>>ne)-M,ue.height=ue.height||(S.height>>ne)-V,P(S.type===ue.type&&S.format===ue.format&&S.internalformat===ue.internalformat,"incompatible format for texture.subimage"),P(M>=0&&V>=0&&M+ue.width<=S.width&&V+ue.height<=S.height,"texture.subimage write out of bounds"),P(S.mipmask&1<<ne,"missing mipmap data"),P(ue.data||ue.element||ue.needsCopy,"missing image data"),Ur(S),ut(ue,wu+U,M,V,ne),Lt(),At(ue),w}function ee(U){var W=U|0;if(W!==S.width){w.width=S.width=W,w.height=S.height=W,Ur(S);for(var j=0;j<6;++j)for(var F=0;S.mipmask>>F;++F)_.texImage2D(wu+j,F,S.format,W>>F,W>>F,0,S.format,S.type,null);return Lt(),ae.profile&&(S.stats.size=Xu(S.internalformat,S.type,w.width,w.height,!1,!0)),w}}return w(N,ie,Q,Xe,Tt,Yt),w.subimage=J,w.resize=ee,w._reglType="textureCube",w._texture=S,ae.profile&&(w.stats=S.stats),w.destroy=function(){S.decRef()},w}function lr(){for(var N=0;N<Vr;++N)_.activeTexture(Vu+N),_.bindTexture(ui,null),yr[N]=null;I(Pr).forEach(it),re.cubeCount=0,re.textureCount=0}ae.profile&&(re.getTotalTextureSize=function(){var N=0;return Object.keys(Pr).forEach(function(ie){N+=Pr[ie].stats.size}),N});function Qn(){for(var N=0;N<Vr;++N){var ie=yr[N];ie&&(ie.bindCount=0,ie.unit=-1,yr[N]=null)}I(Pr).forEach(function(Q){Q.texture=_.createTexture(),_.bindTexture(Q.target,Q.texture);for(var Xe=0;Xe<32;++Xe)if((Q.mipmask&1<<Xe)!==0)if(Q.target===ui)_.texImage2D(ui,Xe,Q.internalformat,Q.width>>Xe,Q.height>>Xe,0,Q.internalformat,Q.type,null);else for(var Tt=0;Tt<6;++Tt)_.texImage2D(wu+Tt,Xe,Q.internalformat,Q.width>>Xe,Q.height>>Xe,0,Q.internalformat,Q.type,null);gr(Q.texInfo,Q.target)})}return{create2D:St,createCube:Nt,clear:lr,getTexture:function(N){return null},restore:Qn}}var Ri=36161,Wu=32854,u_=32855,l_=36194,c_=33189,f_=36168,h_=34041,d_=35907,p_=34836,__=34842,v_=34843,Vn=[];Vn[Wu]=2,Vn[u_]=2,Vn[l_]=2,Vn[c_]=2,Vn[f_]=1,Vn[h_]=4,Vn[d_]=4,Vn[p_]=16,Vn[__]=8,Vn[v_]=6;function m_(_,C,L){return Vn[_]*C*L}var ZT=function(_,C,L,te,fe){var re={rgba4:Wu,rgb565:l_,"rgb5 a1":u_,depth:c_,stencil:f_,"depth stencil":h_};C.ext_srgb&&(re.srgba=d_),C.ext_color_buffer_half_float&&(re.rgba16f=__,re.rgb16f=v_),C.webgl_color_buffer_float&&(re.rgba32f=p_);var ae=[];Object.keys(re).forEach(function(Ae){var Pe=re[Ae];ae[Pe]=Ae});var xe=0,Ce={};function De(Ae){this.id=xe++,this.refCount=1,this.renderbuffer=Ae,this.format=Wu,this.width=0,this.height=0,fe.profile&&(this.stats={size:0})}De.prototype.decRef=function(){--this.refCount<=0&&Ie(this)};function Ie(Ae){var Pe=Ae.renderbuffer;P(Pe,"must not double destroy renderbuffer"),_.bindRenderbuffer(Ri,null),_.deleteRenderbuffer(Pe),Ae.renderbuffer=null,Ae.refCount=0,delete Ce[Ae.id],te.renderbufferCount--}function Oe(Ae,Pe){var Y=new De(_.createRenderbuffer());Ce[Y.id]=Y,te.renderbufferCount++;function oe(Le,me){var He=0,be=0,ke=Wu;if(typeof Le=="object"&&Le){var ge=Le;if("shape"in ge){var we=ge.shape;P(Array.isArray(we)&&we.length>=2,"invalid renderbuffer shape"),He=we[0]|0,be=we[1]|0}else"radius"in ge&&(He=be=ge.radius|0),"width"in ge&&(He=ge.width|0),"height"in ge&&(be=ge.height|0);"format"in ge&&(P.parameter(ge.format,re,"invalid renderbuffer format"),ke=re[ge.format])}else typeof Le=="number"?(He=Le|0,typeof me=="number"?be=me|0:be=He):Le?P.raise("invalid arguments to renderbuffer constructor"):He=be=1;if(P(He>0&&be>0&&He<=L.maxRenderbufferSize&&be<=L.maxRenderbufferSize,"invalid renderbuffer size"),!(He===Y.width&&be===Y.height&&ke===Y.format))return oe.width=Y.width=He,oe.height=Y.height=be,Y.format=ke,_.bindRenderbuffer(Ri,Y.renderbuffer),_.renderbufferStorage(Ri,ke,He,be),P(_.getError()===0,"invalid render buffer format"),fe.profile&&(Y.stats.size=m_(Y.format,Y.width,Y.height)),oe.format=ae[Y.format],oe}function Re(Le,me){var He=Le|0,be=me|0||He;return He===Y.width&&be===Y.height||(P(He>0&&be>0&&He<=L.maxRenderbufferSize&&be<=L.maxRenderbufferSize,"invalid renderbuffer size"),oe.width=Y.width=He,oe.height=Y.height=be,_.bindRenderbuffer(Ri,Y.renderbuffer),_.renderbufferStorage(Ri,Y.format,He,be),P(_.getError()===0,"invalid render buffer format"),fe.profile&&(Y.stats.size=m_(Y.format,Y.width,Y.height))),oe}return oe(Ae,Pe),oe.resize=Re,oe._reglType="renderbuffer",oe._renderbuffer=Y,fe.profile&&(oe.stats=Y.stats),oe.destroy=function(){Y.decRef()},oe}fe.profile&&(te.getTotalRenderbufferSize=function(){var Ae=0;return Object.keys(Ce).forEach(function(Pe){Ae+=Ce[Pe].stats.size}),Ae});function Be(){I(Ce).forEach(function(Ae){Ae.renderbuffer=_.createRenderbuffer(),_.bindRenderbuffer(Ri,Ae.renderbuffer),_.renderbufferStorage(Ri,Ae.format,Ae.width,Ae.height)}),_.bindRenderbuffer(Ri,null)}return{create:Oe,clear:function(){I(Ce).forEach(Ie)},restore:Be}},li=36160,Af=36161,to=3553,ju=34069,g_=36064,E_=36096,y_=36128,A_=33306,T_=36053,qT=36054,KT=36055,QT=36057,JT=36061,eS=36193,tS=5121,rS=5126,S_=6407,x_=6408,nS=6402,iS=[S_,x_],Tf=[];Tf[x_]=4,Tf[S_]=3;var Gu=[];Gu[tS]=1,Gu[rS]=4,Gu[eS]=2;var oS=32854,aS=32855,sS=36194,uS=33189,lS=36168,R_=34041,cS=35907,fS=34836,hS=34842,dS=34843,pS=[oS,aS,sS,cS,hS,dS,fS],Xo={};Xo[T_]="complete",Xo[qT]="incomplete attachment",Xo[QT]="incomplete dimensions",Xo[KT]="incomplete, missing attachment",Xo[JT]="unsupported";function _S(_,C,L,te,fe,re){var ae={cur:null,next:null,dirty:!1,setFBO:null},xe=["rgba"],Ce=["rgba4","rgb565","rgb5 a1"];C.ext_srgb&&Ce.push("srgba"),C.ext_color_buffer_half_float&&Ce.push("rgba16f","rgb16f"),C.webgl_color_buffer_float&&Ce.push("rgba32f");var De=["uint8"];C.oes_texture_half_float&&De.push("half float","float16"),C.oes_texture_float&&De.push("float","float32");function Ie(Ue,Me,_e){this.target=Ue,this.texture=Me,this.renderbuffer=_e;var ut=0,Mt=0;Me?(ut=Me.width,Mt=Me.height):_e&&(ut=_e.width,Mt=_e.height),this.width=ut,this.height=Mt}function Oe(Ue){Ue&&(Ue.texture&&Ue.texture._texture.decRef(),Ue.renderbuffer&&Ue.renderbuffer._renderbuffer.decRef())}function Be(Ue,Me,_e){if(!!Ue)if(Ue.texture){var ut=Ue.texture._texture,Mt=Math.max(1,ut.width),Ze=Math.max(1,ut.height);P(Mt===Me&&Ze===_e,"inconsistent width/height for supplied texture"),ut.refCount+=1}else{var At=Ue.renderbuffer._renderbuffer;P(At.width===Me&&At.height===_e,"inconsistent width/height for renderbuffer"),At.refCount+=1}}function Ae(Ue,Me){Me&&(Me.texture?_.framebufferTexture2D(li,Ue,Me.target,Me.texture._texture.texture,0):_.framebufferRenderbuffer(li,Ue,Af,Me.renderbuffer._renderbuffer.renderbuffer))}function Pe(Ue){var Me=to,_e=null,ut=null,Mt=Ue;typeof Ue=="object"&&(Mt=Ue.data,"target"in Ue&&(Me=Ue.target|0)),P.type(Mt,"function","invalid attachment data");var Ze=Mt._reglType;return Ze==="texture2d"?(_e=Mt,P(Me===to)):Ze==="textureCube"?(_e=Mt,P(Me>=ju&&Me<ju+6,"invalid cube map target")):Ze==="renderbuffer"?(ut=Mt,Me=Af):P.raise("invalid regl object for attachment"),new Ie(Me,_e,ut)}function Y(Ue,Me,_e,ut,Mt){if(_e){var Ze=te.create2D({width:Ue,height:Me,format:ut,type:Mt});return Ze._texture.refCount=0,new Ie(to,Ze,null)}else{var At=fe.create({width:Ue,height:Me,format:ut});return At._renderbuffer.refCount=0,new Ie(Af,null,At)}}function oe(Ue){return Ue&&(Ue.texture||Ue.renderbuffer)}function Re(Ue,Me,_e){Ue&&(Ue.texture?Ue.texture.resize(Me,_e):Ue.renderbuffer&&Ue.renderbuffer.resize(Me,_e),Ue.width=Me,Ue.height=_e)}var Le=0,me={};function He(){this.id=Le++,me[this.id]=this,this.framebuffer=_.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function be(Ue){Ue.colorAttachments.forEach(Oe),Oe(Ue.depthAttachment),Oe(Ue.stencilAttachment),Oe(Ue.depthStencilAttachment)}function ke(Ue){var Me=Ue.framebuffer;P(Me,"must not double destroy framebuffer"),_.deleteFramebuffer(Me),Ue.framebuffer=null,re.framebufferCount--,delete me[Ue.id]}function ge(Ue){var Me;_.bindFramebuffer(li,Ue.framebuffer);var _e=Ue.colorAttachments;for(Me=0;Me<_e.length;++Me)Ae(g_+Me,_e[Me]);for(Me=_e.length;Me<L.maxColorAttachments;++Me)_.framebufferTexture2D(li,g_+Me,to,null,0);_.framebufferTexture2D(li,A_,to,null,0),_.framebufferTexture2D(li,E_,to,null,0),_.framebufferTexture2D(li,y_,to,null,0),Ae(E_,Ue.depthAttachment),Ae(y_,Ue.stencilAttachment),Ae(A_,Ue.depthStencilAttachment);var ut=_.checkFramebufferStatus(li);!_.isContextLost()&&ut!==T_&&P.raise("framebuffer configuration not supported, status = "+Xo[ut]),_.bindFramebuffer(li,ae.next?ae.next.framebuffer:null),ae.cur=ae.next,_.getError()}function we(Ue,Me){var _e=new He;re.framebufferCount++;function ut(Ze,At){var ct;P(ae.next!==_e,"can not update framebuffer which is currently in use");var vt=0,Ft=0,dr=!0,xr=!0,xt=null,mr=!0,qt="rgba",pr="uint8",gr=1,Er=null,Pr=null,Vr=null,yr=!1;if(typeof Ze=="number")vt=Ze|0,Ft=At|0||vt;else if(!Ze)vt=Ft=1;else{P.type(Ze,"object","invalid arguments for framebuffer");var pt=Ze;if("shape"in pt){var Ur=pt.shape;P(Array.isArray(Ur)&&Ur.length>=2,"invalid shape for framebuffer"),vt=Ur[0],Ft=Ur[1]}else"radius"in pt&&(vt=Ft=pt.radius),"width"in pt&&(vt=pt.width),"height"in pt&&(Ft=pt.height);("color"in pt||"colors"in pt)&&(xt=pt.color||pt.colors,Array.isArray(xt)&&P(xt.length===1||C.webgl_draw_buffers,"multiple render targets not supported")),xt||("colorCount"in pt&&(gr=pt.colorCount|0,P(gr>0,"invalid color buffer count")),"colorTexture"in pt&&(mr=!!pt.colorTexture,qt="rgba4"),"colorType"in pt&&(pr=pt.colorType,mr?(P(C.oes_texture_float||!(pr==="float"||pr==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),P(C.oes_texture_half_float||!(pr==="half float"||pr==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):pr==="half float"||pr==="float16"?(P(C.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),qt="rgba16f"):(pr==="float"||pr==="float32")&&(P(C.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),qt="rgba32f"),P.oneOf(pr,De,"invalid color type")),"colorFormat"in pt&&(qt=pt.colorFormat,xe.indexOf(qt)>=0?mr=!0:Ce.indexOf(qt)>=0?mr=!1:mr?P.oneOf(pt.colorFormat,xe,"invalid color format for texture"):P.oneOf(pt.colorFormat,Ce,"invalid color format for renderbuffer"))),("depthTexture"in pt||"depthStencilTexture"in pt)&&(yr=!!(pt.depthTexture||pt.depthStencilTexture),P(!yr||C.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in pt&&(typeof pt.depth=="boolean"?dr=pt.depth:(Er=pt.depth,xr=!1)),"stencil"in pt&&(typeof pt.stencil=="boolean"?xr=pt.stencil:(Pr=pt.stencil,dr=!1)),"depthStencil"in pt&&(typeof pt.depthStencil=="boolean"?dr=xr=pt.depthStencil:(Vr=pt.depthStencil,dr=!1,xr=!1))}var Lt=null,it=null,St=null,Nt=null;if(Array.isArray(xt))Lt=xt.map(Pe);else if(xt)Lt=[Pe(xt)];else for(Lt=new Array(gr),ct=0;ct<gr;++ct)Lt[ct]=Y(vt,Ft,mr,qt,pr);P(C.webgl_draw_buffers||Lt.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),P(Lt.length<=L.maxColorAttachments,"too many color attachments, not supported"),vt=vt||Lt[0].width,Ft=Ft||Lt[0].height,Er?it=Pe(Er):dr&&!xr&&(it=Y(vt,Ft,yr,"depth","uint32")),Pr?St=Pe(Pr):xr&&!dr&&(St=Y(vt,Ft,!1,"stencil","uint8")),Vr?Nt=Pe(Vr):!Er&&!Pr&&xr&&dr&&(Nt=Y(vt,Ft,yr,"depth stencil","depth stencil")),P(!!Er+!!Pr+!!Vr<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var lr=null;for(ct=0;ct<Lt.length;++ct)if(Be(Lt[ct],vt,Ft),P(!Lt[ct]||Lt[ct].texture&&iS.indexOf(Lt[ct].texture._texture.format)>=0||Lt[ct].renderbuffer&&pS.indexOf(Lt[ct].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+ct+" is invalid"),Lt[ct]&&Lt[ct].texture){var Qn=Tf[Lt[ct].texture._texture.format]*Gu[Lt[ct].texture._texture.type];lr===null?lr=Qn:P(lr===Qn,"all color attachments much have the same number of bits per pixel.")}return Be(it,vt,Ft),P(!it||it.texture&&it.texture._texture.format===nS||it.renderbuffer&&it.renderbuffer._renderbuffer.format===uS,"invalid depth attachment for framebuffer object"),Be(St,vt,Ft),P(!St||St.renderbuffer&&St.renderbuffer._renderbuffer.format===lS,"invalid stencil attachment for framebuffer object"),Be(Nt,vt,Ft),P(!Nt||Nt.texture&&Nt.texture._texture.format===R_||Nt.renderbuffer&&Nt.renderbuffer._renderbuffer.format===R_,"invalid depth-stencil attachment for framebuffer object"),be(_e),_e.width=vt,_e.height=Ft,_e.colorAttachments=Lt,_e.depthAttachment=it,_e.stencilAttachment=St,_e.depthStencilAttachment=Nt,ut.color=Lt.map(oe),ut.depth=oe(it),ut.stencil=oe(St),ut.depthStencil=oe(Nt),ut.width=_e.width,ut.height=_e.height,ge(_e),ut}function Mt(Ze,At){P(ae.next!==_e,"can not resize a framebuffer which is currently in use");var ct=Math.max(Ze|0,1),vt=Math.max(At|0||ct,1);if(ct===_e.width&&vt===_e.height)return ut;for(var Ft=_e.colorAttachments,dr=0;dr<Ft.length;++dr)Re(Ft[dr],ct,vt);return Re(_e.depthAttachment,ct,vt),Re(_e.stencilAttachment,ct,vt),Re(_e.depthStencilAttachment,ct,vt),_e.width=ut.width=ct,_e.height=ut.height=vt,ge(_e),ut}return ut(Ue,Me),n(ut,{resize:Mt,_reglType:"framebuffer",_framebuffer:_e,destroy:function(){ke(_e),be(_e)},use:function(Ze){ae.setFBO({framebuffer:ut},Ze)}})}function tt(Ue){var Me=Array(6);function _e(Mt){var Ze;P(Me.indexOf(ae.next)<0,"can not update framebuffer which is currently in use");var At={color:null},ct=0,vt=null,Ft="rgba",dr="uint8",xr=1;if(typeof Mt=="number")ct=Mt|0;else if(!Mt)ct=1;else{P.type(Mt,"object","invalid arguments for framebuffer");var xt=Mt;if("shape"in xt){var mr=xt.shape;P(Array.isArray(mr)&&mr.length>=2,"invalid shape for framebuffer"),P(mr[0]===mr[1],"cube framebuffer must be square"),ct=mr[0]}else"radius"in xt&&(ct=xt.radius|0),"width"in xt?(ct=xt.width|0,"height"in xt&&P(xt.height===ct,"must be square")):"height"in xt&&(ct=xt.height|0);("color"in xt||"colors"in xt)&&(vt=xt.color||xt.colors,Array.isArray(vt)&&P(vt.length===1||C.webgl_draw_buffers,"multiple render targets not supported")),vt||("colorCount"in xt&&(xr=xt.colorCount|0,P(xr>0,"invalid color buffer count")),"colorType"in xt&&(P.oneOf(xt.colorType,De,"invalid color type"),dr=xt.colorType),"colorFormat"in xt&&(Ft=xt.colorFormat,P.oneOf(xt.colorFormat,xe,"invalid color format for texture"))),"depth"in xt&&(At.depth=xt.depth),"stencil"in xt&&(At.stencil=xt.stencil),"depthStencil"in xt&&(At.depthStencil=xt.depthStencil)}var qt;if(vt)if(Array.isArray(vt))for(qt=[],Ze=0;Ze<vt.length;++Ze)qt[Ze]=vt[Ze];else qt=[vt];else{qt=Array(xr);var pr={radius:ct,format:Ft,type:dr};for(Ze=0;Ze<xr;++Ze)qt[Ze]=te.createCube(pr)}for(At.color=Array(qt.length),Ze=0;Ze<qt.length;++Ze){var gr=qt[Ze];P(typeof gr=="function"&&gr._reglType==="textureCube","invalid cube map"),ct=ct||gr.width,P(gr.width===ct&&gr.height===ct,"invalid cube map shape"),At.color[Ze]={target:ju,data:qt[Ze]}}for(Ze=0;Ze<6;++Ze){for(var Er=0;Er<qt.length;++Er)At.color[Er].target=ju+Ze;Ze>0&&(At.depth=Me[0].depth,At.stencil=Me[0].stencil,At.depthStencil=Me[0].depthStencil),Me[Ze]?Me[Ze](At):Me[Ze]=we(At)}return n(_e,{width:ct,height:ct,color:qt})}function ut(Mt){var Ze,At=Mt|0;if(P(At>0&&At<=L.maxCubeMapSize,"invalid radius for cube fbo"),At===_e.width)return _e;var ct=_e.color;for(Ze=0;Ze<ct.length;++Ze)ct[Ze].resize(At);for(Ze=0;Ze<6;++Ze)Me[Ze].resize(At);return _e.width=_e.height=At,_e}return _e(Ue),n(_e,{faces:Me,resize:ut,_reglType:"framebufferCube",destroy:function(){Me.forEach(function(Mt){Mt.destroy()})}})}function st(){ae.cur=null,ae.next=null,ae.dirty=!0,I(me).forEach(function(Ue){Ue.framebuffer=_.createFramebuffer(),ge(Ue)})}return n(ae,{getFramebuffer:function(Ue){if(typeof Ue=="function"&&Ue._reglType==="framebuffer"){var Me=Ue._framebuffer;if(Me instanceof He)return Me}return null},create:we,createCube:tt,clear:function(){I(me).forEach(ke)},restore:st})}var vS=5126,C_=34962;function Sf(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=vS,this.offset=0,this.stride=0,this.divisor=0}function mS(_,C,L,te,fe){for(var re=L.maxAttributes,ae=new Array(re),xe=0;xe<re;++xe)ae[xe]=new Sf;var Ce=0,De={},Ie={Record:Sf,scope:{},state:ae,currentVAO:null,targetVAO:null,restore:Be()?me:function(){},createVAO:He,getVAO:Pe,destroyBuffer:Oe,setVAO:Be()?Y:oe,clear:Be()?Re:function(){}};function Oe(be){for(var ke=0;ke<ae.length;++ke){var ge=ae[ke];ge.buffer===be&&(_.disableVertexAttribArray(ke),ge.buffer=null)}}function Be(){return C.oes_vertex_array_object}function Ae(){return C.angle_instanced_arrays}function Pe(be){return typeof be=="function"&&be._vao?be._vao:null}function Y(be){if(be!==Ie.currentVAO){var ke=Be();be?ke.bindVertexArrayOES(be.vao):ke.bindVertexArrayOES(null),Ie.currentVAO=be}}function oe(be){if(be!==Ie.currentVAO){if(be)be.bindAttrs();else for(var ke=Ae(),ge=0;ge<ae.length;++ge){var we=ae[ge];we.buffer?(_.enableVertexAttribArray(ge),_.vertexAttribPointer(ge,we.size,we.type,we.normalized,we.stride,we.offfset),ke&&ke.vertexAttribDivisorANGLE(ge,we.divisor)):(_.disableVertexAttribArray(ge),_.vertexAttrib4f(ge,we.x,we.y,we.z,we.w))}Ie.currentVAO=be}}function Re(){I(De).forEach(function(be){be.destroy()})}function Le(){this.id=++Ce,this.attributes=[];var be=Be();be?this.vao=be.createVertexArrayOES():this.vao=null,De[this.id]=this,this.buffers=[]}Le.prototype.bindAttrs=function(){for(var be=Ae(),ke=this.attributes,ge=0;ge<ke.length;++ge){var we=ke[ge];we.buffer?(_.enableVertexAttribArray(ge),_.bindBuffer(C_,we.buffer.buffer),_.vertexAttribPointer(ge,we.size,we.type,we.normalized,we.stride,we.offset),be&&be.vertexAttribDivisorANGLE(ge,we.divisor)):(_.disableVertexAttribArray(ge),_.vertexAttrib4f(ge,we.x,we.y,we.z,we.w))}for(var tt=ke.length;tt<re;++tt)_.disableVertexAttribArray(tt)},Le.prototype.refresh=function(){var be=Be();be&&(be.bindVertexArrayOES(this.vao),this.bindAttrs(),Ie.currentVAO=this)},Le.prototype.destroy=function(){if(this.vao){var be=Be();this===Ie.currentVAO&&(Ie.currentVAO=null,be.bindVertexArrayOES(null)),be.deleteVertexArrayOES(this.vao),this.vao=null}De[this.id]&&(delete De[this.id],te.vaoCount-=1)};function me(){var be=Be();be&&I(De).forEach(function(ke){ke.refresh()})}function He(be){var ke=new Le;te.vaoCount+=1;function ge(we){P(Array.isArray(we),"arguments to vertex array constructor must be an array"),P(we.length<re,"too many attributes"),P(we.length>0,"must specify at least one attribute");for(var tt=0;tt<ke.buffers.length;++tt)ke.buffers[tt].destroy();ke.buffers.length=0;var st=ke.attributes;st.length=we.length;for(var Ue=0;Ue<we.length;++Ue){var Me=we[Ue],_e=st[Ue]=new Sf;if(Array.isArray(Me)||r(Me)||x(Me)){var ut=fe.create(Me,C_,!1,!0);_e.buffer=fe.getBuffer(ut),_e.size=_e.buffer.dimension|0,_e.normalized=!1,_e.type=_e.buffer.dtype,_e.offset=0,_e.stride=0,_e.divisor=0,_e.state=1,ke.buffers.push(ut)}else fe.getBuffer(Me)?(_e.buffer=fe.getBuffer(Me),_e.size=_e.buffer.dimension|0,_e.normalized=!1,_e.type=_e.buffer.dtype,_e.offset=0,_e.stride=0,_e.divisor=0,_e.state=1):fe.getBuffer(Me.buffer)?(_e.buffer=fe.getBuffer(Me.buffer),_e.size=(+Me.size||_e.buffer.dimension)|0,_e.normalized=!!Me.normalized||!1,"type"in Me?(P.parameter(Me.type,Ki,"invalid buffer type"),_e.type=Ki[Me.type]):_e.type=_e.buffer.dtype,_e.offset=(Me.offset||0)|0,_e.stride=(Me.stride||0)|0,_e.divisor=(Me.divisor||0)|0,_e.state=1,P(_e.size>=1&&_e.size<=4,"size must be between 1 and 4"),P(_e.offset>=0,"invalid offset"),P(_e.stride>=0&&_e.stride<=255,"stride must be between 0 and 255"),P(_e.divisor>=0,"divisor must be positive"),P(!_e.divisor||!!C.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Me?(P(Ue>0,"first attribute must not be a constant"),_e.x=+Me.x||0,_e.y=+Me.y||0,_e.z=+Me.z||0,_e.w=+Me.w||0,_e.state=2):P(!1,"invalid attribute spec for location "+Ue)}return ke.refresh(),ge}return ge.destroy=function(){ke.destroy()},ge._vao=ke,ge._reglType="vao",ge(be)}return Ie}var b_=35632,gS=35633,ES=35718,yS=35721;function AS(_,C,L,te){var fe={},re={};function ae(Y,oe,Re,Le){this.name=Y,this.id=oe,this.location=Re,this.info=Le}function xe(Y,oe){for(var Re=0;Re<Y.length;++Re)if(Y[Re].id===oe.id){Y[Re].location=oe.location;return}Y.push(oe)}function Ce(Y,oe,Re){var Le=Y===b_?fe:re,me=Le[oe];if(!me){var He=C.str(oe);me=_.createShader(Y),_.shaderSource(me,He),_.compileShader(me),P.shaderError(_,me,He,Y,Re),Le[oe]=me}return me}var De={},Ie=[],Oe=0;function Be(Y,oe){this.id=Oe++,this.fragId=Y,this.vertId=oe,this.program=null,this.uniforms=[],this.attributes=[],te.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Ae(Y,oe,Re){var Le,me,He=Ce(b_,Y.fragId),be=Ce(gS,Y.vertId),ke=Y.program=_.createProgram();if(_.attachShader(ke,He),_.attachShader(ke,be),Re)for(Le=0;Le<Re.length;++Le){var ge=Re[Le];_.bindAttribLocation(ke,ge[0],ge[1])}_.linkProgram(ke),P.linkError(_,ke,C.str(Y.fragId),C.str(Y.vertId),oe);var we=_.getProgramParameter(ke,ES);te.profile&&(Y.stats.uniformsCount=we);var tt=Y.uniforms;for(Le=0;Le<we;++Le)if(me=_.getActiveUniform(ke,Le),me)if(me.size>1)for(var st=0;st<me.size;++st){var Ue=me.name.replace("[0]","["+st+"]");xe(tt,new ae(Ue,C.id(Ue),_.getUniformLocation(ke,Ue),me))}else xe(tt,new ae(me.name,C.id(me.name),_.getUniformLocation(ke,me.name),me));var Me=_.getProgramParameter(ke,yS);te.profile&&(Y.stats.attributesCount=Me);var _e=Y.attributes;for(Le=0;Le<Me;++Le)me=_.getActiveAttrib(ke,Le),me&&xe(_e,new ae(me.name,C.id(me.name),_.getAttribLocation(ke,me.name),me))}te.profile&&(L.getMaxUniformsCount=function(){var Y=0;return Ie.forEach(function(oe){oe.stats.uniformsCount>Y&&(Y=oe.stats.uniformsCount)}),Y},L.getMaxAttributesCount=function(){var Y=0;return Ie.forEach(function(oe){oe.stats.attributesCount>Y&&(Y=oe.stats.attributesCount)}),Y});function Pe(){fe={},re={};for(var Y=0;Y<Ie.length;++Y)Ae(Ie[Y],null,Ie[Y].attributes.map(function(oe){return[oe.location,oe.name]}))}return{clear:function(){var Y=_.deleteShader.bind(_);I(fe).forEach(Y),fe={},I(re).forEach(Y),re={},Ie.forEach(function(oe){_.deleteProgram(oe.program)}),Ie.length=0,De={},L.shaderCount=0},program:function(Y,oe,Re,Le){P.command(Y>=0,"missing vertex shader",Re),P.command(oe>=0,"missing fragment shader",Re);var me=De[oe];me||(me=De[oe]={});var He=me[Y];if(He&&!Le)return He;var be=new Be(oe,Y);return L.shaderCount++,Ae(be,Re,Le),He||(me[Y]=be),Ie.push(be),be},restore:Pe,shader:Ce,frag:-1,vert:-1}}var TS=6408,es=5121,SS=3333,$u=5126;function xS(_,C,L,te,fe,re,ae){function xe(Ie){var Oe;C.next===null?(P(fe.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Oe=es):(P(C.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Oe=C.next.colorAttachments[0].texture._texture.type,re.oes_texture_float?(P(Oe===es||Oe===$u,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Oe===$u&&P(ae.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):P(Oe===es,"Reading from a framebuffer is only allowed for the type 'uint8'"));var Be=0,Ae=0,Pe=te.framebufferWidth,Y=te.framebufferHeight,oe=null;r(Ie)?oe=Ie:Ie&&(P.type(Ie,"object","invalid arguments to regl.read()"),Be=Ie.x|0,Ae=Ie.y|0,P(Be>=0&&Be<te.framebufferWidth,"invalid x offset for regl.read"),P(Ae>=0&&Ae<te.framebufferHeight,"invalid y offset for regl.read"),Pe=(Ie.width||te.framebufferWidth-Be)|0,Y=(Ie.height||te.framebufferHeight-Ae)|0,oe=Ie.data||null),oe&&(Oe===es?P(oe instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Oe===$u&&P(oe instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),P(Pe>0&&Pe+Be<=te.framebufferWidth,"invalid width for read pixels"),P(Y>0&&Y+Ae<=te.framebufferHeight,"invalid height for read pixels"),L();var Re=Pe*Y*4;return oe||(Oe===es?oe=new Uint8Array(Re):Oe===$u&&(oe=oe||new Float32Array(Re))),P.isTypedArray(oe,"data buffer for regl.read() must be a typedarray"),P(oe.byteLength>=Re,"data buffer for regl.read() too small"),_.pixelStorei(SS,4),_.readPixels(Be,Ae,Pe,Y,TS,Oe,oe),oe}function Ce(Ie){var Oe;return C.setFBO({framebuffer:Ie.framebuffer},function(){Oe=xe(Ie)}),Oe}function De(Ie){return!Ie||!("framebuffer"in Ie)?xe(Ie):Ce(Ie)}return De}function Wo(_){return Array.prototype.slice.call(_)}function jo(_){return Wo(_).join("")}function RS(){var _=0,C=[],L=[];function te(Oe){for(var Be=0;Be<L.length;++Be)if(L[Be]===Oe)return C[Be];var Ae="g"+_++;return C.push(Ae),L.push(Oe),Ae}function fe(){var Oe=[];function Be(){Oe.push.apply(Oe,Wo(arguments))}var Ae=[];function Pe(){var Y="v"+_++;return Ae.push(Y),arguments.length>0&&(Oe.push(Y,"="),Oe.push.apply(Oe,Wo(arguments)),Oe.push(";")),Y}return n(Be,{def:Pe,toString:function(){return jo([Ae.length>0?"var "+Ae.join(",")+";":"",jo(Oe)])}})}function re(){var Oe=fe(),Be=fe(),Ae=Oe.toString,Pe=Be.toString;function Y(oe,Re){Be(oe,Re,"=",Oe.def(oe,Re),";")}return n(function(){Oe.apply(Oe,Wo(arguments))},{def:Oe.def,entry:Oe,exit:Be,save:Y,set:function(oe,Re,Le){Y(oe,Re),Oe(oe,Re,"=",Le,";")},toString:function(){return Ae()+Pe()}})}function ae(){var Oe=jo(arguments),Be=re(),Ae=re(),Pe=Be.toString,Y=Ae.toString;return n(Be,{then:function(){return Be.apply(Be,Wo(arguments)),this},else:function(){return Ae.apply(Ae,Wo(arguments)),this},toString:function(){var oe=Y();return oe&&(oe="else{"+oe+"}"),jo(["if(",Oe,"){",Pe(),"}",oe])}})}var xe=fe(),Ce={};function De(Oe,Be){var Ae=[];function Pe(){var me="a"+Ae.length;return Ae.push(me),me}Be=Be||0;for(var Y=0;Y<Be;++Y)Pe();var oe=re(),Re=oe.toString,Le=Ce[Oe]=n(oe,{arg:Pe,toString:function(){return jo(["function(",Ae.join(),"){",Re(),"}"])}});return Le}function Ie(){var Oe=['"use strict";',xe,"return {"];Object.keys(Ce).forEach(function(Pe){Oe.push('"',Pe,'":',Ce[Pe].toString(),",")}),Oe.push("}");var Be=jo(Oe).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Ae=Function.apply(null,C.concat(Be));return Ae.apply(null,L)}return{global:xe,link:te,block:fe,proc:De,scope:re,cond:ae,compile:Ie}}var Go="xyzw".split(""),M_=5121,$o=1,xf=2,I_=0,O_=1,P_=2,N_=3,Rf=4,F_="dither",D_="blend.enable",B_="blend.color",Cf="blend.equation",bf="blend.func",w_="depth.enable",L_="depth.func",U_="depth.range",k_="depth.mask",Mf="colorMask",z_="cull.enable",V_="cull.face",If="frontFace",Of="lineWidth",H_="polygonOffset.enable",Pf="polygonOffset.offset",X_="sample.alpha",W_="sample.enable",Nf="sample.coverage",j_="stencil.enable",G_="stencil.mask",Ff="stencil.func",Df="stencil.opFront",ts="stencil.opBack",$_="scissor.enable",Yu="scissor.box",ci="viewport",rs="profile",ro="framebuffer",ns="vert",is="frag",no="elements",io="primitive",oo="count",Zu="offset",qu="instances",os="vao",Bf="Width",wf="Height",Yo=ro+Bf,Zo=ro+wf,CS=ci+Bf,bS=ci+wf,Y_="drawingBuffer",Z_=Y_+Bf,q_=Y_+wf,MS=[bf,Cf,Ff,Df,ts,Nf,ci,Yu,Pf],qo=34962,IS=34963,OS=35632,PS=35633,K_=3553,NS=34067,FS=2884,DS=3042,BS=3024,wS=2960,LS=2929,US=3089,kS=32823,zS=32926,VS=32928,Lf=5126,Ku=35664,Qu=35665,Ju=35666,Uf=5124,el=35667,tl=35668,rl=35669,kf=35670,nl=35671,il=35672,ol=35673,as=35674,ss=35675,us=35676,ls=35678,cs=35680,Q_=4,fs=1028,ao=1029,J_=2304,zf=2305,HS=32775,XS=32776,WS=519,Ci=7680,e0=0,t0=1,r0=32774,jS=513,n0=36160,GS=36064,Kn={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},i0=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Ko={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},bi={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},o0={frag:OS,vert:PS},Vf={cw:J_,ccw:zf};function al(_){return Array.isArray(_)||r(_)||x(_)}function a0(_){return _.sort(function(C,L){return C===ci?-1:L===ci?1:C<L?-1:1})}function En(_,C,L,te){this.thisDep=_,this.contextDep=C,this.propDep=L,this.append=te}function Mi(_){return _&&!(_.thisDep||_.contextDep||_.propDep)}function hr(_){return new En(!1,!1,!1,_)}function sn(_,C){var L=_.type;if(L===I_){var te=_.data.length;return new En(!0,te>=1,te>=2,C)}else if(L===Rf){var fe=_.data;return new En(fe.thisDep,fe.contextDep,fe.propDep,C)}else return new En(L===N_,L===P_,L===O_,C)}var s0=new En(!1,!1,!1,function(){});function $S(_,C,L,te,fe,re,ae,xe,Ce,De,Ie,Oe,Be,Ae,Pe){var Y=De.Record,oe={add:32774,subtract:32778,"reverse subtract":32779};L.ext_blend_minmax&&(oe.min=HS,oe.max=XS);var Re=L.angle_instanced_arrays,Le=L.webgl_draw_buffers,me={dirty:!0,profile:Pe.profile},He={},be=[],ke={},ge={};function we(S){return S.replace(".","_")}function tt(S,O,w){var J=we(S);be.push(S),He[J]=me[J]=!!w,ke[J]=O}function st(S,O,w){var J=we(S);be.push(S),Array.isArray(w)?(me[J]=w.slice(),He[J]=w.slice()):me[J]=He[J]=w,ge[J]=O}tt(F_,BS),tt(D_,DS),st(B_,"blendColor",[0,0,0,0]),st(Cf,"blendEquationSeparate",[r0,r0]),st(bf,"blendFuncSeparate",[t0,e0,t0,e0]),tt(w_,LS,!0),st(L_,"depthFunc",jS),st(U_,"depthRange",[0,1]),st(k_,"depthMask",!0),st(Mf,Mf,[!0,!0,!0,!0]),tt(z_,FS),st(V_,"cullFace",ao),st(If,If,zf),st(Of,Of,1),tt(H_,kS),st(Pf,"polygonOffset",[0,0]),tt(X_,zS),tt(W_,VS),st(Nf,"sampleCoverage",[1,!1]),tt(j_,wS),st(G_,"stencilMask",-1),st(Ff,"stencilFunc",[WS,0,-1]),st(Df,"stencilOpSeparate",[fs,Ci,Ci,Ci]),st(ts,"stencilOpSeparate",[ao,Ci,Ci,Ci]),tt($_,US),st(Yu,"scissor",[0,0,_.drawingBufferWidth,_.drawingBufferHeight]),st(ci,ci,[0,0,_.drawingBufferWidth,_.drawingBufferHeight]);var Ue={gl:_,context:Be,strings:C,next:He,current:me,draw:Oe,elements:re,buffer:fe,shader:Ie,attributes:De.state,vao:De,uniforms:Ce,framebuffer:xe,extensions:L,timer:Ae,isBufferArgs:al},Me={primTypes:wo,compareFuncs:Ko,blendFuncs:Kn,blendEquations:oe,stencilOps:bi,glTypes:Ki,orientationType:Vf};P.optional(function(){Ue.isArrayLike=ur}),Le&&(Me.backBuffer=[ao],Me.drawBuffer=Qr(te.maxDrawbuffers,function(S){return S===0?[0]:Qr(S,function(O){return GS+O})}));var _e=0;function ut(){var S=RS(),O=S.link,w=S.global;S.id=_e++,S.batchId="0";var J=O(Ue),ee=S.shared={props:"a0"};Object.keys(Ue).forEach(function(z){ee[z]=w.def(J,".",z)}),P.optional(function(){S.CHECK=O(P),S.commandStr=P.guessCommand(),S.command=O(S.commandStr),S.assert=function(z,M,V){z("if(!(",M,"))",this.CHECK,".commandRaise(",O(V),",",this.command,");")},Me.invalidBlendCombinations=i0});var U=S.next={},W=S.current={};Object.keys(ge).forEach(function(z){Array.isArray(me[z])&&(U[z]=w.def(ee.next,".",z),W[z]=w.def(ee.current,".",z))});var j=S.constants={};Object.keys(Me).forEach(function(z){j[z]=w.def(JSON.stringify(Me[z]))}),S.invoke=function(z,M){switch(M.type){case I_:var V=["this",ee.context,ee.props,S.batchId];return z.def(O(M.data),".call(",V.slice(0,Math.max(M.data.length+1,4)),")");case O_:return z.def(ee.props,M.data);case P_:return z.def(ee.context,M.data);case N_:return z.def("this",M.data);case Rf:return M.data.append(S,z),M.data.ref}},S.attribCache={};var F={};return S.scopeAttrib=function(z){var M=C.id(z);if(M in F)return F[M];var V=De.scope[M];V||(V=De.scope[M]=new Y);var ne=F[M]=O(V);return ne},S}function Mt(S){var O=S.static,w=S.dynamic,J;if(rs in O){var ee=!!O[rs];J=hr(function(W,j){return ee}),J.enable=ee}else if(rs in w){var U=w[rs];J=sn(U,function(W,j){return W.invoke(j,U)})}return J}function Ze(S,O){var w=S.static,J=S.dynamic;if(ro in w){var ee=w[ro];return ee?(ee=xe.getFramebuffer(ee),P.command(ee,"invalid framebuffer object"),hr(function(W,j){var F=W.link(ee),z=W.shared;j.set(z.framebuffer,".next",F);var M=z.context;return j.set(M,"."+Yo,F+".width"),j.set(M,"."+Zo,F+".height"),F})):hr(function(W,j){var F=W.shared;j.set(F.framebuffer,".next","null");var z=F.context;return j.set(z,"."+Yo,z+"."+Z_),j.set(z,"."+Zo,z+"."+q_),"null"})}else if(ro in J){var U=J[ro];return sn(U,function(W,j){var F=W.invoke(j,U),z=W.shared,M=z.framebuffer,V=j.def(M,".getFramebuffer(",F,")");P.optional(function(){W.assert(j,"!"+F+"||"+V,"invalid framebuffer object")}),j.set(M,".next",V);var ne=z.context;return j.set(ne,"."+Yo,V+"?"+V+".width:"+ne+"."+Z_),j.set(ne,"."+Zo,V+"?"+V+".height:"+ne+"."+q_),V})}else return null}function At(S,O,w){var J=S.static,ee=S.dynamic;function U(F){if(F in J){var z=J[F];P.commandType(z,"object","invalid "+F,w.commandStr);var M=!0,V=z.x|0,ne=z.y|0,ue,ye;return"width"in z?(ue=z.width|0,P.command(ue>=0,"invalid "+F,w.commandStr)):M=!1,"height"in z?(ye=z.height|0,P.command(ye>=0,"invalid "+F,w.commandStr)):M=!1,new En(!M&&O&&O.thisDep,!M&&O&&O.contextDep,!M&&O&&O.propDep,function(Ke,_t){var We=Ke.shared.context,ot=ue;"width"in z||(ot=_t.def(We,".",Yo,"-",V));var ft=ye;return"height"in z||(ft=_t.def(We,".",Zo,"-",ne)),[V,ne,ot,ft]})}else if(F in ee){var ve=ee[F],Se=sn(ve,function(Ke,_t){var We=Ke.invoke(_t,ve);P.optional(function(){Ke.assert(_t,We+"&&typeof "+We+'==="object"',"invalid "+F)});var ot=Ke.shared.context,ft=_t.def(We,".x|0"),wt=_t.def(We,".y|0"),_r=_t.def('"width" in ',We,"?",We,".width|0:","(",ot,".",Yo,"-",ft,")"),Hn=_t.def('"height" in ',We,"?",We,".height|0:","(",ot,".",Zo,"-",wt,")");return P.optional(function(){Ke.assert(_t,_r+">=0&&"+Hn+">=0","invalid "+F)}),[ft,wt,_r,Hn]});return O&&(Se.thisDep=Se.thisDep||O.thisDep,Se.contextDep=Se.contextDep||O.contextDep,Se.propDep=Se.propDep||O.propDep),Se}else return O?new En(O.thisDep,O.contextDep,O.propDep,function(Ke,_t){var We=Ke.shared.context;return[0,0,_t.def(We,".",Yo),_t.def(We,".",Zo)]}):null}var W=U(ci);if(W){var j=W;W=new En(W.thisDep,W.contextDep,W.propDep,function(F,z){var M=j.append(F,z),V=F.shared.context;return z.set(V,"."+CS,M[2]),z.set(V,"."+bS,M[3]),M})}return{viewport:W,scissor_box:U(Yu)}}function ct(S,O){var w=S.static,J=typeof w[is]=="string"&&typeof w[ns]=="string";if(J){if(Object.keys(O.dynamic).length>0)return null;var ee=O.static,U=Object.keys(ee);if(U.length>0&&typeof ee[U[0]]=="number"){for(var W=[],j=0;j<U.length;++j)P(typeof ee[U[j]]=="number","must specify all vertex attribute locations when using vaos"),W.push([ee[U[j]]|0,U[j]]);return W}}return null}function vt(S,O,w){var J=S.static,ee=S.dynamic;function U(M){if(M in J){var V=C.id(J[M]);P.optional(function(){Ie.shader(o0[M],V,P.guessCommand())});var ne=hr(function(){return V});return ne.id=V,ne}else if(M in ee){var ue=ee[M];return sn(ue,function(ye,ve){var Se=ye.invoke(ve,ue),Ke=ve.def(ye.shared.strings,".id(",Se,")");return P.optional(function(){ve(ye.shared.shader,".shader(",o0[M],",",Ke,",",ye.command,");")}),Ke})}return null}var W=U(is),j=U(ns),F=null,z;return Mi(W)&&Mi(j)?(F=Ie.program(j.id,W.id,null,w),z=hr(function(M,V){return M.link(F)})):z=new En(W&&W.thisDep||j&&j.thisDep,W&&W.contextDep||j&&j.contextDep,W&&W.propDep||j&&j.propDep,function(M,V){var ne=M.shared.shader,ue;W?ue=W.append(M,V):ue=V.def(ne,".",is);var ye;j?ye=j.append(M,V):ye=V.def(ne,".",ns);var ve=ne+".program("+ye+","+ue;return P.optional(function(){ve+=","+M.command}),V.def(ve+")")}),{frag:W,vert:j,progVar:z,program:F}}function Ft(S,O){var w=S.static,J=S.dynamic;function ee(){if(no in w){var M=w[no];al(M)?M=re.getElements(re.create(M,!0)):M&&(M=re.getElements(M),P.command(M,"invalid elements",O.commandStr));var V=hr(function(ue,ye){if(M){var ve=ue.link(M);return ue.ELEMENTS=ve,ve}return ue.ELEMENTS=null,null});return V.value=M,V}else if(no in J){var ne=J[no];return sn(ne,function(ue,ye){var ve=ue.shared,Se=ve.isBufferArgs,Ke=ve.elements,_t=ue.invoke(ye,ne),We=ye.def("null"),ot=ye.def(Se,"(",_t,")"),ft=ue.cond(ot).then(We,"=",Ke,".createStream(",_t,");").else(We,"=",Ke,".getElements(",_t,");");return P.optional(function(){ue.assert(ft.else,"!"+_t+"||"+We,"invalid elements")}),ye.entry(ft),ye.exit(ue.cond(ot).then(Ke,".destroyStream(",We,");")),ue.ELEMENTS=We,We})}return null}var U=ee();function W(){if(io in w){var M=w[io];return P.commandParameter(M,wo,"invalid primitve",O.commandStr),hr(function(ne,ue){return wo[M]})}else if(io in J){var V=J[io];return sn(V,function(ne,ue){var ye=ne.constants.primTypes,ve=ne.invoke(ue,V);return P.optional(function(){ne.assert(ue,ve+" in "+ye,"invalid primitive, must be one of "+Object.keys(wo))}),ue.def(ye,"[",ve,"]")})}else if(U)return Mi(U)?U.value?hr(function(ne,ue){return ue.def(ne.ELEMENTS,".primType")}):hr(function(){return Q_}):new En(U.thisDep,U.contextDep,U.propDep,function(ne,ue){var ye=ne.ELEMENTS;return ue.def(ye,"?",ye,".primType:",Q_)});return null}function j(M,V){if(M in w){var ne=w[M]|0;return P.command(!V||ne>=0,"invalid "+M,O.commandStr),hr(function(ye,ve){return V&&(ye.OFFSET=ne),ne})}else if(M in J){var ue=J[M];return sn(ue,function(ye,ve){var Se=ye.invoke(ve,ue);return V&&(ye.OFFSET=Se,P.optional(function(){ye.assert(ve,Se+">=0","invalid "+M)})),Se})}else if(V&&U)return hr(function(ye,ve){return ye.OFFSET="0",0});return null}var F=j(Zu,!0);function z(){if(oo in w){var M=w[oo]|0;return P.command(typeof M=="number"&&M>=0,"invalid vertex count",O.commandStr),hr(function(){return M})}else if(oo in J){var V=J[oo];return sn(V,function(ye,ve){var Se=ye.invoke(ve,V);return P.optional(function(){ye.assert(ve,"typeof "+Se+'==="number"&&'+Se+">=0&&"+Se+"===("+Se+"|0)","invalid vertex count")}),Se})}else if(U)if(Mi(U)){if(U)return F?new En(F.thisDep,F.contextDep,F.propDep,function(ye,ve){var Se=ve.def(ye.ELEMENTS,".vertCount-",ye.OFFSET);return P.optional(function(){ye.assert(ve,Se+">=0","invalid vertex offset/element buffer too small")}),Se}):hr(function(ye,ve){return ve.def(ye.ELEMENTS,".vertCount")});var ne=hr(function(){return-1});return P.optional(function(){ne.MISSING=!0}),ne}else{var ue=new En(U.thisDep||F.thisDep,U.contextDep||F.contextDep,U.propDep||F.propDep,function(ye,ve){var Se=ye.ELEMENTS;return ye.OFFSET?ve.def(Se,"?",Se,".vertCount-",ye.OFFSET,":-1"):ve.def(Se,"?",Se,".vertCount:-1")});return P.optional(function(){ue.DYNAMIC=!0}),ue}return null}return{elements:U,primitive:W(),count:z(),instances:j(qu,!1),offset:F}}function dr(S,O){var w=S.static,J=S.dynamic,ee={};return be.forEach(function(U){var W=we(U);function j(F,z){if(U in w){var M=F(w[U]);ee[W]=hr(function(){return M})}else if(U in J){var V=J[U];ee[W]=sn(V,function(ne,ue){return z(ne,ue,ne.invoke(ue,V))})}}switch(U){case z_:case D_:case F_:case j_:case w_:case $_:case H_:case X_:case W_:case k_:return j(function(F){return P.commandType(F,"boolean",U,O.commandStr),F},function(F,z,M){return P.optional(function(){F.assert(z,"typeof "+M+'==="boolean"',"invalid flag "+U,F.commandStr)}),M});case L_:return j(function(F){return P.commandParameter(F,Ko,"invalid "+U,O.commandStr),Ko[F]},function(F,z,M){var V=F.constants.compareFuncs;return P.optional(function(){F.assert(z,M+" in "+V,"invalid "+U+", must be one of "+Object.keys(Ko))}),z.def(V,"[",M,"]")});case U_:return j(function(F){return P.command(ur(F)&&F.length===2&&typeof F[0]=="number"&&typeof F[1]=="number"&&F[0]<=F[1],"depth range is 2d array",O.commandStr),F},function(F,z,M){P.optional(function(){F.assert(z,F.shared.isArrayLike+"("+M+")&&"+M+".length===2&&typeof "+M+'[0]==="number"&&typeof '+M+'[1]==="number"&&'+M+"[0]<="+M+"[1]","depth range must be a 2d array")});var V=z.def("+",M,"[0]"),ne=z.def("+",M,"[1]");return[V,ne]});case bf:return j(function(F){P.commandType(F,"object","blend.func",O.commandStr);var z="srcRGB"in F?F.srcRGB:F.src,M="srcAlpha"in F?F.srcAlpha:F.src,V="dstRGB"in F?F.dstRGB:F.dst,ne="dstAlpha"in F?F.dstAlpha:F.dst;return P.commandParameter(z,Kn,W+".srcRGB",O.commandStr),P.commandParameter(M,Kn,W+".srcAlpha",O.commandStr),P.commandParameter(V,Kn,W+".dstRGB",O.commandStr),P.commandParameter(ne,Kn,W+".dstAlpha",O.commandStr),P.command(i0.indexOf(z+", "+V)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+z+", "+V+")",O.commandStr),[Kn[z],Kn[V],Kn[M],Kn[ne]]},function(F,z,M){var V=F.constants.blendFuncs;P.optional(function(){F.assert(z,M+"&&typeof "+M+'==="object"',"invalid blend func, must be an object")});function ne(We,ot){var ft=z.def('"',We,ot,'" in ',M,"?",M,".",We,ot,":",M,".",We);return P.optional(function(){F.assert(z,ft+" in "+V,"invalid "+U+"."+We+ot+", must be one of "+Object.keys(Kn))}),ft}var ue=ne("src","RGB"),ye=ne("dst","RGB");P.optional(function(){var We=F.constants.invalidBlendCombinations;F.assert(z,We+".indexOf("+ue+'+", "+'+ye+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var ve=z.def(V,"[",ue,"]"),Se=z.def(V,"[",ne("src","Alpha"),"]"),Ke=z.def(V,"[",ye,"]"),_t=z.def(V,"[",ne("dst","Alpha"),"]");return[ve,Ke,Se,_t]});case Cf:return j(function(F){if(typeof F=="string")return P.commandParameter(F,oe,"invalid "+U,O.commandStr),[oe[F],oe[F]];if(typeof F=="object")return P.commandParameter(F.rgb,oe,U+".rgb",O.commandStr),P.commandParameter(F.alpha,oe,U+".alpha",O.commandStr),[oe[F.rgb],oe[F.alpha]];P.commandRaise("invalid blend.equation",O.commandStr)},function(F,z,M){var V=F.constants.blendEquations,ne=z.def(),ue=z.def(),ye=F.cond("typeof ",M,'==="string"');return P.optional(function(){function ve(Se,Ke,_t){F.assert(Se,_t+" in "+V,"invalid "+Ke+", must be one of "+Object.keys(oe))}ve(ye.then,U,M),F.assert(ye.else,M+"&&typeof "+M+'==="object"',"invalid "+U),ve(ye.else,U+".rgb",M+".rgb"),ve(ye.else,U+".alpha",M+".alpha")}),ye.then(ne,"=",ue,"=",V,"[",M,"];"),ye.else(ne,"=",V,"[",M,".rgb];",ue,"=",V,"[",M,".alpha];"),z(ye),[ne,ue]});case B_:return j(function(F){return P.command(ur(F)&&F.length===4,"blend.color must be a 4d array",O.commandStr),Qr(4,function(z){return+F[z]})},function(F,z,M){return P.optional(function(){F.assert(z,F.shared.isArrayLike+"("+M+")&&"+M+".length===4","blend.color must be a 4d array")}),Qr(4,function(V){return z.def("+",M,"[",V,"]")})});case G_:return j(function(F){return P.commandType(F,"number",W,O.commandStr),F|0},function(F,z,M){return P.optional(function(){F.assert(z,"typeof "+M+'==="number"',"invalid stencil.mask")}),z.def(M,"|0")});case Ff:return j(function(F){P.commandType(F,"object",W,O.commandStr);var z=F.cmp||"keep",M=F.ref||0,V="mask"in F?F.mask:-1;return P.commandParameter(z,Ko,U+".cmp",O.commandStr),P.commandType(M,"number",U+".ref",O.commandStr),P.commandType(V,"number",U+".mask",O.commandStr),[Ko[z],M,V]},function(F,z,M){var V=F.constants.compareFuncs;P.optional(function(){function ve(){F.assert(z,Array.prototype.join.call(arguments,""),"invalid stencil.func")}ve(M+"&&typeof ",M,'==="object"'),ve('!("cmp" in ',M,")||(",M,".cmp in ",V,")")});var ne=z.def('"cmp" in ',M,"?",V,"[",M,".cmp]",":",Ci),ue=z.def(M,".ref|0"),ye=z.def('"mask" in ',M,"?",M,".mask|0:-1");return[ne,ue,ye]});case Df:case ts:return j(function(F){P.commandType(F,"object",W,O.commandStr);var z=F.fail||"keep",M=F.zfail||"keep",V=F.zpass||"keep";return P.commandParameter(z,bi,U+".fail",O.commandStr),P.commandParameter(M,bi,U+".zfail",O.commandStr),P.commandParameter(V,bi,U+".zpass",O.commandStr),[U===ts?ao:fs,bi[z],bi[M],bi[V]]},function(F,z,M){var V=F.constants.stencilOps;P.optional(function(){F.assert(z,M+"&&typeof "+M+'==="object"',"invalid "+U)});function ne(ue){return P.optional(function(){F.assert(z,'!("'+ue+'" in '+M+")||("+M+"."+ue+" in "+V+")","invalid "+U+"."+ue+", must be one of "+Object.keys(bi))}),z.def('"',ue,'" in ',M,"?",V,"[",M,".",ue,"]:",Ci)}return[U===ts?ao:fs,ne("fail"),ne("zfail"),ne("zpass")]});case Pf:return j(function(F){P.commandType(F,"object",W,O.commandStr);var z=F.factor|0,M=F.units|0;return P.commandType(z,"number",W+".factor",O.commandStr),P.commandType(M,"number",W+".units",O.commandStr),[z,M]},function(F,z,M){P.optional(function(){F.assert(z,M+"&&typeof "+M+'==="object"',"invalid "+U)});var V=z.def(M,".factor|0"),ne=z.def(M,".units|0");return[V,ne]});case V_:return j(function(F){var z=0;return F==="front"?z=fs:F==="back"&&(z=ao),P.command(!!z,W,O.commandStr),z},function(F,z,M){return P.optional(function(){F.assert(z,M+'==="front"||'+M+'==="back"',"invalid cull.face")}),z.def(M,'==="front"?',fs,":",ao)});case Of:return j(function(F){return P.command(typeof F=="number"&&F>=te.lineWidthDims[0]&&F<=te.lineWidthDims[1],"invalid line width, must be a positive number between "+te.lineWidthDims[0]+" and "+te.lineWidthDims[1],O.commandStr),F},function(F,z,M){return P.optional(function(){F.assert(z,"typeof "+M+'==="number"&&'+M+">="+te.lineWidthDims[0]+"&&"+M+"<="+te.lineWidthDims[1],"invalid line width")}),M});case If:return j(function(F){return P.commandParameter(F,Vf,W,O.commandStr),Vf[F]},function(F,z,M){return P.optional(function(){F.assert(z,M+'==="cw"||'+M+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),z.def(M+'==="cw"?'+J_+":"+zf)});case Mf:return j(function(F){return P.command(ur(F)&&F.length===4,"color.mask must be length 4 array",O.commandStr),F.map(function(z){return!!z})},function(F,z,M){return P.optional(function(){F.assert(z,F.shared.isArrayLike+"("+M+")&&"+M+".length===4","invalid color.mask")}),Qr(4,function(V){return"!!"+M+"["+V+"]"})});case Nf:return j(function(F){P.command(typeof F=="object"&&F,W,O.commandStr);var z="value"in F?F.value:1,M=!!F.invert;return P.command(typeof z=="number"&&z>=0&&z<=1,"sample.coverage.value must be a number between 0 and 1",O.commandStr),[z,M]},function(F,z,M){P.optional(function(){F.assert(z,M+"&&typeof "+M+'==="object"',"invalid sample.coverage")});var V=z.def('"value" in ',M,"?+",M,".value:1"),ne=z.def("!!",M,".invert");return[V,ne]})}}),ee}function xr(S,O){var w=S.static,J=S.dynamic,ee={};return Object.keys(w).forEach(function(U){var W=w[U],j;if(typeof W=="number"||typeof W=="boolean")j=hr(function(){return W});else if(typeof W=="function"){var F=W._reglType;F==="texture2d"||F==="textureCube"?j=hr(function(z){return z.link(W)}):F==="framebuffer"||F==="framebufferCube"?(P.command(W.color.length>0,'missing color attachment for framebuffer sent to uniform "'+U+'"',O.commandStr),j=hr(function(z){return z.link(W.color[0])})):P.commandRaise('invalid data for uniform "'+U+'"',O.commandStr)}else ur(W)?j=hr(function(z){var M=z.global.def("[",Qr(W.length,function(V){return P.command(typeof W[V]=="number"||typeof W[V]=="boolean","invalid uniform "+U,z.commandStr),W[V]}),"]");return M}):P.commandRaise('invalid or missing data for uniform "'+U+'"',O.commandStr);j.value=W,ee[U]=j}),Object.keys(J).forEach(function(U){var W=J[U];ee[U]=sn(W,function(j,F){return j.invoke(F,W)})}),ee}function xt(S,O){var w=S.static,J=S.dynamic,ee={};return Object.keys(w).forEach(function(U){var W=w[U],j=C.id(U),F=new Y;if(al(W))F.state=$o,F.buffer=fe.getBuffer(fe.create(W,qo,!1,!0)),F.type=0;else{var z=fe.getBuffer(W);if(z)F.state=$o,F.buffer=z,F.type=0;else if(P.command(typeof W=="object"&&W,"invalid data for attribute "+U,O.commandStr),"constant"in W){var M=W.constant;F.buffer="null",F.state=xf,typeof M=="number"?F.x=M:(P.command(ur(M)&&M.length>0&&M.length<=4,"invalid constant for attribute "+U,O.commandStr),Go.forEach(function(Ke,_t){_t<M.length&&(F[Ke]=M[_t])}))}else{al(W.buffer)?z=fe.getBuffer(fe.create(W.buffer,qo,!1,!0)):z=fe.getBuffer(W.buffer),P.command(!!z,'missing buffer for attribute "'+U+'"',O.commandStr);var V=W.offset|0;P.command(V>=0,'invalid offset for attribute "'+U+'"',O.commandStr);var ne=W.stride|0;P.command(ne>=0&&ne<256,'invalid stride for attribute "'+U+'", must be integer betweeen [0, 255]',O.commandStr);var ue=W.size|0;P.command(!("size"in W)||ue>0&&ue<=4,'invalid size for attribute "'+U+'", must be 1,2,3,4',O.commandStr);var ye=!!W.normalized,ve=0;"type"in W&&(P.commandParameter(W.type,Ki,"invalid type for attribute "+U,O.commandStr),ve=Ki[W.type]);var Se=W.divisor|0;"divisor"in W&&(P.command(Se===0||Re,'cannot specify divisor for attribute "'+U+'", instancing not supported',O.commandStr),P.command(Se>=0,'invalid divisor for attribute "'+U+'"',O.commandStr)),P.optional(function(){var Ke=O.commandStr,_t=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(W).forEach(function(We){P.command(_t.indexOf(We)>=0,'unknown parameter "'+We+'" for attribute pointer "'+U+'" (valid parameters are '+_t+")",Ke)})}),F.buffer=z,F.state=$o,F.size=ue,F.normalized=ye,F.type=ve||z.dtype,F.offset=V,F.stride=ne,F.divisor=Se}}ee[U]=hr(function(Ke,_t){var We=Ke.attribCache;if(j in We)return We[j];var ot={isStream:!1};return Object.keys(F).forEach(function(ft){ot[ft]=F[ft]}),F.buffer&&(ot.buffer=Ke.link(F.buffer),ot.type=ot.type||ot.buffer+".dtype"),We[j]=ot,ot})}),Object.keys(J).forEach(function(U){var W=J[U];function j(F,z){var M=F.invoke(z,W),V=F.shared,ne=F.constants,ue=V.isBufferArgs,ye=V.buffer;P.optional(function(){F.assert(z,M+"&&(typeof "+M+'==="object"||typeof '+M+'==="function")&&('+ue+"("+M+")||"+ye+".getBuffer("+M+")||"+ye+".getBuffer("+M+".buffer)||"+ue+"("+M+'.buffer)||("constant" in '+M+"&&(typeof "+M+'.constant==="number"||'+V.isArrayLike+"("+M+".constant))))",'invalid dynamic attribute "'+U+'"')});var ve={isStream:z.def(!1)},Se=new Y;Se.state=$o,Object.keys(Se).forEach(function(ot){ve[ot]=z.def(""+Se[ot])});var Ke=ve.buffer,_t=ve.type;z("if(",ue,"(",M,")){",ve.isStream,"=true;",Ke,"=",ye,".createStream(",qo,",",M,");",_t,"=",Ke,".dtype;","}else{",Ke,"=",ye,".getBuffer(",M,");","if(",Ke,"){",_t,"=",Ke,".dtype;",'}else if("constant" in ',M,"){",ve.state,"=",xf,";","if(typeof "+M+'.constant === "number"){',ve[Go[0]],"=",M,".constant;",Go.slice(1).map(function(ot){return ve[ot]}).join("="),"=0;","}else{",Go.map(function(ot,ft){return ve[ot]+"="+M+".constant.length>"+ft+"?"+M+".constant["+ft+"]:0;"}).join(""),"}}else{","if(",ue,"(",M,".buffer)){",Ke,"=",ye,".createStream(",qo,",",M,".buffer);","}else{",Ke,"=",ye,".getBuffer(",M,".buffer);","}",_t,'="type" in ',M,"?",ne.glTypes,"[",M,".type]:",Ke,".dtype;",ve.normalized,"=!!",M,".normalized;");function We(ot){z(ve[ot],"=",M,".",ot,"|0;")}return We("size"),We("offset"),We("stride"),We("divisor"),z("}}"),z.exit("if(",ve.isStream,"){",ye,".destroyStream(",Ke,");","}"),ve}ee[U]=sn(W,j)}),ee}function mr(S,O){var w=S.static,J=S.dynamic;if(os in w){var ee=w[os];return ee!==null&&De.getVAO(ee)===null&&(ee=De.createVAO(ee)),hr(function(W){return W.link(De.getVAO(ee))})}else if(os in J){var U=J[os];return sn(U,function(W,j){var F=W.invoke(j,U);return j.def(W.shared.vao+".getVAO("+F+")")})}return null}function qt(S){var O=S.static,w=S.dynamic,J={};return Object.keys(O).forEach(function(ee){var U=O[ee];J[ee]=hr(function(W,j){return typeof U=="number"||typeof U=="boolean"?""+U:W.link(U)})}),Object.keys(w).forEach(function(ee){var U=w[ee];J[ee]=sn(U,function(W,j){return W.invoke(j,U)})}),J}function pr(S,O,w,J,ee){var U=S.static,W=S.dynamic;P.optional(function(){var We=[ro,ns,is,no,io,Zu,oo,qu,rs,os].concat(be);function ot(ft){Object.keys(ft).forEach(function(wt){P.command(We.indexOf(wt)>=0,'unknown parameter "'+wt+'"',ee.commandStr)})}ot(U),ot(W)});var j=ct(S,O),F=Ze(S),z=At(S,F,ee),M=Ft(S,ee),V=dr(S,ee),ne=vt(S,ee,j);function ue(We){var ot=z[We];ot&&(V[We]=ot)}ue(ci),ue(we(Yu));var ye=Object.keys(V).length>0,ve={framebuffer:F,draw:M,shader:ne,state:V,dirty:ye,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(ve.profile=Mt(S),ve.uniforms=xr(w,ee),ve.drawVAO=ve.scopeVAO=mr(S),!ve.drawVAO&&ne.program&&!j&&L.angle_instanced_arrays){var Se=!0,Ke=ne.program.attributes.map(function(We){var ot=O.static[We];return Se=Se&&!!ot,ot});if(Se&&Ke.length>0){var _t=De.getVAO(De.createVAO(Ke));ve.drawVAO=new En(null,null,null,function(We,ot){return We.link(_t)}),ve.useVAO=!0}}return j?ve.useVAO=!0:ve.attributes=xt(O,ee),ve.context=qt(J),ve}function gr(S,O,w){var J=S.shared,ee=J.context,U=S.scope();Object.keys(w).forEach(function(W){O.save(ee,"."+W);var j=w[W];U(ee,".",W,"=",j.append(S,O),";")}),O(U)}function Er(S,O,w,J){var ee=S.shared,U=ee.gl,W=ee.framebuffer,j;Le&&(j=O.def(ee.extensions,".webgl_draw_buffers"));var F=S.constants,z=F.drawBuffer,M=F.backBuffer,V;w?V=w.append(S,O):V=O.def(W,".next"),J||O("if(",V,"!==",W,".cur){"),O("if(",V,"){",U,".bindFramebuffer(",n0,",",V,".framebuffer);"),Le&&O(j,".drawBuffersWEBGL(",z,"[",V,".colorAttachments.length]);"),O("}else{",U,".bindFramebuffer(",n0,",null);"),Le&&O(j,".drawBuffersWEBGL(",M,");"),O("}",W,".cur=",V,";"),J||O("}")}function Pr(S,O,w){var J=S.shared,ee=J.gl,U=S.current,W=S.next,j=J.current,F=J.next,z=S.cond(j,".dirty");be.forEach(function(M){var V=we(M);if(!(V in w.state)){var ne,ue;if(V in W){ne=W[V],ue=U[V];var ye=Qr(me[V].length,function(Se){return z.def(ne,"[",Se,"]")});z(S.cond(ye.map(function(Se,Ke){return Se+"!=="+ue+"["+Ke+"]"}).join("||")).then(ee,".",ge[V],"(",ye,");",ye.map(function(Se,Ke){return ue+"["+Ke+"]="+Se}).join(";"),";"))}else{ne=z.def(F,".",V);var ve=S.cond(ne,"!==",j,".",V);z(ve),V in ke?ve(S.cond(ne).then(ee,".enable(",ke[V],");").else(ee,".disable(",ke[V],");"),j,".",V,"=",ne,";"):ve(ee,".",ge[V],"(",ne,");",j,".",V,"=",ne,";")}}}),Object.keys(w.state).length===0&&z(j,".dirty=false;"),O(z)}function Vr(S,O,w,J){var ee=S.shared,U=S.current,W=ee.current,j=ee.gl;a0(Object.keys(w)).forEach(function(F){var z=w[F];if(!(J&&!J(z))){var M=z.append(S,O);if(ke[F]){var V=ke[F];Mi(z)?M?O(j,".enable(",V,");"):O(j,".disable(",V,");"):O(S.cond(M).then(j,".enable(",V,");").else(j,".disable(",V,");")),O(W,".",F,"=",M,";")}else if(ur(M)){var ne=U[F];O(j,".",ge[F],"(",M,");",M.map(function(ue,ye){return ne+"["+ye+"]="+ue}).join(";"),";")}else O(j,".",ge[F],"(",M,");",W,".",F,"=",M,";")}})}function yr(S,O){Re&&(S.instancing=O.def(S.shared.extensions,".angle_instanced_arrays"))}function pt(S,O,w,J,ee){var U=S.shared,W=S.stats,j=U.current,F=U.timer,z=w.profile;function M(){return typeof performance>"u"?"Date.now()":"performance.now()"}var V,ne;function ue(We){V=O.def(),We(V,"=",M(),";"),typeof ee=="string"?We(W,".count+=",ee,";"):We(W,".count++;"),Ae&&(J?(ne=O.def(),We(ne,"=",F,".getNumPendingQueries();")):We(F,".beginQuery(",W,");"))}function ye(We){We(W,".cpuTime+=",M(),"-",V,";"),Ae&&(J?We(F,".pushScopeStats(",ne,",",F,".getNumPendingQueries(),",W,");"):We(F,".endQuery();"))}function ve(We){var ot=O.def(j,".profile");O(j,".profile=",We,";"),O.exit(j,".profile=",ot,";")}var Se;if(z){if(Mi(z)){z.enable?(ue(O),ye(O.exit),ve("true")):ve("false");return}Se=z.append(S,O),ve(Se)}else Se=O.def(j,".profile");var Ke=S.block();ue(Ke),O("if(",Se,"){",Ke,"}");var _t=S.block();ye(_t),O.exit("if(",Se,"){",_t,"}")}function Ur(S,O,w,J,ee){var U=S.shared;function W(F){switch(F){case Ku:case el:case nl:return 2;case Qu:case tl:case il:return 3;case Ju:case rl:case ol:return 4;default:return 1}}function j(F,z,M){var V=U.gl,ne=O.def(F,".location"),ue=O.def(U.attributes,"[",ne,"]"),ye=M.state,ve=M.buffer,Se=[M.x,M.y,M.z,M.w],Ke=["buffer","normalized","offset","stride"];function _t(){O("if(!",ue,".buffer){",V,".enableVertexAttribArray(",ne,");}");var ot=M.type,ft;if(M.size?ft=O.def(M.size,"||",z):ft=z,O("if(",ue,".type!==",ot,"||",ue,".size!==",ft,"||",Ke.map(function(_r){return ue+"."+_r+"!=="+M[_r]}).join("||"),"){",V,".bindBuffer(",qo,",",ve,".buffer);",V,".vertexAttribPointer(",[ne,ft,ot,M.normalized,M.stride,M.offset],");",ue,".type=",ot,";",ue,".size=",ft,";",Ke.map(function(_r){return ue+"."+_r+"="+M[_r]+";"}).join(""),"}"),Re){var wt=M.divisor;O("if(",ue,".divisor!==",wt,"){",S.instancing,".vertexAttribDivisorANGLE(",[ne,wt],");",ue,".divisor=",wt,";}")}}function We(){O("if(",ue,".buffer){",V,".disableVertexAttribArray(",ne,");",ue,".buffer=null;","}if(",Go.map(function(ot,ft){return ue+"."+ot+"!=="+Se[ft]}).join("||"),"){",V,".vertexAttrib4f(",ne,",",Se,");",Go.map(function(ot,ft){return ue+"."+ot+"="+Se[ft]+";"}).join(""),"}")}ye===$o?_t():ye===xf?We():(O("if(",ye,"===",$o,"){"),_t(),O("}else{"),We(),O("}"))}J.forEach(function(F){var z=F.name,M=w.attributes[z],V;if(M){if(!ee(M))return;V=M.append(S,O)}else{if(!ee(s0))return;var ne=S.scopeAttrib(z);P.optional(function(){S.assert(O,ne+".state","missing attribute "+z)}),V={},Object.keys(new Y).forEach(function(ue){V[ue]=O.def(ne,".",ue)})}j(S.link(F),W(F.info.type),V)})}function Lt(S,O,w,J,ee){for(var U=S.shared,W=U.gl,j,F=0;F<J.length;++F){var z=J[F],M=z.name,V=z.info.type,ne=w.uniforms[M],ue=S.link(z),ye=ue+".location",ve;if(ne){if(!ee(ne))continue;if(Mi(ne)){var Se=ne.value;if(P.command(Se!==null&&typeof Se<"u",'missing uniform "'+M+'"',S.commandStr),V===ls||V===cs){P.command(typeof Se=="function"&&(V===ls&&(Se._reglType==="texture2d"||Se._reglType==="framebuffer")||V===cs&&(Se._reglType==="textureCube"||Se._reglType==="framebufferCube")),"invalid texture for uniform "+M,S.commandStr);var Ke=S.link(Se._texture||Se.color[0]._texture);O(W,".uniform1i(",ye,",",Ke+".bind());"),O.exit(Ke,".unbind();")}else if(V===as||V===ss||V===us){P.optional(function(){P.command(ur(Se),"invalid matrix for uniform "+M,S.commandStr),P.command(V===as&&Se.length===4||V===ss&&Se.length===9||V===us&&Se.length===16,"invalid length for matrix uniform "+M,S.commandStr)});var _t=S.global.def("new Float32Array(["+Array.prototype.slice.call(Se)+"])"),We=2;V===ss?We=3:V===us&&(We=4),O(W,".uniformMatrix",We,"fv(",ye,",false,",_t,");")}else{switch(V){case Lf:P.commandType(Se,"number","uniform "+M,S.commandStr),j="1f";break;case Ku:P.command(ur(Se)&&Se.length===2,"uniform "+M,S.commandStr),j="2f";break;case Qu:P.command(ur(Se)&&Se.length===3,"uniform "+M,S.commandStr),j="3f";break;case Ju:P.command(ur(Se)&&Se.length===4,"uniform "+M,S.commandStr),j="4f";break;case kf:P.commandType(Se,"boolean","uniform "+M,S.commandStr),j="1i";break;case Uf:P.commandType(Se,"number","uniform "+M,S.commandStr),j="1i";break;case nl:P.command(ur(Se)&&Se.length===2,"uniform "+M,S.commandStr),j="2i";break;case el:P.command(ur(Se)&&Se.length===2,"uniform "+M,S.commandStr),j="2i";break;case il:P.command(ur(Se)&&Se.length===3,"uniform "+M,S.commandStr),j="3i";break;case tl:P.command(ur(Se)&&Se.length===3,"uniform "+M,S.commandStr),j="3i";break;case ol:P.command(ur(Se)&&Se.length===4,"uniform "+M,S.commandStr),j="4i";break;case rl:P.command(ur(Se)&&Se.length===4,"uniform "+M,S.commandStr),j="4i";break}O(W,".uniform",j,"(",ye,",",ur(Se)?Array.prototype.slice.call(Se):Se,");")}continue}else ve=ne.append(S,O)}else{if(!ee(s0))continue;ve=O.def(U.uniforms,"[",C.id(M),"]")}V===ls?O("if(",ve,"&&",ve,'._reglType==="framebuffer"){',ve,"=",ve,".color[0];","}"):V===cs&&O("if(",ve,"&&",ve,'._reglType==="framebufferCube"){',ve,"=",ve,".color[0];","}"),P.optional(function(){function Hn(fi,p0){S.assert(O,fi,'bad data or missing for uniform "'+M+'".  '+p0)}function Hf(fi){Hn("typeof "+ve+'==="'+fi+'"',"invalid type, expected "+fi)}function Mn(fi,p0){Hn(U.isArrayLike+"("+ve+")&&"+ve+".length==="+fi,"invalid vector, should have length "+fi,S.commandStr)}function d0(fi){Hn("typeof "+ve+'==="function"&&'+ve+'._reglType==="texture'+(fi===K_?"2d":"Cube")+'"',"invalid texture type",S.commandStr)}switch(V){case Uf:Hf("number");break;case el:Mn(2);break;case tl:Mn(3);break;case rl:Mn(4);break;case Lf:Hf("number");break;case Ku:Mn(2);break;case Qu:Mn(3);break;case Ju:Mn(4);break;case kf:Hf("boolean");break;case nl:Mn(2);break;case il:Mn(3);break;case ol:Mn(4);break;case as:Mn(4);break;case ss:Mn(9);break;case us:Mn(16);break;case ls:d0(K_);break;case cs:d0(NS);break}});var ot=1;switch(V){case ls:case cs:var ft=O.def(ve,"._texture");O(W,".uniform1i(",ye,",",ft,".bind());"),O.exit(ft,".unbind();");continue;case Uf:case kf:j="1i";break;case el:case nl:j="2i",ot=2;break;case tl:case il:j="3i",ot=3;break;case rl:case ol:j="4i",ot=4;break;case Lf:j="1f";break;case Ku:j="2f",ot=2;break;case Qu:j="3f",ot=3;break;case Ju:j="4f",ot=4;break;case as:j="Matrix2fv";break;case ss:j="Matrix3fv";break;case us:j="Matrix4fv";break}if(O(W,".uniform",j,"(",ye,","),j.charAt(0)==="M"){var wt=Math.pow(V-as+2,2),_r=S.global.def("new Float32Array(",wt,")");O("false,(Array.isArray(",ve,")||",ve," instanceof Float32Array)?",ve,":(",Qr(wt,function(Hn){return _r+"["+Hn+"]="+ve+"["+Hn+"]"}),",",_r,")")}else ot>1?O(Qr(ot,function(Hn){return ve+"["+Hn+"]"})):O(ve);O(");")}}function it(S,O,w,J){var ee=S.shared,U=ee.gl,W=ee.draw,j=J.draw;function F(){var ft=j.elements,wt,_r=O;return ft?((ft.contextDep&&J.contextDynamic||ft.propDep)&&(_r=w),wt=ft.append(S,_r)):wt=_r.def(W,".",no),wt&&_r("if("+wt+")"+U+".bindBuffer("+IS+","+wt+".buffer.buffer);"),wt}function z(){var ft=j.count,wt,_r=O;return ft?((ft.contextDep&&J.contextDynamic||ft.propDep)&&(_r=w),wt=ft.append(S,_r),P.optional(function(){ft.MISSING&&S.assert(O,"false","missing vertex count"),ft.DYNAMIC&&S.assert(_r,wt+">=0","missing vertex count")})):(wt=_r.def(W,".",oo),P.optional(function(){S.assert(_r,wt+">=0","missing vertex count")})),wt}var M=F();function V(ft){var wt=j[ft];return wt?wt.contextDep&&J.contextDynamic||wt.propDep?wt.append(S,w):wt.append(S,O):O.def(W,".",ft)}var ne=V(io),ue=V(Zu),ye=z();if(typeof ye=="number"){if(ye===0)return}else w("if(",ye,"){"),w.exit("}");var ve,Se;Re&&(ve=V(qu),Se=S.instancing);var Ke=M+".type",_t=j.elements&&Mi(j.elements);function We(){function ft(){w(Se,".drawElementsInstancedANGLE(",[ne,ye,Ke,ue+"<<(("+Ke+"-"+M_+")>>1)",ve],");")}function wt(){w(Se,".drawArraysInstancedANGLE(",[ne,ue,ye,ve],");")}M?_t?ft():(w("if(",M,"){"),ft(),w("}else{"),wt(),w("}")):wt()}function ot(){function ft(){w(U+".drawElements("+[ne,ye,Ke,ue+"<<(("+Ke+"-"+M_+")>>1)"]+");")}function wt(){w(U+".drawArrays("+[ne,ue,ye]+");")}M?_t?ft():(w("if(",M,"){"),ft(),w("}else{"),wt(),w("}")):wt()}Re&&(typeof ve!="number"||ve>=0)?typeof ve=="string"?(w("if(",ve,">0){"),We(),w("}else if(",ve,"<0){"),ot(),w("}")):We():ot()}function St(S,O,w,J,ee){var U=ut(),W=U.proc("body",ee);return P.optional(function(){U.commandStr=O.commandStr,U.command=U.link(O.commandStr)}),Re&&(U.instancing=W.def(U.shared.extensions,".angle_instanced_arrays")),S(U,W,w,J),U.compile().body}function Nt(S,O,w,J){yr(S,O),w.useVAO?w.drawVAO?O(S.shared.vao,".setVAO(",w.drawVAO.append(S,O),");"):O(S.shared.vao,".setVAO(",S.shared.vao,".targetVAO);"):(O(S.shared.vao,".setVAO(null);"),Ur(S,O,w,J.attributes,function(){return!0})),Lt(S,O,w,J.uniforms,function(){return!0}),it(S,O,O,w)}function lr(S,O){var w=S.proc("draw",1);yr(S,w),gr(S,w,O.context),Er(S,w,O.framebuffer),Pr(S,w,O),Vr(S,w,O.state),pt(S,w,O,!1,!0);var J=O.shader.progVar.append(S,w);if(w(S.shared.gl,".useProgram(",J,".program);"),O.shader.program)Nt(S,w,O,O.shader.program);else{w(S.shared.vao,".setVAO(null);");var ee=S.global.def("{}"),U=w.def(J,".id"),W=w.def(ee,"[",U,"]");w(S.cond(W).then(W,".call(this,a0);").else(W,"=",ee,"[",U,"]=",S.link(function(j){return St(Nt,S,O,j,1)}),"(",J,");",W,".call(this,a0);"))}Object.keys(O.state).length>0&&w(S.shared.current,".dirty=true;")}function Qn(S,O,w,J){S.batchId="a1",yr(S,O);function ee(){return!0}Ur(S,O,w,J.attributes,ee),Lt(S,O,w,J.uniforms,ee),it(S,O,O,w)}function N(S,O,w,J){yr(S,O);var ee=w.contextDep,U=O.def(),W="a0",j="a1",F=O.def();S.shared.props=F,S.batchId=U;var z=S.scope(),M=S.scope();O(z.entry,"for(",U,"=0;",U,"<",j,";++",U,"){",F,"=",W,"[",U,"];",M,"}",z.exit);function V(Ke){return Ke.contextDep&&ee||Ke.propDep}function ne(Ke){return!V(Ke)}if(w.needsContext&&gr(S,M,w.context),w.needsFramebuffer&&Er(S,M,w.framebuffer),Vr(S,M,w.state,V),w.profile&&V(w.profile)&&pt(S,M,w,!1,!0),J)w.useVAO?w.drawVAO?V(w.drawVAO)?M(S.shared.vao,".setVAO(",w.drawVAO.append(S,M),");"):z(S.shared.vao,".setVAO(",w.drawVAO.append(S,z),");"):z(S.shared.vao,".setVAO(",S.shared.vao,".targetVAO);"):(z(S.shared.vao,".setVAO(null);"),Ur(S,z,w,J.attributes,ne),Ur(S,M,w,J.attributes,V)),Lt(S,z,w,J.uniforms,ne),Lt(S,M,w,J.uniforms,V),it(S,z,M,w);else{var ue=S.global.def("{}"),ye=w.shader.progVar.append(S,M),ve=M.def(ye,".id"),Se=M.def(ue,"[",ve,"]");M(S.shared.gl,".useProgram(",ye,".program);","if(!",Se,"){",Se,"=",ue,"[",ve,"]=",S.link(function(Ke){return St(Qn,S,w,Ke,2)}),"(",ye,");}",Se,".call(this,a0[",U,"],",U,");")}}function ie(S,O){var w=S.proc("batch",2);S.batchId="0",yr(S,w);var J=!1,ee=!0;Object.keys(O.context).forEach(function(ue){J=J||O.context[ue].propDep}),J||(gr(S,w,O.context),ee=!1);var U=O.framebuffer,W=!1;U?(U.propDep?J=W=!0:U.contextDep&&J&&(W=!0),W||Er(S,w,U)):Er(S,w,null),O.state.viewport&&O.state.viewport.propDep&&(J=!0);function j(ue){return ue.contextDep&&J||ue.propDep}Pr(S,w,O),Vr(S,w,O.state,function(ue){return!j(ue)}),(!O.profile||!j(O.profile))&&pt(S,w,O,!1,"a1"),O.contextDep=J,O.needsContext=ee,O.needsFramebuffer=W;var F=O.shader.progVar;if(F.contextDep&&J||F.propDep)N(S,w,O,null);else{var z=F.append(S,w);if(w(S.shared.gl,".useProgram(",z,".program);"),O.shader.program)N(S,w,O,O.shader.program);else{w(S.shared.vao,".setVAO(null);");var M=S.global.def("{}"),V=w.def(z,".id"),ne=w.def(M,"[",V,"]");w(S.cond(ne).then(ne,".call(this,a0,a1);").else(ne,"=",M,"[",V,"]=",S.link(function(ue){return St(N,S,O,ue,2)}),"(",z,");",ne,".call(this,a0,a1);"))}}Object.keys(O.state).length>0&&w(S.shared.current,".dirty=true;")}function Q(S,O){var w=S.proc("scope",3);S.batchId="a2";var J=S.shared,ee=J.current;gr(S,w,O.context),O.framebuffer&&O.framebuffer.append(S,w),a0(Object.keys(O.state)).forEach(function(W){var j=O.state[W],F=j.append(S,w);ur(F)?F.forEach(function(z,M){w.set(S.next[W],"["+M+"]",z)}):w.set(J.next,"."+W,F)}),pt(S,w,O,!0,!0),[no,Zu,oo,qu,io].forEach(function(W){var j=O.draw[W];!j||w.set(J.draw,"."+W,""+j.append(S,w))}),Object.keys(O.uniforms).forEach(function(W){w.set(J.uniforms,"["+C.id(W)+"]",O.uniforms[W].append(S,w))}),Object.keys(O.attributes).forEach(function(W){var j=O.attributes[W].append(S,w),F=S.scopeAttrib(W);Object.keys(new Y).forEach(function(z){w.set(F,"."+z,j[z])})}),O.scopeVAO&&w.set(J.vao,".targetVAO",O.scopeVAO.append(S,w));function U(W){var j=O.shader[W];j&&w.set(J.shader,"."+W,j.append(S,w))}U(ns),U(is),Object.keys(O.state).length>0&&(w(ee,".dirty=true;"),w.exit(ee,".dirty=true;")),w("a1(",S.shared.context,",a0,",S.batchId,");")}function Xe(S){if(!(typeof S!="object"||ur(S))){for(var O=Object.keys(S),w=0;w<O.length;++w)if(wr.isDynamic(S[O[w]]))return!0;return!1}}function Tt(S,O,w){var J=O.static[w];if(!J||!Xe(J))return;var ee=S.global,U=Object.keys(J),W=!1,j=!1,F=!1,z=S.global.def("{}");U.forEach(function(V){var ne=J[V];if(wr.isDynamic(ne)){typeof ne=="function"&&(ne=J[V]=wr.unbox(ne));var ue=sn(ne,null);W=W||ue.thisDep,F=F||ue.propDep,j=j||ue.contextDep}else{switch(ee(z,".",V,"="),typeof ne){case"number":ee(ne);break;case"string":ee('"',ne,'"');break;case"object":Array.isArray(ne)&&ee("[",ne.join(),"]");break;default:ee(S.link(ne));break}ee(";")}});function M(V,ne){U.forEach(function(ue){var ye=J[ue];if(!!wr.isDynamic(ye)){var ve=V.invoke(ne,ye);ne(z,".",ue,"=",ve,";")}})}O.dynamic[w]=new wr.DynamicVariable(Rf,{thisDep:W,contextDep:j,propDep:F,ref:z,append:M}),delete O.static[w]}function Yt(S,O,w,J,ee){var U=ut();U.stats=U.link(ee),Object.keys(O.static).forEach(function(j){Tt(U,O,j)}),MS.forEach(function(j){Tt(U,S,j)});var W=pr(S,O,w,J,U);return lr(U,W),Q(U,W),ie(U,W),U.compile()}return{next:He,current:me,procs:function(){var S=ut(),O=S.proc("poll"),w=S.proc("refresh"),J=S.block();O(J),w(J);var ee=S.shared,U=ee.gl,W=ee.next,j=ee.current;J(j,".dirty=false;"),Er(S,O),Er(S,w,null,!0);var F;Re&&(F=S.link(Re)),L.oes_vertex_array_object&&w(S.link(L.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var z=0;z<te.maxAttributes;++z){var M=w.def(ee.attributes,"[",z,"]"),V=S.cond(M,".buffer");V.then(U,".enableVertexAttribArray(",z,");",U,".bindBuffer(",qo,",",M,".buffer.buffer);",U,".vertexAttribPointer(",z,",",M,".size,",M,".type,",M,".normalized,",M,".stride,",M,".offset);").else(U,".disableVertexAttribArray(",z,");",U,".vertexAttrib4f(",z,",",M,".x,",M,".y,",M,".z,",M,".w);",M,".buffer=null;"),w(V),Re&&w(F,".vertexAttribDivisorANGLE(",z,",",M,".divisor);")}return w(S.shared.vao,".currentVAO=null;",S.shared.vao,".setVAO(",S.shared.vao,".targetVAO);"),Object.keys(ke).forEach(function(ne){var ue=ke[ne],ye=J.def(W,".",ne),ve=S.block();ve("if(",ye,"){",U,".enable(",ue,")}else{",U,".disable(",ue,")}",j,".",ne,"=",ye,";"),w(ve),O("if(",ye,"!==",j,".",ne,"){",ve,"}")}),Object.keys(ge).forEach(function(ne){var ue=ge[ne],ye=me[ne],ve,Se,Ke=S.block();if(Ke(U,".",ue,"("),ur(ye)){var _t=ye.length;ve=S.global.def(W,".",ne),Se=S.global.def(j,".",ne),Ke(Qr(_t,function(We){return ve+"["+We+"]"}),");",Qr(_t,function(We){return Se+"["+We+"]="+ve+"["+We+"];"}).join("")),O("if(",Qr(_t,function(We){return ve+"["+We+"]!=="+Se+"["+We+"]"}).join("||"),"){",Ke,"}")}else ve=J.def(W,".",ne),Se=J.def(j,".",ne),Ke(ve,");",j,".",ne,"=",ve,";"),O("if(",ve,"!==",Se,"){",Ke,"}");w(Ke)}),S.compile()}(),compile:Yt}}function YS(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var ZS=34918,qS=34919,u0=35007,KS=function(_,C){if(!C.ext_disjoint_timer_query)return null;var L=[];function te(){return L.pop()||C.ext_disjoint_timer_query.createQueryEXT()}function fe(Re){L.push(Re)}var re=[];function ae(Re){var Le=te();C.ext_disjoint_timer_query.beginQueryEXT(u0,Le),re.push(Le),Ae(re.length-1,re.length,Re)}function xe(){C.ext_disjoint_timer_query.endQueryEXT(u0)}function Ce(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var De=[];function Ie(){return De.pop()||new Ce}function Oe(Re){De.push(Re)}var Be=[];function Ae(Re,Le,me){var He=Ie();He.startQueryIndex=Re,He.endQueryIndex=Le,He.sum=0,He.stats=me,Be.push(He)}var Pe=[],Y=[];function oe(){var Re,Le,me=re.length;if(me!==0){Y.length=Math.max(Y.length,me+1),Pe.length=Math.max(Pe.length,me+1),Pe[0]=0,Y[0]=0;var He=0;for(Re=0,Le=0;Le<re.length;++Le){var be=re[Le];C.ext_disjoint_timer_query.getQueryObjectEXT(be,qS)?(He+=C.ext_disjoint_timer_query.getQueryObjectEXT(be,ZS),fe(be)):re[Re++]=be,Pe[Le+1]=He,Y[Le+1]=Re}for(re.length=Re,Re=0,Le=0;Le<Be.length;++Le){var ke=Be[Le],ge=ke.startQueryIndex,we=ke.endQueryIndex;ke.sum+=Pe[we]-Pe[ge];var tt=Y[ge],st=Y[we];st===tt?(ke.stats.gpuTime+=ke.sum/1e6,Oe(ke)):(ke.startQueryIndex=tt,ke.endQueryIndex=st,Be[Re++]=ke)}Be.length=Re}}return{beginQuery:ae,endQuery:xe,pushScopeStats:Ae,update:oe,getNumPendingQueries:function(){return re.length},clear:function(){L.push.apply(L,re);for(var Re=0;Re<L.length;Re++)C.ext_disjoint_timer_query.deleteQueryEXT(L[Re]);re.length=0,L.length=0},restore:function(){re.length=0,L.length=0}}},QS=16384,JS=256,ex=1024,tx=34962,l0="webglcontextlost",c0="webglcontextrestored",f0=1,rx=2,nx=3;function h0(_,C){for(var L=0;L<_.length;++L)if(_[L]===C)return L;return-1}function ix(_){var C=Wa(_);if(!C)return null;var L=C.gl,te=L.getContextAttributes(),fe=L.isContextLost(),re=Hc(L,C);if(!re)return null;var ae=Va(),xe=YS(),Ce=re.extensions,De=KS(L,Ce),Ie=Ai(),Oe=L.drawingBufferWidth,Be=L.drawingBufferHeight,Ae={tick:0,time:0,viewportWidth:Oe,viewportHeight:Be,framebufferWidth:Oe,framebufferHeight:Be,drawingBufferWidth:Oe,drawingBufferHeight:Be,pixelRatio:C.pixelRatio},Pe={},Y={elements:null,primitive:4,count:-1,offset:0,instances:-1},oe=Jc(L,Ce),Re=oT(L,xe,C,me),Le=mS(L,Ce,oe,xe,Re);function me(it){return Le.destroyBuffer(it)}var He=mT(L,Ce,Re,xe),be=AS(L,ae,xe,C),ke=YT(L,Ce,oe,function(){tt.procs.poll()},Ae,xe,C),ge=ZT(L,Ce,oe,xe,C),we=_S(L,Ce,oe,ke,ge,xe),tt=$S(L,ae,Ce,oe,Re,He,ke,we,Pe,Le,be,Y,Ae,De,C),st=xS(L,we,tt.procs.poll,Ae,te,Ce,oe),Ue=tt.next,Me=L.canvas,_e=[],ut=[],Mt=[],Ze=[C.onDestroy],At=null;function ct(){if(_e.length===0){De&&De.update(),At=null;return}At=$i.next(ct),Vr();for(var it=_e.length-1;it>=0;--it){var St=_e[it];St&&St(Ae,null,0)}L.flush(),De&&De.update()}function vt(){!At&&_e.length>0&&(At=$i.next(ct))}function Ft(){At&&($i.cancel(ct),At=null)}function dr(it){it.preventDefault(),fe=!0,Ft(),ut.forEach(function(St){St()})}function xr(it){L.getError(),fe=!1,re.restore(),be.restore(),Re.restore(),ke.restore(),ge.restore(),we.restore(),Le.restore(),De&&De.restore(),tt.procs.refresh(),vt(),Mt.forEach(function(St){St()})}Me&&(Me.addEventListener(l0,dr,!1),Me.addEventListener(c0,xr,!1));function xt(){_e.length=0,Ft(),Me&&(Me.removeEventListener(l0,dr),Me.removeEventListener(c0,xr)),be.clear(),we.clear(),ge.clear(),ke.clear(),He.clear(),Re.clear(),Le.clear(),De&&De.clear(),Ze.forEach(function(it){it()})}function mr(it){P(!!it,"invalid args to regl({...})"),P.type(it,"object","invalid args to regl({...})");function St(ee){var U=n({},ee);delete U.uniforms,delete U.attributes,delete U.context,delete U.vao,"stencil"in U&&U.stencil.op&&(U.stencil.opBack=U.stencil.opFront=U.stencil.op,delete U.stencil.op);function W(j){if(j in U){var F=U[j];delete U[j],Object.keys(F).forEach(function(z){U[j+"."+z]=F[z]})}}return W("blend"),W("depth"),W("cull"),W("stencil"),W("polygonOffset"),W("scissor"),W("sample"),"vao"in ee&&(U.vao=ee.vao),U}function Nt(ee){var U={},W={};return Object.keys(ee).forEach(function(j){var F=ee[j];wr.isDynamic(F)?W[j]=wr.unbox(F,j):U[j]=F}),{dynamic:W,static:U}}var lr=Nt(it.context||{}),Qn=Nt(it.uniforms||{}),N=Nt(it.attributes||{}),ie=Nt(St(it)),Q={gpuTime:0,cpuTime:0,count:0},Xe=tt.compile(ie,N,Qn,lr,Q),Tt=Xe.draw,Yt=Xe.batch,S=Xe.scope,O=[];function w(ee){for(;O.length<ee;)O.push(null);return O}function J(ee,U){var W;if(fe&&P.raise("context lost"),typeof ee=="function")return S.call(this,null,ee,0);if(typeof U=="function")if(typeof ee=="number")for(W=0;W<ee;++W)S.call(this,null,U,W);else if(Array.isArray(ee))for(W=0;W<ee.length;++W)S.call(this,ee[W],U,W);else return S.call(this,ee,U,0);else if(typeof ee=="number"){if(ee>0)return Yt.call(this,w(ee|0),ee|0)}else if(Array.isArray(ee)){if(ee.length)return Yt.call(this,ee,ee.length)}else return Tt.call(this,ee)}return n(J,{stats:Q})}var qt=we.setFBO=mr({framebuffer:wr.define.call(null,f0,"framebuffer")});function pr(it,St){var Nt=0;tt.procs.poll();var lr=St.color;lr&&(L.clearColor(+lr[0]||0,+lr[1]||0,+lr[2]||0,+lr[3]||0),Nt|=QS),"depth"in St&&(L.clearDepth(+St.depth),Nt|=JS),"stencil"in St&&(L.clearStencil(St.stencil|0),Nt|=ex),P(!!Nt,"called regl.clear with no buffer specified"),L.clear(Nt)}function gr(it){if(P(typeof it=="object"&&it,"regl.clear() takes an object as input"),"framebuffer"in it)if(it.framebuffer&&it.framebuffer_reglType==="framebufferCube")for(var St=0;St<6;++St)qt(n({framebuffer:it.framebuffer.faces[St]},it),pr);else qt(it,pr);else pr(null,it)}function Er(it){P.type(it,"function","regl.frame() callback must be a function"),_e.push(it);function St(){var Nt=h0(_e,it);P(Nt>=0,"cannot cancel a frame twice");function lr(){var Qn=h0(_e,lr);_e[Qn]=_e[_e.length-1],_e.length-=1,_e.length<=0&&Ft()}_e[Nt]=lr}return vt(),{cancel:St}}function Pr(){var it=Ue.viewport,St=Ue.scissor_box;it[0]=it[1]=St[0]=St[1]=0,Ae.viewportWidth=Ae.framebufferWidth=Ae.drawingBufferWidth=it[2]=St[2]=L.drawingBufferWidth,Ae.viewportHeight=Ae.framebufferHeight=Ae.drawingBufferHeight=it[3]=St[3]=L.drawingBufferHeight}function Vr(){Ae.tick+=1,Ae.time=pt(),Pr(),tt.procs.poll()}function yr(){Pr(),tt.procs.refresh(),De&&De.update()}function pt(){return(Ai()-Ie)/1e3}yr();function Ur(it,St){P.type(St,"function","listener callback must be a function");var Nt;switch(it){case"frame":return Er(St);case"lost":Nt=ut;break;case"restore":Nt=Mt;break;case"destroy":Nt=Ze;break;default:P.raise("invalid event, must be one of frame,lost,restore,destroy")}return Nt.push(St),{cancel:function(){for(var lr=0;lr<Nt.length;++lr)if(Nt[lr]===St){Nt[lr]=Nt[Nt.length-1],Nt.pop();return}}}}var Lt=n(mr,{clear:gr,prop:wr.define.bind(null,f0),context:wr.define.bind(null,rx),this:wr.define.bind(null,nx),draw:mr({}),buffer:function(it){return Re.create(it,tx,!1,!1)},elements:function(it){return He.create(it,!1)},texture:ke.create2D,cube:ke.createCube,renderbuffer:ge.create,framebuffer:we.create,framebufferCube:we.createCube,vao:Le.createVAO,attributes:te,frame:Er,on:Ur,limits:oe,hasExtension:function(it){return oe.extensions.indexOf(it.toLowerCase())>=0},read:st,destroy:xt,_gl:L,_refresh:yr,poll:function(){Vr(),De&&De.update()},now:pt,stats:xe});return C.onDone(null,Lt),Lt}return ix})})($A);const Ik=$A.exports;var Ok=class{constructor(e,t){const{buffer:r,offset:n,stride:i,normalized:o,size:a,divisor:s}=t;this.buffer=r,this.attribute={buffer:r.get(),offset:n||0,stride:i||0,normalized:o||!1,divisor:s||0},a&&(this.attribute.size=a)}get(){return this.attribute}updateBuffer(e){this.buffer.subData(e)}destroy(){this.buffer.destroy()}},Pk={[g.POINTS]:"points",[g.LINES]:"lines",[g.LINE_LOOP]:"line loop",[g.LINE_STRIP]:"line strip",[g.TRIANGLES]:"triangles",[g.TRIANGLE_FAN]:"triangle fan",[g.TRIANGLE_STRIP]:"triangle strip"},YA={[g.STATIC_DRAW]:"static",[g.DYNAMIC_DRAW]:"dynamic",[g.STREAM_DRAW]:"stream"},Rp={[g.BYTE]:"int8",[g.INT]:"int32",[g.UNSIGNED_BYTE]:"uint8",[g.UNSIGNED_SHORT]:"uint16",[g.UNSIGNED_INT]:"uint32",[g.FLOAT]:"float"},Nk={[g.ALPHA]:"alpha",[g.LUMINANCE]:"luminance",[g.LUMINANCE_ALPHA]:"luminance alpha",[g.RGB]:"rgb",[g.RGBA]:"rgba",[g.RGBA4]:"rgba4",[g.RGB5_A1]:"rgb5 a1",[g.RGB565]:"rgb565",[g.DEPTH_COMPONENT]:"depth",[g.DEPTH_STENCIL]:"depth stencil"},Fk={[g.DONT_CARE]:"dont care",[g.NICEST]:"nice",[g.FASTEST]:"fast"},IE={[g.NEAREST]:"nearest",[g.LINEAR]:"linear",[g.LINEAR_MIPMAP_LINEAR]:"mipmap",[g.NEAREST_MIPMAP_LINEAR]:"nearest mipmap linear",[g.LINEAR_MIPMAP_NEAREST]:"linear mipmap nearest",[g.NEAREST_MIPMAP_NEAREST]:"nearest mipmap nearest"},OE={[g.REPEAT]:"repeat",[g.CLAMP_TO_EDGE]:"clamp",[g.MIRRORED_REPEAT]:"mirror"},Dk={[g.NONE]:"none",[g.BROWSER_DEFAULT_WEBGL]:"browser"},Bk={[g.NEVER]:"never",[g.ALWAYS]:"always",[g.LESS]:"less",[g.LEQUAL]:"lequal",[g.GREATER]:"greater",[g.GEQUAL]:"gequal",[g.EQUAL]:"equal",[g.NOTEQUAL]:"notequal"},PE={[g.FUNC_ADD]:"add",[g.MIN_EXT]:"min",[g.MAX_EXT]:"max",[g.FUNC_SUBTRACT]:"subtract",[g.FUNC_REVERSE_SUBTRACT]:"reverse subtract"},Il={[g.ZERO]:"zero",[g.ONE]:"one",[g.SRC_COLOR]:"src color",[g.ONE_MINUS_SRC_COLOR]:"one minus src color",[g.SRC_ALPHA]:"src alpha",[g.ONE_MINUS_SRC_ALPHA]:"one minus src alpha",[g.DST_COLOR]:"dst color",[g.ONE_MINUS_DST_COLOR]:"one minus dst color",[g.DST_ALPHA]:"dst alpha",[g.ONE_MINUS_DST_ALPHA]:"one minus dst alpha",[g.CONSTANT_COLOR]:"constant color",[g.ONE_MINUS_CONSTANT_COLOR]:"one minus constant color",[g.CONSTANT_ALPHA]:"constant alpha",[g.ONE_MINUS_CONSTANT_ALPHA]:"one minus constant alpha",[g.SRC_ALPHA_SATURATE]:"src alpha saturate"},wk={[g.NEVER]:"never",[g.ALWAYS]:"always",[g.LESS]:"less",[g.LEQUAL]:"lequal",[g.GREATER]:"greater",[g.GEQUAL]:"gequal",[g.EQUAL]:"equal",[g.NOTEQUAL]:"notequal"},la={[g.ZERO]:"zero",[g.KEEP]:"keep",[g.REPLACE]:"replace",[g.INVERT]:"invert",[g.INCR]:"increment",[g.DECR]:"decrement",[g.INCR_WRAP]:"increment wrap",[g.DECR_WRAP]:"decrement wrap"},Lk={[g.FRONT]:"front",[g.BACK]:"back"},Uk=class{constructor(e,t){this.isDestroyed=!1;const{data:r,usage:n,type:i}=t;this.buffer=e.buffer({data:r,usage:YA[n||g.STATIC_DRAW],type:Rp[i||g.UNSIGNED_BYTE]})}get(){return this.buffer}destroy(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}subData({data:e,offset:t}){this.buffer.subdata(e,t)}},kk=class{constructor(e,t){const{data:r,usage:n,type:i,count:o}=t;this.elements=e.elements({data:r,usage:YA[n||g.STATIC_DRAW],type:Rp[i||g.UNSIGNED_BYTE],count:o})}get(){return this.elements}subData({data:e}){this.elements.subdata(e)}destroy(){}},zk=class{constructor(e,t){const{width:r,height:n,color:i,colors:o}=t,a={width:r,height:n};Array.isArray(o)&&(a.colors=o.map(s=>s.get())),i&&typeof i!="boolean"&&(a.color=i.get()),this.framebuffer=e.framebuffer(a)}get(){return this.framebuffer}destroy(){this.framebuffer.destroy()}resize({width:e,height:t}){this.framebuffer.resize(e,t)}},Vk=Object.defineProperty,Hk=Object.defineProperties,Xk=Object.getOwnPropertyDescriptors,NE=Object.getOwnPropertySymbols,Wk=Object.prototype.hasOwnProperty,jk=Object.prototype.propertyIsEnumerable,FE=(e,t,r)=>t in e?Vk(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Fs=(e,t)=>{for(var r in t||(t={}))Wk.call(t,r)&&FE(e,r,t[r]);if(NE)for(var r of NE(t))jk.call(t,r)&&FE(e,r,t[r]);return e},Gk=(e,t)=>Hk(e,Xk(t)),{isPlainObject:$k,isTypedArray:Yk}=Ar,Zk=class{constructor(e,t){this.destroyed=!1,this.uniforms={},this.reGl=e;const{vs:r,fs:n,attributes:i,uniforms:o,primitive:a,count:s,elements:u,depth:l,cull:f,instances:c}=t,h={platformString:"WebGL1",glslVersion:"#version 100",explicitBindingLocations:!1,separateSamplerTextures:!1,viewportOrigin:ni.LOWER_LEFT,clipSpaceNearZ:Na.NEGATIVE_ONE,supportMRT:!1},d={};this.options=t,o&&(this.uniforms=this.extractUniforms(o),Object.keys(o).forEach(A=>{d[A]=e.prop(A)}));const p={};Object.keys(i).forEach(A=>{p[A]=i[A].get()});const v=Ov(wa(h,"frag",n,null,!1)),m=Ov(wa(h,"vert",r,null,!1)),y={attributes:p,frag:v,uniforms:d,vert:m,colorMask:e.prop("colorMask"),lineWidth:1,blend:{enable:e.prop("blend.enable"),func:e.prop("blend.func"),equation:e.prop("blend.equation"),color:e.prop("blend.color")},stencil:{enable:e.prop("stencil.enable"),mask:e.prop("stencil.mask"),func:e.prop("stencil.func"),opFront:e.prop("stencil.opFront"),opBack:e.prop("stencil.opBack")},primitive:Pk[a===void 0?g.TRIANGLES:a]};c&&(y.instances=c),s?y.count=s:u&&(y.elements=u.get()),this.initDepthDrawParams({depth:l},y),this.initCullDrawParams({cull:f},y),this.drawCommand=e(y),this.drawParams=y}updateAttributesAndElements(e,t){const r={};Object.keys(e).forEach(n=>{r[n]=e[n].get()}),this.drawParams.attributes=r,this.drawParams.elements=t.get(),this.drawCommand=this.reGl(this.drawParams)}updateAttributes(e){const t={};Object.keys(e).forEach(r=>{t[r]=e[r].get()}),this.drawParams.attributes=t,this.drawCommand=this.reGl(this.drawParams)}addUniforms(e){this.uniforms=Fs(Fs({},this.uniforms),this.extractUniforms(e))}draw(e,t){if(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)return;const r=Fs(Fs({},this.uniforms),this.extractUniforms(e.uniforms||{})),n={};Object.keys(r).forEach(i=>{const o=typeof r[i];o==="boolean"||o==="number"||Array.isArray(r[i])||r[i].BYTES_PER_ELEMENT?n[i]=r[i]:n[i]=r[i].get()}),n.blend=t?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(e),n.stencil=this.getStencilDrawParams(e),n.colorMask=this.getColorMaskDrawParams(e,t),this.drawCommand(n)}destroy(){var e,t;(t=(e=this.drawParams)==null?void 0:e.elements)==null||t.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(r=>{r==null||r.destroy()}),this.destroyed=!0}initDepthDrawParams({depth:e},t){e&&(t.depth={enable:e.enable===void 0?!0:!!e.enable,mask:e.mask===void 0?!0:!!e.mask,func:Bk[e.func||g.LESS],range:e.range||[0,1]})}getBlendDrawParams({blend:e}){const{enable:t,func:r,equation:n,color:i=[0,0,0,0]}=e||{};return{enable:!!t,func:{srcRGB:Il[r&&r.srcRGB||g.SRC_ALPHA],srcAlpha:Il[r&&r.srcAlpha||g.SRC_ALPHA],dstRGB:Il[r&&r.dstRGB||g.ONE_MINUS_SRC_ALPHA],dstAlpha:Il[r&&r.dstAlpha||g.ONE_MINUS_SRC_ALPHA]},equation:{rgb:PE[n&&n.rgb||g.FUNC_ADD],alpha:PE[n&&n.alpha||g.FUNC_ADD]},color:i}}getStencilDrawParams({stencil:e}){const{enable:t,mask:r=-1,func:n={cmp:g.ALWAYS,ref:0,mask:-1},opFront:i={fail:g.KEEP,zfail:g.KEEP,zpass:g.KEEP},opBack:o={fail:g.KEEP,zfail:g.KEEP,zpass:g.KEEP}}=e||{};return{enable:!!t,mask:r,func:Gk(Fs({},n),{cmp:wk[n.cmp]}),opFront:{fail:la[i.fail],zfail:la[i.zfail],zpass:la[i.zpass]},opBack:{fail:la[o.fail],zfail:la[o.zfail],zpass:la[o.zpass]}}}getColorMaskDrawParams({stencil:e},t){return(e==null?void 0:e.enable)&&e.opFront&&!t?[!1,!1,!1,!1]:[!0,!0,!0,!0]}initCullDrawParams({cull:e},t){if(e){const{enable:r,face:n=g.BACK}=e;t.cull={enable:!!r,face:Lk[n]}}}extractUniforms(e){const t={};return Object.keys(e).forEach(r=>{this.extractUniformsRecursively(r,e[r],t,"")}),t}extractUniformsRecursively(e,t,r,n){if(t===null||typeof t=="number"||typeof t=="boolean"||Array.isArray(t)&&typeof t[0]=="number"||Yk(t)||t===""||"resize"in t){r[`${n&&n+"."}${e}`]=t;return}$k(t)&&Object.keys(t).forEach(i=>{this.extractUniformsRecursively(i,t[i],r,`${n&&n+"."}${e}`)}),Array.isArray(t)&&t.forEach((i,o)=>{Object.keys(i).forEach(a=>{this.extractUniformsRecursively(a,i[a],r,`${n&&n+"."}${e}[${o}]`)})})}},qk=class{constructor(e,t){this.isDestroy=!1;const{data:r,type:n=g.UNSIGNED_BYTE,width:i,height:o,flipY:a=!1,format:s=g.RGBA,mipmap:u=!1,wrapS:l=g.CLAMP_TO_EDGE,wrapT:f=g.CLAMP_TO_EDGE,aniso:c=0,alignment:h=1,premultiplyAlpha:d=!1,mag:p=g.NEAREST,min:v=g.NEAREST,colorSpace:m=g.BROWSER_DEFAULT_WEBGL,x:y=0,y:A=0,copy:T=!1}=t;this.width=i,this.height=o;const R={width:i,height:o,type:Rp[n],format:Nk[s],wrapS:OE[l],wrapT:OE[f],mag:IE[p],min:IE[v],alignment:h,flipY:a,colorSpace:Dk[m],premultiplyAlpha:d,aniso:c,x:y,y:A,copy:T};r&&(R.data=r),typeof u=="number"?R.mipmap=Fk[u]:typeof u=="boolean"&&(R.mipmap=u),this.texture=e.texture(R)}get(){return this.texture}update(e={}){this.texture(e)}bind(){this.texture._texture.bind()}resize({width:e,height:t}){this.texture.resize(e,t),this.width=e,this.height=t}getSize(){return[this.width,this.height]}destroy(){var e;this.isDestroy||(e=this.texture)==null||e.destroy(),this.isDestroy=!0}},Oh=(e,t,r)=>new Promise((n,i)=>{var o=u=>{try{s(r.next(u))}catch(l){i(l)}},a=u=>{try{s(r.throw(u))}catch(l){i(l)}},s=u=>u.done?n(u.value):Promise.resolve(u.value).then(o,a);s((r=r.apply(e,t)).next())}),Kk=class{constructor(){this.uniformBuffers=[],this.queryVerdorInfo=()=>"WebGL1",this.createModel=e=>new Zk(this.gl,e),this.createAttribute=e=>new Ok(this.gl,e),this.createBuffer=e=>new Uk(this.gl,e),this.createElements=e=>new kk(this.gl,e),this.createTexture2D=e=>new qk(this.gl,e),this.createFramebuffer=e=>new zk(this.gl,e),this.useFramebuffer=(e,t)=>{this.gl({framebuffer:e?e.get():null})(t)},this.useFramebufferAsync=(e,t)=>Oh(this,null,function*(){this.gl({framebuffer:e?e.get():null})(t)}),this.clear=e=>{var t;const{color:r,depth:n,stencil:i,framebuffer:o=null}=e,a={color:r,depth:n,stencil:i};a.framebuffer=o===null?o:o.get(),(t=this.gl)==null||t.clear(a)},this.viewport=({x:e,y:t,width:r,height:n})=>{this.gl._gl.viewport(e,t,r,n),this.width=r,this.height=n,this.gl._refresh()},this.readPixels=e=>{const{framebuffer:t,x:r,y:n,width:i,height:o}=e,a={x:r,y:n,width:i,height:o};return t&&(a.framebuffer=t.get()),this.gl.read(a)},this.readPixelsAsync=e=>Oh(this,null,function*(){return this.readPixels(e)}),this.getViewportSize=()=>({width:this.gl._gl.drawingBufferWidth,height:this.gl._gl.drawingBufferHeight}),this.getContainer=()=>{var e;return(e=this.canvas)==null?void 0:e.parentElement},this.getCanvas=()=>this.canvas,this.getGLContext=()=>this.gl._gl,this.destroy=()=>{var e,t,r;this.canvas=null,(r=(t=(e=this.gl)==null?void 0:e._gl)==null?void 0:t.getExtension("WEBGL_lose_context"))==null||r.loseContext(),this.gl.destroy(),this.gl=null}}init(e,t,r){return Oh(this,null,function*(){this.canvas=e,r?this.gl=r:this.gl=yield new Promise((n,i)=>{Ik({canvas:this.canvas,attributes:{alpha:!0,antialias:t.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,stencil:t.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:(o,a)=>{(o||!a)&&i(o),n(a)}})}),this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")}})}getPointSizeRange(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}testExtension(e){return!!this.getGLContext().getExtension(e)}setState(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}setBaseState(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}setCustomLayerDefaults(){const e=this.getGLContext();e.disable(e.CULL_FACE)}setDirty(e){this.isDirty=e}getDirty(){return this.isDirty}beginFrame(){}endFrame(){}},Ph=["selectstart","selecting","selectend"],Qk=class extends vn.exports.EventEmitter{constructor(e,t={}){super(),this.isEnable=!1,this.onDragStart=r=>{this.box.style.display="block",this.startEvent=this.endEvent=r,this.syncBoxBound(),this.emit("selectstart",this.getLngLatBox(),this.startEvent,this.endEvent)},this.onDragging=r=>{this.endEvent=r,this.syncBoxBound(),this.emit("selecting",this.getLngLatBox(),this.startEvent,this.endEvent)},this.onDragEnd=r=>{this.endEvent=r,this.box.style.display="none",this.emit("selectend",this.getLngLatBox(),this.startEvent,this.endEvent)},this.scene=e,this.options=t}get container(){return this.scene.getMapService().getMarkerContainer()}enable(){if(this.isEnable)return;const{className:e}=this.options;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){const t=pn("div",void 0,this.container);t.classList.add("l7-select-box"),e&&t.classList.add(e),t.style.display="none",this.box=t}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}disable(){!this.isEnable||(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}syncBoxBound(){const{x:e,y:t}=this.startEvent,{x:r,y:n}=this.endEvent,i=Math.min(e,r),o=Math.min(t,n),a=Math.abs(e-r),s=Math.abs(t-n);this.box.style.top=`${o}px`,this.box.style.left=`${i}px`,this.box.style.width=`${a}px`,this.box.style.height=`${s}px`}getLngLatBox(){const{lngLat:{lng:e,lat:t}}=this.startEvent,{lngLat:{lng:r,lat:n}}=this.endEvent;return wb([[e,t],[r,n]])}},Jk=Object.defineProperty,e9=Object.defineProperties,t9=Object.getOwnPropertyDescriptors,DE=Object.getOwnPropertySymbols,r9=Object.prototype.hasOwnProperty,n9=Object.prototype.propertyIsEnumerable,BE=(e,t,r)=>t in e?Jk(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,i9=(e,t)=>{for(var r in t||(t={}))r9.call(t,r)&&BE(e,r,t[r]);if(DE)for(var r of DE(t))n9.call(t,r)&&BE(e,r,t[r]);return e},o9=(e,t)=>e9(e,t9(t)),Ds=(e,t,r)=>new Promise((n,i)=>{var o=u=>{try{s(r.next(u))}catch(l){i(l)}},a=u=>{try{s(r.throw(u))}catch(l){i(l)}},s=u=>u.done?n(u.value):Promise.resolve(u.value).then(o,a);s((r=r.apply(e,t)).next())}),a9=class{constructor(e){const{id:t,map:r,canvas:n,renderer:i="regl"}=e,o=gN();this.container=o,r.setContainer(o,t,n),i==="regl"?o.rendererService=new Kk:o.rendererService=new Mk,this.sceneService=o.sceneService,this.mapService=o.mapService,this.iconService=o.iconService,this.fontService=o.fontService,this.controlService=o.controlService,this.layerService=o.layerService,this.debugService=o.debugService,this.debugService.setEnable(e.debug),this.markerService=o.markerService,this.interactionService=o.interactionService,this.popupService=o.popupService,this.boxSelect=new Qk(this,{}),this.initComponent(t),this.sceneService.init(e),this.initControl()}get map(){return this.mapService.map}get loaded(){return this.sceneService.loaded}getServiceContainer(){return this.container}getSize(){return this.mapService.getSize()}getMinZoom(){return this.mapService.getMinZoom()}getMaxZoom(){return this.mapService.getMaxZoom()}getType(){return this.mapService.getType()}getMapContainer(){return this.mapService.getMapContainer()}getMapCanvasContainer(){return this.mapService.getMapCanvasContainer()}getMapService(){return this.mapService}getDebugService(){return this.debugService}exportPng(e){return Ds(this,null,function*(){return this.sceneService.exportPng(e)})}exportMap(e){return Ds(this,null,function*(){return this.sceneService.exportPng(e)})}registerRenderService(e){this.sceneService.loaded?new e(this).init():this.on("loaded",()=>{new e(this).init()})}setBgColor(e){this.mapService.setBgColor(e)}addLayer(e){this.loaded?this.preAddLayer(e):this.once("loaded",()=>{this.preAddLayer(e)})}preAddLayer(e){const t=Zs(this.container);if(e.setContainer(t),this.sceneService.addLayer(e),e.inited){this.initTileLayer(e);const r=this.initMask(e);this.addMask(r,e.id)}else e.on("inited",()=>{this.initTileLayer(e);const r=this.initMask(e);this.addMask(r,e.id)})}initMask(e){const{mask:t,maskfence:r,maskColor:n="#000",maskOpacity:i=0}=e.getLayerConfig();return!t||!r?void 0:new yA().source(r).shape("fill").style({color:n,opacity:i})}addMask(e,t){if(!e)return;const r=this.getLayer(t);if(r){const n=Zs(this.container);e.setContainer(n),r.addMaskLayer(e),this.sceneService.addMask(e)}else console.warn("parent layer not find!")}getPickedLayer(){return this.layerService.pickedLayerId}getLayers(){return this.layerService.getLayers()}getLayer(e){return this.layerService.getLayer(e)}getLayerByName(e){return this.layerService.getLayerByName(e)}removeLayer(e,t){return Ds(this,null,function*(){yield this.layerService.remove(e,t)})}removeAllLayer(){return Ds(this,null,function*(){yield this.layerService.removeAllLayers()})}render(){this.sceneService.render()}setEnableRender(e){this.layerService.setEnableRender(e)}addIconFont(e,t){this.fontService.addIconFont(e,t)}addIconFonts(e){e.forEach(([t,r])=>{this.fontService.addIconFont(t,r)})}addFontFace(e,t){this.fontService.once("fontloaded",r=>{this.emit("fontloaded",r)}),this.fontService.addFontFace(e,t)}addImage(e,t){return Ds(this,null,function*(){yield this.iconService.addImage(e,t)})}hasImage(e){return this.iconService.hasImage(e)}removeImage(e){this.iconService.removeImage(e)}addIconFontGlyphs(e,t){this.fontService.addIconGlyphs(t)}addControl(e){this.controlService.addControl(e,this.container)}removeControl(e){this.controlService.removeControl(e)}getControlByName(e){return this.controlService.getControlByName(e)}addMarker(e){this.markerService.addMarker(e)}addMarkerLayer(e){this.markerService.addMarkerLayer(e)}removeMarkerLayer(e){this.markerService.removeMarkerLayer(e)}removeAllMarkers(){this.markerService.removeAllMarkers()}removeAllMakers(){console.warn("removeAllMakers \u5DF2\u5E9F\u5F03\uFF0C\u8BF7\u4F7F\u7528 removeAllMarkers"),this.markerService.removeAllMarkers()}addPopup(e){this.popupService.addPopup(e)}removePopup(e){this.popupService.removePopup(e)}on(e,t){var r;Ph.includes(e)?(r=this.boxSelect)==null||r.on(e,t):pl.includes(e)?this.sceneService.on(e,t):this.mapService.on(e,t)}once(e,t){var r;Ph.includes(e)?(r=this.boxSelect)==null||r.once(e,t):pl.includes(e)?this.sceneService.once(e,t):this.mapService.once(e,t)}emit(e,t){pl.indexOf(e)===-1?this.mapService.on(e,t):this.sceneService.emit(e,t)}off(e,t){var r;Ph.includes(e)?(r=this.boxSelect)==null||r.off(e,t):pl.includes(e)?this.sceneService.off(e,t):this.mapService.off(e,t)}getZoom(){return this.mapService.getZoom()}getCenter(e){return this.mapService.getCenter(e)}setCenter(e,t){return this.mapService.setCenter(e,t)}getPitch(){return this.mapService.getPitch()}setPitch(e){return this.mapService.setPitch(e)}getRotation(){return this.mapService.getRotation()}getBounds(){return this.mapService.getBounds()}setRotation(e){this.mapService.setRotation(e)}zoomIn(){this.mapService.zoomIn()}zoomOut(){this.mapService.zoomOut()}panTo(e){this.mapService.panTo(e)}panBy(e,t){this.mapService.panBy(e,t)}getContainer(){return this.mapService.getContainer()}setZoom(e){this.mapService.setZoom(e)}fitBounds(e,t){const{fitBoundsOptions:r,animate:n}=this.sceneService.getSceneConfig();this.mapService.fitBounds(e,t||o9(i9({},r),{animate:n}))}setZoomAndCenter(e,t){this.mapService.setZoomAndCenter(e,t)}setMapStyle(e){this.mapService.setMapStyle(e)}setMapStatus(e){this.mapService.setMapStatus(e)}pixelToLngLat(e){return this.mapService.pixelToLngLat(e)}lngLatToPixel(e){return this.mapService.lngLatToPixel(e)}containerToLngLat(e){return this.mapService.containerToLngLat(e)}lngLatToContainer(e){return this.mapService.lngLatToContainer(e)}destroy(){this.sceneService.destroy()}registerPostProcessingPass(e){this.container.postProcessingPass.name=new e}enableShaderPick(){this.layerService.enableShaderPick()}diasbleShaderPick(){this.layerService.disableShaderPick()}enableBoxSelect(e=!0){this.boxSelect.enable(),e&&this.boxSelect.once("selectend",()=>{this.disableBoxSelect()})}disableBoxSelect(){this.boxSelect.disable()}static addProtocol(e,t){Ol.REGISTERED_PROTOCOLS[e]=t}static removeProtocol(e){delete Ol.REGISTERED_PROTOCOLS[e]}getProtocol(e){return Ol.REGISTERED_PROTOCOLS[e]}startAnimate(){this.layerService.startAnimate()}stopAnimate(){this.layerService.stopAnimate()}getPointSizeRange(){return this.sceneService.getPointSizeRange()}initComponent(e){this.controlService.init({container:gb(e)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}initControl(){const{logoVisible:e,logoPosition:t}=this.sceneService.getSceneConfig();e&&this.addControl(new fD({position:t}))}initTileLayer(e){e.getSource().isTile&&(e.tileLayer=new S7(e))}};const l9={__name:"globalMapWithNode",setup(e){const t=Fx(null),r=[{node:"xx1",region:"cn-beijing",provider:"aws",Latitude:28.391139,Longitude:-80.588343,target:[{node:"xx2",provider:"aliyun",region:"cn-shanghai",Latitude:27.931944,Longitude:-15.386667,packageLossRate:5}]},{node:"xx2",region:"cn-shanghai",Latitude:27.931944,Longitude:-15.386667,provider:"aliyun",target:[{node:"xx1",provider:"aws",region:"cn-beijing",Latitude:28.391139,Longitude:-80.588343,packageLossRate:0}]}];function n(i){return i>=10?"#FF0000":i>0&&i<10?"#FFA500":"#008000"}return Dx(()=>{const i=new a9({id:t.value,map:new q7({pitch:0,style:"dark",center:[120.19382669582967,30.258134],zoom:-1,projection:"equirectangular"}),viewMode:"3d",enableScroll:!1});i.on("loaded",()=>{const o=new gp().source(r.flatMap(s=>s.target.map(u=>({coord:[u.Longitude,u.Latitude],color:n(u.packageLossRate)}))),{parser:{type:"json",coordinates:"coord"}}).color("color").size(2).linecap("round").linejoin("miter").dasharray([5,10]).style({opacity:.6});i.addLayer(o);const a=new fc().source(r.map(s=>({name:s.node,provider:s.provider,coordinate:[s.Longitude,s.Latitude]}))).size(5).shape("circle").style({opacity:.8});i.addLayer(a),a.on("click",s=>{const u=s.data;console.log(u)}),o.on("click",s=>{const u=s.data;console.log(u)})})}),(i,o)=>(Lx(),Bx("div",{style:{height:"800px"},ref_key:"mapContainer",ref:t},null,512))}};export{l9 as default};
