import{b as reactive,r as ref,w as watch,aa as onMounted,n as nextTick,o as openBlock,k as createElementBlock,az as withKeys,aA as withModifiers,ax as toRaw}from"./antdv.415263d7.js";import{m as markdownCommand}from"./NotionView.7fbebf1e.js";import{_ as _export_sfc}from"./_plugin-vue_export-helper.cdc0426e.js";import"./index.d0653a71.js";const ContenteditableItem_vue_vue_type_style_index_0_scoped_bbb91e27_lang="",_hoisted_1=["onKeydown","contenteditable"],_sfc_main={__name:"ContenteditableItem",props:{config:Object,configItem:{type:Object,default:()=>({type:"p",html:""})},order:Number,readOnly:{type:Boolean,default:!1},focusOrder:Number},emits:["removeConfigItem","addConfigItem","setFocusOrder","updateConfigItem","updateMarkerPosition"],setup(__props,{emit:__emit}){const props=__props,state=reactive({value:"",isActive:!1}),editItem=ref(null);watch(()=>props.focusOrder,autofocusHandler);const emit=__emit;onMounted(()=>{editItem.value.innerHTML=props.configItem.html}),nextTick(()=>{autofocusHandler(props.focusOrder)});function autofocusHandler(e){e===props.order&&setAnchorPosition(editItem.value)}function mouseDownHandler(){}function mouseUpHandler(e){const o=document.getSelection().toString().length,t={x:0,y:0};if(o===0){emit("updateMarkerPosition",t);return}const n=o/2;t.x=n,t.y=e.y,emit("updateMarkerPosition",t)}function setAnchorPosition(e){e.focus();var o=document.createRange();o.selectNodeContents(e),o.collapse(!1);var t=window.getSelection();t.anchorOffset==0&&(t.removeAllRanges(),t.addRange(o))}function changeSpace(){console.log("space",state.value)}function inputText(){state.value=editItem.value.innerHTML}function hasCommand(e){return e.type!=="p"}function changeEnter(){let config=markdownCommand.default,html=editItem.value.innerHTML;if(Object.keys(markdownCommand).map(command=>{if(state.value.startsWith(command)){config=markdownCommand[command];const reg=eval("/"+command+"/gi");html=html.replace(reg,"")}}),config.html=html,hasCommand(config)){emit("updateConfigItem",{order:props.order,config}),emit("setFocusOrder",props.order);return}state.value="",config.html="",emit("addConfigItem",{order:props.order,config:toRaw(config)}),emit("setFocusOrder",props.order+1)}return(e,o)=>(openBlock(),createElementBlock("div",{onKeydown:[withKeys(withModifiers(changeEnter,["prevent"]),["enter"]),withKeys(changeSpace,["enter","space"])],onMousedown:mouseDownHandler,onMouseup:mouseUpHandler,onInput:inputText,ref_key:"editItem",ref:editItem,class:"editItem p",contenteditable:!__props.readOnly},null,40,_hoisted_1))}},ContenteditableItem=_export_sfc(_sfc_main,[["__scopeId","data-v-bbb91e27"]]);export{ContenteditableItem as default};
